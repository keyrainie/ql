<?xml version="1.0" encoding="utf-8" ?>
<dataOperations xmlns="http://oversea.newegg.com/DataOperation"
				xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  <dataCommand name="CheckOnlinelistItemByPageType" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[			  
SELECT  
    A.[SysNo] 
   ,A.[OnlineListlocationSysNo] 
   ,p.ProductSysNo  
   ,A.[ProductID] 
   ,B.[PageType] 
   ,B.[PositionID] 
   ,B.[PageID] 
   ,B.[Description] 
   ,p.BrandSysNo 
   ,C3.[C1Sysno]   C1SysNo 
   ,C3.[C2Sysno]   C2SysNo 
   ,C3.[C3Sysno]   C3SysNo                                             
   ,p.ProductGroupSysNo                                                  
FROM OverseaECommerceManagement.[dbo].[OnlineList] A WITH(NOLOCK) 
LEFT JOIN OverseaECommerceManagement.[dbo].[OnlineListlocation] B WITH(NOLOCK) 
    ON (A.OnlineListlocationSysNo=B.OnlineListlocationSysNo 
    AND B.CompanyCode=A.CompanyCode) 
INNER JOIN OverseaContentManagement.dbo.V_CM_AllProductInfo  AS p WITH(NOLOCK) 
    ON (A.ProductID=p.ProductID 
    AND p.CompanyCode=A.CompanyCode) 
INNER JOIN OverseaECommerceManagement.dbo.EC_CategoryProductMapping ecpm WITH(NOLOCK) 
	ON ecpm.ProductSysNo = p.ProductSysNo 
LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Inventory AS Inventory WITH(NOLOCK) 
    ON p.[ProductSysNo] = Inventory.ItemSysNumber  
    AND Inventory.CompanyCode=A.CompanyCode 
LEFT JOIN OverseaECommerceManagement.dbo.V_EM_EC_Category C3 WITH(NOLOCK) 
    ON  C3.C3SysNo=ECPM.ECCategorySysNo 
    AND C3.CompanyCode=A.CompanyCode 
WHERE  
    (A.EndDate>= GETDATE() OR A.EndDate IS NULL) 
    AND A.[InUser]<>'System' 
    AND A.EndDate> GETDATE() 
    AND B.[PageType]=@PageType
    AND A.[Status]='A'  
    AND B.[Status]='A' 
    AND p.Status=1 
    AND c3.[C1Status]='A'
    AND c3.[C2Status]='A'
    AND c3.[C3Status]='A'
    AND (Inventory.[OnlineQty]>0  OR Inventory.[ShiftQty]>0 )   
    AND A.CompanyCode=@CompanyCode 
ORDER BY A.Priority
        ]]>
    </commandText>
    <parameters>
      <param name="@PageType" dbType="Int32"/>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetOnlinelistItemByPageType" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[			  
  SELECT
  A.[SysNo]
  ,A.[OnlineListlocationSysNo]
  ,IC.[ProductSysNo]
  ,IC.ProductGroupSysNo
  ,A.[ProductID]
  ,B.[PageType]
  ,B.[PositionID]
  ,B.[PageID]
  ,B.[Description]
  ,ISNULL(m.sysno,0)    BrandSysNo  
  FROM OverseaECommerceManagement.[dbo].[OnlineList] A WITH(NOLOCK)
  LEFT JOIN OverseaECommerceManagement.[dbo].[OnlineListlocation] B WITH(NOLOCK)
  ON (A.OnlineListlocationSysNo=B.OnlineListlocationSysNo
  AND B.CompanyCode=A.CompanyCode)
  INNER JOIN OverseaContentManagement.dbo.V_CM_AllProductInfo AS IC WITH(NOLOCK)
  ON (A.ProductID=IC.ProductID
  AND IC.CompanyCode=A.CompanyCode)
  LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Inventory AS Inventory WITH(NOLOCK)
  ON IC.[ProductSysNo] = Inventory.ItemSysNumber
  AND Inventory.CompanyCode=A.CompanyCode
  LEFT JOIN overseacontentmanagement.dbo.Brand m  WITH (NOLOCK)
  ON  IC.BrandSysNo=m.sysno
  AND m.CompanyCode=A.CompanyCode
  WHERE
  A.[InDate]>DATEADD(DAY,-30,GETDATE())
  AND A.[InUser]<>'System'
  AND A.EndDate> GETDATE()
  AND B.[PageType]=@PageType
  AND A.[Status]='A'
  AND B.[Status]='A'
  AND IC.Status=1
  AND (Inventory.[OnlineQty]>0  OR Inventory.[ShiftQty]>0 )
  AND A.CompanyCode=@CompanyCode
ORDER BY A.Priority
        ]]>
    </commandText>
    <parameters>
      <param name="@PageType" dbType="Int32"/>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength"/>
    </parameters>
  </dataCommand>


  <dataCommand name="InsertOnlineList" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[			
			INSERT INTO [OverseaECommerceManagement].[dbo].[OnlineList]
					   ([OnlineListlocationSysNo]
					   ,[ProductID]
					   ,[Priority]
					   ,[BeginDate]
					   ,[EndDate]
					   ,[InDate]
					   ,[InUser]
					   ,[EditDate]
					   ,[EditUser]
					   ,[Status]
					   ,[CompanyCode]
					   ,[LanguageCode]
					   ,[StoreCompanyCode])
				 VALUES
					   (@OnlineListlocationSysNo
					   ,@ProductID
					   ,@Priority
					   ,@BeginDate
					   ,@EndDate
					   ,@InDate
					   ,@InUser
					   ,@EditDate
					   ,@EditUser
					   ,@Status
					   ,@CompanyCode
					   ,@LanguageCode
					   ,@StoreCompanyCode)
				SELECT @SysNo=SCOPE_IDENTITY()
			  ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32"  direction="Output"/>
      <param name="@OnlineListlocationSysNo" dbType="Int32"/>
      <param name="@ProductID" dbType="String"/>
      <param name="@Priority" dbType="Int32"/>
      <param name="@BeginDate" dbType="DateTime"/>
      <param name="@EndDate" dbType="DateTime"/>
      <param name="@InDate" dbType="DateTime"/>
      <param name="@InUser" dbType="String"/>
      <param name="@EditDate" dbType="DateTime"/>
      <param name="@EditUser" dbType="String"/>
      <param name="@Status" dbType="String"/>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@LanguageCode" dbType="String"/>
      <param name="@StoreCompanyCode" dbType="String"/>
    </parameters>
  </dataCommand>

  <dataCommand name="InsertOnlineListlocation" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[			
			INSERT INTO [OverseaECommerceManagement].[dbo].[OnlineListlocation]
						([PageType]
						,[PositionID]
						,[Priority]
						,[PageID]
						,[Description]
						,[InDate]
						,[InUser]
						,[EditDate]
						,[EditUser]
						,[Status]
						,[CompanyCode]
						,[LanguageCode]
						,[StoreCompanyCode])
				VALUES
						(@PageType
						,@PositionID
						,@Priority
						,@PageID
						,@Description
						,@InDate
						,@InUser
						,@EditDate
						,@EditUser
						,@Status
						,@CompanyCode
						,@LanguageCode
						,@StoreCompanyCode)
	
				SELECT @OnlineListlocationSysNo=SCOPE_IDENTITY()
			  ]]>
    </commandText>
    <parameters>
      <param name="@OnlineListlocationSysNo" dbType="Int32"  direction="Output"/>
      <param name="@PageType" dbType="Int32"/>
      <param name="@PositionID" dbType="Int32"/>
      <param name="@Priority" dbType="Int32"/>
      <param name="@PageID" dbType="Int32"/>
      <param name="@Description" dbType="String"/>
      <param name="@InDate" dbType="DateTime"/>
      <param name="@InUser" dbType="String"/>
      <param name="@EditDate" dbType="DateTime"/>
      <param name="@EditUser" dbType="String"/>
      <param name="@Status" dbType="String"/>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@LanguageCode" dbType="String"/>
      <param name="@StoreCompanyCode" dbType="String"/>
    </parameters>
  </dataCommand>

  <dataCommand name="DeleteOnlineListSystem" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[	
			UPDATE  OverseaECommerceManagement.dbo.OnlineList				
			SET  [Status] ='D'
				,[EditDate] = getdate()
				,[EditUser] = 'System'			
			WHERE InUser='System'	
				AND 	OnlineListlocationSysNo IN (
										SELECT  [OnlineListlocationSysNo]   
										 FROM [OverseaECommerceManagement].[dbo].[OnlineListlocation] WITH(NOLOCK)
										WHERE  [Status]='A'  
										AND  [CompanyCode]='@CompanyCode'
										AND   [PageType]=@PageType
										AND   [PositionID]=@PositionID
                    AND PageID=@PageID                  
										)			  
           AND [Status]='A'
           AND DeleteMark='Y'
			     AND CompanyCode='@CompanyCode'
			]]>
    </commandText>
  </dataCommand>

  <dataCommand name="UpdateInvalidData" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[	
			UPDATE  OverseaECommerceManagement.dbo.OnlineList				
			SET  DeleteMark='Y'
			WHERE InUser='System'	
				AND 	OnlineListlocationSysNo IN (
										SELECT  [OnlineListlocationSysNo]   
										 FROM [OverseaECommerceManagement].[dbo].[OnlineListlocation] WITH(NOLOCK)
										WHERE  [Status]='A'  
										AND  [CompanyCode]='@CompanyCode'
										AND   [PageType]=@PageType
										AND   [PositionID]=@PositionID
                    AND PageID=@PageID                  
										)			  
           AND [Status]='A'         
			     AND CompanyCode='@CompanyCode'
			]]>
    </commandText>
  </dataCommand>


  <dataCommand name="GetAllBrand" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[
	SELECT distinct SysNo  BrandSysno  	       
	FROM overseacontentmanagement.dbo.Brand WITH(NOLOCK)
	WHERE [Status]='A'  AND CompanyCode=@CompanyCode
  AND [Type]>0
			]]>
    </commandText>
    <parameters>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
    </parameters>
  </dataCommand>

  <dataCommand name="CheckOnlineListLocation" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[			
			SELECT OnlineListlocationSysNo  
			FROM [OverseaECommerceManagement].[dbo].[OnlineListlocation] WITH(NOLOCK)
			WHERE  [PageType]=@PageType  
					AND  [PositionID]=@PositionID
					AND  [PageID]=@PageID	
					AND  [status]='A'		
					AND CompanyCode=@CompanyCode
			]]>
    </commandText>
    <parameters>
      <param name="@PageType" dbType="Int32"/>
      <param name="@PageID" dbType="Int32"/>
      <param name="@PositionID" dbType="Int32"/>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetAllC1SysNolist" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[
SELECT 
     distinct [C1SysNo] 
  FROM [OverseaECommerceManagement].[dbo].[V_EM_EC_Category] WITH(NOLOCK)
WHERE [CompanyCode]=@CompanyCode
AND [C1Status]='A'
AND [C2Status]='A'
AND [C3Status]='A'

			]]>
    </commandText>
    <parameters>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetAllC2SysNolist" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[
SELECT 
     distinct [C2SysNo] 
  FROM [OverseaECommerceManagement].[dbo].[V_EM_EC_Category] WITH(NOLOCK)
WHERE [CompanyCode]=@CompanyCode
AND [C1Status]='A'
AND [C2Status]='A'
AND [C3Status]='A'
			]]>
    </commandText>
    <parameters>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetAllC3SysNolist" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[		
SELECT  distinct [C3SysNo] 
  FROM [OverseaECommerceManagement].[dbo].[V_EM_EC_Category] WITH(NOLOCK)
WHERE [CompanyCode]=@CompanyCode
AND [C1Status]='A'
AND [C2Status]='A'
AND [C3Status]='A'
			]]>
    </commandText>
    <parameters>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetPriceDownItemForBrand" database="OverseaECommerceManagement" commandType="StoredProcedure">
    <commandText>
      <![CDATA[			
      DECLARE @tb_HasItemSysnolist TABLE
( 
     sysno int 
 );

INSERT INTO @tb_HasItemSysnolist 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@HasItemSysnolist,',')

DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')

SELECT  TOP (@Num)
    ProductSysNo 
   ,ProductID 
   ,ProductGroupSysNo   
 FROM (SELECT 
    ProductSysNo 
   ,ProductID 
    ,ProductGroupSysNo
    ,TotalAdjustPrice
FROM  OverseaECommerceManagement.dbo.V_EM_PriceDownItem  WITH(NOLOCK) 
WHERE  
    Createdate >=@DateTime
    AND BrandSysNo=@BrandSysNo				 
    AND CompanyCode=@CompanyCode   
    AND BackC3SysNo<>@GiftC3SysNo 
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_HasItemSysnolist WHERE sysno = ProductSysNo)  
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo) 
) a
GROUP BY a.ProductSysNo ,a.ProductID ,a.ProductGroupSysNo,a.[TotalAdjustPrice]
Order  By a.[TotalAdjustPrice]
      ]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@DateTime" dbType="DateTime"/>
      <param name="@BrandSysNo" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@HasItemSysnolist" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetPriceDownItemForBrandNoHistory" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[		
  DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')

SELECT  TOP (@Num)
    ProductSysNo 
   ,ProductID 
   ,ProductGroupSysNo
FROM (SELECT 
    ProductSysNo 
   ,ProductID 
   ,ProductGroupSysNo 
   ,TotalAdjustPrice
FROM  OverseaECommerceManagement.dbo.V_EM_PriceDownItem  WITH(NOLOCK) 
WHERE  
    Createdate >=@DateTime
    AND BrandSysNo=@BrandSysNo				 
    AND CompanyCode=@CompanyCode   
    AND BackC3SysNo<>@GiftC3SysNo 
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo)  
) a
GROUP BY a.ProductSysNo ,a.ProductID ,a.ProductGroupSysNo,a.[TotalAdjustPrice]
Order  By a.[TotalAdjustPrice]
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@BrandSysNo" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@DateTime" dbType="DateTime"/>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetPriceDownItem" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[		
DECLARE @tb_HasItemSysnolist TABLE
( 
     sysno int 
 );

INSERT INTO @tb_HasItemSysnolist 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@HasItemSysnolist,',')

DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')

SELECT TOP (@Num)
       [ProductSysNo]
      ,[ProductID] 
      ,ProductGroupSysNo   
FROM (SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,TotalAdjustPrice
  FROM [OverseaECommerceManagement].[dbo].[V_EM_PriceDownItem_v1] WITH(NOLOCK)
WHERE CreateDate>= @DateTime
   AND C1SysNo=@CategorySysNo 
   AND C3SysNo<>@GiftC3SysNo
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_HasItemSysnolist WHERE sysno = ProductSysNo)   
   AND CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,TotalAdjustPrice
  FROM [OverseaECommerceManagement].[dbo].[V_EM_PriceDownItem_v1] WITH(NOLOCK)
  WHERE CreateDate>= @DateTime
   AND C2SysNo=@CategorySysNo 
   AND C3SysNo<>@GiftC3SysNo
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_HasItemSysnolist WHERE sysno = ProductSysNo)   
   AND CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,TotalAdjustPrice
  FROM [OverseaECommerceManagement].[dbo].[V_EM_PriceDownItem_v1] WITH(NOLOCK)
  WHERE CreateDate>= @DateTime
   AND C3SysNo=@CategorySysNo 
   AND C3SysNo<>@GiftC3SysNo
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_HasItemSysnolist WHERE sysno = ProductSysNo)   
   AND CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo) 
) a
GROUP BY a.ProductSysNo ,a.ProductID ,a.ProductGroupSysNo,a.[TotalAdjustPrice]
Order  By a.[TotalAdjustPrice]
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@DateTime" dbType="DateTime"/>
      <param name="@CategorySysNo" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@HasItemSysnolist" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetPriceDownItemNoHistory" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[		
DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')

SELECT TOP (@Num)
       [ProductSysNo]
      ,[ProductID]  
      ,ProductGroupSysNo  
 FROM (SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
      ,TotalAdjustPrice
  FROM [OverseaECommerceManagement].[dbo].[V_EM_PriceDownItem_v1] WITH(NOLOCK)
WHERE CreateDate>= @DateTime
   AND C1SysNo=@CategorySysNo 
   AND C3SysNo<>@GiftC3SysNo  
   AND CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
      ,TotalAdjustPrice
  FROM [OverseaECommerceManagement].[dbo].[V_EM_PriceDownItem_v1] WITH(NOLOCK)
  WHERE CreateDate>= @DateTime
   AND C2SysNo=@CategorySysNo 
   AND C3SysNo<>@GiftC3SysNo  
   AND CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
      ,TotalAdjustPrice
  FROM [OverseaECommerceManagement].[dbo].[V_EM_PriceDownItem_v1] WITH(NOLOCK)
  WHERE CreateDate>= @DateTime
   AND C3SysNo=@CategorySysNo 
   AND C3SysNo<>@GiftC3SysNo  
   AND CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo) 
) a
GROUP BY a.ProductSysNo ,a.ProductID ,a.ProductGroupSysNo,a.[TotalAdjustPrice]
Order  By a.[TotalAdjustPrice]
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@DateTime" dbType="DateTime"/>
      <param name="@CategorySysNo" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetPriceDownItemForHomePageNoHistory" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[		
SELECT TOP (@Num)  
       [ProductSysNo]
      ,[ProductID]  
      ,ProductGroupSysNo    
FROM ( SELECT 
       [ProductSysNo]
      ,[ProductID]
      ,ProductGroupSysNo 
      ,TotalAdjustPrice
FROM [OverseaECommerceManagement].[dbo].[V_EM_PriceDownItem]  WITH(NOLOCK)
WHERE [C1SysNo]  IN (SELECT CAST(F1 AS INT) FROM [IPP3].[dbo].[f_splitstr](@C1List,','))   
     AND [C3SysNo] NOT IN (SELECT CAST(F1 AS INT) FROM [IPP3].[dbo].[f_splitstr](@ExceptC3List,','))      
     AND BackC3SysNo<>@GiftC3SysNo
     AND CompanyCode=@CompanyCode
     AND CreateDate>=@DateTime
 ) a
GROUP BY a.ProductSysNo ,a.ProductID ,a.ProductGroupSysNo,a.[TotalAdjustPrice]
Order  By a.[TotalAdjustPrice]
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@DateTime" dbType="DateTime"/>
      <param name="@C1List" dbType="String" />
      <param name="@ExceptC3List" dbType="String" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
    </parameters>
  </dataCommand>

  <!--为首页取商品 除去已存在商品所在的组-->
  <dataCommand name="GetPriceDownItemForHomePageNoHistoryByGroup" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[		
DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')

SELECT TOP (@Num)  
       [ProductSysNo]
      ,[ProductID]  
      ,ProductGroupSysNo       
FROM ( SELECT 
       [ProductSysNo]
      ,[ProductID]
      ,ProductGroupSysNo 
      ,TotalAdjustPrice
FROM [OverseaECommerceManagement].[dbo].[V_EM_PriceDownItem]  WITH(NOLOCK)
WHERE [C1SysNo]  IN (SELECT CAST(F1 AS INT) FROM [IPP3].[dbo].[f_splitstr](@C1List,','))   
     AND [C3SysNo] NOT IN (SELECT CAST(F1 AS INT) FROM [IPP3].[dbo].[f_splitstr](@ExceptC3List,','))      
     AND BackC3SysNo<>@GiftC3SysNo
     AND CompanyCode=@CompanyCode
     AND CreateDate>=@DateTime
     AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo)
 ) a
GROUP BY a.ProductSysNo ,a.ProductID ,a.ProductGroupSysNo,a.[TotalAdjustPrice]
Order  By a.[TotalAdjustPrice]
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@DateTime" dbType="DateTime"/>
      <param name="@C1List" dbType="String" />
      <param name="@ExceptC3List" dbType="String" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetPriceDownItemForHomePage" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[		
DECLARE @tb_HasItemSysnolist TABLE
( 
     sysno int 
 );

INSERT INTO @tb_HasItemSysnolist 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@HasItemSysnolist,',')

SELECT TOP (@Num)  
       [ProductSysNo]
      ,[ProductID]  
      ,ProductGroupSysNo      
 FROM ( SELECT 
       [ProductSysNo]
      ,[ProductID] 
      ,ProductGroupSysNo 
      ,TotalAdjustPrice
FROM [OverseaECommerceManagement].[dbo].[V_EM_PriceDownItem]  WITH(NOLOCK)
WHERE [C1SysNo]  IN (SELECT CAST(F1 AS INT) FROM [IPP3].[dbo].[f_splitstr](@C1List,','))   
     AND [C3SysNo] NOT IN (SELECT CAST(F1 AS INT) FROM [IPP3].[dbo].[f_splitstr](@ExceptC3List,','))      
     AND BackC3SysNo<>@GiftC3SysNo
     AND CompanyCode=@CompanyCode
     AND CreateDate>=@DateTime
     AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_HasItemSysnolist WHERE sysno = ProductSysNo)  
) a
GROUP BY a.ProductSysNo ,a.ProductID ,a.ProductGroupSysNo,a.[TotalAdjustPrice]
Order  By a.[TotalAdjustPrice]
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@DateTime" dbType="DateTime"/>
      <param name="@C1List" dbType="String" />
      <param name="@ExceptC3List" dbType="String" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@HasItemSysnolist" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
    </parameters>
  </dataCommand>

  <!--为首页取商品 除去已存在商品所在的组-->
  <dataCommand name="GetPriceDownItemForHomePageByGroup" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[			
DECLARE @tb_HasItemSysnolist TABLE
( 
     sysno int 
 );

INSERT INTO @tb_HasItemSysnolist 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@HasItemSysnolist,',')

DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')

SELECT TOP (@Num)  
       [ProductSysNo]
      ,[ProductID]  
      ,ProductGroupSysNo      
 FROM ( SELECT 
       [ProductSysNo]
      ,[ProductID] 
      ,ProductGroupSysNo 
      ,[TotalAdjustPrice]
FROM [OverseaECommerceManagement].[dbo].[V_EM_PriceDownItem]  WITH(NOLOCK)
WHERE [C1SysNo]  IN (SELECT CAST(F1 AS INT) FROM [IPP3].[dbo].[f_splitstr](@C1List,','))   
     AND [C3SysNo] NOT IN (SELECT CAST(F1 AS INT) FROM [IPP3].[dbo].[f_splitstr](@ExceptC3List,','))      
     AND BackC3SysNo<>@GiftC3SysNo
     AND CompanyCode=@CompanyCode
     AND CreateDate>=@DateTime
     AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_HasItemSysnolist WHERE sysno = ProductSysNo)  
     AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo) 
                 
) a
GROUP BY a.ProductSysNo ,a.ProductID ,a.ProductGroupSysNo,a.[TotalAdjustPrice]
Order  By a.[TotalAdjustPrice]
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@DateTime" dbType="DateTime"/>
      <param name="@C1List" dbType="String" />
      <param name="@ExceptC3List" dbType="String" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@HasItemSysnolist" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetSaleHightItemNoHistory" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[	
SELECT TOP (@Num) 
             [ProductSysNo] 
            ,[ProductID]  
            ,ProductGroupSysNo     
       FROM (SELECT 
       shi.[ProductSysNo]
      ,shi.[ProductID] 
       ,shi.ProductGroupSysNo 
        ,shi.W1
    FROM [OverseaECommerceManagement].[dbo].[V_EM_SaleHightItem_v1] shi WITH(NOLOCK) 
WHERE shi.C1SysNo=@CategorySysNo 
   AND shi.C3SysNo<>@GiftC3SysNo
   AND shi.CompanyCode=@CompanyCode   
UNION  
SELECT 
       shi.[ProductSysNo]
      ,shi.[ProductID] 
       ,shi.ProductGroupSysNo 
		,shi.W1
	FROM [OverseaECommerceManagement].[dbo].[V_EM_SaleHightItem_v1] shi WITH(NOLOCK) 
  WHERE shi.C2SysNo=@CategorySysNo 
   AND shi.C3SysNo<>@GiftC3SysNo 
   AND shi.CompanyCode=@CompanyCode   
UNION  
SELECT 
       shi.[ProductSysNo]
      ,shi.[ProductID] 
       ,shi.ProductGroupSysNo 
		,shi.W1
	FROM [OverseaECommerceManagement].[dbo].[V_EM_SaleHightItem_v1] shi WITH(NOLOCK) 

  WHERE shi.C3SysNo=@CategorySysNo 
   AND shi.C3SysNo<>@GiftC3SysNo 
   AND shi.CompanyCode=@CompanyCode   
) a
GROUP BY a.ProductSysNo,a.ProductID,a.ProductGroupSysNo,a.w1
     ORDER  BY  a.w1 desc
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@CategorySysNo" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
    </parameters>
  </dataCommand>

  <!--除去已存在记录的组-->
  <dataCommand name="GetSaleHightItemNoHistoryByGroup" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[	
DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')


       SELECT TOP (@Num) 
             [ProductSysNo] 
            ,[ProductID]  
            ,ProductGroupSysNo
       FROM (SELECT 
       shi.[ProductSysNo]
      ,shi.[ProductID] 
       ,shi.ProductGroupSysNo 
        ,shi.W1
    FROM [OverseaECommerceManagement].[dbo].[V_EM_SaleHightItem_v1] shi WITH(NOLOCK) 
WHERE shi.C1SysNo=@CategorySysNo 
   AND shi.C3SysNo<>@GiftC3SysNo   
   AND shi.CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE sysno =shi.ProductGroupSysNo)
UNION  
SELECT 
       shi.[ProductSysNo]
      ,shi.[ProductID] 
       ,shi.ProductGroupSysNo 
        ,shi.W1
    FROM [OverseaECommerceManagement].[dbo].[V_EM_SaleHightItem_v1] shi WITH(NOLOCK) 
  WHERE shi.C2SysNo=@CategorySysNo 
   AND shi.C3SysNo<>@GiftC3SysNo 
   AND shi.CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =shi.ProductGroupSysNo)
UNION  
SELECT 
       shi.[ProductSysNo]
      ,shi.[ProductID] 
       ,shi.ProductGroupSysNo 
        ,shi.W1
    FROM [OverseaECommerceManagement].[dbo].[V_EM_SaleHightItem_v1] shi WITH(NOLOCK) 
  WHERE shi.C3SysNo=@CategorySysNo 
   AND shi.C3SysNo<>@GiftC3SysNo  
   AND shi.CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =shi.ProductGroupSysNo) 
) a
   GROUP BY a.ProductSysNo,a.ProductID,a.ProductGroupSysNo,a.w1
   ORDER  BY  a.w1 desc
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@CategorySysNo" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetSaleHightItem" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[	 
DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_ItemSysnolist 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@ItemSysnolist,',')



        SELECT TOP (@Num) 
             [ProductSysNo] 
            ,[ProductID] 
            ,ProductGroupSysNo       
     FROM (SELECT 
       shi.[ProductSysNo]
      ,shi.[ProductID] 
       ,shi.ProductGroupSysNo 
       ,shi.W1
	FROM [OverseaECommerceManagement].[dbo].[V_EM_SaleHightItem_v1]  shi WITH(NOLOCK) 
WHERE shi.C1SysNo=@CategorySysNo 
   AND shi.C3SysNo<>@GiftC3SysNo  
   AND shi.CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_ItemSysnolist WHERE sysno =shi.ProductSysNo)
UNION  
SELECT 
       shi.[ProductSysNo]
      ,shi.[ProductID] 
       ,shi.ProductGroupSysNo 
       ,shi.W1
	FROM [OverseaECommerceManagement].[dbo].[V_EM_SaleHightItem_v1]  shi WITH(NOLOCK) 
  WHERE shi.C2SysNo=@CategorySysNo 
   AND BackC3SysNo<>@GiftC3SysNo 
   AND shi.CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_ItemSysnolist WHERE  sysno =shi.ProductSysNo)
UNION  
SELECT 
       shi.[ProductSysNo]
      ,shi.[ProductID] 
       ,shi.ProductGroupSysNo 
       ,shi.W1
	FROM [OverseaECommerceManagement].[dbo].[V_EM_SaleHightItem_v1]  shi WITH(NOLOCK) 
  WHERE shi.C3SysNo=@CategorySysNo 
   AND shi.C3SysNo<>@GiftC3SysNo 
   AND shi.CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_ItemSysnolist WHERE  sysno =shi.ProductSysNo) 
) a
GROUP BY a.ProductSysNo,a.ProductID,a.ProductGroupSysNo,a.w1
     ORDER  BY  a.w1 desc
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@ItemSysnolist" dbType="String" />
      <param name="@CategorySysNo" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetSaleHightItemByGroup" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[	   
DECLARE @tb_ItemSysnolist TABLE
( 
     sysno int 
 );

INSERT INTO @tb_ItemSysnolist 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@ItemSysnolist,',')

DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')



        SELECT TOP (@Num) 
             [ProductSysNo] 
            ,[ProductID] 
            ,ProductGroupSysNo  
     FROM (SELECT 
       shi.[ProductSysNo]
      ,shi.[ProductID] 
       ,shi.ProductGroupSysNo 
        ,shi.W1
    FROM [OverseaECommerceManagement].[dbo].[V_EM_SaleHightItem_v1] shi WITH(NOLOCK) 
WHERE shi.C1SysNo=@CategorySysNo 
   AND shi.C3SysNo<>@GiftC3SysNo
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_ItemSysnolist WHERE sysno = shi.ProductSysNo)   
   AND shi.CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE sysno =ProductGroupSysNo)
   
UNION  
SELECT 
       shi.[ProductSysNo]
      ,shi.[ProductID] 
       ,shi.ProductGroupSysNo 
        ,shi.W1
    FROM [OverseaECommerceManagement].[dbo].[V_EM_SaleHightItem_v1]  shi WITH(NOLOCK) 
  WHERE shi.C2SysNo=@CategorySysNo 
   AND shi.C3SysNo<>@GiftC3SysNo
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_ItemSysnolist WHERE sysno = shi.ProductSysNo)   
   AND shi.CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo)
UNION  
SELECT 
       shi.[ProductSysNo]
      ,shi.[ProductID] 
       ,shi.ProductGroupSysNo 
        ,shi.W1
    FROM [OverseaECommerceManagement].[dbo].[V_EM_SaleHightItem_v1]  shi WITH(NOLOCK) 
  WHERE shi.C3SysNo=@CategorySysNo 
  AND shi.C3SysNo<>@GiftC3SysNo  
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_ItemSysnolist WHERE sysno = shi.ProductSysNo)   
   AND shi.CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo) 
) a
     GROUP BY a.ProductSysNo,a.ProductID,a.ProductGroupSysNo,a.w1
     ORDER  BY  a.w1 desc
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@ItemSysnolist" dbType="String" />
      <param name="@CategorySysNo" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetSaleHightItemForHomePage" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[	      
DECLARE @tb_ItemSysnolist TABLE
( 
     sysno int 
 );

INSERT INTO @tb_ItemSysnolist 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@ItemSysnolist,',')

      SELECT TOP (@Num) 
             [ProductSysNo] 
            ,[ProductID] 
            ,ProductGroupSysNo            
        FROM ( SELECT 
             [ProductSysNo] 
            ,[ProductID]   
            ,ProductGroupSysNo 
            ,W1
        FROM [OverseaECommerceManagement].[dbo].[V_EM_SaleHightItem]  WITH(NOLOCK) 
        WHERE [C1SysNo]  IN (SELECT CAST(F1 AS INT) FROM [IPP3].[dbo].[f_splitstr](@C1List,','))   
        AND [C3SysNo] NOT IN (SELECT CAST(F1 AS INT) FROM [IPP3].[dbo].[f_splitstr](@ExceptC3List,','))     
        AND BackC3SysNo<>@GiftC3SysNo 
        AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_ItemSysnolist WHERE sysno = ProductSysNo)   
        AND CompanyCode=@CompanyCode 
       ) a
      GROUP BY a.ProductSysNo,a.ProductID,a.ProductGroupSysNo,a.w1
     ORDER  BY a.w1 desc
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@C1List" dbType="String" />
      <param name="@ExceptC3List" dbType="String" />
      <param name="@ItemSysnolist" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetSaleHightItemForHomePageByGroup" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[	 
DECLARE @tb_ItemSysnolist TABLE
( 
     sysno int 
 );

INSERT INTO @tb_ItemSysnolist 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@ItemSysnolist,',')

DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')

      SELECT TOP (@Num) 
             [ProductSysNo] 
            ,[ProductID] 
            ,ProductGroupSysNo          
        FROM ( SELECT 
             [ProductSysNo] 
            ,[ProductID]   
            ,ProductGroupSysNo 
            ,W1
        FROM [OverseaECommerceManagement].[dbo].[V_EM_SaleHightItem]  WITH(NOLOCK) 
        WHERE [C1SysNo]  IN (SELECT CAST(F1 AS INT) FROM [IPP3].[dbo].[f_splitstr](@C1List,','))   
        AND [C3SysNo] NOT IN (SELECT CAST(F1 AS INT) FROM [IPP3].[dbo].[f_splitstr](@ExceptC3List,','))     
        AND BackC3SysNo<>@GiftC3SysNo 
        AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_ItemSysnolist WHERE sysno = ProductSysNo)   
        AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo)
        AND CompanyCode=@CompanyCode 
       ) a
      GROUP BY a.ProductSysNo,a.ProductID,a.ProductGroupSysNo,a.w1
     ORDER  BY a.w1 desc
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@C1List" dbType="String" />
      <param name="@ExceptC3List" dbType="String" />
      <param name="@ItemSysnolist" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String" />
    </parameters>
  </dataCommand>


  <dataCommand name="GetSaleHightItemForHomePageNoHistory" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[	
     SELECT TOP (@Num) 
             [ProductSysNo] 
            ,[ProductID]  
            ,ProductGroupSysNo            
        FROM ( SELECT 
             [ProductSysNo] 
            ,[ProductID]  
            ,ProductGroupSysNo 
            ,W1
    FROM [OverseaECommerceManagement].[dbo].[V_EM_SaleHightItem] WITH(NOLOCK) 
    WHERE [C1SysNo]  IN (SELECT CAST(F1 AS INT) FROM [IPP3].[dbo].[f_splitstr](@C1List,','))   
     AND [C3SysNo] NOT IN (SELECT CAST(F1 AS INT) FROM [IPP3].[dbo].[f_splitstr](@ExceptC3List,','))      
     AND BackC3SysNo<>@GiftC3SysNo
     AND CompanyCode=@CompanyCode  
       ) a
     GROUP BY a.ProductSysNo,a.ProductID,a.ProductGroupSysNo,a.w1
     ORDER  BY a.w1 desc
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@C1List" dbType="String" />
      <param name="@ExceptC3List" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetSaleHightItemForHomePageNoHistoryByGroup" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[	
DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')

     SELECT TOP (@Num) 
             [ProductSysNo] 
            ,[ProductID]  
            ,ProductGroupSysNo          
        FROM ( SELECT 
             [ProductSysNo] 
            ,[ProductID]  
            ,ProductGroupSysNo 
            ,W1
    FROM [OverseaECommerceManagement].[dbo].[V_EM_SaleHightItem] WITH(NOLOCK) 
    WHERE [C1SysNo]  IN (SELECT CAST(F1 AS INT) FROM [IPP3].[dbo].[f_splitstr](@C1List,','))   
     AND [C3SysNo] NOT IN (SELECT CAST(F1 AS INT) FROM [IPP3].[dbo].[f_splitstr](@ExceptC3List,','))      
     AND BackC3SysNo<>@GiftC3SysNo
     AND CompanyCode=@CompanyCode  
     AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo)
       ) a
      GROUP BY a.ProductSysNo,a.ProductID,a.ProductGroupSysNo,a.w1
     ORDER  BY a.w1 desc
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@C1List" dbType="String" />
      <param name="@ExceptC3List" dbType="String" />
      <param name="@GroupSysNoList" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
    </parameters>
  </dataCommand>

  <!--专卖店当季热销-->
  <dataCommand name="GetSaleHightItemForBrand" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[	
DECLARE @tb_HasItemSysnolist TABLE
( 
     sysno int 
 );

INSERT INTO @tb_HasItemSysnolist 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@HasItemSysnolist,',')

DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')

  SELECT TOP 
      (@Num) item.sysno  productsysno 
     ,item.ProductID 
     ,Isnull((item.Month1Salescount+item.Month2Salescount+item.Month3Salescount),0) M3 
     ,p.BrandSysNo 
     ,p.ProductGroupSysNo 
  FROM     overseacontentmanagement.dbo.v_cm_itemcommoninfo item WITH (NOLOCK) 
  INNER JOIN OverseaInventoryManagement.dbo.V_INM_Inventory  inventory  WITH(NOLOCK) 
      ON  inventory.ItemSysNumber=item.sysno 
      AND inventory.CompanyCode=item.CompanyCode 
  INNER JOIN OverseaContentManagement.dbo.V_CM_AllProductInfo  p  WITH(NOLOCK) 
      ON  item.sysno=p.ProductSysNo       
  WHERE  
      item.status = 1 
      AND  p.BrandSysNo=@BrandSysNo 
      AND item.ProductType=0	
      AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_HasItemSysnolist WHERE sysno = ProductSysNo)  
      AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo) 
      AND item.CompanyCode=@CompanyCode 
      AND item.category3sysno<>@GiftC3SysNo 
      AND (inventory.OnlineQty>0 OR inventory.ShiftQty>0) 
  GROUP BY (item.Month1Salescount+item.Month2Salescount+item.Month3Salescount) 
  ,item.sysno ,item.ProductID ,p.BrandSysNo  ,p.ProductGroupSysNo 		 
  ORDER BY (item.Month1SalesCount+item.Month2SalesCount+item.Month3SalesCount) DESC
      ]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@BrandSysNo" dbType="Int32" />
      <param name="@HasItemSysnolist" dbType="String" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetSaleHightItemForBrandNoHistory" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[			
DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')

	  SELECT TOP (@Num) 
        item.sysno  productsysno 
       ,item.ProductID 
       ,Isnull((item.Month1SalesCount+item.Month2SalesCount+item.Month3SalesCount),0) M3 
       ,item.BrandSysNo 
       ,p.ProductGroupSysNo 
    FROM  OverseaContentManagement.dbo.v_cm_itemcommoninfo item WITH (NOLOCK)   
    INNER JOIN OverseaInventoryManagement.dbo.V_INM_Inventory  inventory  WITH(NOLOCK) 
        ON  inventory.ItemSysNumber=item.sysno 
        AND inventory.CompanyCode=item.CompanyCode 
    INNER JOIN OverseaContentManagement.dbo.V_CM_AllProductInfo p WITH(NOLOCK) 
        ON  item.sysno=p.ProductSysNo         
    WHERE  
        item.status =1 
        AND item.BrandSysNo=@BrandSysNo	 
        AND item.ProductType=0 
        AND item.category3sysno<>@GiftC3SysNo 
        AND item.CompanyCode=@CompanyCode    
        AND (inventory.OnlineQty>0 OR inventory.ShiftQty>0)	 
        AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo)
    GROUP BY (item.Month1SalesCount+item.Month2SalesCount+item.Month3SalesCount) 
,item.sysno ,item.ProductID ,item.BrandSysNo 	,p.ProductGroupSysNo 	 
    ORDER BY (item.Month1SalesCount+item.Month2SalesCount+item.Month3SalesCount) DESC
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@BrandSysNo" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetSaleHightItemForHundredShop" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[			
			
DECLARE @tb_ItemSysnolist TABLE
( 
     sysno int 
 );

INSERT INTO @tb_ItemSysnolist
SELECT * FROM [IPP3].[dbo].[f_splitstr](@ItemSysnolist,',')

DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')



SELECT TOP (@Num) 
			       ProductSysNo
						,ProductID	
            ,ProductGroupSysNo   
       FROM (SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,W1
	FROM  OverseaECommerceManagement.[dbo].[V_EM_SaleHightItem] WITH(NOLOCK)
WHERE C1SysNo=@CategorySysNo 
   AND BackC3SysNo<>@GiftC3SysNo
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_ItemSysnolist WHERE sysno = ProductSysNo)   
   AND CompanyCode=@CompanyCode   
   AND CurrentPrice<=110
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,W1
	FROM  OverseaECommerceManagement.[dbo].[V_EM_SaleHightItem] WITH(NOLOCK)
  WHERE C2SysNo=@CategorySysNo 
   AND BackC3SysNo<>@GiftC3SysNo
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_ItemSysnolist WHERE sysno = ProductSysNo)   
   AND CompanyCode=@CompanyCode 
   AND CurrentPrice<=110  
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,W1
	FROM  OverseaECommerceManagement.[dbo].[V_EM_SaleHightItem] WITH(NOLOCK)
  WHERE C3SysNo=@CategorySysNo 
   AND BackC3SysNo<>@GiftC3SysNo
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_ItemSysnolist WHERE sysno = ProductSysNo)   
   AND CompanyCode=@CompanyCode  
   AND CurrentPrice<=110 
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo) 
) a
     GROUP BY a.ProductSysNo,a.ProductID,a.ProductGroupSysNo,a.w1
     Order by a.W1 desc
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@CategorySysNo" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@ItemSysnolist" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetSaleHightItemForHundredShopNoHistory" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[			
			
DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')



			SELECT TOP (@Num) 
			       ProductSysNo
						,ProductID	
            ,ProductGroupSysNo   
	  FROM (SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
		,W1
	FROM  OverseaECommerceManagement.[dbo].[V_EM_SaleHightItem] WITH(NOLOCK)
WHERE C1SysNo=@CategorySysNo 
   AND BackC3SysNo<>@GiftC3SysNo  
   AND CompanyCode=@CompanyCode  
   AND CurrentPrice<=110 
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
		,W1
	FROM  OverseaECommerceManagement.[dbo].[V_EM_SaleHightItem] WITH(NOLOCK)
  WHERE C2SysNo=@CategorySysNo 
   AND BackC3SysNo<>@GiftC3SysNo
   AND CompanyCode=@CompanyCode  
   AND CurrentPrice<=110  
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
		,W1
	FROM  OverseaECommerceManagement.[dbo].[V_EM_SaleHightItem] WITH(NOLOCK)
  WHERE C3SysNo=@CategorySysNo 
   AND BackC3SysNo<>@GiftC3SysNo
   AND CompanyCode=@CompanyCode  
   AND CurrentPrice<=110  
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo) 
) a
     GROUP BY a.ProductSysNo,a.ProductID	,a.ProductGroupSysNo,a.w1
     Order by a.W1 desc
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@CategorySysNo" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetNewItemNoHistory" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[	
		
DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')



			SELECT TOP (@Num) 
			       ProductSysNo
						,ProductID	
            ,ProductGroupSysNo
  FROM (SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,FirstOnlineTime
  FROM [OverseaECommerceManagement].[dbo].[V_EM_NewItem_v1] WITH(NOLOCK)
WHERE C1SysNo=@CategorySysNo 
   AND C3SysNo<>@GiftC3SysNo 
   AND CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,FirstOnlineTime
  FROM [OverseaECommerceManagement].[dbo].[V_EM_NewItem_v1] WITH(NOLOCK)
  WHERE C2SysNo=@CategorySysNo 
   AND C3SysNo<>@GiftC3SysNo  
   AND CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,FirstOnlineTime
  FROM [OverseaECommerceManagement].[dbo].[V_EM_NewItem_v1] WITH(NOLOCK)
  WHERE C3SysNo=@CategorySysNo 
   AND C3SysNo<>@GiftC3SysNo  
   AND CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo) 
) a
  GROUP BY a.ProductSysNo,a.ProductID,a.ProductGroupSysNo ,a.[FirstOnlineTime]
     order by a.[FirstOnlineTime] desc
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@CategorySysNo" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetNewItem" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[		
DECLARE @tb_HasItemSysnolist TABLE
( 
     sysno int 
 );

INSERT INTO @tb_HasItemSysnolist 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@HasItemSysnolist,',')

DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')



SELECT TOP (@Num) 
			       ProductSysNo
						,ProductID	
            ,ProductGroupSysNo 
  FROM (SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,FirstOnlineTime
  FROM [OverseaECommerceManagement].[dbo].[V_EM_NewItem_v1] WITH(NOLOCK)
WHERE C1SysNo=@CategorySysNo 
   AND C3SysNo<>@GiftC3SysNo
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_HasItemSysnolist WHERE sysno = ProductSysNo)   
   AND CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,FirstOnlineTime
  FROM [OverseaECommerceManagement].[dbo].[V_EM_NewItem_v1] WITH(NOLOCK)
  WHERE C2SysNo=@CategorySysNo 
   AND C3SysNo<>@GiftC3SysNo
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_HasItemSysnolist WHERE sysno = ProductSysNo)   
   AND CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,FirstOnlineTime
  FROM [OverseaECommerceManagement].[dbo].[V_EM_NewItem_v1] WITH(NOLOCK)
  WHERE C3SysNo=@CategorySysNo 
   AND C3SysNo<>@GiftC3SysNo
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_HasItemSysnolist WHERE sysno = ProductSysNo)   
   AND CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo) 
) a
   GROUP BY a.ProductSysNo,a.ProductID,a.ProductGroupSysNo ,a.[FirstOnlineTime]
     order by a.[FirstOnlineTime] desc
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@CategorySysNo" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@HasItemSysnolist" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetSpecialItem" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[		
DECLARE @tb_HasItemSysnolist TABLE
( 
     sysno int 
 );

INSERT INTO @tb_HasItemSysnolist 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@HasItemSysnolist,',')

DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')



SELECT TOP (@Num) 
			       ProductSysNo
						,ProductID	
            ,ProductGroupSysNo 
  FROM (
SELECT 
	[ProductSysNo]
	,[ProductID] 
	,ProductGroupSysNo 
	,FirstOnlineTime
  ,discount
FROM [OverseaECommerceManagement].[dbo].[V_EM_SpecialItem_v1] WITH(NOLOCK)
WHERE C1SysNo=@CategorySysNo 
	AND C3SysNo<>@GiftC3SysNo
	AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_HasItemSysnolist WHERE sysno = ProductSysNo)   
	AND CompanyCode=@CompanyCode   
	AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE sysno =ProductGroupSysNo)
UNION  
SELECT 
	[ProductSysNo]
	,[ProductID] 
	,ProductGroupSysNo 
	,FirstOnlineTime
  ,discount
FROM [OverseaECommerceManagement].[dbo].[V_EM_SpecialItem_v1] WITH(NOLOCK)
WHERE C2SysNo=@CategorySysNo 
	AND C3SysNo<>@GiftC3SysNo
	AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_HasItemSysnolist WHERE sysno = ProductSysNo)   
	AND CompanyCode=@CompanyCode   
	AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo)
UNION  
SELECT 
	[ProductSysNo]
	,[ProductID] 
	,ProductGroupSysNo 
	,FirstOnlineTime
  ,discount
FROM [OverseaECommerceManagement].[dbo].[V_EM_SpecialItem_v1] WITH(NOLOCK)
WHERE C3SysNo=@CategorySysNo 
	AND C3SysNo<>@GiftC3SysNo
	AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_HasItemSysnolist WHERE sysno = ProductSysNo)   
	AND CompanyCode=@CompanyCode   
	AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo) 
) a
   GROUP BY a.ProductSysNo,a.ProductID,a.ProductGroupSysNo ,a.[FirstOnlineTime]
     order by a.discount asc
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@CategorySysNo" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@HasItemSysnolist" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetSpecialItemNoHistory" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[	
		
DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')



			SELECT TOP (@Num) 
			       ProductSysNo
						,ProductID	
            ,ProductGroupSysNo
  FROM (SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,FirstOnlineTime
       ,discount
  FROM [OverseaECommerceManagement].[dbo].[V_EM_SpecialItem_v1] WITH(NOLOCK)
WHERE C1SysNo=@CategorySysNo 
   AND C3SysNo<>@GiftC3SysNo 
   AND CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,FirstOnlineTime
       ,discount
  FROM [OverseaECommerceManagement].[dbo].[V_EM_SpecialItem_v1] WITH(NOLOCK)
  WHERE C2SysNo=@CategorySysNo 
   AND C3SysNo<>@GiftC3SysNo  
   AND CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,FirstOnlineTime
       ,discount
  FROM [OverseaECommerceManagement].[dbo].[V_EM_SpecialItem_v1] WITH(NOLOCK)
  WHERE C3SysNo=@CategorySysNo 
   AND C3SysNo<>@GiftC3SysNo  
   AND CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo) 
) a
  GROUP BY a.ProductSysNo,a.ProductID,a.ProductGroupSysNo ,a.[FirstOnlineTime]
     order by a.discount asc
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@CategorySysNo" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetNewItemForBrand" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[
DECLARE @tb_HasItemSysnolist TABLE
( 
     sysno int 
 );

INSERT INTO @tb_HasItemSysnolist 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@HasItemSysnolist,',')

DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')

			SELECT TOP (@Num) 
			       ProductSysNo
						,ProductID	
            ,ProductGroupSysNo         
      FROM (	SELECT 
			       ProductSysNo
						,ProductID	
            ,ProductGroupSysNo 
            ,FirstOnlineTime
				FROM   [OverseaECommerceManagement].[dbo].[V_EM_NewItem]  WITH(NOLOCK)
				WHERE BrandSysNo=@BrandSysNo 
             AND BackC3SysNo<>@GiftC3SysNo
             AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_HasItemSysnolist WHERE sysno = ProductSysNo)  
             AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo)
						 AND CompanyCode=@CompanyCode	
		  ) a
  GROUP BY a.ProductSysNo,a.ProductID,a.ProductGroupSysNo ,a.[FirstOnlineTime]
     order by a.[FirstOnlineTime] desc
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@BrandSysNo" dbType="Int32" />
      <param name="@HasItemSysnolist" dbType="String" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetNewItemForBrandNoHistory" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[
DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')

		SELECT TOP (@Num) 
			       ProductSysNo
						,ProductID	
            ,ProductGroupSysNo           
      FROM (SELECT 
			       ProductSysNo
						,ProductID		
            ,ProductGroupSysNo 
            ,[FirstOnlineTime]
				FROM   [OverseaECommerceManagement].[dbo].[V_EM_NewItem]  WITH(NOLOCK)
				WHERE BrandSysNo=@BrandSysNo 
             AND BackC3SysNo<>@GiftC3SysNo					
						 AND CompanyCode=@CompanyCode
             AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo)
		  ) a
     GROUP BY a.ProductSysNo,a.ProductID,a.ProductGroupSysNo ,a.[FirstOnlineTime]
     order by a.[FirstOnlineTime] desc
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@BrandSysNo" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String"/>      
    </parameters>
  </dataCommand>

  <dataCommand name="GetNewItemForC1PageForHundred" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[	
DECLARE @tb_HasItemSysnolist TABLE
( 
     sysno int 
 );

INSERT INTO @tb_HasItemSysnolist 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@HasItemSysnolist,',')

DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')



    	SELECT TOP (@Num) 
			       ProductSysNo
						,ProductID	
            ,ProductGroupSysNo  
	  FROM (SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,FirstOnlineTime
  FROM [OverseaECommerceManagement].[dbo].[V_EM_NewItem] WITH(NOLOCK)
WHERE C1SysNo=@CategorySysNo 
   AND BackC3SysNo<>@GiftC3SysNo
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_HasItemSysnolist WHERE sysno = ProductSysNo)   
   AND CompanyCode=@CompanyCode  
   AND CurrentPrice <=@itemPrice 
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,FirstOnlineTime
  FROM [OverseaECommerceManagement].[dbo].[V_EM_NewItem] WITH(NOLOCK)
  WHERE C2SysNo=@CategorySysNo 
   AND BackC3SysNo<>@GiftC3SysNo
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_HasItemSysnolist WHERE sysno = ProductSysNo)   
   AND CompanyCode=@CompanyCode 
   AND CurrentPrice <=@itemPrice  
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,FirstOnlineTime
  FROM [OverseaECommerceManagement].[dbo].[V_EM_NewItem] WITH(NOLOCK)
  WHERE C3SysNo=@CategorySysNo 
   AND BackC3SysNo<>@GiftC3SysNo
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_HasItemSysnolist WHERE sysno = ProductSysNo)   
   AND CompanyCode=@CompanyCode 
   AND CurrentPrice <=@itemPrice  
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo) 
) a
  GROUP BY a.ProductSysNo,a.ProductID,a.ProductGroupSysNo ,a.[FirstOnlineTime]
     order by a.[FirstOnlineTime] desc
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@itemPrice" dbType="Decimal" />
      <param name="@CategorySysNo" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@HasItemSysnolist" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetNewItemForC1PageForHundredNoHistory" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[	   
DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')



	   	SELECT TOP (@Num) 
			       ProductSysNo
						,ProductID	
            ,ProductGroupSysNo     
			  FROM (SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,FirstOnlineTime
  FROM [OverseaECommerceManagement].[dbo].[V_EM_NewItem] WITH(NOLOCK)
WHERE C1SysNo=@CategorySysNo 
   AND BackC3SysNo<>@GiftC3SysNo
   AND CurrentPrice <=@itemPrice   
   AND CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,FirstOnlineTime
  FROM [OverseaECommerceManagement].[dbo].[V_EM_NewItem] WITH(NOLOCK)
  WHERE C2SysNo=@CategorySysNo 
   AND BackC3SysNo<>@GiftC3SysNo
   AND CurrentPrice <=@itemPrice 
   AND CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,FirstOnlineTime
  FROM [OverseaECommerceManagement].[dbo].[V_EM_NewItem] WITH(NOLOCK)
  WHERE C3SysNo=@CategorySysNo 
   AND BackC3SysNo<>@GiftC3SysNo
   AND CurrentPrice <=@itemPrice   
   AND CompanyCode=@CompanyCode   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo) 
) a
  GROUP BY a.ProductSysNo,a.ProductID,a.ProductGroupSysNo ,a.[FirstOnlineTime]
     order by a.[FirstOnlineTime] desc
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@itemPrice" dbType="Decimal" />
      <param name="@CategorySysNo" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@GroupSysNoList" dbType="String"/>      
    </parameters>
  </dataCommand>

  <dataCommand name="GetPriceDownItemForHundred" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[
DECLARE @tb_HasItemSysnolist TABLE
( 
     sysno int 
 );

INSERT INTO @tb_HasItemSysnolist 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@HasItemSysnolist,',')

DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')



SELECT TOP (@Num) 
			       ProductSysNo
						,ProductID	
            ,ProductGroupSysNo 
   	  FROM (SELECT 
       [ProductSysNo]
      ,[ProductID] 
      ,ProductGroupSysNo 
      ,TotalAdjustPrice
	FROM OverseaECommerceManagement.dbo.V_EM_PriceDownItem WITH(NOLOCK)
WHERE CreateDate>=@DateTime 
   AND C1SysNo=@CategorySysNo 
   AND BackC3SysNo<>@GiftC3SysNo
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_HasItemSysnolist WHERE sysno = ProductSysNo)   
   AND CompanyCode=@CompanyCode 
   AND CurrentPrice <=110   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
      ,ProductGroupSysNo 
      ,TotalAdjustPrice
	FROM OverseaECommerceManagement.dbo.V_EM_PriceDownItem WITH(NOLOCK)
  WHERE CreateDate>=@DateTime 
   AND C2SysNo=@CategorySysNo 
   AND BackC3SysNo<>@GiftC3SysNo
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_HasItemSysnolist WHERE sysno = ProductSysNo)   
   AND CompanyCode=@CompanyCode   
   AND CurrentPrice <=110   
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
      ,ProductGroupSysNo 
      ,TotalAdjustPrice
	FROM OverseaECommerceManagement.dbo.V_EM_PriceDownItem WITH(NOLOCK)
  WHERE CreateDate>=@DateTime 
   AND C3SysNo=@CategorySysNo 
   AND BackC3SysNo<>@GiftC3SysNo
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_HasItemSysnolist WHERE sysno = ProductSysNo)   
   AND CompanyCode=@CompanyCode  
   AND CurrentPrice <=110    
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo) 
) a
 GROUP BY a.ProductSysNo ,a.ProductID ,a.ProductGroupSysNo,a.[TotalAdjustPrice]
Order  By a.[TotalAdjustPrice]
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@DateTime" dbType="DateTime" />
      <param name="@CategorySysNo" dbType="Int32" />
      <param name="@HasItemSysnolist" dbType="String" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="String"/>
      <param name="@GroupSysNoList" dbType="String"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetPriceDownItemForHundredNoHistory" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[
  	
DECLARE @tb_GroupSysNoList TABLE
    ( 
         sysno int 
    );

INSERT INTO @tb_GroupSysNoList 
SELECT * FROM [IPP3].[dbo].[f_splitstr](@GroupSysNoList,',')



  	SELECT TOP (@Num) 
			       ProductSysNo
						,ProductID	
            ,ProductGroupSysNo  
	  FROM (SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,TotalAdjustPrice
  FROM  OverseaECommerceManagement.dbo.V_EM_PriceDownItem  WITH(NOLOCK)
WHERE CreateDate>=@DateTime 
   AND C1SysNo=@CategorySysNo 
   AND BackC3SysNo<>@GiftC3SysNo  
   AND CompanyCode=@CompanyCode 
   AND CurrentPrice <=110  
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,TotalAdjustPrice
  FROM  OverseaECommerceManagement.dbo.V_EM_PriceDownItem  WITH(NOLOCK)
  WHERE CreateDate>=@DateTime 
   AND C2SysNo=@CategorySysNo 
   AND BackC3SysNo<>@GiftC3SysNo 
   AND CompanyCode=@CompanyCode 
   AND CurrentPrice <=110  
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo)
UNION  
SELECT 
       [ProductSysNo]
      ,[ProductID] 
       ,ProductGroupSysNo 
       ,TotalAdjustPrice
  FROM  OverseaECommerceManagement.dbo.V_EM_PriceDownItem  WITH(NOLOCK)
  WHERE CreateDate>=@DateTime 
   AND C3SysNo=@CategorySysNo 
   AND BackC3SysNo<>@GiftC3SysNo 
   AND CompanyCode=@CompanyCode 
   AND CurrentPrice <=110  
   AND NOT EXISTS (SELECT TOP 1 1 FROM @tb_GroupSysNoList WHERE  sysno =ProductGroupSysNo) 
) a
GROUP BY a.ProductSysNo ,a.ProductID ,a.ProductGroupSysNo,a.[TotalAdjustPrice] 
Order  By a.[TotalAdjustPrice]
			]]>
    </commandText>
    <parameters>
      <param name="@Num" dbType="Int32" />
      <param name="@DateTime" dbType="DateTime" />
      <param name="@CategorySysNo" dbType="Int32" />
      <param name="@GiftC3SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="String"/>      
      <param name="@GroupSysNoList" dbType="String"/>
    </parameters>
  </dataCommand>

  <dataCommand name="CheckBrandItemNum" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[
		SELECT COUNT(item.sysno) 
    FROM  overseacontentmanagement.dbo.v_cm_itemcommoninfo  item  WITH(NOLOCK) 
    WHERE  item.[status] = 1 
        AND item.ProductType=0 
        AND item.BrandSysno=@BrandSysNo				 
        AND item.CompanyCode=@CompanyCode
			]]>
    </commandText>
    <parameters>
      <param name="@BrandSysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="String"/>
    </parameters>
  </dataCommand>

  <dataCommand name="ClearTableOnLinelist" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[
		DELETE TOP(5000) OverseaECommerceManagement.[dbo].[OnlineList]
	    WHERE [Status]='D' 
		      AND Datediff(DAY,InDate,Getdate()) >@Day
		      AND CompanyCode='@CompanyCode'			 
			]]>
    </commandText>
  </dataCommand>

  <dataCommand name="CheckC2ItemNumOnC1" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[
		SELECT distinct [C2Sysno]   
		FROM [OverseaECommerceManagement].dbo.V_EM_EC_Category  WITH(NOLOCK)
		WHERE [C1Status]='A'
    AND [C2Status]='A'
    AND [C3Status]='A'
		AND C1Sysno=@Category1Sysno
		AND CompanyCode='@CompanyCode'		 
			]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetNewItemDomainList" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[
SELECT [DomainCode]
      ,[DomainName]  
      ,C1List 
      ,ExceptC3List
FROM [OverseaECommerceManagement].[dbo].[Domain] WITH(NOLOCK)
WHERE [CompanyCode]=@CompanyCode
AND [Status]='A'
ORDER BY SysNo ASC
			]]>
    </commandText>
    <parameters>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
    </parameters>
  </dataCommand>

  <dataCommand name="SendMailInfo" database="OverseaECommerceManagement" commandType="Text">
    <commandText>
      <![CDATA[	
	INSERT INTO [MailDB].[dbo].[AsyncEmail_Internal]
           ([MailAddress]
           ,[CCMailAddress]         
           ,[MailSubject]
           ,[MailBody]
           ,[Status]
           ,[Priority]      
           ,[CreateTime]
           ,[CompanyCode]
           ,[LanguageCode]
           ,[StoreCompanyCode])
     VALUES
           (@MailAddress
           ,@CCMailAddress
           ,@MailSubject
           ,@MailBody
           ,0
           ,1
           ,getdate()
           ,@CompanyCode
           ,@LanguageCode
           ,@CompanyCode)
			 ]]>
    </commandText>
    <parameters>
      <param name="@MailAddress" dbType="String" />
      <param name="@CCMailAddress" dbType="String" />
      <param name="@MailSubject" dbType="String" />
      <param name="@MailBody" dbType="String" />
      <param name="@CompanyCode" dbType="String"/>
      <param name="@LanguageCode" dbType="String"/>
    </parameters>
  </dataCommand>

</dataOperations>
