<?xml version="1.0" encoding="utf-8" ?>
<dataOperations xmlns="http://oversea.newegg.com/DataOperation">
  <dataCommand name="QueryProduct" database="IMService" commandType="Text">
    <!--定义SQL语句-->
    <commandText>
      <![CDATA[
          SELECT @TotalCount = COUNT(Product.SysNo)
        FROM IPP3.[dbo].[Product] AS Product WITH(NOLOCK)
                  LEFT JOIN IPP3.dbo.Product_Ex EX WITH(NOLOCK)
				ON Product.SysNo=Ex.SysNo
				LEFT JOIN IPP3.dbo.Product_Status PStatus WITH(NOLOCK)
					ON Product.SysNo=PStatus.ProductSysNo
				LEFT JOIN [OverseaContentManagement].[dbo].[ProductCommonInfo] PCI WITH(NOLOCK) 
					ON Product.ProductCommonInfoSysno=PCI.SysNo 
				LEFT JOIN OverseaContentManagement.dbo.ProductCommonInfo_Ex PCI_EX WITH(NOLOCK) 
					ON PCI.SysNo=PCI_EX.SysNo 
				INNER JOIN IPP3.dbo.Category3 C3 WITH(NOLOCK) 
          ON Product.C3SysNo=C3.SysNo 
        LEFT JOIN IPP3.dbo.Category2 C2 WITH(NOLOCK) 
					ON C2.SysNo=C3.C2SysNo
				LEFT JOIN OverseaContentManagement.dbo.Brand B WITH(NOLOCK) 
					ON Product.BrandSysNo=B.SysNo 
				LEFT JOIN IPP3.dbo.Manufacturer M WITH(NOLOCK) 
					ON B.ManufacturerSysNo=M.SysNo 
				INNER JOIN [IPP3].[dbo].[Product_Price] PP WITH(NOLOCK) 
					ON Product.SysNo=PP.ProductSysNo
				LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList V WITH(NOLOCK) 
					ON Product.MerchantSysNo=V.SysNo 
				LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo VUSER WITH(NOLOCK) 
					ON Product.PMUserSysNo=VUSER.UserSysNo 
			    INNER JOIN OverseaInventoryManagement.[dbo].[V_INM_Inventory] AS Inventory WITH(NOLOCK) 
									ON Product.SysNo = Inventory.ItemSysNumber 
         #StrWhere#

        IF @EndNumber > @TotalCount
	        SET @EndNumber = @TotalCount

        ;WITH IT AS (
		          SELECT TOP (@EndNumber - @StartNumber ) 
              a.Sysno
              , RowNumber 
		          FROM 
			           (SELECT TOP (@EndNumber) 
                 Product.[SysNo] AS [SysNo]
						        ,ROW_NUMBER() OVER(ORDER BY #SortColumnName#) AS RowNumber
				          FROM  IPP3.[dbo].[Product] AS Product WITH(NOLOCK)   
               LEFT JOIN IPP3.dbo.Product_Ex EX WITH(NOLOCK)
				ON Product.SysNo=Ex.SysNo
				LEFT JOIN IPP3.dbo.Product_Status PStatus WITH(NOLOCK)
					ON Product.SysNo=PStatus.ProductSysNo
				LEFT JOIN [OverseaContentManagement].[dbo].[ProductCommonInfo] PCI WITH(NOLOCK) 
					ON Product.ProductCommonInfoSysno=PCI.SysNo 
				LEFT JOIN OverseaContentManagement.dbo.ProductCommonInfo_Ex PCI_EX WITH(NOLOCK) 
					ON PCI.SysNo=PCI_EX.SysNo 
				INNER JOIN IPP3.dbo.Category3 C3 WITH(NOLOCK) 
					ON Product.C3SysNo=C3.SysNo 
        LEFT JOIN IPP3.dbo.Category2 C2 WITH(NOLOCK) 
					ON C2.SysNo=C3.C2SysNo
				LEFT JOIN OverseaContentManagement.dbo.Brand B WITH(NOLOCK) 
					ON Product.BrandSysNo=B.SysNo 
				LEFT JOIN IPP3.dbo.Manufacturer M WITH(NOLOCK) 
					ON B.ManufacturerSysNo=M.SysNo 
				INNER JOIN [IPP3].[dbo].[Product_Price] PP WITH(NOLOCK) 
					ON Product.SysNo=PP.ProductSysNo
				LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList V WITH(NOLOCK) 
					ON Product.MerchantSysNo=V.SysNo 
				LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo VUSER WITH(NOLOCK) 
					ON Product.PMUserSysNo=VUSER.UserSysNo 
          			    INNER JOIN OverseaInventoryManagement.[dbo].[V_INM_Inventory] AS Inventory WITH(NOLOCK) 
									ON Product.SysNo = Inventory.ItemSysNumber 
				         #StrWhere#
				        ) AS a
                 ORDER BY RowNumber DESC)

            SELECT	
	               Product.[SysNo] AS [SysNo] 
                ,Product.CompanyCode 
                ,[ProductID] 
                ,Product.[ProductName] 
                ,[AccountQty] 
                ,[AvailableQty] 
                ,[AllocatedQty] 
                ,[OrderQty] 
                ,[ConsignQty] 
                ,Product.[PMUserSysNo] 
                ,[DisplayName] AS PMUserName 
                ,PriceInfo.[UnitCost] 
                ,PriceInfo.[UnitCostWithoutTax]
                ,PriceInfo.BasicPrice
                ,Product.SysNo AS ProductSysNo 
                ,Product.ProductMode AS [ProductModel]
                ,ISNULL(PriceInfo.CurrentPrice,0.00) AS Price
                ,Product.[Status]  
                ,Product.ProductType
                ,Product.Weight
                ,b.BrandName_Ch AS [BrandName]
                ,PriceInfo.CurrentPrice
                ,Inventory.OnlineQty
                ,Product.C3SysNo
                ,Product.Warranty
                ,Product.InventoryType
                ,Product.ERPProductID
                --关联礼品查询
                ,(
                  SELECT COUNT(1) FROM IPP3.[dbo].Product AS p WITH(NOLOCK) 
                  INNER JOIN OverseaECommerceManagement.dbo.V_MKT_Gift_GiftRules gg WITH(nolock)
                      ON gg.ProductSysNo=p.SysNo
                  INNER JOIN OverseaECommerceManagement.dbo.V_MKT_Gift_SaleRules gs WITH(nolock)
                      ON gg.PromotionSysNo=gs.PromotionSysNo
                  INNER JOIN OverseaECommerceManagement.dbo.V_MKT_Gift g WITH(nolock)
                      ON g.SysNo=gs.PromotionSysNo AND g.Type='V' AND g.Status='A' AND gs.Type='I'
                  WHERE p.MerchantSysNo=1 AND gs.ProductSysNo = Product.SysNo
                  ) AS GiftItemCount
                --关联延保查询(以后可以提出来，按条件返回字段)(拆分自方法OverseaContentManagement.dbo.UF_GetExtendWarranty_V102009112001)
                ,(
                  SELECT COUNT(1)
		                FROM IPP3.dbo.Category3 c3 WITH(NOLOCK) 
			                INNER JOIN OverseaContentManagement.dbo.ExtendWarrantyInfo ewi WITH(NOLOCK)
				                ON c3.SysNo= ewi.C3SysNo 
		                WHERE
			                Product.productType=0 
			                AND c3.SysNo = Product.C3SysNo
				                AND NOT EXISTS (
									                SELECT TOP 1 1 
									                FROM OverseaContentManagement.dbo.ExtendWarrantyDisuseItem ewdi WITH(NOLOCK)
									                WHERE ewdi.ProductSysNo = Product.SysNo
								                )
				                AND NOT EXISTS (
					                SELECT TOP 1 1 
					                FROM OverseaContentManagement.dbo.ExtendWarrantyDisuseBrand ewdb WITH(NOLOCK)
					                WHERE (
							                ewdb.C3SysNo = -1 
							                OR
							                ewdb.C3SysNo = Product.C3SysNo
						                  )
						                  AND ewdb.ManufacturerSysNo = Product.ManufacturerSysNo 						                  
				                )
				                AND ewi.Status = 'A' 
				                AND ewi.MinUnitPrice <= PriceInfo.CurrentPrice
				                AND ewi.MaxUnitPrice >= PriceInfo.CurrentPrice
                        --待确认
				                --AND (ewi.ManufacturerSysNo = -1 OR Product.ManufacturerSysNo = ewi.ManufacturerSysNo)
                ) AS ExtendWarrantyCount
                ,case  Product.ProductType when 0 then 'O' WHEN 1 THEN 'S' ELSE  'B' end as ProductType
                ,poPrice.PurchasePrice
                ,product.VFItem
                ,PriceInfo.VirtualPrice
                ,CASE WHEN vendor.VendorType=0 THEN '食佳时代' ELSE vendor.VendorName END AS MerchantName
                --最大分仓数量
                ,(SELECT TOP(1) MAX(isnull(AvailableQty,0)+isnull(VirtualQty,0)+isnull(ConsignQty,0)) as MaxQty
	                      FROM OverseaInventoryManagement.dbo.V_INM_Inventory_Stock as Inventory
	                      INNER JOIN OverseaInventoryManagement.dbo.V_INM_Stock as Stock 
		                    ON Stock.SysNo = Inventory.WarehouseSysNumber 
	                      WHERE 
		                    Inventory.ItemSysNumber = Product.[SysNo] 
	                      GROUP By Inventory.WarehouseSysNumber,Inventory.ItemSysNumber 
	                      ORDER BY MaxQty DESC) AS MaxQuantity
                --最优分仓编号,名称
                ,(SELECT '{"StockName":"'+StockName+'","SysNo":' + CONVERT(VARCHAR(5),SysNo)+'}' 
                        FROM (SELECT ROW_NUMBER() OVER(ORDER BY isnull(stock.WarehouseRate*100,0) DESC) as RN
	                      ,Stock.StockName,Stock.SysNo
	                      FROM OverseaInventoryManagement.dbo.V_INM_Inventory_Stock as Inventory
	                      INNER JOIN OverseaInventoryManagement.dbo.V_INM_Stock as Stock 
		                    ON Stock.SysNo = Inventory.WarehouseSysNumber 
	                      WHERE 
                          Inventory.AvailableQty+Inventory.ConsignQty+Inventory.VirtualQty-isnull(Inventory.InvalidQty,0) > 0
		                    AND Inventory.ItemSysNumber =  Product.[SysNo])t WHERE t.RN=1) AS OptimalizingStock
                 --是否有批次
                 ,CASE WHEN ISNULL(p_ex.isbatch,'N')='N' THEN 0 ELSE 1 END AS IsHasBatch
                 ,Product.IsConsign AS IsConsign
                 ,C3.MinMargin
                 ,ISNULL(p_ex.GiftVoucherType,0) AS GiftVoucherType
                 ,isnull(p_en.StoreType,0) AS StoreType
                 ,p_en.TariffRate
            FROM IT
	            INNER JOIN 	IPP3.[dbo].[Product] AS Product WITH(NOLOCK)  
		            ON (IT.SysNo = Product.SysNo)
              LEFT JOIN IPP3.dbo.Category3 AS C3 WITH(NOLOCK) ON Product.C3SysNo = C3.SysNo
              LEFT JOIN OverseaPOASNManagement.dbo.[V_PM_VendorList] AS vendor WITH (NOLOCK)
	              ON Product.MerchantSysNo=vendor.SysNo 
              LEFT JOIN OverseaContentManagement.dbo.Brand b WITH(NOLOCK)
                ON b.SysNo=Product.BrandSysNo  
              LEFT OUTER JOIN IPP3.dbo.[Product_Price] AS PriceInfo WITH (NOLOCK) 
                ON PriceInfo.ProductSysNo = Product.SysNo
              LEFT OUTER JOIN OverseaArchitecture.[dbo].[V_AR_UserInfo] AS UserInfo WITH(NOLOCK) 
                ON UserInfo.UserSysNo = Product.PMUserSysNo 
           	   INNER JOIN OverseaInventoryManagement.[dbo].[V_INM_Inventory] AS Inventory WITH(NOLOCK) 
              ON Product.SysNo = Inventory.ItemSysNumber 
              left join [OverseaContentManagement].[dbo].[Product3Party_SynProduct] as poPrice WITH (NOLOCK) 
              on Product.SysNo=poPrice.ProductMappingSysno
              LEFT JOIN IPP3.dbo.Product_Ex AS p_ex WITH(NOLOCK)
              ON p_ex.SysNo = Product.SysNo
              LEFT JOIN ipp3.dbo.product_EntryInfo p_en WITH(NOLOCK)
              ON p_en.ProductSysNo = Product.SysNo
            ORDER BY RowNumber
	  ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="QueryProductEx" database="IMService" commandType="StoredProcedure">
    <commandText>
      <![CDATA[[IPP3].[dbo].[UP_IPP_OVS_ContentMgmt_GetProductList_V102012111701]]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@Status" dbType="Int32" />
      <param name="@StatusOP" dbType="String" size="2" />
      <param name="@ProductID" dbType="String" size="30" />
      <param name="@ERPProductID" dbType="String" size="30" />
      <param name="@ProductName" dbType="String" size="202" />
      <param name="@PromotionTitle" dbType="String" size="202" />
      <param name="@PMUserSysNo" dbType="Int32"  />
      <param name="@PMUserCondition" dbType="Int32" />
      <param name="@AllPMValue" dbType="String" />
      <param name="@Weight" dbType="Int32" />
      <param name="@WeightOP" dbType="String" size="2"/>
      <param name="@C1SysNo" dbType="Int32" />
      <param name="@C2SysNo" dbType="Int32" />
      <param name="@C3SysNo" dbType="Int32" />
      <param name="@ProductType" dbType="Int32" />
      <param name="@ManufacturerName" dbType="String" size="102"/>
      <param name="@VendorName" dbType="String" size="102"/>
      <param name="@BrandName" dbType="String" size="102"/>
      <param name="@UnitCost" dbType="Decimal" size="19"/>
      <param name="@UnitCostOP" dbType="String" size="2"/>
      <param name="@CurrentPrice" dbType="Decimal" size="19"/>
      <param name="@CurrentPriceOP" dbType="String" size="2"/>
      <param name="@Point" dbType="Int32" />
      <param name="@PointOP" dbType="String" size="2"/>
      <param name="@PriceApplyStatus" dbType="Int32" />
      <param name="@AccountQty" dbType="Decimal" size="19"/>
      <param name="@AccountQtyOP" dbType="String" size="2"/>

      <param name="@IsBatch" dbType="Int32" />

      <param name="@DaysToSell" dbType="Decimal" size="19"/>
      <param name="@DaysToSellOP" dbType="String" size="2"/>

      <param name="@ShiftQty" dbType="Decimal" size="19"/>
      <param name="@ShiftQtyOP" dbType="String" size="2"/>
      <param name="@AvailableQty" dbType="Decimal" size="19"/>
      <param name="@AvailableQtyOP" dbType="String" size="2"/>
      <param name="@AllocatedQty" dbType="Decimal" size="19"/>
      <param name="@AllocatedQtyOP" dbType="String" size="2"/>
      <param name="@OrderQty" dbType="Decimal" size="19"/>
      <param name="@OrderQtyOP" dbType="String" size="2"/>
      <param name="@VirtualQty" dbType="Decimal" size="19"/>
      <param name="@VirtualQtyOP" dbType="String" size="2"/>
      <param name="@ConsignQty" dbType="Decimal" size="19"/>
      <param name="@ConsignQtyOP" dbType="String" size="2"/>
      <param name="@OnlineQty" dbType="Decimal" size="19"/>
      <param name="@OnlineQtyOP" dbType="String" size="2"/>
      <param name="@SafeQty" dbType="Decimal" size="19"/>
      <param name="@SafeQtyOP" dbType="String" size="2"/>
      <param name="@StockAccountQty" dbType="Decimal" size="19"/>
      <param name="@StockAccountQtyOP" dbType="String" size="2"/>
      <param name="@InfoStatus" dbType="Int32"/>
      <param name="@PriceStatus" dbType="Int32"/>
      <param name="@WarrantyStatus" dbType="Int32"/>
      <param name="@WeightStatus" dbType="Int32"/>
      <param name="@PicStatus" dbType="Int32"/>
      <param name="@AllowStatus" dbType="Int32"/>
      <param name="@virtualPicStatus" dbType="Int32"/>
      <param name="@IsConsign" dbType="Int32"/>
      <param name="@IsInstalmentProduct" dbType="Int32"/>
      <param name="@IsLarge" dbType="Int32"/>
      <param name="@WarehouseNumber" dbType="Int32"/>
      <param name="@IsTakePictures" dbType="Int32"/>
      <param name="@Performance" dbType="Int32"/>
      <param name="@IsPurchase" dbType="Int32"/>
      <param name="@CurrentUserSysNo" dbType="Int32"/>
      <param name="@ProductDescLong" dbType="Int32"/>
      <param name="@BeginTime" dbType="DateTime"/>
      <param name="@EndTime" dbType="DateTime"/>
      <param name="@SortField" dbType="String" size="30"/>
      <param name="@SortType" dbType="String"/>
      <param name="@PageSize" dbType="Int32"/>
      <param name="@PageCurrent" dbType="Int32"/>
      <param name="@ProductInfoFinishStatus" dbType="String"/>
      <param name="@VirtualType" dbType="Int32"/>
      <param name="@VirtualRequest" dbType="Int32"/>
      <param name="@IsVideo" dbType="Int32"/>
      <param name="@Is360Show" dbType="Int32"/>
      <param name="@MerchantSysNo" dbType="Int32"/>
      <param name="@PurchaseQty" dbType="Int32" size="19"/>
      <param name="@PurchaseQtyOP" dbType="AnsiStringFixedLength" size="2"/>
      <param name="@IngramID" dbType="String" size="20"/>
      <param name="@IngramTypeCondition" dbType="AnsiStringFixedLength" size="1"/>
      <param name="@SupplyPriceCondition" dbType="Int32" size="1"/>

      <param name="@TotalCount" dbType="Int32" size="10" direction="Output"/>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@TariffApplyStatus" dbType="Int32"/>
      <param name="@EntryStatus" dbType="Int32"/>
      <param name="@EntryStatusEx" dbType="Int32"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetProductInfoBySysNo" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
    
      SELECT TOP 1
    PCI.CommonSKUNumber AS [ProductBasicInfo.CommonSKUNumber] 
   ,C3.SysNo AS [ProductBasicInfo.ProductCategoryInfo.SysNo] 
   ,C3.C3ID AS [ProductBasicInfo.ProductCategoryInfo.CategoryID] 
   ,C3.C3Name AS [ProductBasicInfo.ProductCategoryInfo.CategoryName.Content] 
   ,C3.[Status] AS [ProductBasicInfo.ProductCategoryInfo.Status] 
   ,B.SysNo AS [ProductBasicInfo.ProductBrandInfo.SysNo] 
   ,B.BrandName_Ch AS [ProductBasicInfo.ProductBrandInfo.BrandNameLocal.Content] 
   ,B.BrandName_En AS [ProductBasicInfo.ProductBrandInfo.BrandNameGlobal] 
   ,B.[Status] AS [ProductBasicInfo.ProductBrandInfo.Status] 
   ,B.[Description] AS [ProductBasicInfo.ProductBrandInfo.BrandDescription.Content] 
   ,B.ServicePhone AS [ProductBasicInfo.ProductBrandInfo.BrandSupportInfo.ServicePhone] 
   ,B.ServiceEmail AS [ProductBasicInfo.ProductBrandInfo.BrandSupportInfo.ServiceEmail] 
   ,B.ServiceUrl AS [ProductBasicInfo.ProductBrandInfo.BrandSupportInfo.ServiceUrl] 
   ,B.Website AS [ProductBasicInfo.ProductBrandInfo.BrandSupportInfo.ManufacturerUrl] 
   ,M.SysNo AS [ProductBasicInfo.ProductBrandInfo.Manufacturer.SysNo] 
   ,M.ManufacturerID AS [ProductBasicInfo.ProductBrandInfo.Manufacturer.ManufacturerID] 
   ,M.ManufacturerName AS [ProductBasicInfo.ProductBrandInfo.Manufacturer.ManufacturerNameLocal.Content] 
   ,M.BriefName AS [ProductBasicInfo.ProductBrandInfo.Manufacturer.ManufacturerNameGlobal] 
   ,M.[Status] AS [ProductBasicInfo.ProductBrandInfo.Manufacturer.Status] 
   ,M.Note AS [ProductBasicInfo.ProductBrandInfo.Manufacturer.ManufacturerDescription.Content] 
   ,M.CustomerServicePhone AS [ProductBasicInfo.ProductBrandInfo.Manufacturer.SupportInfo.ServicePhone] 
   ,M.SupportEmail AS [ProductBasicInfo.ProductBrandInfo.Manufacturer.SupportInfo.ServiceEmail] 
   ,M.SupportURL AS [ProductBasicInfo.ProductBrandInfo.Manufacturer.SupportInfo.ServiceUrl] 
   ,M.ManufacturerWebsite AS [ProductBasicInfo.ProductBrandInfo.Manufacturer.SupportInfo.ManufacturerUrl] 
   ,PCI.ProductName AS [ProductBasicInfo.ProductTitle.Content] 
   ,PCI.ProductModel AS [ProductBasicInfo.ProductModel.Content] 
   ,PCI.Keywords AS [ProductBasicInfo.Keywords.Content] 
   ,PCI.UPCCode AS [ProductBasicInfo.UPCCode] 
   ,PCI.BMCode AS [ProductBasicInfo.BMCode]
   ,PCI.ProductType AS [ProductBasicInfo.ProductType] 
   ,PCI.ProductDesc AS [ProductBasicInfo.ShortDescription.Content] 
   ,PCI_EX.ProductDescLong AS [ProductBasicInfo.LongDescription.Content] 
   ,PCI_EX.ProductPhotoDesc AS [ProductBasicInfo.PhotoDescription.Content] 
   ,PCI_EX.Performance AS [ProductBasicInfo.Performance] 
   ,PCI.PackageList AS [ProductBasicInfo.PackageList.Content] 
   ,PCI.ProductLink AS [ProductBasicInfo.ProductLink] 
   ,PCI.Attention AS [ProductBasicInfo.Attention.Content]        
   ,PCI.[Length] AS [ProductBasicInfo.ProductDimensionInfo.Length] 
   ,PCI.Width AS [ProductBasicInfo.ProductDimensionInfo.Width] 
   ,PCI.Height AS [ProductBasicInfo.ProductDimensionInfo.Height] 
   ,PCI.Weight AS [ProductBasicInfo.ProductDimensionInfo.Weight] 
   ,PCI.IsLarge AS [ProductBasicInfo.ProductDimensionInfo.LargeFlag] 
   ,PCI.IsTakePictures AS [ProductBasicInfo.IsTakePicture] 
   ,PCI.MinPackNumber AS [ProductPOInfo.MinPackNumber] 
   ,p.InventoryType AS [ProductPOInfo.InventoryType] 
   ,p.ERPProductID as [ProductPOInfo.ERPProductID]
   ,PCI.Note AS [ProductBasicInfo.Note] 
   ,PCI.SysNo AS [ProductCommonInfoSysNo] 
   ,PCI.EditDate AS [LastEditDate] 
   ,P.SysNo AS [SysNo] 
   ,P.ProductID AS [ProductID] 
   ,P.PromotionTitle AS [PromotionTitle.Content] 
   ,P.ProductName AS [ProductName.Content] 
   ,P.ProductLine AS [ProductBasicInfo.ProductBriefTitle.Content] 
   ,P.BriefNameAddition AS [ProductBasicInfo.ProductBriefAddition.Content] 
   ,P.IsConsign AS [ProductConsignFlag] 
   ,P.ProductDescLong AS [ProductBasicInfo.LongDescription.Content]
   ,P.SourceProductID AS [SourceProductID]
   ,p.InventoryType as InventoryType
   ,p.ERPProductID as ERPProductID
   ,Ex.IsSyncShopPrice as [ProductPriceInfo.IsSyncShopPrice]
   ,Ex.HostWarrantyDay AS [ProductWarrantyInfo.HostWarrantyDay] 
   ,Ex.PartWarrantyDay AS [ProductWarrantyInfo.PartWarrantyDay] 
   ,P.Warranty AS [ProductWarrantyInfo.Warranty.Content] 
   ,Ex.ServicePhone AS [ProductWarrantyInfo.ServicePhone] 
   ,Ex.ServiceInfo AS [ProductWarrantyInfo.ServiceInfo] 
   ,Ex.IsOfferValueAddedInvoice AS [ProductWarrantyInfo.OfferVATInvoice] 
   ,Ex.PO_Memo AS [ProductPOInfo.POMemo]
   ,Ex.ProductInfoFinishStatus AS [ProductBasicInfo.ProductInfoFinishStatus]
   ,Ex.AutoAdjustPrice AS [AutoAdjustPrice.IsAutoAdjustPrice]
   ,Ex.AutoPricingStartDate AS [AutoAdjustPrice.NotAutoPricingBeginDate]
   ,Ex.AutoPricingEndDate AS [AutoAdjustPrice.NotAutoPricingEndDate]
   ,PStatus.AllowStatus AS [ProductWarrantyInfo.WarrantyShow] 
   ,PCI_Status.IsAccessoriesShow AS [ProductBasicInfo.IsAccessoryShow] 
   ,PCI_Status.IsVirtualPic AS [ProductBasicInfo.IsVirtualPic] 
   ,PP.BasicPrice AS [ProductPriceInfo.BasicPrice] 
   ,PP.CurrentPrice AS [ProductPriceInfo.CurrentPrice] 
   ,PP.Point AS [ProductPriceInfo.Point] 
   ,PP.CashRebate AS [ProductPriceInfo.CashRebate]
   ,PP.MinCommission AS [ProductPriceInfo.MinCommission]
   ,PP.Discount AS [ProductPriceInfo.DiscountAmount] 
   ,PP.UnitCost AS [ProductPriceInfo.UnitCost] 
   ,PP.UnitCostWithoutTax AS [ProductPriceInfo.UnitCostWithoutTax] 
   ,PP.VirtualPrice AS [ProductPriceInfo.VirtualPrice] 
   ,PP.MinCountPerOrder AS [ProductPriceInfo.MinCountPerOrder] 
   ,PP.MaxPerOrder AS [ProductPriceInfo.MaxCountPerDay] 
   ,PP.PointType AS [ProductPriceInfo.PayType]
   ,PP.IsUseAlipayVipPrice AS [ProductPriceInfo.IsUseAlipayVipPrice]
   ,PP.AlipayVipPrice AS [ProductPriceInfo.AlipayVipPrice]
   ,PPR.SysNo AS [ProductPriceRequest.SysNo] 
   ,PPR.BasicPrice AS [ProductPriceRequest.BasicPrice] 
   ,PPR.CurrentPrice AS [ProductPriceRequest.CurrentPrice] 
   ,PPR.CashRebate AS [ProductPriceRequest.CashRebate] 
   ,PPR.Point AS [ProductPriceRequest.Point] 
   ,PPR.Status AS [ProductPriceRequest.RequestStatus]
   ,PPR.PMMemo AS [ProductPriceRequest.PMMemo]
   ,PPR.TLMemo AS [ProductPriceRequest.TLMemo]
   ,PPR.PMDMemo AS [ProductPriceRequest.PMDMemo]
   ,PPR.IsUseAlipayVipPrice AS [ProductPriceRequest.IsUseAlipayVipPrice]
   ,PPR.AlipayVipPrice AS [ProductPriceRequest.AlipayVipPrice]
   ,P.[Status] AS [ProductStatus] 
   ,P.SysNo AS [SysNo]
   ,p.EntryRecord as [ProductBasicInfo.EntryRecord]
   ,p.TariffPrice as [ProductBasicInfo.TariffPrice] 
   ,p.TaxNo as [ProductBasicInfo.TaxNo] 
   ,P.DefaultImage AS [ProductBasicInfo.DefaultImage]
   ,PStatus.FirstOnlineTime AS [FirstOnSaleDate] 
   ,V.VendorID AS [Merchant.MerchantID] 
   ,CASE WHEN V.VendorType=0 THEN '食佳时代' ELSE V.VendorName END AS [Merchant.MerchantName]
   ,V.SysNo AS [Merchant.SysNo] 
   ,PP.MaxPerOrder AS [LimitQuantityPerOrder] 
   ,PP.PointType AS [PointType] 
   ,CASE 
        WHEN (ED.Status IS NULL OR ED.Status='D') THEN 0 ELSE 1 END AS [ProductWarrantyInfo.IsNoExtendWarranty]
   ,JDP.JDItemNumber AS [JDProductID]
   ,JDP.JDPrice AS [ProductPriceInfo.JDPrice]
   ,AMP.AMItemNumber AS [AMProductID]
   ,AMP.AMPrice AS [ProductPriceInfo.AMPrice]
   ,LPOI.LastVendorSysNo AS [ProductPOInfo.LastVendorSysNo]
   ,VUSER.UserSysNo AS [ProductBasicInfo.ProductManager.SysNo] 
   ,VUSER.DisplayName AS [ProductBasicInfo.ProductManager.UserInfo.UserDisplayName] 
   ,VUSER.EmailAddress AS [ProductBasicInfo.ProductManager.UserInfo.EmailAddress] 
   ,VUSER.UserSysNo AS [ProductBasicInfo.ProductManager.UserInfo.SysNo] 
   ,P.ShoppingGuideURL AS [ProductBasicInfo.ShoppingGuideURL] 
   ,Ex.SafeQty AS [ProductBasicInfo.SafeQty] 
   ,Ex.ProductTradeType AS [ProductBasicInfo.TradeType] 
   ,v_ex.InvoiceType AS [Merchant.VendorInvoiceType]
   ,P.ShoppingGuideURL AS [Merchant.ShoppingGuideURL]
   ,pei.StoreType as [ProductBasicInfo.StoreType] 
FROM [IPP3].[dbo].[Product] P WITH(NOLOCK) 
LEFT JOIN IPP3.dbo.Product_Ex EX WITH(NOLOCK) 
    ON P.SysNo=Ex.SysNo 
LEFT JOIN IPP3.dbo.Product_Status PStatus WITH(NOLOCK) 
    ON P.SysNo=PStatus.ProductSysNo 
INNER JOIN [OverseaContentManagement].[dbo].[ProductCommonInfo] PCI WITH(NOLOCK) 
    ON P.ProductCommonInfoSysno=PCI.SysNo 
LEFT JOIN OverseaContentManagement.dbo.ProductCommonInfo_Ex PCI_EX WITH(NOLOCK) 
    ON PCI.SysNo=PCI_EX.SysNo
LEFT JOIN OverseaContentManagement.dbo.ProductCommonInfo_Status PCI_Status WITH(NOLOCK)
    ON PCI.CommonSKUNumber=PCI_Status.CommonSKUNumber
INNER JOIN IPP3.dbo.Category3 C3 WITH(NOLOCK) 
    ON P.C3SysNo=C3.SysNo 
LEFT JOIN OverseaContentManagement.dbo.Brand B WITH(NOLOCK) 
    ON P.BrandSysNo=B.SysNo 
LEFT JOIN IPP3.dbo.Manufacturer M WITH(NOLOCK) 
    ON B.ManufacturerSysNo=M.SysNo 
INNER JOIN [IPP3].[dbo].[Product_Price] PP WITH(NOLOCK) 
    ON P.SysNo=PP.ProductSysNo 
LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList V WITH(NOLOCK) 
    ON P.MerchantSysNo=V.SysNo 
LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo VUSER WITH(NOLOCK) 
    ON P.PMUserSysNo=VUSER.UserSysNo 
LEFT JOIN [IPP3].[dbo].[Product_Price_Request] PPR WITH(NOLOCK) 
    ON P.SysNo=PPR.ProductSysNo 
    AND PPR.Status IN (0,9)
LEFT JOIN IPP3.dbo.Product_PriceCatch JDP WITH(NOLOCK) 
    ON P.SysNo=JDP.ProductSysNo 
LEFT JOIN IPP3.dbo.Product_PriceCatchForAm AMP WITH(NOLOCK) 
    ON P.SysNo=AMP.ProductSysNo
LEFT JOIN OverseaContentManagement.dbo.ExtendWarrantyDisuseItem ED WITH(NOLOCK)
	ON P.SysNo=ED.ProductSysNo
LEFT JOIN IPP3.dbo.Product_LastPOInfo LPOI WITH(NOLOCK)
	ON P.SysNo=LPOI.ProductSysNo
LEFT JOIN [IPP3].[dbo].[Vendor_Ex] v_ex WITH(NOLOCK)
	ON P.MerchantSysNo = v_ex.VendorSysNo
LEFT JOIN [IPP3].[dbo].[Product_EntryInfo] pei WITH(NOLOCK)
	ON P.SysNo=pei.ProductSysNo
WHERE  
    P.[SysNo] = @ProductSysNo
ORDER BY LPOI.LastInTime DESC
      
      
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetSimpleProductInfoBySysNo" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT 
   P.SysNo AS [SysNo] 
   ,P.ProductID AS [ProductID] 
   ,P.PromotionTitle AS [PromotionTitle.Content] 
   ,P.ProductName AS [ProductName.Content] 
   ,P.ProductLine AS [ProductBasicInfo.ProductBriefTitle.Content] 
   ,P.BriefNameAddition AS [ProductBasicInfo.ProductBriefAddition.Content] 
   ,P.IsConsign AS [ProductConsignFlag] 
   ,P.[Status] AS [ProductStatus] 
   ,P.C3SysNo AS [ProductBasicInfo.ProductCategoryInfo.SysNo]
   ,P.BrandSysNo AS [ProductBasicInfo.ProductBrandInfo.SysNo]
   ,P.ProductTitle AS [ProductBasicInfo.ProductTitle.Content]
   ,PCI.ProductGroupSysno
FROM [IPP3].[dbo].[Product] P WITH(NOLOCK)
INNER JOIN [OverseaContentManagement].[dbo].[ProductCommonInfo] PCI WITH(NOLOCK) 
    ON P.ProductCommonInfoSysno=PCI.SysNo 
WHERE  
    P.[SysNo] = @ProductSysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetSimpleProductListByID" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT 
   P.SysNo AS [SysNo] 
   ,P.ProductID AS [ProductID] 
   ,P.PromotionTitle AS [PromotionTitle.Content] 
   ,P.ProductName AS [ProductName.Content] 
   ,P.ProductLine AS [ProductBasicInfo.ProductBriefTitle.Content] 
   ,P.BriefNameAddition AS [ProductBasicInfo.ProductBriefAddition.Content] 
   ,P.IsConsign AS [ProductConsignFlag] 
   ,P.[Status] AS [ProductStatus] 
   ,P.C3SysNo AS [ProductBasicInfo.ProductCategoryInfo.SysNo]
   ,P.ProductTitle AS [ProductBasicInfo.ProductTitle.Content]
FROM [IPP3].[dbo].[Product] P WITH(NOLOCK) 
WHERE  
    P.[ProductID] = @ProductID
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductID" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetProductInfoByID" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
    SELECT TOP 1
    PCI.CommonSKUNumber AS [ProductBasicInfo.CommonSKUNumber] 
   ,C3.SysNo AS [ProductBasicInfo.ProductCategoryInfo.SysNo] 
   ,C3.C3ID AS [ProductBasicInfo.ProductCategoryInfo.CategoryID] 
   ,C3.C3Name AS [ProductBasicInfo.ProductCategoryInfo.CategoryName.Content] 
   ,C3.[Status] AS [ProductBasicInfo.ProductCategoryInfo.Status] 
   ,B.SysNo AS [ProductBasicInfo.ProductBrandInfo.SysNo] 
   ,B.BrandName_Ch AS [ProductBasicInfo.ProductBrandInfo.BrandNameLocal.Content] 
   ,B.BrandName_En AS [ProductBasicInfo.ProductBrandInfo.BrandNameGlobal] 
   ,B.[Status] AS [ProductBasicInfo.ProductBrandInfo.Status] 
   ,B.[Description] AS [ProductBasicInfo.ProductBrandInfo.BrandDescription.Content] 
   ,B.ServicePhone AS [ProductBasicInfo.ProductBrandInfo.BrandSupportInfo.ServicePhone] 
   ,B.ServiceEmail AS [ProductBasicInfo.ProductBrandInfo.BrandSupportInfo.ServiceEmail] 
   ,B.ServiceUrl AS [ProductBasicInfo.ProductBrandInfo.BrandSupportInfo.ServiceUrl] 
   ,B.Website AS [ProductBasicInfo.ProductBrandInfo.BrandSupportInfo.ManufacturerUrl] 
   ,M.SysNo AS [ProductBasicInfo.ProductBrandInfo.Manufacturer.SysNo] 
   ,M.ManufacturerID AS [ProductBasicInfo.ProductBrandInfo.Manufacturer.ManufacturerID] 
   ,M.ManufacturerName AS [ProductBasicInfo.ProductBrandInfo.Manufacturer.ManufacturerNameLocal.Content] 
   ,M.BriefName AS [ProductBasicInfo.ProductBrandInfo.Manufacturer.ManufacturerNameGlobal] 
   ,M.[Status] AS [ProductBasicInfo.ProductBrandInfo.Manufacturer.Status] 
   ,M.Note AS [ProductBasicInfo.ProductBrandInfo.Manufacturer.ManufacturerDescription.Content] 
   ,M.CustomerServicePhone AS [ProductBasicInfo.ProductBrandInfo.Manufacturer.SupportInfo.ServicePhone] 
   ,M.SupportEmail AS [ProductBasicInfo.ProductBrandInfo.Manufacturer.SupportInfo.ServiceEmail] 
   ,M.SupportURL AS [ProductBasicInfo.ProductBrandInfo.Manufacturer.SupportInfo.ServiceUrl] 
   ,M.ManufacturerWebsite AS [ProductBasicInfo.ProductBrandInfo.Manufacturer.SupportInfo.ManufacturerUrl] 
   ,PCI.ProductName AS [ProductBasicInfo.ProductTitle.Content] 
   ,PCI.ProductModel AS [ProductBasicInfo.ProductModel.Content] 
   ,PCI.Keywords AS [ProductBasicInfo.Keywords.Content] 
   ,PCI.UPCCode AS [ProductBasicInfo.UPCCode]
   ,PCI.BMCode AS [ProductBasicInfo.BMCode]
   ,PCI.ProductType AS [ProductBasicInfo.ProductType] 
   ,PCI.ProductDesc AS [ProductBasicInfo.ShortDescription.Content] 
   ,PCI_EX.ProductDescLong AS [ProductBasicInfo.LongDescription.Content] 
   ,PCI_EX.ProductPhotoDesc AS [ProductBasicInfo.PhotoDescription.Content] 
   ,PCI_EX.Performance AS [ProductBasicInfo.Performance] 
   ,PCI.PackageList AS [ProductBasicInfo.PackageList.Content] 
   ,PCI.ProductLink AS [ProductBasicInfo.ProductLink] 
   ,PCI.Attention AS [ProductBasicInfo.Attention.Content]        
   ,PCI.[Length] AS [ProductBasicInfo.ProductDimensionInfo.Length] 
   ,PCI.Width AS [ProductBasicInfo.ProductDimensionInfo.Width] 
   ,PCI.Height AS [ProductBasicInfo.ProductDimensionInfo.Height] 
   ,PCI.Weight AS [ProductBasicInfo.ProductDimensionInfo.Weight] 
   ,PCI.IsLarge AS [ProductBasicInfo.ProductDimensionInfo.LargeFlag] 
   ,PCI.IsTakePictures AS [ProductBasicInfo.IsTakePicture] 
   ,PCI.MinPackNumber AS [ProductPOInfo.MinPackNumber] 
   ,PCI.Note AS [ProductBasicInfo.Note] 
   ,PCI.SysNo AS [ProductCommonInfoSysNo] 
   ,PCI.EditDate AS [LastEditDate] 
   ,P.SysNo AS [SysNo] 
   ,P.ProductID AS [ProductID] 
   ,P.PromotionTitle AS [PromotionTitle.Content] 
   ,P.ProductName AS [ProductName.Content] 
   ,P.ProductLine AS [ProductBasicInfo.ProductBriefTitle.Content] 
   ,P.BriefNameAddition AS [ProductBasicInfo.ProductBriefAddition.Content] 
   ,P.IsConsign AS [ProductConsignFlag] 
   ,P.ProductDescLong AS [ProductBasicInfo.LongDescription.Content]
   ,P.SourceProductID AS [SourceProductID]
   ,Ex.HostWarrantyDay AS [ProductWarrantyInfo.HostWarrantyDay] 
   ,Ex.PartWarrantyDay AS [ProductWarrantyInfo.PartWarrantyDay] 
   ,P.Warranty AS [ProductWarrantyInfo.Warranty.Content] 
   ,Ex.ServicePhone AS [ProductWarrantyInfo.ServicePhone] 
   ,Ex.ServiceInfo AS [ProductWarrantyInfo.ServiceInfo] 
   ,Ex.IsOfferValueAddedInvoice AS [ProductWarrantyInfo.OfferVATInvoice] 
   ,Ex.PO_Memo AS [ProductPOInfo.POMemo]
   ,Ex.ProductInfoFinishStatus AS [ProductBasicInfo.ProductInfoFinishStatus]
   ,Ex.AutoAdjustPrice AS [AutoAdjustPrice.IsAutoAdjustPrice]
   ,Ex.AutoPricingStartDate AS [AutoAdjustPrice.NotAutoPricingBeginDate]
   ,Ex.AutoPricingEndDate AS [AutoAdjustPrice.NotAutoPricingEndDate]
   ,PStatus.AllowStatus AS [ProductWarrantyInfo.WarrantyShow] 
   ,PCI_Status.IsAccessoriesShow AS [ProductBasicInfo.IsAccessoryShow] 
   ,PCI_Status.IsVirtualPic AS [ProductBasicInfo.IsVirtualPic] 
   ,PP.BasicPrice AS [ProductPriceInfo.BasicPrice] 
   ,PP.CurrentPrice AS [ProductPriceInfo.CurrentPrice] 
   ,PP.Point AS [ProductPriceInfo.Point] 
   ,PP.CashRebate AS [ProductPriceInfo.CashRebate] 
   ,PP.Discount AS [ProductPriceInfo.DiscountAmount] 
   ,PP.UnitCost AS [ProductPriceInfo.UnitCost] 
   ,PP.UnitCostWithoutTax AS [ProductPriceInfo.UnitCostWithoutTax] 
   ,PP.VirtualPrice AS [ProductPriceInfo.VirtualPrice] 
   ,PP.MinCountPerOrder AS [ProductPriceInfo.MinCountPerOrder] 
   ,PP.MaxPerOrder AS [ProductPriceInfo.MaxCountPerDay] 
   ,PP.PointType AS [ProductPriceInfo.PayType]
   ,PP.IsUseAlipayVipPrice AS [ProductPriceInfo.IsUseAlipayVipPrice]
   ,PP.AlipayVipPrice AS [ProductPriceInfo.AlipayVipPrice]
   ,PPR.SysNo AS [ProductPriceRequest.SysNo] 
   ,PPR.BasicPrice AS [ProductPriceRequest.BasicPrice] 
   ,PPR.CurrentPrice AS [ProductPriceRequest.CurrentPrice] 
   ,PPR.CashRebate AS [ProductPriceRequest.CashRebate] 
   ,PPR.Point AS [ProductPriceRequest.Point] 
   ,PPR.Status AS [ProductPriceRequest.RequestStatus]
   ,PPR.PMMemo AS [ProductPriceRequest.PMMemo]
   ,PPR.TLMemo AS [ProductPriceRequest.TLMemo]
   ,PPR.PMDMemo AS [ProductPriceRequest.PMDMemo]
   ,PPR.IsUseAlipayVipPrice AS [ProductPriceRequest.IsUseAlipayVipPrice]
   ,PPR.AlipayVipPrice AS [ProductPriceRequest.AlipayVipPrice]
   ,P.[Status] AS [ProductStatus] 
   ,P.SysNo AS [SysNo] 
   ,PStatus.FirstOnlineTime AS [FirstOnSaleDate] 
   ,V.VendorID AS [Merchant.MerchantID] 
   ,V.VendorName AS [Merchant.MerchantName]
   ,V.SysNo AS [Merchant.SysNo] 
   ,PP.MaxPerOrder AS [LimitQuantityPerOrder] 
   ,PP.PointType AS [PointType] 
   ,CASE 
        WHEN (ED.Status IS NULL OR ED.Status='D') THEN 0 ELSE 1 END AS [ProductWarrantyInfo.IsNoExtendWarranty]
   ,JDP.JDItemNumber AS [JDProductID]
   ,JDP.JDPrice AS [ProductPriceInfo.JDPrice]
   ,AMP.AMItemNumber AS [AMProductID]
   ,AMP.AMPrice AS [ProductPriceInfo.AMPrice]
   ,LPOI.LastVendorSysNo AS [ProductPOInfo.LastVendorSysNo]
   ,VUSER.UserSysNo AS [ProductBasicInfo.ProductManager.SysNo] 
   ,VUSER.DisplayName AS [ProductBasicInfo.ProductManager.UserInfo.UserDisplayName] 
   ,VUSER.EmailAddress AS [ProductBasicInfo.ProductManager.UserInfo.EmailAddress] 
   ,VUSER.UserSysNo AS [ProductBasicInfo.ProductManager.UserInfo.SysNo] 
FROM [IPP3].[dbo].[Product] P WITH(NOLOCK) 
LEFT JOIN IPP3.dbo.Product_Ex EX WITH(NOLOCK) 
    ON P.SysNo=Ex.SysNo 
LEFT JOIN IPP3.dbo.Product_Status PStatus WITH(NOLOCK) 
    ON P.SysNo=PStatus.ProductSysNo 
INNER JOIN [OverseaContentManagement].[dbo].[ProductCommonInfo] PCI WITH(NOLOCK) 
    ON P.ProductCommonInfoSysno=PCI.SysNo 
LEFT JOIN OverseaContentManagement.dbo.ProductCommonInfo_Ex PCI_EX WITH(NOLOCK) 
    ON PCI.SysNo=PCI_EX.SysNo
LEFT JOIN OverseaContentManagement.dbo.ProductCommonInfo_Status PCI_Status WITH(NOLOCK)
    ON PCI.CommonSKUNumber=PCI_Status.CommonSKUNumber
INNER JOIN IPP3.dbo.Category3 C3 WITH(NOLOCK) 
    ON P.C3SysNo=C3.SysNo 
LEFT JOIN OverseaContentManagement.dbo.Brand B WITH(NOLOCK) 
    ON P.BrandSysNo=B.SysNo 
LEFT JOIN IPP3.dbo.Manufacturer M WITH(NOLOCK) 
    ON B.ManufacturerSysNo=M.SysNo 
INNER JOIN [IPP3].[dbo].[Product_Price] PP WITH(NOLOCK) 
    ON P.SysNo=PP.ProductSysNo 
LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList V WITH(NOLOCK) 
    ON P.MerchantSysNo=V.SysNo 
LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo VUSER WITH(NOLOCK) 
    ON P.PMUserSysNo=VUSER.UserSysNo 
LEFT JOIN [IPP3].[dbo].[Product_Price_Request] PPR WITH(NOLOCK) 
    ON P.SysNo=PPR.ProductSysNo 
    AND PPR.Status IN (0,9)
LEFT JOIN IPP3.dbo.Product_PriceCatch JDP WITH(NOLOCK) 
    ON P.SysNo=JDP.ProductSysNo 
LEFT JOIN IPP3.dbo.Product_PriceCatchForAm AMP WITH(NOLOCK) 
    ON P.SysNo=AMP.ProductSysNo
LEFT JOIN OverseaContentManagement.dbo.ExtendWarrantyDisuseItem ED WITH(NOLOCK)
	ON P.SysNo=ED.ProductSysNo
LEFT JOIN IPP3.dbo.Product_LastPOInfo LPOI WITH(NOLOCK)
	ON P.SysNo=LPOI.ProductSysNo
WHERE  
    P.[ProductID] = @ProductID
ORDER BY LPOI.LastInTime DESC    
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductID" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetSourceProductID" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT 
    SourceProductID 
FROM IPP3.DBO.Product WITH(NOLOCK) 
WHERE 
    SysNo=@ProductSysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdateProductStatus" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
      UPDATE IPP3.dbo.Product 
      SET Status=@ProductStatus 
WHERE 
    SysNo=@ProductSysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@ProductStatus" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdateProductOnlineTime" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
      DECLARE @FirstOnlineTime datetime

SET @FirstOnlineTime = (SELECT 
                            FirstOnlineTime 
                        FROM IPP3.dbo.Product_Status WITH(NOLOCK) 
                        WHERE 
                            ProductSysNo=@ProductSysNo
                     
                     )

IF(@FirstOnlineTime IS NULL)
BEGIN
	SET @FirstOnlineTime=GETDATE()
END

UPDATE IPP3.dbo.Product_Status 
SET FirstOnlineTime=@FirstOnlineTime
   ,LastOnlineTime=GETDATE() 
WHERE 
    ProductSysNo=@ProductSysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetProductSysNoListByProductGroupSysNo" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT P.SysNo 
      FROM IPP3.dbo.Product P WITH(NOLOCK) 
      INNER JOIN OverseaContentManagement.dbo.ProductCommonInfo PCI WITH(NOLOCK) 
        ON p.ProductCommonInfoSysno=PCI.SysNo 
      INNER JOIN OverseaContentManagement.dbo.ProductGroupInfo PGI WITH(NOLOCK) 
        ON PCI.ProductGroupSysno=PGI.SysNo
      INNER JOIN IPP3.dbo.Category3 C3 WITH(NOLOCK) 
        ON P.C3SysNo=C3.SysNo 
      WHERE PGI.SYSNO=@ProductGroupSysNo
      ORDER BY P.SysNo 
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductGroupSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetProductAccessoryListByProductSysNo" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT 
    PA.SysNo
   ,A.Sysno AS [AccessoryInfo.SysNo] 
   ,A.AccessoriesID AS [AccessoryInfo.AccessoryID] 
   ,A.AccessoriesName AS [AccessoryInfo.AccessoryName.Content]
   ,CASE WHEN PA.Status IS NULL THEN -1 ELSE PA.Status END AS [Status]
   ,PA.Qty AS [Qty] 
   ,PA.Description AS [Description.Content] 
   ,(CASE WHEN PA.ListOrder IS NULL THEN CA.AccessoryOrder ELSE PA.ListOrder END) AS [Priority] 
FROM IPP3.dbo.Category_Accessories CA WITH(NOLOCK) 
INNER JOIN IPP3.dbo.Accessories A WITH(NOLOCK) 
    ON CA.AccessoriesSysno=A.Sysno 
LEFT JOIN IPP3.dbo.Product_Accessories PA WITH(NOLOCK) 
    ON CA.AccessoriesSysno=PA.AccessoriesSysno 
    AND PA.ProductSysno=@ProductSysNo 
WHERE 
    CA.C3Sysno=@CategorySysNo 
    AND CA.Status=0
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@CategorySysNo" dbType="Int32" />
    </parameters>
  </dataCommand>


  <dataCommand name="GetProductPropertyListByProductCommonInfoSysNo" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
    DECLARE @CommonSkuNumber nvarchar(20)
    DECLARE @ProductSysNo INT
    SELECT 
        @CommonSkuNumber=PCI.CommonSKUNumber,
        @ProductSysNo=PRO.SysNo
    FROM OverseaContentManagement.dbo.ProductCommonInfo PCI WITH(NOLOCK)
    INNER JOIN IPP3.dbo.Product PRO WITH(NOLOCK)
    ON PCI.SysNo=PRO.ProductCommonInfoSysno AND PCI.SysNo=@ProductCommonInfoSysNo
                    

    SELECT
	      PPR.SysNo 
       ,PP.SysNo AS [Property.PropertyInfo.SysNo] 
       ,PP.PropertyDescription AS [Property.PropertyInfo.PropertyName.Content] 
       ,PP.IsActive AS [Property.PropertyInfo.Status] 
       ,PPV.ValueDescription AS [Property.ValueDescription.Content] 
       ,PPV.IsActive AS [Property.ValueStatus] 
       ,CTP.Priority AS [Property.Priority] 
       ,PPV.SysNo AS [Property.SysNo] 
       ,PCIP.ManualInput AS [PersonalizedValue.Content] 
       ,PG.SysNo AS [PropertyGroup.SysNo]
       ,PG.GroupDescription AS [PropertyGroup.PropertyGroupName.Content]
       ,CTP.IsMustInput AS [Required]
    FROM PMDB.dbo.PIM_CategoryTemplate CT WITH(NOLOCK) 
    INNER JOIN PMDB.dbo.PIM_CategoryTemplateProperty CTP WITH(NOLOCK) 
        ON CT.SysNo=CTP.CategoryTemplateSysNo 
    INNER JOIN PMDB.dbo.PIM_Property PP WITH(NOLOCK) 
        ON CTP.PropertySysNo = PP.SysNo
    LEFT JOIN OverseaContentManagement.dbo.ProductCommonInfo_Property PCIP WITH(NOLOCK) 
        ON CTP.PropertySysNo=PCIP.PropertySysno 
        AND PCIP.CommonSKUNumber=@CommonSkuNumber
    LEFT JOIN [PMDB].[dbo].[PIM_ProductProperty] PPR WITH(NOLOCK) 
	    ON PPR.ProductSysNo=@ProductSysNo AND PPR.PropertySysNo=PCIP.PropertySysNo
    LEFT JOIN PMDB.dbo.PIM_PropertyGroup PG WITH(NOLOCK)
	      ON CTP.GroupSysno=PG.SysNo
    LEFT JOIN OverseaContentManagement.dbo.ProductCommonInfo PCI WITH(NOLOCK) 
        ON PCIP.CommonSKUNumber=PCI.CommonSKUNumber
    LEFT JOIN PMDB.dbo.PIM_PropertyValue PPV WITH(NOLOCK) 
        ON PCIP.ValueSysno=PPV.SysNo and PPV.IsActive=1  
    WHERE 
        CT.CategorySysNo=@CategorySysNo  order by CTP.Priority,CTP.SysNo
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductCommonInfoSysNo" dbType="Int32" />
      <param name="@CategorySysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetProductSalesAreaInfoBySysNo" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT 
    StockSysNo AS [Stock.SysNo]
   ,StockName AS [Stock.StockName]
   ,ProvinceSysNo AS [Province.ProvinceSysNo]
   ,ProvinceName AS [Province.ProvinceName]
   ,CitySysNo AS [Province.CitySysNo]
   ,CityName AS [Province.CityName]
FROM OverseaContentManagement.dbo.ProductRestrictedArea WITH(NOLOCK) 
WHERE 
    Status='A' AND ProductSysNo=@ProductSysNo
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetProductTimelyPromotionTitle" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
    SELECT 
    [PromotionTitle] AS [PromotionTitle.Content]
   ,[Type] AS [PromotionTitleType]
   ,[BeginDate] AS [BeginDate]
   ,[EndDate] AS [EndDate]
   ,[Status] AS [Status]
FROM [OverseaContentManagement].[dbo].[Product_PromotionTitle] WITH (NOLOCK) 
WHERE 
    ProductSysNo=@ProductSysNo
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetProductMappingList" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
    SELECT 
    PartnerType AS [ThirdPartner]
   ,SynProductID AS [SynProductID]
   ,VFType AS [StockRules]
   ,LimitVFQty AS [LimitQty]
   ,Status AS [Status] 
FROM OverseaContentManagement.dbo.Product3Party_Mapping WITH(NOLOCK) 
WHERE 
    ProductSysno=@ProductSysNo AND PartnerType IN ('H','X','B','Y','I')
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="InsertProductAccessory" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
    INSERT INTO [IPP3].[dbo].[Product_Accessories] 
(
     [ProductSysno] 
    ,[AccessoriesSysno] 
    ,[Status] 
    ,[Qty] 
    ,[Description] 
    ,[CreateDate] 
    ,[UpdateDate] 
    ,[CreateUserSysno] 
    ,[UpdateUserSysno] 
    ,[ListOrder] 
    ,[CompanyCode] 
    ,[LanguageCode] 
    ,[StoreCompanyCode]
) 
VALUES
(
     @ProductSysNo 
    ,@AccessoriesSysno 
    ,@Status 
    ,@Qty 
    ,@Description 
    ,GETDATE() 
    ,GETDATE() 
    ,@InUserSysNo 
    ,@InUserSysNo 
    ,@ListOrder 
    ,@CompanyCode 
    ,@LanguageCode 
    ,@CompanyCode
)
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@AccessoriesSysno" dbType="Int32" />
      <param name="@Status" dbType="Int32" />
      <param name="@Qty" dbType="Int32" />
      <param name="@Description" dbType="String" />
      <param name="@ListOrder" dbType="Int32" />
      <param name="@InUserSysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@LanguageCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="DeleteProductAccessory" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
    DELETE 
FROM [IPP3].[dbo].[Product_Accessories] 
WHERE 
    ProductSysNo=@ProductSysNo
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="InsertProductSalesArea" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
    INSERT INTO [OverseaContentManagement].[dbo].[ProductRestrictedArea] 
( 
     [ProductSysNo] 
    ,[ProductID] 
    ,[ProductName] 
    ,[StockSysNo] 
    ,[StockName] 
    ,[ProvinceSysNo] 
    ,[ProvinceName] 
    ,[CitySysNo]
    ,[CityName]
    ,[InDate] 
    ,[InUser] 
    ,[EditDate] 
    ,[EditUser] 
    ,[CompanyCode] 
    ,[CountryCode] 
    ,[LanguageCode] 
    ,[Status] 
    ,[StoreCompanyCode] 
) 
VALUES
( 
     @ProductSysNo 
    ,@ProductID 
    ,@ProductName 
    ,@StockSysNo 
    ,@StockName 
    ,@ProvinceSysNo 
    ,@ProvinceName 
    ,@CitySysNo 
    ,@CityName 
    ,GETDATE()
    ,@InUser
    ,GETDATE()
    ,@InUser
    ,@CompanyCode 
    ,NULL 
    ,@LanguageCode
    ,'A'
    ,@CompanyCode)
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@ProductID" dbType="String" />
      <param name="@ProductName" dbType="String" />
      <param name="@StockSysNo" dbType="Int32" />
      <param name="@StockName" dbType="String" />
      <param name="@CitySysNo" dbType="Int32" />
      <param name="@CityName" dbType="String" />
      <param name="@ProvinceSysNo" dbType="Int32" />
      <param name="@ProvinceName" dbType="String" />
      <param name="@InUser" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@LanguageCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="DeleteProductSalesArea" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
    DELETE 
FROM [OverseaContentManagement].[dbo].[ProductRestrictedArea] 
WHERE 
    ProductSysNo=@ProductSysNo
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="InsertProductTimelyPromotionTitle" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
    INSERT INTO [OverseaContentManagement].[dbo].[Product_PromotionTitle] 
(
     [ProductSysNo] 
    ,[PromotionTitle] 
    ,[Type] 
    ,[BeginDate] 
    ,[Enddate] 
    ,[Status] 
    ,[InDate] 
    ,[InUser] 
    ,[EditDate] 
    ,[EditUser] 
    ,[CompanyCode] 
    ,[LanguageCode] 
    ,[StoreCompanyCode]
) 
VALUES
(
     @ProductSysNo 
    ,@PromotionTitle 
    ,@Type 
    ,@BeginDate 
    ,@EndDate 
    ,@Status 
    ,GETDATE() 
    ,@InUser 
    ,GETDATE() 
    ,@InUser 
    ,@CompanyCode 
    ,@LanguageCode 
    ,@StoreCompanyCode
)
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@PromotionTitle" dbType="String" />
      <param name="@Type" dbType="String" />
      <param name="@BeginDate" dbType="DateTime" />
      <param name="@EndDate" dbType="DateTime" />
      <param name="@Status" dbType="String" />
      <param name="@InUser" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@LanguageCode" dbType="AnsiStringFixedLength" />
      <param name="@StoreCompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="DeleteProductTimelyPromotionTitle" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
    DELETE 
FROM [OverseaContentManagement].[dbo].[Product_PromotionTitle] 
WHERE 
    ProductSysNo=@ProductSysNo
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetProductCountExcept" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
    SELECT 
    COUNT(1) 
FROM IPP3.dbo.Product WITH(NOLOCK) 
WHERE 
    BrandSysNo=@BrandSysNo 
    AND C3SysNo=@CategorySysNo 
    AND ProductMode = @ProductModel 
    AND MerchantSysNo=@MechantSysNo 
    AND SysNo != @ProductSysNo
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@BrandSysNo" dbType="Int32" />
      <param name="@CategorySysNo" dbType="Int32" />
      <param name="@ProductModel" dbType="String" />
      <param name="@MechantSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdateProductBasicInfo" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
    DECLARE @ManufacturerSysNo int
SET @ManufacturerSysNo = (SELECT 
                              ManufacturerSysNo 
                          FROM OverseaContentManagement.dbo.Brand WITH(NOLOCK) 
                          WHERE 
                              SysNo=@BrandSysNo
                       
                       )

UPDATE [IPP3].[dbo].[Product] 
SET [ManufacturerSysNo] = @ManufacturerSysNo 
   ,[BrandSysNo] = @BrandSysNo 
   ,[C3SysNo] = @CategorySysNo 
   ,[IsConsign] = @ProductConsignFlag
   ,[ProductName] = @ProductName
   ,[PromotionTitle] = @PromotionTitle 
   ,[ProductLine] = @ProductBriefTitle 
   ,[BriefNameAddition] = @ProductBriefAddition
   ,[TaxNo]=@TaxNo
   ,[EntryRecord]=@EntryRecord
   ,[TariffPrice]=@TariffPrice
   ,[ShoppingGuideURL]=@ShoppingGuideURL
WHERE 
    [SysNo] = @ProductSysNo
    
UPDATE [IPP3].[dbo].[Product_Ex]
SET ProductTradeType = @TradeType,SafeQty=@SafeQty
WHERE 
    [SysNo] = @ProductSysNo
    
    UPDATE [IPP3].[dbo].[Product_EntryInfo]
SET StoreType = @StoreType
WHERE 
    [ProductSysNo] = @ProductSysNo
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@BrandSysNo" dbType="Int32" />
      <param name="@CategorySysNo" dbType="Int32" />
      <param name="@ProductName" dbType="String" />
      <param name="@PromotionTitle" dbType="String" />
      <param name="@ProductBriefTitle" dbType="String" />
      <param name="@ProductBriefAddition" dbType="String" />
      <param name="@ProductConsignFlag" dbType="Int32" />
      <param name="@TaxNo" dbType="String" />
      <param name="@EntryRecord" dbType="String" />
      <param name="@TariffPrice" dbType="String" />
      <param name="@ShoppingGuideURL" dbType="String" />
      <param name="@TradeType" dbType="Int32" />
      <param name="@SafeQty" dbType="Int32" />
      <param name="@StoreType" dbType="Int32" />
    </parameters>
  </dataCommand>

  <!--批量修改商品信息是调用（修改的内容：商品标题（和商品名称）、商品简名、简名附加、商品的描述）-->
  <dataCommand name="UpdateProductBasicInfoWhenBatchUpdate" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
      
          DECLARE @ManufacturerSysNo int
SET @ManufacturerSysNo = (SELECT 
                              ManufacturerSysNo 
                          FROM OverseaContentManagement.dbo.Brand WITH(NOLOCK) 
                          WHERE 
                              SysNo=@BrandSysNo
                       
                       )
                       
         UPDATE  ipp3.dbo.product 
         SET ProductTitle = @ProductTitle,
         ProductName = @ProductTitle,
         ProductDesc = @ProductDesc,
         BriefName = @BriefName,
         ProductLine = @BriefName,
         BriefNameAddition = @BriefNameAddition,
         PackageList = @PackageList,
         Attention = @Attention,
         Note = @Note,
         ProductLink = @ProductLink
         ,[ManufacturerSysNo] = @ManufacturerSysNo 
   ,[BrandSysNo] = @BrandSysNo 
   ,[C3SysNo] = @CategorySysNo 
   ,[IsConsign] = @ProductConsignFlag
         WHERE SysNo = @SysNo
         
         UPDATE [OverseaContentManagement].[dbo].[ProductCommonInfo] 
         Set ProductName = @ProductTitle,ProductDesc = @ProductDesc
         ,PackageList=@PackageList,Attention=@Attention,Note=@Note
         ,ProductLink=@ProductLink,BMCode=@BMCode,UPCCode=@UPCCode
         where sysno in (select ProductCommonInfoSysno from   ipp3.dbo.product  where SysNo = @SysNo)
     
         UPDATE [IPP3].[dbo].[Product_Ex]
        SET ProductTradeType = @TradeType,SafeQty=@SafeQty
        WHERE 
            [SysNo] = @SysNo
    
        UPDATE [IPP3].[dbo].[Product_EntryInfo]
        SET StoreType = @StoreType
        WHERE 
            [ProductSysNo] = @SysNo
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductTitle" dbType="String" />
      <param name="@ProductDesc" dbType="String" />
      <param name="@BriefName" dbType="String" />
      <param name="@BriefNameAddition" dbType="String" />
      <param name="@PackageList" dbType="String" />
      <param name="@Attention" dbType="String" />
      <param name="@Note" dbType="String" />
      <param name="@ProductLink" dbType="String" />
      <param name="@TradeType" dbType="Int32" />
      <param name="@SafeQty" dbType="Int32" />
      <param name="@StoreType" dbType="Int32" />
      <param name="@BMCode" dbType="String" />
      <param name="@UPCCode" dbType="String" />
      <param name="@ProductConsignFlag" dbType="Int32" />
      <param name="@BrandSysNo" dbType="Int32" />
      <param name="@CategorySysNo" dbType="Int32" />
      <param name="@SysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdateGroupProductBrandInfo" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
      DECLARE @ManufacturerSysNo int

      SET @ManufacturerSysNo=(SELECT 
                                  ManufacturerSysNo 
                              FROM OverseaContentManagement.dbo.Brand WITH(NOLOCK) 
                              WHERE 
                                  SysNo=@BrandSysNo  
                     
                           )


      UPDATE OverseaContentManagement.dbo.ProductGroupInfo 
      SET BrandSysno=@BrandSysNo
         ,EditUser=@EditUser
         ,EditDate=GETDATE() 
      WHERE 
          SysNo=@ProductGroupSysNo

      UPDATE OverseaContentManagement.dbo.ProductCommonInfo 
      SET EditUser=@EditUser
         ,EditDate=GETDATE() 
      WHERE 
          ProductGroupSysno=@ProductGroupSysNo


      UPDATE IPP3.dbo.Product 
      SET BrandSysNo=@BrandSysNo 
         ,ManufacturerSysNo=@ManufacturerSysNo 
      WHERE 
          SysNo IN ( 
                  SELECT 
                      P.SysNo 
                  FROM IPP3.dbo.Product P WITH(NOLOCK) 
                  INNER JOIN OverseaContentManagement.dbo.ProductCommonInfo PCI WITH(NOLOCK) 
                      ON P.ProductCommonInfoSysno = PCI.SysNo 
                  INNER JOIN OverseaContentManagement.dbo.ProductGroupInfo PGI WITH(NOLOCK) 
                      ON PCI.ProductGroupSysno=PGI.SysNo 
                  WHERE 
                      PGI.SysNo = @ProductGroupSysNo)
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductGroupSysNo" dbType="Int32" />
      <param name="@BrandSysNo" dbType="Int32" />
      <param name="@EditUser" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdateGroupProductCategoryInfo" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
      UPDATE OverseaContentManagement.dbo.ProductGroupInfo 
      SET C3SysNo=@CategorySysNo
         ,EditUser=@EditUser
         ,EditDate=GETDATE() 
      WHERE 
          SysNo=@ProductGroupSysNo

      UPDATE OverseaContentManagement.dbo.ProductCommonInfo 
      SET EditUser=@EditUser 
         ,EditDate=GETDATE() 
      WHERE 
          ProductGroupSysno=@ProductGroupSysNo

      UPDATE IPP3.dbo.Product 
      SET C3SysNo=@CategorySysNo 
      WHERE 
          SysNo IN ( 
                  SELECT 
                      P.SysNo 
                  FROM IPP3.dbo.Product P WITH(NOLOCK) 
                  INNER JOIN OverseaContentManagement.dbo.ProductCommonInfo PCI WITH(NOLOCK) 
                      ON P.ProductCommonInfoSysno = PCI.SysNo 
                  INNER JOIN OverseaContentManagement.dbo.ProductGroupInfo PGI WITH(NOLOCK) 
                      ON PCI.ProductGroupSysno=PGI.SysNo 
                  WHERE 
                      PGI.SysNo = @ProductGroupSysNo)
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductGroupSysNo" dbType="Int32" />
      <param name="@CategorySysNo" dbType="Int32" />
      <param name="@EditUser" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdateProductPromotionType" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
    UPDATE IPP3.dbo.Product_Ex 
SET PromotionType=@PromotionType 
WHERE 
    SysNo=@ProductSysNo
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@PromotionType" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdateProductInfoFinishStatus" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
    UPDATE IPP3.dbo.Product_Ex 
SET ProductInfoFinishStatus=@ProductInfoFinishStatus 
WHERE 
    SysNo=@ProductSysNo
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@ProductInfoFinishStatus" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdateProductIsNoExtendWarranty" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
    DECLARE @Count int
SET @Count = (SELECT 
                  COUNT(1) 
              FROM OverseaContentManagement.dbo.ExtendWarrantyDisuseItem WITH(NOLOCK) 
              WHERE 
                  ProductSysNo=@ProductSysNo  
           
           )

IF(@Count=1)
BEGIN
	UPDATE OverseaContentManagement.dbo.ExtendWarrantyDisuseItem 
    SET Status=@Status
       ,EditUser=@InUser
       ,EditDate=GETDATE() 
    WHERE 
        ProductSysNo=@ProductSysNo
END
ELSE
BEGIN
	INSERT INTO [OverseaContentManagement].[dbo].[ExtendWarrantyDisuseItem] 
    ( 
         [ProductSysNo] 
        ,[ProductID] 
        ,[InDate] 
        ,[InUser] 
        ,[CompanyCode] 
        ,[StoreCompanyCode] 
        ,[LanguageCode] 
        ,[CountryCode] 
        ,[EditDate] 
        ,[EditUser] 
        ,[Status] 
    ) 
    VALUES
    ( 
         @ProductSysNo 
        ,@ProductID 
        ,GETDATE() 
        ,@InUser 
        ,@CompanyCode 
        ,@StoreCompanyCode 
        ,@LanguageCode 
        ,NULL 
        ,GETDATE() 
        ,@InUser 
        ,@Status 
    )
END
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@ProductID" dbType="String" />
      <param name="@Status" dbType="String" />
      <param name="@InUser" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@LanguageCode" dbType="AnsiStringFixedLength" />
      <param name="@StoreCompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdateProductPurchaseInfo" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
      UPDATE IPP3.dbo.Product_Ex 
      SET MinPackNumber=@MinPackNumber 
         ,PO_Memo=@POMemo
         ,EditUser=@EditUserSysNo
         ,EditDate=GETDATE()
      WHERE 
          SysNo=@ProductSysNo
          
      update ipp3.dbo.product
      set InventoryType=@InventoryType,
      ERPProductID=@ERPProductID
      WHERE 
          SysNo=@ProductSysNo

      DECLARE @ProductCommonInfoSysNo int
      SET @ProductCommonInfoSysNo = (SELECT 
                                         ProductCommonInfoSysNo 
                                     FROM IPP3.dbo.Product WITH(NOLOCK) 
                                     WHERE 
                                         SysNo=@ProductSysNo  
                            
                                  )

      IF(@ProductCommonInfoSysNo IS NOT NULL)
      BEGIN
      UPDATE OverseaContentManagement.dbo.ProductCommonInfo 
      SET MinPackNumber=@MinPackNumber
         ,EditUser=@EditUser
         ,EditDate=GETDATE() 
      WHERE 
          SysNo=@ProductCommonInfoSysNo
      END
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@MinPackNumber" dbType="Int32" />
      <param name="@POMemo" dbType="String" />
      <param name="@ERPProductID" dbType="Int32" />
      <param name="@InventoryType" dbType="Int32" />
      <param name="@EditUser" dbType="String" />
      <param name="@EditUserSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <!--<dataCommand name="UpdateProductThirdPartyInventory" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
    DECLARE @Count int
SET @Count = (SELECT 
                  COUNT(1) 
              FROM OverseaContentManagement.dbo.Product3Party_Mapping WITH(NOLOCK) 
              WHERE 
                  ProductSysNo=@ProductSysNo  
           
           )

IF(@Count=1)
BEGIN
	UPDATE OverseaContentManagement.dbo.Product3Party_Mapping 
    SET SynProductID=@SynProductID 
       ,PartnerType =@PartnerType 
       ,VFType =@VFType 
       ,LimitVFQty=@LimitVFQty 
       ,Status=@Status 
       ,EditUser=@EditUser 
       ,EditDate=GETDATE() 
    WHERE 
        ProductSysNo=@ProductSysNo
END
ELSE
BEGIN
	INSERT INTO [OverseaContentManagement].[dbo].[Product3Party_Mapping] 
    ( 
         [ProductSysno] 
        ,[ProductID] 
        ,[PartnerType] 
        ,[VFType] 
        ,[LimitVFQty] 
        ,[Status] 
        ,[CompanyCode] 
        ,[StoreCompanyCode] 
        ,[LanguageCode] 
        ,[InDate] 
        ,[InUser] 
        ,[EditDate] 
        ,[EditUser] 
        ,[SynProductID] 
    ) 
    VALUES
    ( 
         @ProductSysno 
        ,@ProductID 
        ,@PartnerType 
        ,@VFType 
        ,@LimitVFQty 
        ,@Status 
        ,@CompanyCode 
        ,@StoreCompanyCode 
        ,@LanguageCode 
        ,GETDATE() 
        ,@InUser 
        ,NULL 
        ,NULL 
        ,@SynProductID 
    )
END


DECLARE @VFItem char(1)

IF(@Status='A')
BEGIN
SET @VFItem='Y'
END
ELSE
BEGIN
SET @VFItem='N'
END

UPDATE IPP3.dbo.Product
SET VFItem=@VFItem
WHERE SysNo=@ProductSysNo
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@ProductID" dbType="String" />
      <param name="@SynProductID" dbType="String" />
      <param name="@PartnerType" dbType="String" />
      <param name="@VFType" dbType="String" />
      <param name="@LimitVFQty" dbType="Int32" />
      <param name="@Status" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@LanguageCode" dbType="AnsiStringFixedLength" />
      <param name="@StoreCompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@InUser" dbType="String" />
      <param name="@EditUser" dbType="String" />
    </parameters>
  </dataCommand>-->

  <dataCommand name="UpdateProductAutoPriceInfo" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
      UPDATE IPP3.dbo.Product_Ex 
      SET AutoAdjustPrice=@AutoAdjustPrice 
         ,AutoPricingStartDate=@AutoPricingStartDate 
         ,AutoPricingEndDate=@AutoPricingEndDate 
      WHERE 
          SysNo=@ProductSysNo

      UPDATE OverseaContentManagement.dbo.ProductCommonInfo 
      SET EditUser=@EditUser
         ,EditDate=GETDATE() 
      WHERE 
          SysNo IN (
                  SELECT 
                      ProductCommonInfoSysno 
                  FROM IPP3.dbo.Product WITH(NOLOCK) 
                  WHERE 
                      SysNo=@ProductSysNo)
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@AutoAdjustPrice" dbType="Int32" />
      <param name="@AutoPricingStartDate" dbType="DateTime" />
      <param name="@AutoPricingEndDate" dbType="DateTime" />
      <param name="@EditUser" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdateSourceProductID" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
        UPDATE IPP3.dbo.Product 
    SET SourceProductID=@SourceProductID
    WHERE 
        SysNo=@ProductSysNo
	  ]]>
    </commandText>
    <parameters>
      <param name="@SourceProductID" dbType="String" />
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetProductSequence" database="IMService"  commandType="Text">
    <commandText>
      <![CDATA[
    INSERT INTO IPP3.dbo.Product_Sequence 
( 
     CreateTime 
) 
VALUES
( 
     GETDATE() 
)
SELECT 
    @SysNo = SCOPE_IDENTITY()
		]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" size="10" direction="Output"/>
    </parameters>
  </dataCommand>

  <dataCommand name="InsertProduct" database="IMService"  commandType="Text">
    <commandText>
      <![CDATA[
    DECLARE @IsLargeINT int
DECLARE @ProductTypeINT int

IF(@IsLarge = 'Y')
BEGIN
	SET @IsLargeINT=1
END
ELSE
	SET @IsLargeINT=0

IF(@ProductType = 'B')
BEGIN
	SET @ProductTypeINT=2
END
ELSE IF(@ProductType='S')
BEGIN
	SET @ProductTypeINT=1
END
ELSE IF(@ProductType='V')
BEGIN
	SET @ProductTypeINT=3
END

ELSE
	SET @ProductTypeINT=0

INSERT INTO [IPP3].[dbo].[Product]
           ([SysNo]
           ,[ProductID]
           ,[ProductMode]
           ,[ProductType]
           ,[ProductName]
           ,[ProductDesc]
           ,[ProductDescLong]
           ,[Performance]
           ,[Warranty]
           ,[PackageList]
           ,[Weight]
           ,[C3SysNo]
           ,[ManufacturerSysNo]
           ,[ProductLink]
           ,[PMUserSysNo]
           ,[PPMUserSysNo]
           ,[CreateUserSysNo]
           ,[CreateTime]
           ,[Attention]
           ,[Note]
           ,[BarCode]
           ,[Status]
           ,[IsLarge]
           ,[OrderByDateTime]
           ,[BriefName]
           ,[RemarkCount]
           ,[RemarkScore]
           ,[IsConsign]
           ,[OwnerList]
           ,[PromotionTitle]
           ,[ProductTitle]
           ,[ProductLine]
           ,[BriefNameAddition]
           ,[IsHaveValidGift]
           ,[CompanyCode]
           ,[CurrencySysNo ]
           ,[LanguageCode]
           ,[StoreCompanyCode]
           ,[ProductPhotoDesc]
           ,[VFItem]
           ,[BrandSysNo]
           ,[ProductCommonInfoSysno]
           ,[MerchantSysNo]
           ,[DefaultImage]
           ,[MerchantProductID])
     VALUES
           (@SysNo
           ,@ProductID
           ,@ProductMode
           ,@ProductTypeINT
           ,@ProductName
           ,@ProductDesc
           ,@ProductDescLong
           ,@Performance
           ,@Warranty
           ,@PackageList
           ,@Weight
           ,@C3SysNo
           ,@ManufacturerSysNo
           ,@ProductLink
           ,@PMUserSysNo
           ,@PPMUserSysNo
           ,@CreateUserSysNo
           ,@CreateTime
           ,@Attention
           ,@Note
           ,@BarCode
           ,@Status
           ,@IsLargeINT
           ,@OrderByDateTime
           ,@BriefName
           ,@RemarkCount
           ,@RemarkScore
           ,@IsConsign
           ,@OwnerList
           ,@PromotionTitle
           ,@ProductTitle
           ,@ProductLine
           ,@BriefNameAddition
           ,@IsHaveValidGift
           ,@CompanyCode
           ,@CurrencySysNo
           ,@LanguageCode
           ,@StoreCompanyCode
           ,@ProductPhotoDesc
           ,@VFItem
           ,@BrandSysNo
           ,@ProductCommonInfoSysno
           ,@MerchantSysNo
           ,@DefaultImage
           ,@ProductID)
		]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@ProductID" dbType="String" />
      <param name="@ProductMode" dbType="String" />
      <param name="@ProductType" dbType="String" />
      <param name="@ProductName" dbType="String" />
      <param name="@ProductDesc" dbType="String" />
      <param name="@ProductDescLong" dbType="String" />
      <param name="@Performance" dbType="String" />
      <param name="@Warranty" dbType="String" />
      <param name="@PackageList" dbType="String" />
      <param name="@Weight" dbType="Int32" />
      <param name="@C3SysNo" dbType="Int32" />
      <param name="@ManufacturerSysNo" dbType="Int32" />
      <param name="@ProductLink" dbType="String" />
      <param name="@PMUserSysNo" dbType="Int32" />
      <param name="@PPMUserSysNo" dbType="Int32" />
      <param name="@CreateUserSysNo" dbType="Int32" />
      <param name="@CreateTime" dbType="DateTime" />
      <param name="@Attention" dbType="String" />
      <param name="@Note" dbType="String" />
      <param name="@BarCode" dbType="String" />
      <param name="@Status" dbType="Int32" />
      <param name="@IsLarge" dbType="String" />
      <param name="@OrderByDateTime" dbType="DateTime" />
      <param name="@BriefName" dbType="String" />
      <param name="@RemarkCount" dbType="Int32" />
      <param name="@RemarkScore" dbType="Int32" />
      <param name="@IsConsign" dbType="Int32" />
      <param name="@OwnerList" dbType="String" />
      <param name="@PromotionTitle" dbType="String" />
      <param name="@ProductTitle" dbType="String" />
      <param name="@ProductLine" dbType="String" />
      <param name="@BriefNameAddition" dbType="String" />
      <param name="@IsHaveValidGift" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@CurrencySysNo" dbType="Int32" />
      <param name="@LanguageCode" dbType="AnsiStringFixedLength" />
      <param name="@StoreCompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@ProductPhotoDesc" dbType="String" />
      <param name="@VFItem" dbType="String" />
      <param name="@BrandSysNo" dbType="Int32" />
      <param name="@ProductCommonInfoSysno" dbType="Int32" />
      <param name="@MerchantSysNo" dbType="Int32" />
      <param name="@DefaultImage" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="InsertProductEx" database="IMService"  commandType="Text">
    <commandText>
      <![CDATA[
    DECLARE @IsTakePicturesINT int
DECLARE @AccessoriesIsShowINT int

IF(@AccessoriesIsShow = 'Y')
BEGIN
	SET @AccessoriesIsShowINT=1
END
ELSE
BEGIN
	SET @AccessoriesIsShowINT=0
END

IF(@IsTakePictures = 'Y')
BEGIN
	SET @IsTakePicturesINT=1
END
ELSE
BEGIN
  SET @IsTakePicturesINT=0
END

INSERT INTO [IPP3].[dbo].[Product_Ex] 
( 
     [SysNo] 
    ,[IsPermitRefund] 
    ,[IsOfferValueAddedInvoice] 
    ,[DMSValue] 
    ,[SaleDays] 
    ,[InventoryDays] 
    ,[CompanyProduct] 
    ,[PreviousProductSysNo] 
    ,[BuyOnlyForRank] 
    ,[IsInstalmentProduct] 
    ,[InstalmentPhase] 
    ,[HoldMark] 
    ,[HoldDate] 
    ,[HoldUser] 
    ,[HoldReason] 
    ,[NoInventoryDays] 
    ,[AccessoriesIsShow] 
    ,[AccessoriesMemo] 
    ,[Keywords] 
    ,[IsTakePictures] 
    ,[ProductNotifyTimes] 
    ,[ProductColor] 
    ,[HostWarrantyDay] 
    ,[PartWarrantyDay] 
    ,[ServicePhone] 
    ,[ServiceInfo] 
    ,[WeighupByWMS] 
    ,[IsChangeStylewithTemplate] 
    ,[AutoAdjustPrice] 
    ,[CompanyCode] 
    ,[LanguageCode] 
    ,[StoreCompanyCode] 
    ,[AutoPricingStartDate] 
    ,[AutoPricingEndDate] 
    ,[UnshownAllowSearch] 
    ,[ImageVersion] 
    ,[EditDate] 
    ,[EditUser] 
    ,[MinPackNumber] 
    ,[PO_Memo] 
    ,[Keywords0] 
    ,[IsBatch] 
    ,[ProductInfoFinishStatus]
    ,[ProductTradeType]
) 
VALUES
( 
     @SysNo 
    ,@IsPermitRefund 
    ,@IsOfferValueAddedInvoice 
    ,@DMSValue 
    ,@SaleDays 
    ,@InventoryDays 
    ,@CompanyProduct 
    ,@PreviousProductSysNo 
    ,@BuyOnlyForRank 
    ,@IsInstalmentProduct 
    ,@InstalmentPhase 
    ,@HoldMark 
    ,@HoldDate 
    ,@HoldUser 
    ,@HoldReason 
    ,@NoInventoryDays 
    ,@AccessoriesIsShowINT 
    ,@AccessoriesMemo 
    ,@Keywords 
    ,@IsTakePicturesINT 
    ,@ProductNotifyTimes 
    ,@ProductColor 
    ,@HostWarrantyDay 
    ,@PartWarrantyDay 
    ,@ServicePhone 
    ,@ServiceInfo 
    ,@WeighupByWMS 
    ,@IsChangeStylewithTemplate 
    ,@AutoAdjustPrice 
    ,@CompanyCode 
    ,@LanguageCode 
    ,@StoreCompanyCode 
    ,@AutoPricingStartDate 
    ,@AutoPricingEndDate 
    ,@UnshownAllowSearch 
    ,@ImageVersion 
    ,@EditDate 
    ,@EditUser 
    ,@MinPackNumber 
    ,@PO_Memo 
    ,@Keywords0 
    ,@IsBatch 
    ,@ProductInfoFinishStatus 
    ,@ProductTradeType
)
		]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@IsPermitRefund" dbType="Int32" />
      <param name="@IsOfferValueAddedInvoice" dbType="Int32" />
      <param name="@DMSValue" dbType="Decimal" />
      <param name="@SaleDays" dbType="Decimal" />
      <param name="@InventoryDays" dbType="Int32" />
      <param name="@CompanyProduct" dbType="Int32" />
      <param name="@PreviousProductSysNo" dbType="Int32" />
      <param name="@BuyOnlyForRank" dbType="Int32" />
      <param name="@IsInstalmentProduct" dbType="Int32" />
      <param name="@InstalmentPhase" dbType="Int32" />
      <param name="@HoldMark" dbType="String" />
      <param name="@HoldDate" dbType="DateTime" />
      <param name="@HoldUser" dbType="Int32" />
      <param name="@HoldReason" dbType="String" />
      <param name="@NoInventoryDays" dbType="Int32" />
      <param name="@AccessoriesIsShow" dbType="String" />
      <param name="@AccessoriesMemo" dbType="String" />
      <param name="@Keywords" dbType="String" />
      <param name="@IsTakePictures" dbType="String" />
      <param name="@ProductNotifyTimes" dbType="Int32" />
      <param name="@ProductColor" dbType="String" />
      <param name="@HostWarrantyDay" dbType="Int32" />
      <param name="@PartWarrantyDay" dbType="Int32" />
      <param name="@ServicePhone" dbType="String" />
      <param name="@ServiceInfo" dbType="String" />
      <param name="@WeighupByWMS" dbType="Int32" />
      <param name="@IsChangeStylewithTemplate" dbType="Int32" />
      <param name="@AutoAdjustPrice" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@LanguageCode" dbType="AnsiStringFixedLength" />
      <param name="@StoreCompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@AutoPricingStartDate" dbType="DateTime" />
      <param name="@AutoPricingEndDate" dbType="DateTime" />
      <param name="@UnshownAllowSearch" dbType="String" />
      <param name="@ImageVersion" dbType="String" />
      <param name="@EditDate" dbType="DateTime" />
      <param name="@EditUser" dbType="Int32" />
      <param name="@MinPackNumber" dbType="Int32" />
      <param name="@PO_Memo" dbType="String" />
      <param name="@Keywords0" dbType="String" />
      <param name="@IsBatch" dbType="String" />
      <param name="@ProductInfoFinishStatus" dbType="String" />
      <param name="@ProductTradeType" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="InsertProductPrice" database="IMService"  commandType="Text">
    <commandText>
      <![CDATA[
    INSERT INTO [IPP3].[dbo].[Product_Price] 
(
     [ProductSysNo] 
    ,[BasicPrice] 
    ,[CurrentPrice] 
    ,[UnitCost] 
    ,[Discount] 
    ,[PointType] 
    ,[MaxPerOrder] 
    ,[IsWholeSale] 
    ,[Q1] 
    ,[P1] 
    ,[Q2] 
    ,[P2] 
    ,[Q3] 
    ,[P3] 
    ,[CashRebate] 
    ,[Point] 
    ,[ClearanceSale] 
    ,[CreateTime] 
    ,[UnitCostWithoutTax] 
    ,[IsExistRankPrice] 
    ,[PMMemo] 
    ,[TLMemo] 
    ,[LastOnSaleTime] 
    ,[CompanyCode] 
    ,[CurrencySysNo ] 
    ,[LanguageCode] 
    ,[StoreCompanyCode] 
    ,[ReservedMaxPerOrder] 
    ,[VirtualPrice] 
    ,[SupplyMemo] 
    ,[SupplyPrice] 
    ,[MinCommission] 
    ,[IsUseAlipayVipPrice] 
    ,[AlipayVipPrice] 
    ,[MinCountPerOrder]
) 
VALUES
(
     @ProductSysNo 
    ,@BasicPrice 
    ,@CurrentPrice 
    ,@UnitCost 
    ,@Discount 
    ,@PointType 
    ,@MaxPerOrder 
    ,@IsWholeSale 
    ,@Q1 
    ,@P1 
    ,@Q2 
    ,@P2 
    ,@Q3 
    ,@P3 
    ,@CashRebate 
    ,@Point 
    ,@ClearanceSale 
    ,@CreateTime 
    ,@UnitCostWithoutTax 
    ,@IsExistRankPrice 
    ,@PMMemo 
    ,@TLMemo 
    ,@LastOnSaleTime 
    ,@CompanyCode 
    ,@CurrencySysNo 
    ,@LanguageCode 
    ,@StoreCompanyCode 
    ,@ReservedMaxPerOrder 
    ,@VirtualPrice 
    ,@SupplyMemo 
    ,@SupplyPrice 
    ,@MinCommission 
    ,@IsUseAlipayVipPrice 
    ,@AlipayVipPrice 
    ,@MinCountPerOrder
)
		]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@BasicPrice" dbType="Decimal" />
      <param name="@CurrentPrice" dbType="Decimal" />
      <param name="@UnitCost" dbType="Decimal" />
      <param name="@Discount" dbType="Decimal" />
      <param name="@PointType" dbType="Int32" />
      <param name="@MaxPerOrder" dbType="Int32" />
      <param name="@IsWholeSale" dbType="Int32" />
      <param name="@Q1" dbType="Int32" />
      <param name="@P1" dbType="Decimal" />
      <param name="@Q2" dbType="Int32" />
      <param name="@P2" dbType="Decimal" />
      <param name="@Q3" dbType="Int32" />
      <param name="@P3" dbType="Decimal" />
      <param name="@CashRebate" dbType="Decimal" />
      <param name="@Point" dbType="Int32" />
      <param name="@ClearanceSale" dbType="Int32" />
      <param name="@CreateTime" dbType="DateTime" />
      <param name="@UnitCostWithoutTax" dbType="Decimal" />
      <param name="@IsExistRankPrice" dbType="Int32" />
      <param name="@PMMemo" dbType="String" />
      <param name="@TLMemo" dbType="String" />
      <param name="@LastOnSaleTime" dbType="DateTime" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@CurrencySysNo" dbType="Int32" />
      <param name="@LanguageCode" dbType="AnsiStringFixedLength" />
      <param name="@StoreCompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@ReservedMaxPerOrder" dbType="Int32" />
      <param name="@VirtualPrice" dbType="Decimal" />
      <param name="@SupplyMemo" dbType="String" />
      <param name="@SupplyPrice" dbType="Decimal" />
      <param name="@MinCommission" dbType="Decimal" />
      <param name="@IsUseAlipayVipPrice" dbType="Int32" />
      <param name="@AlipayVipPrice" dbType="Decimal" />
      <param name="@MinCountPerOrder" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="InsertProductStatus" database="IMService"  commandType="Text">
    <commandText>
      <![CDATA[
    INSERT INTO [IPP3].[dbo].[Product_Status] 
(
     [ProductSysNo] 
    ,[InfoStatus] 
    ,[InfoUserSysNo] 
    ,[InfoTime] 
    ,[PicStatus] 
    ,[PicUserSysNo] 
    ,[PicTime] 
    ,[WarrantyStatus] 
    ,[WarrantyUserSysNo] 
    ,[WarrantyTime] 
    ,[PriceStatus] 
    ,[PriceUserSysNo] 
    ,[PriceTime] 
    ,[WeightStatus] 
    ,[WeightUserSysNo] 
    ,[WeightTime] 
    ,[AllowStatus] 
    ,[AllowUserSysNo] 
    ,[AllowTime] 
    ,[FirstOnlineTime] 
    ,[LastOnlineTime] 
    ,[virtualPicStatus] 
    ,[AccessoryStatus] 
    ,[CompanyCode] 
    ,[LanguageCode] 
    ,[StoreCompanyCode]
) 
VALUES
(
     @ProductSysNo 
    ,@InfoStatus 
    ,@InfoUserSysNo 
    ,@InfoTime 
    ,@PicStatus 
    ,@PicUserSysNo 
    ,@PicTime 
    ,@WarrantyStatus 
    ,@WarrantyUserSysNo 
    ,@WarrantyTime 
    ,@PriceStatus 
    ,@PriceUserSysNo 
    ,@PriceTime 
    ,@WeightStatus 
    ,@WeightUserSysNo 
    ,@WeightTime 
    ,@AllowStatus 
    ,@AllowUserSysNo 
    ,@AllowTime 
    ,@FirstOnlineTime 
    ,@LastOnlineTime 
    ,@virtualPicStatus 
    ,@AccessoryStatus 
    ,@CompanyCode 
    ,@LanguageCode 
    ,@StoreCompanyCode
)
		]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@InfoStatus" dbType="Int32" />
      <param name="@InfoUserSysNo" dbType="Int32" />
      <param name="@InfoTime" dbType="DateTime" />
      <param name="@PicStatus" dbType="Int32" />
      <param name="@PicUserSysNo" dbType="Int32" />
      <param name="@PicTime" dbType="DateTime" />
      <param name="@WarrantyStatus" dbType="Int32" />
      <param name="@WarrantyUserSysNo" dbType="Int32" />
      <param name="@WarrantyTime" dbType="DateTime" />
      <param name="@PriceStatus" dbType="Int32" />
      <param name="@PriceUserSysNo" dbType="Int32" />
      <param name="@PriceTime" dbType="DateTime" />
      <param name="@WeightStatus" dbType="Int32" />
      <param name="@WeightUserSysNo" dbType="Int32" />
      <param name="@WeightTime" dbType="DateTime" />
      <param name="@AllowStatus" dbType="Int32" />
      <param name="@AllowUserSysNo" dbType="Int32" />
      <param name="@AllowTime" dbType="DateTime" />
      <param name="@FirstOnlineTime" dbType="DateTime" />
      <param name="@LastOnlineTime" dbType="DateTime" />
      <param name="@virtualPicStatus" dbType="Int32" />
      <param name="@AccessoryStatus" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@LanguageCode" dbType="AnsiStringFixedLength" />
      <param name="@StoreCompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="InsertProductDimension" database="IMService"  commandType="Text">
    <commandText>
      <![CDATA[
    INSERT INTO [OverseaContentManagement].[dbo].[Product_Dimensions] 
(
     [ProductSysNo] 
    ,[Length] 
    ,[Width] 
    ,[Height] 
    ,[InDate] 
    ,[InUser] 
    ,[EditDate] 
    ,[EditUser] 
    ,[CompanyCode] 
    ,[StoreCompanyCode] 
    ,[CountryCode] 
    ,[LanguageCode] 
    ,[Status]
) 
VALUES
(
     @ProductSysNo 
    ,@Length 
    ,@Width 
    ,@Height 
    ,@InDate 
    ,@InUser 
    ,@EditDate 
    ,@EditUser 
    ,@CompanyCode 
    ,@StoreCompanyCode 
    ,@CountryCode 
    ,@LanguageCode 
    ,@Status
)
		]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@Length" dbType="Decimal" />
      <param name="@Width" dbType="Decimal" />
      <param name="@Height" dbType="Decimal" />
      <param name="@InDate" dbType="DateTime" />
      <param name="@InUser" dbType="String" />
      <param name="@EditDate" dbType="DateTime" />
      <param name="@EditUser" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@StoreCompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@CountryCode" dbType="String" />
      <param name="@LanguageCode" dbType="AnsiStringFixedLength" />
      <param name="@Status" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="InsertProductVirtualPriceLog" database="IMService"  commandType="Text">
    <commandText>
      <![CDATA[
    INSERT INTO [OverseaContentManagement].[dbo].[ProductVirtualPricePricechangeLog] 
(
     [ProductSysno] 
    ,[NewVirtualPrice] 
    ,[OldVirtualPrice] 
    ,[Note] 
    ,[OptIP] 
    ,[CompanyCode] 
    ,[LanguageCode] 
    ,[StoreCompanyCode] 
    ,[CreateUser] 
    ,[CreateDate]
) 
VALUES
(
     @ProductSysno 
    ,@NewVirtualPrice 
    ,@OldVirtualPrice 
    ,@Note 
    ,@OptIP 
    ,@CompanyCode 
    ,@LanguageCode 
    ,@StoreCompanyCode 
    ,@CreateUser 
    ,@CreateDate
)
		]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@NewVirtualPrice" dbType="Decimal" />
      <param name="@OldVirtualPrice" dbType="Decimal" />
      <param name="@Note" dbType="String" />
      <param name="@OptIP" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@LanguageCode" dbType="AnsiStringFixedLength" />
      <param name="@StoreCompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@CreateUser" dbType="String" />
      <param name="@CreateDate" dbType="DateTime" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetCloneCount" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[			
      SELECT (COUNT(1)+1) CloneCount
      FROM IPP3.dbo.product WITH (NOLOCK) WHERE ProductID LIKE (@ProductID + @SixthLetter + '%')
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductID" dbType="String" size="20"/>
      <param name="@SixthLetter" dbType="String" size="20"/>
    </parameters>
  </dataCommand>

  <dataCommand name="InsertProductProperty" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
      IF NOT EXISTS (SELECT 1 from [PMDB].[dbo].[PIM_ProductProperty] where ProductSysNo = @ProductSysNo AND PropertySysNo = @PropertySysNo)
      BEGIN
          INSERT INTO [PMDB].[dbo].[PIM_ProductProperty] 
            (
                 [ProductSysNo] 
                ,[GroupSysNo] 
                ,[PropertySysNo] 
                ,[ValueSysNo] 
                ,[ManualInput] 
                ,[IsActive] 
                ,[LastEditUserSysNo] 
                ,[LastEditTime] 
                ,[CompanyCode] 
                ,[LanguageCode] 
                ,[StoreCompanyCode]
            )
            VALUES
            (
                @ProductSysNo
               ,@GroupSysNo
               ,@PropertySysNo
               ,@ValueSysNo
               ,@ManualInput
               ,1
               ,@InUserSysNo
               ,GETDATE()
               ,@CompanyCode
               ,@LanguageCode
               ,@CompanyCode 
            )
          SELECT @@IDENTITY;
      END
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@GroupSysNo" dbType="Int32" />
      <param name="@PropertySysNo" dbType="Int32" />
      <param name="@ValueSysNo" dbType="Int32" />
      <param name="@ManualInput" dbType="String" />
      <param name="@InUserSysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@LanguageCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <!--获取商品的组系统编号-->
  <dataCommand name="IM_Product_GetProductGroupSysNo" database="MKTService" commandType="Text">
    <commandText>
      <![CDATA[
  select pc.ProductGroupSysno
  from IPP3.dbo.Product p
  INNER JOIN OverseaContentManagement.dbo.ProductCommonInfo pc
  ON p.ProductCommonInfoSysno=pc.SysNo
  WHERE p.SysNo=@ProductSysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetProductTariffInfoByProductSysNos" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
    
      SELECT 
    P.SysNo AS [SysNo] 
   ,P.ProductID AS [ProductID] 
   ,PP.CurrentPrice AS [CurrentPrice] 
   ,PE.TariffRate as [TariffRate] 
FROM [IPP3].[dbo].[Product] P WITH(NOLOCK) 
INNER JOIN [IPP3].[dbo].[Product_Price] PP WITH(NOLOCK) 
    ON P.SysNo=PP.ProductSysNo 
INNER JOIN [IPP3].[dbo].[Product_EntryInfo] PE WITH(NOLOCK) 
    ON P.SysNo=PE.ProductSysNo 
WHERE  
    P.[SysNo] IN  (#SysNos#)
      
      ]]>
    </commandText>
  </dataCommand>

  <!--获取同系商品ID前缀最大的商品ID-->
  <dataCommand name="IM_Product_GetProductSameIDMaxProductID" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
  SELECT MAX([ProductID]) AS [ProductID]
  FROM [IPP3].[dbo].[Product](NOLOCK)
  WHERE [ProductID] LIKE (@Code + N'%')
        ]]>
    </commandText>
    <parameters>
      <param name="@Code" dbType="String"/>
    </parameters>
  </dataCommand>

  <!--插入商品产地信息-->
  <dataCommand name="IM_Product_InsertProductEntryInfo" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
  INSERT INTO [IPP3].[dbo].[Product_EntryInfo]
           ([ProductSysNo]
           ,[ProductName_EN]
           ,[Specifications]
           ,[Functions]
           ,[Component]
           ,[Origin]
           ,[Purpose]
           ,[TaxQty]
           ,[TaxUnit]
           ,[ApplyUnit]
           ,[GrossWeight]
           ,[BizType]
           ,[ApplyDistrict]
           ,[Product_SKUNO]
           ,[Supplies_Serial_No]
           ,[ApplyQty]
           ,[SuttleWeight]
           ,[Note]
           ,[Supplies_Serial_No_1]
           ,[TariffRate]
           ,[TariffCode]
           ,[StoreType]
           ,[EntryCode]
           ,[Remark1]
           ,[Remark2]
           ,[Remark3]
           ,[Remark4])
     VALUES
           (@ProductSysNo
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,@Origin
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,NULL)
        ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32"/>
      <param name="@Origin" dbType="String"/>
    </parameters>
  </dataCommand>

  <!--获取商品产地列表-->
  <dataCommand name="IM_Product_GetProductCountryList" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
  SELECT [SysNo]
      ,[CountryName]
      ,[CountryCode]
  FROM [IPP3].[dbo].[Country](NOLOCK)
  ORDER BY [CountryName]
        ]]>
    </commandText>
    <parameters>
    </parameters>
  </dataCommand>

  <!--更新商品采购价格-->
  <dataCommand name="IM_Product_UpdateProductVirtualPrice" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
        UPDATE  [IPP3].[dbo].[Product_Price] 
        SET VirtualPrice=@VirtualPrice
        WHERE productsysno=@productSysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32"/>
      <param name="@VirtualPrice" dbType="Decimal"/>
    </parameters>
  </dataCommand>

  <dataCommand name="IM_Product_ExporterEntryFile_Query" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
 DECLARE @ProductTable table(ProductSysNo int  PRIMARY KEY ) 
 
 #InstertProductSysNoToTempTable#
--INSERT @ProductTable(ProductSysNo) values(13022683)

SELECT     
     A.SysNo,A.ProductID,A.ERPProductID,A.ProductMode,A.ProductName,A.BriefName,A.ProductTitle,A.PromotionTitle     
                   ,A.MultiPicNum,A.Status,B.BasicPrice,CAST(ROUND(ISNULL(B.CurrentPrice,0),2) AS numeric(19,2)) CurrentPrice,B.SupplyPrice,B.SupplyMemo, CAST(ROUND(ISNULL(B.VirtualPrice,0),2) AS numeric(19,2)) VirtualPrice     
                   ,0 AS ComparePrice     
                   ,ISNULL((CASE     
                        WHEN B.UnitCost > 0 THEN CAST(B.UnitCost AS numeric(19,2))    
                        WHEN B.UnitCost = 0 AND PO.ProductSysNo IS NOT NULL THEN 0     
                        ELSE B.VirtualPrice     
                    END), 0) AS UnitCost     
                   ,B.Point,CAST(ROUND(ISNULL(B.CashRebate,0),2) AS numeric(19,2)) CashRebate,PO.LastPrice     
                   ,(CASE     
                        WHEN A.ProductType = 1 THEN PIS.InStockDate     
                        ELSE PO.LastInTime     
                    END) AS LastInTime     
                   ,CAST(PPC.JDPrice AS decimal(19,2)) AS JDPrice ,PPC.Stock AS JDStock,ISNULL(PPC.JDPromotion, '') AS JDPromotion     
                   ,PPC.JDItemNumber,CAST(PPAM.AMPrice AS decimal(19,2)) AS AMPrice,PPAM.Stock AS AMStock ,ISNULL(PPAM.AMPromotion, '') AS AMPromotion     
                   ,PPAM.AMItemNumber,C3.SysNo AS C3SysNo,C3.C3Name,C2.SysNo AS C2SysNo,C2.C2Name,C1.SysNo AS C1SysNo,C1.C1Name     
                   ,(CASE     
                        WHEN E.Is360Show IS NOT NULL AND E.Is360Show='A'  THEN 1     
                        ELSE 0     
                    END) AS Is360Show     
                   ,(CASE     
                        WHEN E.IsVideo IS NOT NULL AND E.IsVideo='A'  THEN 1     
                        ELSE 0     
                    END) AS IsVideo     
                   ,E.MinPackNumber AS MinPackNumber,E.PO_Memo AS POMemo,P3PMP.SynProductID AS IngramItemID    
                   ,P3PSP.ProductDescription AS IngramItemDes ,P3PSP.InventoryQty AS IngramInventoryQty    
       ,PGI.Sysno AS GroupID, PCI.UPCCode AS UPCCode ,PCI.BMCode AS BMCode  
                   ,P3PSP.PurchasePrice AS IngramPurchasePrice,P3PMP.Status AS IngramStatus 
       
       ,M.SysNo AS ManufacturerSysNo    
       ,M.ManufacturerName    
       ,M.ManufacturerID    
       ,R.SysNo AS BrandSysNo    
       ,R.BrandName_Ch AS BrandNameCH    
       ,R.BrandName_En AS BrandNameEN    
                   ,VM.VendorName AS MerchantName    
       ,VM.VendorType    
       ,VM.InvoiceType    
                   ,VM.StockType    
       ,VM.ShippingType  
       ,A.DefaultImage  
      ,[entry].[ProductName_EN]  
      ,[entry].[Specifications]  
      ,[entry].[Functions]  
      ,[entry].[Component]  
      ,[entry].[Origin]  
      ,[entry].[Purpose]  
      ,[entry].[TaxQty]  
      ,[entry].[TaxUnit]  
      ,[entry].[ApplyUnit]  
      ,[entry].[GrossWeight]  
      ,[entry].[BizType]  
      ,[entry].[ApplyDistrict]  
      ,[entry].[Product_SKUNO]  
      ,[entry].[Supplies_Serial_No]  
      ,[entry].[ApplyQty]  
      ,[entry].[SuttleWeight]  
      ,[entry].[Note]  
      ,[entry].[Supplies_Serial_No_1]  
      ,[entry].[TariffRate]  
      ,[entry].[TariffCode]  
      ,[entry].[StoreType]  
      ,[entry].[EntryCode]  
      ,[entry].[Remark1]  
      ,[entry].[Remark2]  
      ,[entry].[Remark3]  
      ,[entry].[Remark4]  
      ,[entry].[ProductOthterName]  
      ,[entry].[ManufactureDate]  
      ,cty.CountryName AS OriginCountryName 
      ,[entry].NeedValid
      ,[entry].NeedLabel
      ,[entry].EntryStatus
      ,[entry].EntryStatusEx
      ,[entry].AuditNote
     FROM @ProductTable as ProductTable
     INNER JOIN  IPP3.dbo.Product A WITH(NOLOCK)  ON   ProductTable.ProductSysNo=A.SysNo 
                LEFT JOIN OverseaContentManagement.dbo.V_IM_Product_Ex E WITH(NOLOCK)  ON A.SysNo = E.SysNo      
                LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList VM WITH(NOLOCK)     ON VM.SysNo=A.MerchantSysNo         
    LEFT JOIN OverseaContentManagement.dbo.ProductCommonInfo PCI WITH(NOLOCK)     
                    ON A.ProductCommonInfoSysno = PCI.Sysno     
    LEFT JOIN OverseaContentManagement.dbo.ProductGroupInfo PGI WITH(NOLOCK)     
                    ON PCI.ProductGroupSysno = PGI.Sysno      
                LEFT JOIN IPP3.dbo.Product_Price B WITH(NOLOCK)     
                    ON A.SysNo = B.ProductSysNo     
                LEFT JOIN IPP3.dbo.Product_PriceCatch PPC WITH(NOLOCK)     
                    ON A.SysNo=PPC.ProductSysNo     
                LEFT JOIN IPP3.dbo.Product_PriceCatchForAm PPAM WITH(NOLOCK)     
                    ON A.SysNo=PPAM.ProductSysNo     
                LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo U WITH(NOLOCK)     
                    ON A.PMUserSysNo = U.UserSysNo     
                LEFT JOIN OverseaContentManagement.dbo.V_CM_Product_LastPOInfo_V1 PO WITH(NOLOCK)     
                    ON PO.ProductSysNo=A.SysNo       
                LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList V WITH(NOLOCK)     
                    ON V.SysNo=PO.LastVendorSysNo     
    LEFT JOIN IPP3.dbo.Manufacturer M WITH(NOLOCK)     
                    ON A.ManufacturerSysNo = M.SysNo     
       LEFT JOIN OverseaContentManagement.dbo.Brand R WITH(NOLOCK)     
                    ON A.BrandSysNo = R.SysNo   
    LEFT JOIN IPP3.dbo.PM_Master Z WITH(NOLOCK)     
                    ON A.PMUserSysNo = Z.PMUserSysNo            
                LEFT JOIN OverseaContentManagement.dbo.ProductSecondhand_InStock PIS WITH(NOLOCK)     
                    ON A.SysNo=PIS.ProductSysNo     
                LEFT JOIN OverseaContentManagement.dbo.Product3Party_Mapping P3PMP WITH(NOLOCK)    
                    ON A.SysNo=P3PMP.ProductSysno AND P3PMP.PartnerType='I' AND P3PMP.Status='A'  
                LEFT JOIN OverseaContentManagement.dbo.Product3Party_SynProduct P3PSP WITH(NOLOCK)    
                    ON P3PSP.ProductMappingSysno = P3PMP.SysNo      
    LEFT JOIN OverseaInventoryManagement.dbo.V_Inventory_Product_AllStock_AVGDailySales AllAVGDailySales WITH(NOLOCK)     
                    ON A.SysNo=AllAVGDailySales.ProductSysNo 
     LEFT JOIN IPP3.dbo.Category3 C3 WITH(NOLOCK)     
                    ON A.C3SysNo = C3.SysNo      
                LEFT JOIN IPP3.dbo.Category2 C2 WITH(NOLOCK)     
                    ON C3.C2SysNo = C2.SysNo      
                LEFT JOIN IPP3.dbo.Category1 C1 WITH(NOLOCK)     
                    ON C2.C1SysNo = C1.SysNo
 LEFT JOIN IPP3.dbo.Product_EntryInfo [entry] WITH(NOLOCK)   
    ON   A.SysNo=entry.ProductSysNo   
    LEFT JOIN [IPP3].[dbo].[Country] cty WITH(NOLOCK) ON [entry].Origin=cty.CountryCode 

      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="BatchAuditProduct" database="IMService" commandType="Text">
    <commandText>
      <![CDATA[
DECLARE @ProductSysNoTable Table
(
	SysNo int
)
INSERT INTO @ProductSysNoTable(SysNo)
SELECT 
	T.c.value('(text())[1]','int') AS SoNumber
FROM @ProductSysNoXml.nodes('//SysNos/SysNo') T(c)

UPDATE IPP3.dbo.Product 
SET Status = @ProductStatus 
WHERE SysNo in (SELECT SysNo FROM @ProductSysNoTable)
AND Status IN (3, 5)
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNoXml" dbType="Xml"/>
      <param name="@ProductStatus" dbType="Int32" />
    </parameters>
  </dataCommand>
</dataOperations>
