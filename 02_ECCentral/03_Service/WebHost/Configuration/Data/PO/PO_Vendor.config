<?xml version="1.0" encoding="utf-8" ?>
<dataOperations xmlns="http://oversea.newegg.com/DataOperation">

  <dataCommand name="QueryVendorListByLeverRequest" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT @TotalCount = COUNT(V.[SysNo])
        FROM [IPP3].[dbo].[Vendor] V WITH(NOLOCK)
        LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo U WITH (NOLOCK)
		    ON V.CreateVendorUserSysNo = U.UserSysNo
        LEFT JOIN ipp3.dbo.Vendor_Ex ex WITH(nolock)
        ON v.SysNo = ex.VendorSysNO
        #StrWhere#

        SELECT
           [SysNo]
          ,[VendorID]
          ,[VendorName]
          ,[EnglishName]
          ,[BriefName]
          ,[VendorType]
          ,[District]
          ,[Address]
          ,[Zip]
          ,[Contact]
          ,[Phone]
          ,[Fax]
          ,[Email]
          ,[Site]
          ,[Bank]
          ,[Account]
          ,[TaxNo]
          ,[Comment]
          ,[Note]
          ,[Status]
          ,[RMAPolicy]
          ,[PayPeriod]
          ,[RepairAddress]
          ,[RepairAreaSysNo]
          ,[RepairContact]
          ,[RepairContactPhone]
          ,[Cellphone]
          ,[AcctContactName]
          ,[AcctPhone]
          ,[RMAServiceArea]
          ,[IsConsign]
          ,[PayPeriodType]
          ,[PayTermsName]
          ,[ValidDate]
          ,[ExpiredDate]
          ,[ContractAmt]
          ,[TotalPOMoney]
          ,[CreateVendorUserSysNo]
          ,[UserName] AS [CreateVendorUserName]
          ,[CreateVendorTime]
          ,[VendorContractInfo]
          ,[HoldMark]
          ,[HoldDate]
          ,[HoldUser]
          ,[HoldReason]
          ,[IsCooperate]
          ,[AcctContactEmail]
          ,DisplayName
          ,AuditStatus = 10
          ,RowNumber
          ,[RANK]
          ,[PaySettleCompany]
        FROM
        (
	          SELECT TOP (@EndNumber)
                   V.[SysNo]
                  ,V.[VendorID]
                  ,V.[VendorName]
                  ,V.[EnglishName]
                  ,V.[BriefName]
                  ,V.[VendorType]
                  ,V.[District]
                  ,V.[Address]
                  ,V.[Zip]
                  ,V.[Contact]
                  ,V.[Phone]
                  ,V.[Fax]
                  ,V.[Email]
                  ,V.[Site]
                  ,V.[Bank]
                  ,V.[Account]
                  ,V.[TaxNo]
                  ,V.[Comment]
                  ,V.[Note]
                  ,V.[Status]
                  ,V.[RMAPolicy]
                  ,V.[PayPeriod]
                  ,V.[RepairAddress]
                  ,V.[RepairAreaSysNo]
                  ,V.[RepairContact]
                  ,V.[RepairContactPhone]
                  ,V.[Cellphone]
                  ,V.[AcctContactName]
                  ,V.[AcctPhone]
                  ,V.[RMAServiceArea]
                  ,V.[IsConsign]
                  ,V.[PayPeriodType]
                  ,PT.[PayTermsName]
                  ,V.[ValidDate]
                  ,V.[ExpiredDate]
                  ,V.[ContractAmt]
                  ,V.[TotalPOMoney]
                  ,V.[CreateVendorUserSysNo]
                  ,SU.[UserName]
                  ,V.[CreateVendorTime]
                  ,V.[VendorContractInfo]
                  ,V.[HoldMark]
                  ,V.[HoldDate]
                  ,V.[HoldUser]
                  ,V.[HoldReason]
                  ,V.[IsCooperate]
                  ,V.[AcctContactEmail]
                  ,V.RANK
                  ,V.PaySettleCompany
	              ,U.DisplayName
	              ,(SELECT top 1 f.Status
					 FROM IPP3.dbo.Vendor_ModifyRequest f  WITH(NOLOCK)
					 WHERE f.VendorSysNo =V.sysno
						AND   f.RequestType = 0
						ORDER  BY  sysno DESC) AS AuditStatus
	              ,(ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
	          FROM [IPP3].[dbo].[Vendor] V WITH (NOLOCK)
            LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo U WITH (NOLOCK)
			      ON V.CreateVendorUserSysNo = U.UserSysNo
            LEFT JOIN ipp3.dbo.Vendor_Ex ex WITH(nolock)
            ON v.SysNo = ex.VendorSysNO
            LEFT JOIN OverseaInvoiceReceiptManagement.dbo.V_IM_VendorPayTerms PT WITH(NOLOCK)
            ON PT.PayTermsNo = V.PayPeriodType
            LEFT JOIN IPP3.dbo.Sys_User SU WITH(NOLOCK)
            ON SU.SysNo= V.CreateVendorUserSysNo
	          #strwhere#
        )RESULT where RowNumber > @StartNumber

			]]>
    </commandText>
  </dataCommand>

  <dataCommand name="QueryVendorList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT @TotalCount = COUNT(V.[SysNo])
        FROM  [IPP3].[dbo].[Vendor] V WITH(NOLOCK)
        LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo U WITH (NOLOCK)
		    ON V.CreateVendorUserSysNo = U.UserSysNo
        LEFT JOIN ipp3.dbo.Vendor_Ex ex WITH(nolock)
        ON v.SysNo = ex.VendorSysNO
        #StrWhere#

        SELECT
           [SysNo]
          ,[VendorID]
          ,[VendorName]
          ,[EnglishName]
          ,[BriefName]
          ,[VendorType]
          ,[District]
          ,[Address]
          ,[Zip]
          ,[Contact]
          ,[Phone]
          ,[Fax]
          ,[Email]
          ,[Site]
          ,[Bank]
          ,[Account]
          ,[TaxNo]
          ,[Comment]
          ,[Note]
          ,[Status]
          ,[RMAPolicy]
          ,[PayPeriod]
          ,[RepairAddress]
          ,[RepairAreaSysNo]
          ,[RepairContact]
          ,[RepairContactPhone]
          ,[Cellphone]
          ,[AcctContactName]
          ,[AcctPhone]
          ,[RMAServiceArea]
          ,[IsConsign]
          ,[PayPeriodType]
          ,[PayTermsName]
          ,[ValidDate]
          ,[ExpiredDate]
          ,[ContractAmt]
          ,[TotalPOMoney]
          ,[CreateVendorUserSysNo]
          ,[UserName] AS [CreateVendorUserName]
          ,[CreateVendorTime]
          ,[VendorContractInfo]
          ,[HoldMark]
          ,[HoldDate]
          ,[HoldUser]
          ,[HoldReason]
          ,[IsCooperate]
          ,[AcctContactEmail]
          ,DisplayName
          ,AuditStatus
          ,RowNumber
          ,[RANK]
          ,[PaySettleCompany]
          ,EPortSysNo
          ,EPortName
        FROM
        (
	          SELECT TOP (@EndNumber)
                   V.[SysNo]
                  ,V.[VendorID]
                  ,V.[VendorName]
                  ,V.[EnglishName]
                  ,V.[BriefName]
                  ,V.[VendorType]
                  ,V.[District]
                  ,V.[Address]
                  ,V.[Zip]
                  ,V.[Contact]
                  ,V.[Phone]
                  ,V.[Fax]
                  ,V.[Email]
                  ,V.[Site]
                  ,V.[Bank]
                  ,V.[Account]
                  ,V.[TaxNo]
                  ,V.[Comment]
                  ,V.[Note]
                  ,V.[Status]
                  ,V.[RMAPolicy]
                  ,V.[PayPeriod]
                  ,V.[RepairAddress]
                  ,V.[RepairAreaSysNo]
                  ,V.[RepairContact]
                  ,V.[RepairContactPhone]
                  ,V.[Cellphone]
                  ,V.[AcctContactName]
                  ,V.[AcctPhone]
                  ,V.[RMAServiceArea]
                  ,V.[IsConsign]
                  ,V.[PayPeriodType]
                  ,PT.[PayTermsName]
                  ,V.[ValidDate]
                  ,V.[ExpiredDate]
                  ,V.[ContractAmt]
                  ,V.[TotalPOMoney]
                  ,V.[CreateVendorUserSysNo]
                  ,SU.[UserName]
                  ,V.[CreateVendorTime]
                  ,V.[VendorContractInfo]
                  ,V.[HoldMark]
                  ,V.[HoldDate]
                  ,V.[HoldUser]
                  ,V.[HoldReason]
                  ,V.[IsCooperate]
                  ,V.[AcctContactEmail]
                  ,V.RANK
                  ,V.[PaySettleCompany]
	              ,U.DisplayName
	              ,( SELECT top 1 f.Status
					 FROM [IPP3].dbo.Vendor_ModifyRequest f  WITH(NOLOCK)
					 WHERE f.VendorSysNo =V.sysno
						AND   f.RequestType = 0
						ORDER  BY  sysno DESC) AS AuditStatus
	            ,(ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
              ,V.[ePortSysNo] AS EPortSysNo
              ,E.[ePortName] AS EPortName
	          FROM [IPP3].[dbo].[Vendor] V WITH (NOLOCK)
            LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo U WITH (NOLOCK)
			      ON V.CreateVendorUserSysNo = U.UserSysNo
            LEFT JOIN ipp3.dbo.Vendor_Ex ex WITH(nolock)
            ON v.SysNo = ex.VendorSysNO
            LEFT JOIN OverseaInvoiceReceiptManagement.dbo.V_IM_VendorPayTerms PT WITH(NOLOCK)
            ON PT.PayTermsNo = V.PayPeriodType
            LEFT JOIN IPP3.dbo.Sys_User SU WITH(NOLOCK)
            ON SU.SysNo= V.CreateVendorUserSysNo
            LEFT JOIN IPP3.dbo.[ePort] E WITH(NOLOCK)
            ON E.SysNo= V.[ePortSysNo]
	          #StrWhere#
        )RESULT where RowNumber > @StartNumber

			]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetManufacturerList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
       SELECT @TotalCount = COUNT(SysNo)
       FROM OverseaContentManagement.dbo.V_CM_Manufacturer
       #StrWhere#

        SELECT
           [SysNo]
          ,[ManufacturerID]
          ,[ManufacturerName]
          ,[BriefName]
          ,[Status]
          ,RowNumber
        FROM
        (
	          SELECT TOP (@EndNumber)
            [SysNo]
            ,[ManufacturerID]
            ,[ManufacturerName]
            ,[BriefName]
            ,[Status]
            ,(ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
            FROM OverseaContentManagement.dbo.V_CM_Manufacturer WITH(NOLOCK)
	          #StrWhere#
        )RESULT WHERE RowNumber > @StartNumber
			]]>
    </commandText>
  </dataCommand>

  <dataCommand name="QueryVendorbySysNoRequestRank" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
       SELECT V.[SysNo] as [SysNo]
      ,V.[VendorID] as [VendorBasicInfo.VendorID]
      ,V.[SellerID] as [VendorBasicInfo.SellerID]
      ,V.[VendorName] as [VendorBasicInfo.VendorNameLocal]
      ,V.[EnglishName] as [VendorBasicInfo.VendorNameGlobal]
      ,V.[BriefName] as [VendorBasicInfo.VendorBriefName]
      ,V.[VendorType] as [VendorBasicInfo.VendorType]
      ,V.[District] as [VendorBasicInfo.District]
      ,V.[Address] as [VendorBasicInfo.Address]
      ,V.[Zip] as [VendorBasicInfo.ZipCode]
      ,V.[Contact] as [VendorBasicInfo.Contact]
      ,V.[Phone] as [VendorBasicInfo.Phone]
      ,V.[Fax] as [VendorBasicInfo.Fax]
      ,V.[Email] as [VendorBasicInfo.EmailAddress]
      ,V.[Site] as [VendorBasicInfo.Website]
      ,V.[PaySettleCompany] as [VendorBasicInfo.PaySettleCompany]
      ,V.[Bank] as [VendorFinanceInfo.BankName]
      ,V.[Account] as [VendorFinanceInfo.AccountNumber]
      ,V.[TaxNo] as [VendorFinanceInfo.TaxNumber]
      ,V.[Comment] as [VendorBasicInfo.Comment]
      ,V.[Note] as [VendorBasicInfo.Note]
      ,V.[Status] as [VendorBasicInfo.VendorStatus]
      ,V.IsConsign as [VendorBasicInfo.ConsignFlag]
      ,V.[RMAPolicy] as [VendorServiceInfo.RMAPolicy]
      ,V.[PayPeriod] as [VendorFinanceInfo.PayPeriod]
      ,V.[PaySettleCompany] as [VendorFinanceInfo.PaySettleCompany]     
      ,V.[RepairAddress] as [VendorServiceInfo.Address]
      ,V.[RepairAreaSysNo]  as [VendorServiceInfo.AreaInfo.SysNo]
      ,V.[RepairContact] as [VendorServiceInfo.Contact]
      ,V.[RepairContactPhone] as [VendorServiceInfo.ContactPhone]
      ,V.[RepairPostcode] as [VendorServiceInfo.ZipCode]
      ,V.[Cellphone] as  [VendorBasicInfo.CellPhone]
      ,V.[AcctContactName] as [VendorFinanceInfo.AccountContact]
      ,V.[AcctPhone] as [VendorFinanceInfo.AccountPhone]
      ,V.[RMAServiceArea] as [VendorServiceInfo.RMAServiceArea]
      ,V.[IsConsign] as [VendorBasicInfo.ConsignFlag]
      ,V.[PayPeriodType] as [VendorFinanceInfo.PayPeriodType.PayTermsNo]
      ,V.[ValidDate] as [VendorFinanceInfo.CooperateValidDate]
      ,V.[ExpiredDate] as [VendorFinanceInfo.CooperateExpiredDate]
      ,V.[ContractAmt] as [VendorFinanceInfo.CooperateAmt]
      ,V.[TotalPOMoney] as [VendorFinanceInfo.TotalPOAmt]
      ,V.[CreateVendorUserSysNo]
      ,V.[CreateVendorTime]
      ,V.[VendorContractInfo]
      ,V.[HoldMark] as [VendorBasicInfo.HoldMark]
      ,V.[HoldDate]
      ,V.[HoldUser]
      ,V.[HoldReason] as [VendorBasicInfo.HoldReason]
      ,V.[IsCooperate] as [VendorBasicInfo.VendorIsCooperate]
      ,V.[IsToLease] as [VendorBasicInfo.VendorIsToLease]
      ,V.[AcctContactEmail] as [VendorFinanceInfo.AccountContactEmail]
      ,V.[RANK] as [VendorBasicInfo.VendorRank]
      ,R.[RANK] AS  [VendorBasicInfo.RequestVendorRank]
      ,V.BuyWeekDay as [VendorBasicInfo.BuyWeekDayVendor]
      ,B.BuyWeekDay as [VendorBasicInfo.RequestBuyWeekDayVendor]
      ,B.Status AS [VendorFinanceInfo.VerifyStatus]
      ,V.IsToLease as [VendorBasicInfo.VendorIsToLease]
      ,(CASE WHEN C.AutoAudit = 'Y' THEN 1 ELSE 0 END) as [VendorFinanceInfo.IsAutoAudit]

      ,C.SettlePeriodType as [VendorFinanceInfo.SettlePeriodType]
      ,(case C.IsShowStore when 'Y' then cast(1 AS bit) else cast(0 AS bit) end) AS IsShowStore
      ,V.CompanyCode
      ,C.DeductSysNo as [VendorDeductInfo.DeductSysNo]
      ,C.CalcType as [VendorDeductInfo.CalcType]
      ,C.DeductPercent as [VendorDeductInfo.DeductPercent]
      ,C.FixAmt as [VendorDeductInfo.FixAmt]
      ,C.MaxAmt as [VendorDeductInfo.MaxAmt]
      ,V.[ePortSysNo] as [VendorBasicInfo.EPortSysNo]
      FROM [IPP3].[dbo].[Vendor] V WITH(NOLOCK)
      LEFT JOIN [IPP3].[dbo].[Vendor_ModifyRequest] R WITH(NOLOCK)
      ON V.[SysNo] = R.VendorSysNo
      AND R.status = 0
      AND R.RequestType = 1
      LEFT JOIN IPP3.dbo.Vendor_Ex C WITH(nolock)
      ON V.SysNo = C.VendorSysNo
      LEFT JOIN ipp3.[dbo].[Vendor_ModifyRequest] B WITH(NOLOCK)
      ON V.[SysNo] = B.VendorSysNo
      AND B.status = 0
      AND B.RequestType = 4
      #StrWhere#

			]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetVendorByVendorName" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT  V.[SysNo] as [SysNo]
      ,V.[VendorID] as [VendorBasicInfo.VendorID]
      ,V.[VendorName] as [VendorBasicInfo.VendorNameLocal]
      ,V.[EnglishName] as [VendorBasicInfo.VendorNameGlobal]
      ,V.[BriefName] as [VendorBasicInfo.VendorBriefName]
      ,V.[VendorType] as [VendorBasicInfo.VendorType]
      ,V.[District] as [VendorBasicInfo.District]
      ,V.[Address] as [VendorBasicInfo.Address]
      ,V.[Zip] as [VendorBasicInfo.ZipCode]
      ,V.[Contact] as [VendorBasicInfo.Contact]
      ,V.[Phone] as [VendorBasicInfo.Phone]
      ,V.[Fax] as [VendorBasicInfo.Fax]
      ,V.[Email] as [VendorBasicInfo.EmailAddress]
      ,V.[Site] as [VendorBasicInfo.Website]
      ,V.[Bank] as [VendorFinanceInfo.BankName]
      ,V.[Account] as [VendorFinanceInfo.AccountNumber]
      ,V.[TaxNo] as [VendorFinanceInfo.TaxNumber]
      ,V.[Comment]
      ,V.[Note]
      ,V.[Status] as [VendorBasicInfo.VendorStatus]
      ,V.[RMAPolicy] as [VendorServiceInfo.RMAPolicy]
      ,V.[PayPeriod] as [VendorFinanceInfo.PayPeriod]
      ,V.[RepairAddress] as [VendorServiceInfo.Address]
      ,V.[RepairAreaSysNo]  as [VendorServiceInfo.AreaInfo.SysNo]
      ,V.[RepairContact] as [VendorServiceInfo.Contact]
      ,V.[RepairContactPhone] as [VendorServiceInfo.ContactPhone]
      ,V.[RepairPostcode] as [VendorServiceInfo.ZipCode]
      ,V.[Cellphone] as  [VendorBasicInfo.CellPhone]
      ,V.[AcctContactName] as [VendorFinanceInfo.AccountContact]
      ,V.[AcctPhone] as [VendorFinanceInfo.AccountPhone]
      ,V.[RMAServiceArea] as [VendorServiceInfo.RMAServiceArea]
      ,V.[IsConsign] as [VendorBasicInfo.ConsignFlag]
      ,V.[PayPeriodType] as [VendorFinanceInfo.PayPeriodType.PayTermsNo]
      ,V.[ValidDate] as [VendorFinanceInfo.CooperateValidDate]
      ,V.[ExpiredDate] as [VendorFinanceInfo.CooperateExpiredDate]
      ,V.[ContractAmt] as [VendorFinanceInfo.CooperateAmt]
      ,V.[TotalPOMoney] as [VendorFinanceInfo.TotalPOAmt]
      ,V.[CreateVendorUserSysNo]
      ,V.[CreateVendorTime]
      ,V.[VendorContractInfo]
      ,V.[HoldMark]
      ,V.[HoldDate]
      ,V.[HoldUser]
      ,V.[HoldReason]
      ,V.[IsCooperate] as [VendorBasicInfo.VendorIsCooperate]
      ,V.[AcctContactEmail]
      ,V.[RANK] as [VendorBasicInfo.VendorRank]
      ,V.BuyWeekDay as [VendorBasicInfo.BuyWeekDayVendor]
      ,V.SellerID as [VendorBasicInfo.SellerID]
      ,V.[ePortSysNo] as [VendorBasicInfo.EPortSysNo]
        FROM IPP3.[dbo].[Vendor] AS V WITH (NOLOCK)
        WHERE VendorName = @VendorName
			]]>
    </commandText>
    <parameters>
      <param name="@VendorName" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetVendorExInfo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT TOP 1
	      a.SysNo
	      ,a.VendorSysNo
	      ,a.StockType
	      ,a.ShippingType
	      ,a.InvoiceType
	      ,a.LogoPath
	      ,a.MerchantRate
	      ,a.BriefInfo
	      ,a.Bulletin
	      ,a.DefaultStock
	      ,a.CurrencyCode
	      ,b.RentFee
        ,(CASE WHEN a.IsShowStore = 'Y' THEN 1 ELSE 0 END) as IsShowStore
        ,a.QQNumber  
        ,(case a.IM_Enabled  when 'Y' then cast(1 AS bit) else cast(0 AS bit) end) AS IM_Enabled 
      FROM ipp3.dbo.Vendor_Ex a WITH(nolock)
      LEFT JOIN OverseaPOASNManagement.dbo.CommissionRule_Merchant b WITH(nolock)
      ON a.SysNo = b.VendorManufacturerSysNo
      WHERE a.VendorSysNo = @VendorSysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="QueryVendorHitoryByVendorSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
		SELECT @TotalCount = COUNT(VendorSysNo)
        FROM   (SELECT req.VendorSysNo
			  ,req.[CreateTime]
			  ,req.[CreateUserSysNo]
			  ,CreateUser.DisplayName
			  ,req.[AuditTime]
			  ,req.[AuditUserSysNo]
			  ,AuditUser.DisplayName  AuditUserName
			  ,req.[Status]
			  ,req.[RequestType]
			  ,req.[ActionType]
			  ,req.[Content]
			  ,req.[Memo]
        ,req.CompanyCode
		FROM [IPP3].[dbo].[Vendor_ModifyRequest] req with(nolock)
		LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo CreateUser with(nolock)
		ON CreateUser.UserSysNo=req.[CreateUserSysNo]
		LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo AuditUser with(nolock)
		ON AuditUser.UserSysNo=req.[AuditUserSysNo]
		 UNION ALL
		SELECT history.VendorSysNo
			  ,history.[CreateTime]
			  ,history.[CreateUserSysNo]
			  ,CreateUser.DisplayName as InUserAcct
			  ,NULL  AuditTime
			  ,NULL  AuditUserSysNo
			  ,NULL  AuditUserName
			  ,2 Status
			  ,5  RequestType
			  ,4  ActionType
			  ,history.[Content]
			  ,NULL Memo
        ,history.CompanyCode
		 FROM [IPP3].[dbo].[Vendor_HisRecord] history with(nolock)
		 LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo CreateUser with(nolock)
		 ON  CreateUser.UserSysNo=history.[CreateUserSysNo]) a
        #StrWhere#

SELECT
       VendorSysNo
      ,CreateTime as HistoryDate
      ,CreateUserSysNo
      ,CreateUserName as DisplayName
      ,AuditTime
      ,AuditUserSysNo
      ,AuditUserName
      ,[Status] as Status
      ,RequestType
      ,ActionType
      ,[Content] as HistoryReason
      ,Memo as Memo
 FROM(
		SELECT   TOP (@EndNumber)
			   VendorSysNo
			  ,CreateTime
			  ,CreateUserSysNo
			  ,CreateUserName
			  ,AuditTime
			  ,AuditUserSysNo
			  ,AuditUserName
			  ,[Status] as Status
			  ,RequestType
			  ,ActionType
			  ,[Content]
			  ,Memo as Memo
			  ,(ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
		FROM (
				SELECT req.VendorSysNo
					  ,req.[CreateTime]
					  ,req.[CreateUserSysNo]
					  ,CreateUser.DisplayName CreateUserName
					  ,req.[AuditTime]
					  ,req.[AuditUserSysNo]
					  ,AuditUser.DisplayName  AuditUserName
					  ,req.[Status] as Status
					  ,req.[RequestType]
					  ,req.[ActionType]
					  ,req.[Content]
					  ,req.[Memo] as Memo
            ,req.CompanyCode
				FROM [IPP3].[dbo].[Vendor_ModifyRequest] req with(nolock)
				LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo CreateUser with(nolock)
				ON CreateUser.UserSysNo=req.[CreateUserSysNo]
				LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo AuditUser with(nolock)
				ON AuditUser.UserSysNo=req.[AuditUserSysNo]
				 UNION ALL
				SELECT history.VendorSysNo
					  ,history.[CreateTime]
					  ,history.[CreateUserSysNo]
					  ,CreateUser.DisplayName CreateUserName
					  ,NULL  AuditTime
					  ,NULL  AuditUserSysNo
					  ,NULL  AuditUserName
					  ,2  Status
					  ,5  RequestType
					  ,4  ActionType
					  ,history.[Content]
					  ,NULL Memo
            ,history.CompanyCode
				 FROM [IPP3].[dbo].[Vendor_HisRecord] history with(nolock)
				 LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo CreateUser with(nolock)
				 ON  CreateUser.UserSysNo=history.[CreateUserSysNo]
		)  a
   #StrWhere#
   order  by   CreateTime    DESC) AS b
  WHERE  RowNumber > @StartNumber

        ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetManufacturerByVendorSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT  DISTINCT
      a.[SysNo] as [AgentSysNo]
      ,a.[VendorSysNo]
      ,a.[ManufacturerSysNo] as [ManufacturerInfo.SysNo]
      ,a.[C2SysNo] AS [C2SysNo]
      ,a.[AgentLevel] AS [AgentLevel]
      ,a.[Status]
      ,a.[CreateTime]
      ,a.[C3SysNo] AS [C3SysNo]
      ,a.[SendPeriod]
      ,a.[BuyWeekDay]
      ,a.[BrandSysNo] as [BrandInfo.SysNo]
      ,ISNULL(f.BrandName_Ch,f.BrandName_En) AS [BrandInfo.BrandNameLocal.Content]
      ,Isnull(b.ManufacturerName,b.BriefName) AS [ManufacturerInfo.ManufacturerNameLocal.Content]
      ,c.Category2Name AS [C2Name]
      ,d.Category3Name AS [C3Name]
      ,e.Status AS [RequestType]
      ,e.ActionType AS [CheckType]
      ,e.[SendPeriod] as RequestSendPeriod
      ,e.[BuyWeekDay] as RequestBuyWeekDay
      ,e.[Content] as [Content]
      --,a.[SettleType]  AS [SettleType]
      --,a.[SettlePercentage] AS SettlePercentage
      ,(CASE e.ActionType WHEN 1 THEN e.[SettleType] ELSE a.[SettleType] END) AS SettleType
      ,(CASE e.ActionType WHEN 1 THEN e.[SettlePercentage] ELSE a.[SettlePercentage] END) AS SettlePercentage
      ,g.OrderCommissionFee as [VendorCommissionInfo.OrderCommissionAmt]
      ,g.DeliveryFee as [VendorCommissionInfo.DeliveryFee]
      ,g.RentFee as [VendorCommissionInfo.RentFee]
      ,g.SalesRule as [VendorCommissionInfo.StagedSaleRuleItemsXml]
      ,b.BriefName AS [ManufacturerInfo.BriefName]
      ,f.BrandName_En AS [BrandInfo.BrandNameGlobal]
      
      FROM ipp3.dbo.Vendor_Manufacturer a WITH(NOLOCK)
      LEFT JOIN OverseaContentManagement.dbo.V_CM_Manufacturer b WITH(NOLOCK) ON b.SysNo = a.ManufacturerSysNo
      LEFT JOIN OverseaContentManagement.dbo.V_CM_CategoryInfo c WITH(NOLOCK)  ON c.Category2Sysno = a.C2SysNo
      LEFT JOIN OverseaContentManagement.dbo.V_CM_CategoryInfo d WITH(NOLOCK)  ON d.Category3Sysno=a.C3SysNo
      LEFT JOIN IPP3.dbo.Vendor_ModifyRequest e WITH(NOLOCK)  ON e.VendorManufacturerSysNo=a.[SysNo] AND e.Status NOT IN (1,2,-2)
      LEFT JOIN OverseaContentManagement.dbo.V_IM_Brand f WITH(nolock) ON f.SysNo = a.BrandSysNo
      LEFT JOIN OverseaPOASNManagement.dbo.CommissionRule_Merchant g WITH(nolock) ON a.SysNo = g.VendorManufacturerSysNO AND g.Status = 'A'
      WHERE a.Status = 0 and a.VendorSysNo = @VendorSysNo
			]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetVendorManufacturerByVendorNoAndProductNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
			SELECT
				 m.[SysNo]
				,m.[VendorSysNo]
				,m.[C2SysNo]
				,m.[C3SysNo]
				,m.SettleType
				,m.SettlePercentage
			FROM [IPP3].[dbo].[Vendor_Manufacturer] m WITH(NOLOCK)
			INNER JOIN
				(SELECT b.SysNo AS ProductSysNo,c3.Category2Sysno,b.Category3SysNo
						FROM OverseaContentManagement.dbo.V_CM_ItemBasicInfo b WITH(NOLOCK)
				INNER JOIN OverseaContentManagement.dbo.V_CM_CategoryInfo c3 WITH(NOLOCK)
						ON b.Category3SysNo = c3.Category3Sysno
				WHERE b.SysNo = @ProductSysNo ) p2
			ON p2.Category2Sysno = m.[C2SysNo]
			left JOIN
				(SELECT b.SysNo AS ProductSysNo,c3.Category2Sysno,b.Category3SysNo
						FROM OverseaContentManagement.dbo.V_CM_ItemBasicInfo b WITH(NOLOCK)
				INNER JOIN OverseaContentManagement.dbo.V_CM_CategoryInfo c3 WITH(NOLOCK)
						ON b.Category3SysNo = c3.Category3Sysno
				WHERE b.SysNo = @ProductSysNo ) p3
			ON p3.Category3Sysno = m.[C3SysNo]
			WHERE m.VendorSysNo = @VendorSysNo
			]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetVendorCheckInfo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT b.ManufacturerName AS [ManufacturerInfo.ManufacturerNameLocal.Content]
              ,a.SysNo
              ,a.ManufacturerSysNo AS [ManufacturerInfo.SysNo]
              ,a.[LEVEL] AS AgentLevel
              ,a.C2SysNo
              ,a.C3SysNo
              ,a.VendorManufacturerSysNo
              ,c.C2Name
              ,d.C3Name
              ,a.[SettleType]
              ,a.[SettlePercentage]
              ,a.BuyWeekDay
              ,a.SendPeriod
              ,a.Content
              ,a.BrandSysNo AS [BrandInfo.SysNo]
              ,isnull(e.BrandName_Ch,e.BrandName_En) AS [BrandInfo.BrandNameLocal.Content]
              ,f.OrderCommissionFee
			        ,f.DeliveryFee
			        ,f.RentFee
			        ,f.SalesRule
        FROM ipp3.dbo.Vendor_ModifyRequest a WITH (NOLOCK)
        INNER JOIN  ipp3.dbo.Manufacturer b WITH (NOLOCK)
        ON b.SysNo = a.ManufacturerSysNo
        INNER JOIN OverseaContentManagement.dbo.V_IM_Category2 c WITH (NOLOCK)
        ON a.C2SysNo = c.SysNo
		    LEFT JOIN OverseaContentManagement.dbo.V_IM_Category3 d WITH (NOLOCK)
        ON a.C3SysNo = d.SysNo
        LEFT JOIN OverseaContentManagement.dbo.V_IM_Brand e WITH(nolock)
        ON e.SysNo = a.BrandSysNo
        LEFT JOIN OverseaPOASNManagement.dbo.CommissionRule_Merchant f WITH(nolock)
        ON f.Status = 'A' AND f.VendorManufacturerSysNo = a.VendorManufacturerSysNo
        WHERE a.VendorManufacturerSysNo = @VendorManufacturerSysNo
        AND a.status = 0
        ]]>
    </commandText>
    <parameters>
      <param name="@VendorManufacturerSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="CreateVendor" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
DECLARE @SysNo INT
INSERT INTO IPP3.dbo.Vendor_Sequence (CreateTime) VALUES(GETDATE())
SET @SysNo = SCOPE_IDENTITY()

INSERT INTO IPP3.dbo.Vendor
(
SysNo, VendorID, VendorName, EnglishName,
BriefName, VendorType, District, Address,
Zip, Phone, Fax, Email,
Site, Bank, Account, TaxNo,
Contact, Comment, Note,
Status ,RMAPolicy,PayPeriod,
RepairAddress,RepairAreaSysNo,RepairContact,RepairContactPhone,
Cellphone,AcctContactName,AcctPhone,RMAServiceArea,
IsConsign,PayPeriodType,ValidDate,ExpiredDate,ContractAmt,TotalPOMoney,
CreateVendorUserSysNo,CreateVendorTime,VendorContractInfo,IsCooperate,AcctContactEmail,CompanyCode
,SellerID
,RepairPostcode
,PaySettleCompany
,[ePortSysNo]
)
VALUES (
@SysNo, @SysNo, @VendorName, @EnglishName,
@BriefName, @VendorType, @District, @Address,
@Zip, @Phone, @Fax, @Email,
@Site, @Bank, @Account, @TaxNo,
@Contact, @Comment, @Note,
@Status , @RMAPolicy , @PayPeriod,
@RepairAddress,@RepairAreaSysNo,@RepairContact,@RepairContactPhone,
@Cellphone,@AcctContactName,@AcctPhone,@RMAServiceArea,
@IsConsign,@PayPeriodType,@ValidDate,@ExpiredDate,@ContractAmt,@TotalPOMoney,
@CreateVendorUserSysNo,getdate(),@VendorContractInfo,@IsCooperate,@AcctContactEmail,@CompanyCode
,@SellerID
,@RepairPostcode
,@PaySettleCompany
,@EPortSysNo
)

  Insert into [ECStore].[dbo].[StoreBasicInfo]
  (SellerSysNo,Name,StoreName,[Address],ContactName,Mobile,Email)
  Select SysNo,  VendorName, VendorName, [Address],  Contact, Cellphone,  Email
  from IPP3.dbo.Vendor Where SysNo=@SysNo

SELECT [SysNo] as [SysNo]
,[VendorID] as [VendorBasicInfo.VendorID]
,[VendorName] as [VendorBasicInfo.VendorNameLocal]
,[EnglishName]  as [VendorBasicInfo.VendorNameGlobal]
,[BriefName] as [VendorBasicInfo.VendorBriefName]
,[VendorType] as [VendorBasicInfo.VendorType]
,[District] as [VendorBasicInfo.District]
,[Address] as [VendorBasicInfo.Address]
,[Zip] as [VendorBasicInfo.ZipCode]
,[Contact] as [VendorBasicInfo.Contact]
,[Phone] as [VendorBasicInfo.Phone]
,[Fax] as [VendorBasicInfo.Fax]
,[Email] as [VendorBasicInfo.EmailAddress]
,[Site] as [VendorBasicInfo.Website]
,[Bank] as [VendorFinanceInfo.BankName]
,[Account] as [VendorFinanceInfo.AccountNumber]
,[TaxNo] as [VendorFinanceInfo.TaxNumber]
,[Comment]
,[Note]
,[Status] as [VendorBasicInfo.VendorStatus]
,[RMAPolicy] as [VendorServiceInfo.RMAPolicy]
,[PayPeriod] as [VendorFinanceInfo.PayPeriod]
,[RepairAddress] as [VendorServiceInfo.Address]
,[RepairAreaSysNo]  as [VendorServiceInfo.AreaInfo.SysNo]
,[RepairContact] as [VendorServiceInfo.Contact]
,[RepairContactPhone] as [VendorServiceInfo.ContactPhone]
,[RepairPostcode] as [VendorServiceInfo.ZipCode]
,[Cellphone] as  [VendorBasicInfo.CellPhone]
,[AcctContactName] as [VendorFinanceInfo.AccountContact]
,[AcctPhone] as [VendorFinanceInfo.AccountPhone]
,[RMAServiceArea] as [VendorServiceInfo.RMAServiceArea]
,[IsConsign] as [VendorBasicInfo.ConsignFlag]
,[PayPeriodType] as [VendorFinanceInfo.PayPeriodType.PayTermsNo]
,[ValidDate] as [VendorFinanceInfo.CooperateValidDate]
,[ExpiredDate] as [VendorFinanceInfo.CooperateExpiredDate]
,[ContractAmt] as [VendorFinanceInfo.CooperateAmt]
,[TotalPOMoney] as [VendorFinanceInfo.TotalPOAmt]
,[CreateVendorUserSysNo]
,[CreateVendorTime]
,[VendorContractInfo]
,[HoldMark]
,[HoldDate]
,[HoldUser]
,[HoldReason]
,[IsCooperate]
,[AcctContactEmail]
,[PaySettleCompany] AS [VendorBasicInfo.PaySettleCompany]
,SellerID
,RepairPostcode
,CompanyCode
,[ePortSysNo] AS EPortSysNo
FROM IPP3.[dbo].[Vendor] WITH (NOLOCK) WHERE SysNo = @SysNo AND CompanyCode = @CompanyCode
			]]>
    </commandText>
    <parameters>
      <param name="@VendorName" dbType="String" size="200" />
      <param name="@EnglishName" dbType="String" size="200" />
      <param name="@BriefName" dbType="String" size="100" />
      <param name="@VendorType" dbType="Int32" />
      <param name="@District" dbType="String" size="200" />
      <param name="@Address" dbType="String" size="200" />
      <param name="@Zip" dbType="String" size="20" />
      <param name="@Contact" dbType="String" size="40" />
      <param name="@Phone" dbType="String" size="100" />
      <param name="@Fax" dbType="String" size="100" />
      <param name="@Email" dbType="String" size="1000" />
      <param name="@Site" dbType="String" size="200" />
      <param name="@Bank" dbType="String" size="100" />
      <param name="@Account" dbType="String" size="100" />
      <param name="@TaxNo" dbType="String" size="100" />
      <param name="@Comment" dbType="String" size="40" />
      <param name="@Note" dbType="String" size="1000" />
      <param name="@Status" dbType="Int32" />
      <param name="@RMAPolicy" dbType="String" size="1000" />
      <param name="@PayPeriod" dbType="Int32" />
      <param name="@RepairAddress" dbType="String" size="200" />
      <param name="@RepairAreaSysNo" dbType="Int32" />
      <param name="@RepairContact" dbType="String" size="40" />
      <param name="@RepairContactPhone" dbType="String" size="100" />
      <param name="@Cellphone" dbType="String" size="100" />
      <param name="@AcctContactName" dbType="String" size="200" />
      <param name="@AcctPhone" dbType="String" size="100" />
      <param name="@RMAServiceArea" dbType="String" size="1000" />
      <param name="@IsConsign" dbType="Int32" />
      <param name="@PayPeriodType" dbType="Int32" />
      <param name="@ValidDate" dbType="DateTime" />
      <param name="@ExpiredDate" dbType="DateTime" />
      <param name="@ContractAmt" dbType="Decimal" />
      <param name="@TotalPOMoney" dbType="Decimal" />
      <param name="@CreateVendorUserSysNo" dbType="Int32" />
      <param name="@VendorContractInfo" dbType="String" size="40" />
      <param name="@IsCooperate" dbType="Int32" />
      <param name="@AcctContactEmail" dbType="String" size="100" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@SellerID" dbType ="AnsiStringFixedLength"/>
      <param name="@RepairPostcode" dbType="String" />
      <param name="@PaySettleCompany" dbType="Int32" />
      <param name="@EPortSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="CreateVendorManufacturer" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
DECLARE @SysNo INT

INSERT INTO ipp3.dbo.Vendor_Manufacturer
(
[VendorSysNo],
[ManufacturerSysNo],
[C2SysNo],
[AgentLevel],
[Status],
[CreateTime],
[C3SysNo],
CompanyCode)
VALUES
(
@VendorSysNo,
@ManufacturerSysNo,
@C2SysNo,
@AgentLevel,
@Status,
getdate(),
@C3SysNo,
@CompanyCode
)

SET @SysNo = SCOPE_IDENTITY()

SELECT [SysNo] as [AgentSysNo]
,[VendorSysNo]
,[ManufacturerSysNo] as [ManufacturerInfo.SysNo]
,[C2SysNo]
,[AgentLevel]
,[Status]
,[CreateTime]
,[C3SysNo]
FROM ipp3.[dbo].[Vendor_Manufacturer] WITH (NOLOCK)
WHERE SysNo = @SysNo AND CompanyCode = @CompanyCode
        ]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
      <param name="@ManufacturerSysNo" dbType="Int32" />
      <param name="@C2SysNo" dbType="Int32" />
      <param name="@AgentLevel" dbType="String" size="50" />
      <param name="@Status" dbType="Int32" />
      <param name="@C3SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="CreateVMCommissionRule" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        INSERT INTO OverseaPOASNManagement.dbo.CommissionRule_Merchant
        (
	        VendorManufacturerSysNo,
	        OrderCommissionFee,
	        DeliveryFee,
	        RentFee,
	        Status,
	        InUser,
	        InDate,
	        EditUser,
	        EditDate,
	        CompanyCode,
	        SalesRule
        )
        VALUES
        (
	        @VendorManufacturerSysNo,
	        @OrderCommissionFee,
	        @DeliveryFee,
	        @RentFee,
	        'A',
	        @InUser,
	        GetDATE(),
	        @EditUser,
	        GetDATE(),
	        @CompanyCode,
	        @SalesRule
        )
			]]>
    </commandText>
    <parameters>
      <param name="@VendorManufacturerSysNo" dbType="Int32" />
      <param name="@OrderCommissionFee" dbType="Decimal" />
      <param name="@DeliveryFee" dbType="Decimal" />
      <param name="@RentFee" dbType="Decimal" />
      <param name="@InUser" dbType="String" />
      <param name="@EditUser" dbType="String" />
      <param name="@SalesRule" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength"/>
    </parameters>
  </dataCommand>

  <dataCommand name="EditVendor" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
              UPDATE IPP3.dbo.Vendor
              SET
              [VendorID] = @VendorID,
              [VendorName] = @VendorName,
              [EnglishName] = @EnglishName,
              [BriefName] = @BriefName,
              [VendorType] = @VendorType,
              [District] = @District,
              [Address] = @Address,
              [Zip] = @Zip,
              [Contact] = @Contact,
              [Phone] = @Phone,
              [Fax] = @Fax,
              [Email] = @Email,
              [Site] = @Site,
              [Bank] = @Bank,
              [Account] = @Account,
              [TaxNo] = @TaxNo,
              [Comment] = @Comment,
              [Note] = @Note,
              [Status] = @Status,
              [RMAPolicy] = @RMAPolicy,
              [PayPeriod] = @PayPeriod,
              [RepairAddress] = @RepairAddress,
              [RepairAreaSysNo] = @RepairAreaSysNo,
              [RepairContact] = @RepairContact,
              [RepairContactPhone] = @RepairContactPhone,
              [Cellphone] = @Cellphone,
              [AcctContactName] = @AcctContactName,
              [AcctPhone] = @AcctPhone,
              [RMAServiceArea] = @RMAServiceArea,
              [IsConsign] = @IsConsign,
              [PayPeriodType] = @PayPeriodType,
              [VendorContractInfo] = @VendorContractInfo,
              [IsCooperate] = @IsCooperate,
              [AcctContactEmail] = @AcctContactEmail,
              RepairPostcode = @RepairPostcode,
              [IsToLease]=@IsToLease,
              [ePortSysNo]=@EPortSysNo
              WHERE SysNo = @SysNo
              
              update [IPP3].[dbo].[Vendor_Ex]
              set DeductSysNo=@DeductSysNo,
              CalcType=@CalcType,
              DeductPercent=@DeductPercent,
              FixAmt=@FixAmt,
              MaxAmt=@MaxAmt
              where vendorsysno=@SysNo
			            ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@VendorID" dbType="String" size="40" />
      <param name="@VendorName" dbType="String" size="200" />
      <param name="@EnglishName" dbType="String" size="200" />
      <param name="@BriefName" dbType="String" size="100" />
      <param name="@VendorType" dbType="Int32" />
      <param name="@District" dbType="String" size="200" />
      <param name="@Address" dbType="String" size="200" />
      <param name="@Zip" dbType="String" size="20" />
      <param name="@Contact" dbType="String" size="40" />
      <param name="@Phone" dbType="String" size="100" />
      <param name="@Fax" dbType="String" size="100" />
      <param name="@Email" dbType="String" size="1000" />
      <param name="@Site" dbType="String" size="200" />
      <param name="@Bank" dbType="String" size="100" />
      <param name="@Account" dbType="String" size="100" />
      <param name="@TaxNo" dbType="String" size="100" />
      <param name="@Comment" dbType="String" size="40" />
      <param name="@Note" dbType="String" size="1000" />
      <param name="@Status" dbType="Int32" />
      <param name="@RMAPolicy" dbType="String" size="1000" />
      <param name="@PayPeriod" dbType="Int32" />
      <param name="@RepairAddress" dbType="String" size="200" />
      <param name="@RepairAreaSysNo" dbType="Int32" />
      <param name="@RepairContact" dbType="String" size="40" />
      <param name="@RepairContactPhone" dbType="String" size="100" />
      <param name="@Cellphone" dbType="String" size="100" />
      <param name="@AcctContactName" dbType="String" size="200" />
      <param name="@AcctPhone" dbType="String" size="100" />
      <param name="@RMAServiceArea" dbType="String" size="1000" />
      <param name="@IsConsign" dbType="Int32" />
      <param name="@PayPeriodType" dbType="Int32" />
      <param name="@VendorContractInfo" dbType="String" size="40" />
      <param name="@IsCooperate" dbType="Int32" />
      <param name="@AcctContactEmail" dbType="String" size="100" />
      <param name="@RepairPostcode" dbType="String" />
      <param name="@IsToLease" dbType="Int32" />
      <param name="@DeductSysNo" dbType="Int32" />
      <param name="@CalcType" dbType="Int32" />
      <param name="@DeductPercent" dbType="Decimal" />
      <param name="@FixAmt" dbType="Decimal" />
      <param name="@MaxAmt" dbType="Decimal" />
      <param name="@EPortSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="CreateOrEditIsShowStore" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
          IF EXISTS (SELECT TOP 1 1 FROM IPP3.dbo.Vendor_Ex WITH (NOLOCK) WHERE VendorSysNo = @VendorSysNo)
          BEGIN
              UPDATE IPP3.dbo.Vendor_Ex
              SET IsShowStore = @IsShowStore
              ,QQNumber=@QQNumber
              ,IM_Enabled=@IM_Enabled
              WHERE [VendorSysNo] = @VendorSysNo AND CompanyCode = @CompanyCode
          END
          ELSE
          BEGIN
              INSERT INTO IPP3.dbo.Vendor_Ex
              (
		          [VendorSysNo],
		          IsShowStore,
		          [CompanyCode],
		          IM_Enabled,
		          QQNumber
		          
              )
              VALUES
              (
		          @VendorSysNo,
		          @IsShowStore,
		          @CompanyCode,
		          @IM_Enabled,
		          @QQNumber
              )
          END
        ]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
      <param name="@IsShowStore" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@QQNumber" dbType ="AnsiStringFixedLength"/>
      <param name="@IM_Enabled" dbType ="AnsiStringFixedLength"/>
    </parameters>
  </dataCommand>

  <dataCommand name="CreateOrUpdateVendorExInfo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      IF EXISTS (SELECT TOP 1 1 FROM ipp3.dbo.Vendor_Ex WITH (NOLOCK) WHERE VendorSysNo = @VendorSysNo AND CompanyCode = @CompanyCode)
      BEGIN
         UPDATE ipp3.dbo.Vendor_Ex
        SET
	        StockType = @StockType,
	        ShippingType = @ShippingType,
	        InvoiceType = @InvoiceType,
	        --LogoPath = @LogoPath,
	        MerchantRate = @MerchantRate,
	        BriefInfo = @BriefInfo,
	        Bulletin = @Bulletin,
	        DefaultStock = @DefaultStock,
	        CurrencyCode = @CurrencyCode,
	        SettlePeriodType = @SettlePeriodType,
          AutoAudit = @AutoAudit
        WHERE VendorSysNo = @VendorSysNo AND CompanyCode  = @CompanyCode
      END
      ELSE
      BEGIN
          INSERT INTO IPP3.dbo.Vendor_Ex
          (
            VendorSysNo,
	          StockType,
	          ShippingType,
	          InvoiceType,
	          LogoPath,
	          MerchantRate,
	          BriefInfo,
	          Bulletin,
	          DefaultStock,
	          CurrencyCode,
	          CompanyCode,
	          LanguageCode,
	          StoreCompanyCode,
            SettlePeriodType,
            AutoAudit
          )
          VALUES
          (
            @VendorSysNo,
	          @StockType,
	          @ShippingType,
	          @InvoiceType,
	          @LogoPath,
	          @MerchantRate,
	          @BriefInfo,
	          @Bulletin,
	          @DefaultStock,
	          @CurrencyCode,
	          @CompanyCode,
	          @LanguageCode,
	          @StoreCompanyCode,
            @SettlePeriodType,
            @AutoAudit
          )
      END

      SELECT TOP 1
        SysNo as ItemSysNo,
        VendorSysNo as SysNo,
        StockType as [VendorBasicInfo.ExtendedInfo.StockType],
        ShippingType as [VendorBasicInfo.ExtendedInfo.ShippingType],
        InvoiceType as [VendorBasicInfo.ExtendedInfo.InvoiceType],
        LogoPath,
        MerchantRate,
        BriefInfo,
        Bulletin,
        DefaultStock,
        CurrencyCode,
        CompanyCode,
        LanguageCode,
        StoreCompanyCode,
        SettlePeriodType as [VendorFinanceInfo.SettlePeriodType],
        (CASE WHEN AutoAudit = 'Y' THEN 1 ELSE 0 END) as AutoAudit
      FROM ipp3.[dbo].[Vendor_Ex] WITH (NOLOCK)
      WHERE [VendorSysNo] = @VendorSysNo AND CompanyCode = @CompanyCode
      ]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
      <param name="@StockType" dbType="String" size="5"/>
      <param name="@ShippingType" dbType="String" size="5" />
      <param name="@InvoiceType" dbType="String" size="5" />
      <param name="@LogoPath" dbType="String" size="500" />
      <param name="@MerchantRate" dbType="Int32"/>
      <param name="@BriefInfo" dbType="String" size="500" />
      <param name="@Bulletin" dbType="String" size="500" />
      <param name="@DefaultStock" dbType="Int32"/>
      <param name="@CurrencyCode" dbType="String"/>
      <param name="@LanguageCode" dbType="String"/>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength"/>
      <param name="@StoreCompanyCode" dbType="AnsiStringFixedLength"/>
      <param name="@SettlePeriodType" dbType="Int32"/>
      <param name="@AutoAudit" dbType="AnsiStringFixedLength"/>
    </parameters>
  </dataCommand>

  <dataCommand name="UpdateVendorBuyWeekDay" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
			UPDATE ipp3.dbo.Vendor
			     SET [BuyWeekDay]=@BuyWeekDay
				WHERE SysNo=@VendorSysNo

        UPDATE [IPP3].[dbo].[Vendor_ModifyRequest]
				SET [status] = @Status
					,AuditUserSysNo=@AuditUserSysNo
					,AuditTime=getdate()
				WHERE SysNo = @SysNo
			]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
      <param name="@BuyWeekDay" dbType="String" />
      <param name="@SysNo" dbType="Int32" />
      <param name="@Status" dbType="Int32" />
      <param name="@AuditUserSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="CreateModifyRequest" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
			INSERT INTO [IPP3].[dbo].[Vendor_ModifyRequest]
					   ([VendorSysNo]
					   ,[CreateTime]
					   ,[CreateUserSysNo]
					   ,[Status]
					   ,[CompanyCode]
					   ,[RequestType]
					   ,[RANK]
					   ,[ActionType]
					   ,[ManufacturerSysNo]
             ,[VendorManufacturerSysNo]
					   ,[LEVEL]
					   ,[C2SysNo]
					   ,[C3SysNo]
					   ,[Content]
					   ,[Memo]
             ,[SettleType]
					   ,[SettlePercentage]
             ,[BuyWeekDay]
             ,[SendPeriod]
             ,[BrandSysNo]
             ,[SettlePeriodType]
             ,[AutoAudit]
             )
				 VALUES
					   (@VendorSysNo
					   ,getdate()
					   ,@CreateUserSysNo
					   ,@Status
					   ,@CompanyCode
					   ,@RequestType
					   ,@RANK
					   ,@ActionType
					   ,@ManufacturerSysNo
             ,@VendorManufacturerSysNo
					   ,@LEVEL
					   ,@C2SysNo
					   ,@C3SysNo
					   ,@Content
					   ,@Memo
             ,@SettleType
					   ,@SettlePercentage
             ,@BuyWeekDay
             ,@SendPeriod
             ,@BrandSysNo
             ,@SettlePeriodType
             ,@AutoAudit)
             SELECT SCOPE_IDENTITY() 
			]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@RANK" dbType="AnsiStringFixedLength" />
      <param name="@CreateUserSysNo" dbType="Int32" />
      <param name="@Status" dbType="Int32" />
      <param name="@RequestType" dbType="Int32" />
      <param name="@ManufacturerSysNo" dbType="Int32" />
      <param name="@LEVEL" dbType="String" />
      <param name="@C2SysNo" dbType="Int32" />
      <param name="@C3SysNo" dbType="Int32" />
      <param name="@Content" dbType="String" />
      <param name="@Memo" dbType="String" />
      <param name="@ActionType" dbType="Int32" />
      <param name="@VendorManufacturerSysNo" dbType="Int32" />
      <param name="@SettleType" dbType="String" size="1" />
      <param name="@SettlePercentage" dbType="Decimal" />
      <param name="@BuyWeekDay" dbType="String" />
      <param name="@SendPeriod" dbType="String" />
      <param name="@BrandSysNo" dbType="Int32" />
      <param name="@SettlePeriodType" dbType="Int32" />
      <param name="@AutoAudit" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="CreateVendorModifyRequest" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        DECLARE @SysNo INT
        INSERT INTO IPP3.dbo.Vendor_ModifyRequest
        (
	        [VendorSysNo],
	        [PayPeriodType],
	        [ValidDate],
	        [ExpiredDate],
	        [ContractAmt],
	        [CreateTime],
	        [CreateUserSysNo],
	        [NewVendorName],
	        [Status],
	        [CompanyCode],
	        Content,
            ActionType,
            RequestType,
            AutoAudit,
            SettlePeriodType
        )
        VALUES
        (
	        @VendorSysNo,
	        @PayPeriodType,
	        @ValidDate,
	        @ExpiredDate,
	        @ContractAmt,
	        getdate(),
	        @CreateUserSysNo,
	        @NewVendorName,
	        @Status,
	        @CompanyCode,
	        @Content,
	        @ActionType,
            @RequestType,
            @AutoAudit,
            @SettlePeriodType
        )
        SET @SysNo = SCOPE_IDENTITY()
        SELECT [SysNo]
	        ,[VendorSysNo]
	        ,[PayPeriodType] as [PayPeriodType.PayTermsNo]
	        ,[ValidDate]
	        ,[ExpiredDate]
	        ,[ContractAmt]
	        ,[CreateTime]
	        ,[CreateUserSysNo]
	        ,[AuditTime]
	        ,[AuditUserSysNo]
	        ,[NewVendorName]
	        ,[Status]
	        ,Content
	        ,Memo
          ,(CASE WHEN AutoAudit = 'Y' THEN 1 ELSE 0 END) as AutoAudit
          ,SettlePeriodType
        FROM  [IPP3].[dbo].[Vendor_ModifyRequest] WITH (NOLOCK)
        WHERE SysNo = @SysNo AND CompanyCode = @CompanyCode
        ]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
      <param name="@PayPeriodType" dbType="Int32" />
      <param name="@ValidDate" dbType="DateTime" />
      <param name="@ExpiredDate" dbType="DateTime" />
      <param name="@ContractAmt" dbType="Decimal" />
      <param name="@CreateUserSysNo" dbType="Int32" />
      <param name="@Status" dbType="Int32" />
      <param name="@Content" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@NewVendorName" dbType="String" />
      <param name="@ActionType" dbType="Int32" />
      <param name="@RequestType" dbType="Int32" />
      <param name="@AutoAudit" dbType="String" />
      <param name="@SettlePeriodType" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdateVendorModifyRequestStatus" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      UPDATE ipp3.dbo.Vendor_ModifyRequest SET
      Status = @Status,
      AuditTime =@AuditTime,
      AuditUserSysNo = @AuditUserSysNo,
      Memo=@Memo
      WHERE SysNo = @SysNo

      SELECT [SysNo]
      ,[VendorSysNo]
      ,[PayPeriodType] as [PayPeriodType.PayTermsNo]
      ,[ValidDate]
      ,[ExpiredDate]
      ,[ContractAmt]
      ,[CreateTime]
      ,[CreateUserSysNo]
      ,[AuditTime]
      ,[AuditUserSysNo]
      ,[Status]
      ,Content
      ,Memo
      FROM IPP3.[dbo].[Vendor_ModifyRequest] WITH (NOLOCK)
      WHERE SysNo = @SysNo
			]]>
    </commandText>
    <parameters>
      <param name="@Status" dbType="Int32" />
      <param name="@AuditUserSysNo" dbType="Int32" />
      <param name="@AuditTime" dbType="DateTime" />
      <param name="@SysNo" dbType="Int32" />
      <param name="@Memo" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdateVendorEmailBySysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
         UPDATE TOP(1) IPP3.dbo.Vendor SET Email=Email+';'+@Email  WHERE  SysNo=@SysNo;
			]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@Email" dbType="String" size="500"/>
    </parameters>
  </dataCommand>

  <dataCommand name="CreateVendorHistoryLog" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      DECLARE @SysNo INT

      INSERT INTO ipp3.dbo.Vendor_HisRecord
      (
      [VendorSysNo],
      [CreateTime],
      [Content],
      [CreateUserSysNo],
      [Status],
      [CompanyCode])
      VALUES
      (
      @VendorSysNo,
      @CreateTime,
      @Content,
      @CreateUserSysNo,
      @Status,
      @CompanyCode
      )

      SET @SysNo = SCOPE_IDENTITY()

      SELECT [SysNo]
      ,[VendorSysNo]
      ,[CreateTime]
      ,[Content]
      ,[CreateUserSysNo]
      ,[Status]
      FROM ipp3.[dbo].[Vendor_HisRecord] WITH (NOLOCK)
      WHERE SysNo = @SysNo AND CompanyCode = @CompanyCode
        ]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
      <param name="@CreateTime" dbType="DateTime" />
      <param name="@Content" dbType="String" size="500" />
      <param name="@CreateUserSysNo" dbType="Int32" />
      <param name="@Status" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetVendorModifyRequest" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT
           [SysNo]
          ,[VendorSysNo]
          ,[Status]
          ,[CompanyCode]
          ,[RequestType]
          ,[RANK] as [Rank]
          ,[ManufacturerSysNo]
          ,[LEVEL] as [AgentLevel]
          ,[ActionType]
          ,[C2SysNo]
          ,[C3SysNo]
          ,[VendorManufacturerSysNo]
          ,[SettleType]
          ,[SettlePercentage]
          ,BuyWeekDay
          ,SendPeriod
          ,BrandSysNo
          ,SettlePeriodType
          ,CreateUserSysNo
          ,(CASE WHEN AutoAudit = 'Y' THEN 1 ELSE 0 END) as AutoAudit
        FROM [IPP3].[dbo].[Vendor_ModifyRequest] VM WITH (NOLOCK)
        WHERE VendorSysNo=@VendorSysNo
          AND Status=0
          AND RequestType=@RequestType
			]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
      <param name="@RequestType" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="DeleteVendorManufacturerBySysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
			    DELETE FROM ipp3.dbo.Vendor_Manufacturer
				WHERE SysNo=@VendorManufacturerSysNo

			    UPDATE [IPP3].[dbo].[Vendor_ModifyRequest]
			    SET [status] = @Status
					,AuditUserSysNo=@AuditUserSysNo
					,AuditTime=getdate()
			    WHERE SysNo = @SysNo
			]]>
    </commandText>
    <parameters>
      <param name="@VendorManufacturerSysNo" dbType="Int32" />
      <param name="@SysNo" dbType="Int32" />
      <param name="@Status" dbType="Int32" />
      <param name="@AuditUserSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="CancelModifyRequest" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
			UPDATE [IPP3].[dbo].[Vendor_ModifyRequest]
				Set   [AuditTime]=getdate()
					  ,[AuditUserSysNo]=@AuditUserSysNo
					  ,[Status]=@Status
				WHERE VendorSysNo=@VendorSysNo
				AND Status=0
				AND RequestType=@RequestType
			]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
      <param name="@RequestType" dbType="Int32" />
      <param name="@AuditUserSysNo" dbType="Int32" />
      <param name="@Status" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetVendorModifyRequestBySysNoAndStatus" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT TOP 1 [SysNo]
,[VendorSysNo]
,[PayPeriodType] as [PayPeriodType.PayTermsNo]
,[ValidDate]
,[ExpiredDate]
,[ContractAmt]
,[CreateTime]
,[CreateUserSysNo]
,[AuditTime]
,[AuditUserSysNo]
,[NewVendorName] as [VendorName]
,[Status]
,(CASE WHEN AutoAudit = 'Y' THEN 1 ELSE 0 END) as AutoAudit
FROM ipp3.[dbo].[Vendor_ModifyRequest] WITH (NOLOCK)
WHERE SysNo = @SysNo AND Status = @Status
			]]>
    </commandText>
    <parameters>
      <param name="@Status" dbType="Int32" />
      <param name="@SysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="ApproveVendorModifyRequest" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        DECLARE @VendorSysNo INT
DECLARE @ValidDate DATETIME
DECLARE @ExpiredDate DATETIME
DECLARE @PayPeriodType INT
DECLARE @ContractAmt DECIMAL(19,6)
DECLARE @NewVendorName NVARCHAR(100)
DECLARE @AutoAudit char(1)
DECLARE @SettlePeriodType INT

SELECT  @VendorSysNo = VendorSysNo,
		@ValidDate = ValidDate,
		@ExpiredDate = ExpiredDate,
		@PayPeriodType = PayPeriodType,
		@ContractAmt = ContractAmt,
		@NewVendorName = NewVendorName,
    @AutoAudit = AutoAudit,
    @SettlePeriodType = SettlePeriodType
FROM IPP3.dbo.Vendor_ModifyRequest WITH (NOLOCK)
WHERE SysNo = @SysNo

IF @NewVendorName IS NULL
BEGIN
	UPDATE IPP3.dbo.Vendor
	SET ValidDate = @ValidDate,
		ExpiredDate = @ExpiredDate,
		PayPeriodType = @PayPeriodType,
		ContractAmt = @ContractAmt
	WHERE SysNo = @VendorSysNo

  UPDATE IPP3.dbo.Vendor_Ex
  SET AutoAudit = @AutoAudit
  WHERE VendorSysNo = @VendorSysNo
END
ELSE
BEGIN
	UPDATE IPP3.dbo.Vendor
	SET ValidDate = @ValidDate,
		ExpiredDate = @ExpiredDate,
		PayPeriodType = @PayPeriodType,
		ContractAmt = @ContractAmt,
		VendorName = @NewVendorName
	WHERE SysNo = @VendorSysNo

  UPDATE IPP3.dbo.Vendor_Ex
  SET AutoAudit = @AutoAudit,
      SettlePeriodType = @SettlePeriodType
  WHERE VendorSysNo = @VendorSysNo
END

UPDATE IPP3.dbo.Vendor_ModifyRequest
SET
		Status = @Status,
		AuditTime = getdate(),
		AuditUserSysNo = @AuditUserSysNo,
		Memo=@Memo
WHERE SysNo = @SysNo

SELECT [SysNo]
,[VendorSysNo]
,[PayPeriodType] as [PayPeriodType.PayTermsNo]
,[ValidDate]
,[ExpiredDate]
,[ContractAmt]
,[CreateTime]
,[CreateUserSysNo]
,[AuditTime]
,[AuditUserSysNo]
,[Status]
,Content
,Memo
FROM  [IPP3].[dbo].[Vendor_ModifyRequest] WITH (NOLOCK)
WHERE SysNo = @SysNo
			]]>
    </commandText>
    <parameters>
      <param name="@Status" dbType="Int32" />
      <param name="@AuditUserSysNo" dbType="Int32" />
      <param name="@SysNo" dbType="Int32" />
      <param name="@Memo" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="CalculateTotalPOMoney" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
				UPDATE  IPP3.dbo.Vendor
				SET TotalPOMoney=ISNULL((
					SELECT SUM(po.InstockAmt)
					FROM IPP3.dbo.PO_Master po WITH(NOLOCK)
					LEFT JOIN IPP3.dbo.Vendor v WITH(NOLOCK)
					ON po.VendorSysNo=v.SysNo
					WHERE  po.[Status] in (4,6,7,8)  AND VendorSysNo=@VendorSysNo
					AND po.InTime BETWEEN isnull(v.ValidDate,'')  AND  isnull(v.ExpiredDate,'')
				   ),0)
				WHERE SysNo=@VendorSysNo

			]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="DeclineWithdrawVendorModifyRequest" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        UPDATE ipp3.dbo.Vendor_ModifyRequest SET
        Status = @Status,
        AuditTime =@AuditTime,
        AuditUserSysNo = @AuditUserSysNo,
        Memo=@Memo
        WHERE SysNo = @SysNo

        SELECT [SysNo]
        ,[VendorSysNo]
        ,[PayPeriodType] as [PayPeriodType.PayTermsNo]
        ,[ValidDate]
        ,[ExpiredDate]
        ,[ContractAmt]
        ,[CreateTime]
        ,[CreateUserSysNo]
        ,[AuditTime]
        ,[AuditUserSysNo]
        ,[Status]
        ,Content
        ,Memo
        FROM ipp3.[dbo].[Vendor_ModifyRequest] WITH (NOLOCK)
        WHERE SysNo = @SysNo
			]]>
    </commandText>
    <parameters>
      <param name="@Status" dbType="Int32" />
      <param name="@AuditUserSysNo" dbType="Int32" />
      <param name="@AuditTime" dbType="DateTime" />
      <param name="@SysNo" dbType="Int32" />
      <param name="@Memo" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="HoldUnholdVendor" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE ipp3.dbo.Vendor
SET HoldMark = @HoldMark,
HoldDate = getdate(),
HoldUser = @HoldUser,
HoldReason = @holdReason
WHERE SysNo = @SysNo
			]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@HoldMark" dbType="Boolean" />
      <param name="@HoldUser" dbType="Int32" />
      <param name="@HoldReason" dbType="String" size="400" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdateVendorStatus" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE ipp3.dbo.Vendor
SET [Status] = @Status
,[ValidDate] = getdate()
WHERE SysNo = @SysNo
			]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@Status" dbType="Int32" />
    </parameters>
  </dataCommand>


  <dataCommand name="HoldUnholdPMVendor" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE IPP3.dbo.Vendor
SET 
HoldDate = getdate(),
HoldUser = @HoldUser,
HoldReason = @holdReason
WHERE SysNo = @SysNo 
			]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@HoldUser" dbType="Int32" />
      <param name="@HoldReason" dbType="String" size="400" />
    </parameters>
  </dataCommand>




  <dataCommand name="CreateOrUpdateVendorAttachment" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
          IF EXISTS (SELECT TOP 1 1 FROM ipp3.dbo.Vendor_Ex WITH (NOLOCK) WHERE VendorSysNo = @VendorSysNo)
          BEGIN
              UPDATE ipp3.dbo.Vendor_Ex
              SET
              [VendorApplyForm] = @VendorApplyForm,
              [EnterpriseBusinessLicence] = @EnterpriseBusinessLicence,
              [OrganizeCodeCertificate] = @OrganizeCodeCertificate,
              [TaxationAffairsRegistration] = @TaxationAffairsRegistration,
              [AgreementBeingSold] = @AgreementBeingSold,
              [AgreementConsign] = @AgreementConsign,
              [AgreementAfterSold] = @AgreementAfterSold,
              [AgreementOther] = @AgreementOther
              WHERE [VendorSysNo] = @VendorSysNo AND CompanyCode = @CompanyCode
          END
          ELSE
          BEGIN
              INSERT INTO ipp3.dbo.Vendor_Ex
              (
              [VendorSysNo],
              [VendorApplyForm],
              [EnterpriseBusinessLicence],
              [OrganizeCodeCertificate],
              [TaxationAffairsRegistration],
              [AgreementBeingSold],
              [AgreementConsign],
              [AgreementAfterSold],
              [AgreementOther],
              [CompanyCode])
              VALUES
              (
              @VendorSysNo,
              @VendorApplyForm,
              @EnterpriseBusinessLicence,
              @OrganizeCodeCertificate,
              @TaxationAffairsRegistration,
              @AgreementBeingSold,
              @AgreementConsign,
              @AgreementAfterSold,
              @AgreementOther,
              @CompanyCode
              )
          END

          DECLARE @VendorContractInfo VARCHAR(5)

          IF @AgreementBeingSold IS NOT NULL AND LEN(@AgreementBeingSold) <> 0
              SET @VendorContractInfo = '1'
          IF @AgreementConsign IS NOT NULL AND LEN(@AgreementConsign) <> 0
              SET @VendorContractInfo = CASE WHEN @VendorContractInfo IS NULL THEN '2' ELSE @VendorContractInfo + ',2' END
          IF @AgreementAfterSold IS NOT NULL AND LEN(@AgreementAfterSold) <> 0
              SET @VendorContractInfo = CASE WHEN @VendorContractInfo IS NULL THEN '3' ELSE @VendorContractInfo + ',3' END

          UPDATE ipp3.dbo.Vendor
          SET VendorContractInfo = @VendorContractInfo
          WHERE SysNo = @VendorSysNo

          SELECT TOP 1
          [SysNo]
          ,[VendorSysNo]
          ,[VendorApplyForm]
          ,[EnterpriseBusinessLicence]
          ,[OrganizeCodeCertificate]
          ,[TaxationAffairsRegistration]
          ,[AgreementBeingSold]
          ,[AgreementConsign]
          ,[AgreementAfterSold]
          ,[AgreementOther]
          FROM ipp3.[dbo].[Vendor_Ex] WITH (NOLOCK)
          WHERE [VendorSysNo] = @VendorSysNo AND CompanyCode = @CompanyCode
        ]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
      <param name="@VendorApplyForm" dbType="String" size="500" />
      <param name="@EnterpriseBusinessLicence" dbType="String" size="500" />
      <param name="@OrganizeCodeCertificate" dbType="String" size="500" />
      <param name="@TaxationAffairsRegistration" dbType="String" size="500" />
      <param name="@AgreementBeingSold" dbType="String" size="500" />
      <param name="@AgreementConsign" dbType="String" size="500" />
      <param name="@AgreementAfterSold" dbType="String" size="500" />
      <param name="@AgreementOther" dbType="String" size="500" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetManufacturerName" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
			SELECT   ISNULL(ManufacturerName,'')
			FROM ipp3.dbo.Manufacturer  WITH(NOLOCK)
			WHERE sysno=@ManufacturerSysNo
			]]>
    </commandText>
    <parameters>
      <param name="@ManufacturerSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetVendorManufacturerBySysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
			SELECT
				DISTINCT  m.[SysNo]
			   ,m.[VendorSysNo]
			   ,m.[ManufacturerSysNo] as [ManufacturerInfo.SysNo]
			   ,Manufacturer.ManufacturerName as [ManufacturerInfo.ManufacturerNameLocal.Content]
			   ,m.[C2SysNo]
			   ,m.[AgentLevel]
			   ,m.[C3SysNo]
			   ,c2.Category2Name  as C2Name
			   ,ISNULL(c3.Category3Name,'') C3Name
         ,m.SendPeriod
         ,m.BuyWeekDay
         ,isnull(b.BrandName_Ch,b.BrandName_En)  AS [BrandInfo.BrandNameLocal.Content]
         ,m.BrandSysNo as [BrandInfo.SysNo]
         ,m.SettleType
         ,m.SettlePercentage
			FROM [IPP3].[dbo].[Vendor_Manufacturer] m WITH(NOLOCK)
			LEFT JOIN ipp3.dbo.Manufacturer Manufacturer WITH(NOLOCK)
				ON m.Manufacturersysno=Manufacturer.sysno
      LEFT JOIN OverseaContentManagement.dbo.V_IM_Brand b WITH(NOLOCK)
        ON m.BrandSysNo = b.SysNo
			LEFT JOIN OverseaContentManagement.dbo.V_CM_CategoryInfo c2  WITH(NOLOCK)
				ON c2.Category2Sysno=m.[C2SysNo]
			LEFT JOIN OverseaContentManagement.dbo.V_CM_CategoryInfo c3  WITH(NOLOCK)
				ON c3.Category3Sysno=m.[C3SysNo]
			WHERE  m.sysno=@SysNo
			]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="AbandonVMCommissionRule" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        UPDATE OverseaPOASNManagement.dbo.CommissionRule_Merchant
        SET
	        Status = 'D',
          EditDate = GetDate()
        WHERE VendorManufacturerSysNo = @VendorManufacturerSysNo
        AND Status = 'A'
			]]>
    </commandText>
    <parameters>
      <param name="@VendorManufacturerSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdateVendorManufacturer" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
			    UPDATE ipp3.dbo.Vendor_Manufacturer
          SET
            ManufacturerSysNo=@ManufacturerSysNo,
            C2SysNo=@C2SysNo,
            C3SysNo=@C3SysNo,
            AgentLevel=@Level,
            SettleType = @SettleType,
            SettlePercentage = @SettlePercentage,
            BuyWeekDay = @BuyWeekDay,
            SendPeriod = @SendPeriod,
            BrandSysNo = @BrandSysNo
          WHERE SysNo=@VendorManufacturerSysNo

				UPDATE [IPP3].[dbo].[Vendor_ModifyRequest]
				SET [status] = @Status
					,AuditUserSysNo=@AuditUserSysNo
					,AuditTime=getdate()
				WHERE SysNo = @SysNo
			]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@ManufacturerSysNo" dbType="Int32" />
      <param name="@C2SysNo" dbType="Int32" />
      <param name="@C3SysNo" dbType="Int32" />
      <param name="@Status" dbType="Int32" />
      <param name="@Level" dbType="String" />
      <param name="@VendorManufacturerSysNo" dbType="Int32" />
      <param name="@AuditUserSysNo" dbType="Int32" />
      <param name="@SettleType" dbType="String" size="1" />
      <param name="@SettlePercentage" dbType="Decimal" />
      <param name="@SendPeriod" dbType="String" />
      <param name="@BuyWeekDay" dbType="String" />
      <param name="@BrandSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetProductCountByVendorManufacturerNumber" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT COUNT(1)
        FROM
        (
        SELECT
		      1 AS V
	      FROM OverseaContentManagement.dbo.V_IM_Product prd WITH(nolock)
	      inner join ipp3.dbo.Vendor_Manufacturer mv WITH(nolock)
	      ON prd.MerchantSysNo = mv.VendorSysNo
	      AND prd.C3SysNo = mv.C3SysNo
          WHERE mv.SysNo = @VendorManufacturerSysNo
          AND prd.status <> -1

          UNION all

          SELECT
		      1 AS V
	      FROM OverseaContentManagement.dbo.V_IM_Product prd WITH(nolock)
	      INNER JOIN OverseaContentManagement.dbo.V_IM_Category3 c3 WITH(nolock)
	      ON c3.SysNo = prd.C3SysNo
	      inner join ipp3.dbo.Vendor_Manufacturer mv WITH(nolock)
	      ON prd.MerchantSysNo = mv.VendorSysNo
	      AND c3.C2SysNo = mv.C2SysNo
	      AND mv.C3SysNo IS null
          WHERE mv.SysNo = @VendorManufacturerSysNo
          AND prd.status <> -1
        ) as a
			]]>
    </commandText>
    <parameters>
      <param name="@VendorManufacturerSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetPayPeriodType" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT  [PayPeriodType]
        FROM IPP3.dbo.Vendor WITH(NOLOCK)
        WHERE SysNo=@VendorSysNo
			]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdateVendorRank" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
			UPDATE ipp3.dbo.Vendor
			     SET [RANK]=@Rank
				WHERE SysNo=@VendorSysNo

        	UPDATE [IPP3].[dbo].[Vendor_ModifyRequest]
				SET [status] = @Status
					,AuditUserSysNo=@AuditUserSysNo
					,AuditTime=getdate()
				WHERE SysNo = @SysNo
			]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
      <param name="@Rank" dbType="AnsiStringFixedLength" />
      <param name="@SysNo" dbType="Int32" />
      <param name="@Status" dbType="Int32" />
      <param name="@AuditUserSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetApplyVendorModifyRequest" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT TOP 1 [SysNo]
        ,[VendorSysNo]
        ,[PayPeriodType] as [PayPeriodType.PayTermsNo]
        ,[ValidDate]
        ,[ExpiredDate]
        ,[ContractAmt]
        ,[CreateTime]
        ,[CreateUserSysNo]
        ,[AuditTime]
        ,[AuditUserSysNo]
        ,[Status]
        ,[Memo]
        ,[NewVendorName] as [VendorName]
        ,[SettleType]
        ,[SettlePeriodType] as [SettlePeriodType]
        ,[SettlePercentage]
        ,[Content]
        ,(CASE WHEN AutoAudit = 'Y' THEN 1 ELSE 0 END) as AutoAudit
        FROM ipp3.[dbo].[Vendor_ModifyRequest] WITH (NOLOCK)
        WHERE VendorSysNo = @SysNo
        AND RequestType=0
        ORDER BY CreateTime DESC
			]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetVendorAttachment" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT TOP 1
[SysNo]
,[VendorSysNo]
,[VendorApplyForm]
,[EnterpriseBusinessLicence]
,[OrganizeCodeCertificate]
,[TaxationAffairsRegistration]
,[AgreementBeingSold]
,[AgreementConsign]
,[AgreementAfterSold]
,[AgreementOther]
FROM ipp3.[dbo].[Vendor_Ex] WITH (NOLOCK)
WHERE [VendorSysNo] = @VendorSysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetMaxSellerID" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT max(sellerid)
        FROM ipp3.dbo.Vendor WITH(nolock)
        WHERE VendorType = @VendorType
        AND CompanyCode = @CompanyCode
			]]>
    </commandText>
    <parameters>
      <param name="@VendorType" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength"/>
    </parameters>
  </dataCommand>


  <dataCommand name="CheckVendorFiananceAccountAndConsignExists" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT SysNo FROM ipp3.dbo.vendor
        where IsConsign=@IsConsign and Account =@AccountNumber and CompanyCode=@CompanyCode and sysno <> @VendorSysNo
			]]>
    </commandText>
    <parameters>
      <param name="@IsConsign" dbType="Int32" />
      <param name="@AccountNumber" dbType="AnsiStringFixedLength"/>
      <param name="@VendorSysNo" dbType="Int32"/>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetVendor" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT
            VendorName [Value]
           ,SysNo [Key]
        FROM  IPP3.dbo.Vendor  WITH(NOLOCK)
        WHERE
            vendortype= @VendorType
            AND  [Status]=0
            AND [CompanyCode]=@CompanyCode
        ORDER BY  SysNo
            ]]>
    </commandText>
    <parameters>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
      <param name="@VendorType" dbType="Int32"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetVendorFinanceMailInfo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT TOP 1
a.NewVendorName AS [VendorName]
,b.[District]
,a.[PayPeriodType]
,a.[ValidDate]
,a.[ExpiredDate]
,a.[ContractAmt]
,c.[DisplayName] AS [CreateUserName]
,c.[EmailAddress] AS [CreateUserEmailAddress]
FROM  [IPP3].[dbo].[Vendor_ModifyRequest] a WITH (NOLOCK)
LEFT JOIN  [IPP3].[dbo].[Vendor] b WITH (NOLOCK)
ON a.VendorSysNo = b.SysNo
LEFT JOIN [OverseaArchitecture].[dbo].[V_AR_UserInfo] c WITH (NOLOCK)
ON a.CreateUserSysNo = c.UserSysNo
WHERE a.SysNo = @SysNo
			]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetCanLockPMListByVendorSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
     SELECT 
      DISTINCT pm.PMUserSysNo as PMSysNo
     ,su.UserID as PMID
     ,su.UserName as PMName
  FROM  ipp3.dbo.PM_Master pm WITH(NOLOCK) 
  INNER JOIN OverseaContentManagement.dbo.V_IM_Product p  WITH(NOLOCK) 
      ON pm.PMUserSysNo= p.PMUserSysNo
  INNER JOIN ipp3.dbo.Sys_User su WITH(NOLOCK) 
      ON pm.PMUserSysNo = su.SysNo 
  WHERE 
      p.sysno   in  (  
              SELECT 
                  productsysno
              FROM OverseaInventoryManagement.dbo.V_Inventory_Obtain  AS obtain WITH(NOLOCK) 
              WHERE 
                  obtain.VendorSysno=@VendorSysno 
          ) 
      AND pm.status=0 
      AND p.CompanyCode = @CompanyCode 
  order by PMName
			]]>
    </commandText>
    <parameters>
      <param name="@VendorSysno" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetVendorPMHoldInfoByVendorSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT 
    [SysNo] 
   ,[VendorSysNo] 
   ,[PMSysNo] as PMSysNo
   ,[HoldMark] as IsChecked
   ,[InUser] 
   ,[InDate] 
   ,[EditUser] 
   ,[EditDate] 
   ,[CompanyCode] 
   ,[StoreCompanyCode] 
   ,[CurrencyCode] 
   ,[LanguageCode] 
FROM [OverseaPOASNManagement].[dbo].[Vendor_PM_HoldInfo] WITH(NOLOCK) 
WHERE 
    VendorSysNo=@VendorSysNo 
    AND CompanyCode=@CompanyCode
        
        ]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="CreateVendorPMHoldInfo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
DECLARE @SysNo int 
INSERT INTO [OverseaPOASNManagement].[dbo].[Vendor_PM_HoldInfo] 
(
     [VendorSysNo] 
    ,[PMSysNo] 
    ,[HoldMark] 
    ,[InUser] 
    ,[InDate] 
    ,[CompanyCode] 
    ,[StoreCompanyCode] 
) 
VALUES
(
     @VendorSysNo 
    ,@PMSysNo 
    ,@HoldMark 
    ,@InUser 
    ,GETDATE() 
    ,@CompanyCode 
    ,@StoreCompanyCode 
)
SET @SysNo = SCOPE_IDENTITY()
SELECT 
    SysNo 
   ,[VendorSysNo] 
   ,[PMSysNo] 
   ,[HoldMark] 
   ,[InUser] 
   ,[InDate] 
   ,[CompanyCode] 
   ,[StoreCompanyCode] 
FROM OverseaPOASNManagement.dbo.Vendor_PM_HoldInfo 
WHERE 
    SysNo=@SysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
      <param name="@PMSysNo" dbType="Int32" />
      <param name="@HoldMark" dbType="Int32" />
      <param name="@InUser" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@StoreCompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="EditPMHoldInfo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE  [OverseaPOASNManagement].[dbo].[Vendor_PM_HoldInfo] 
SET [HoldMark] = @HoldMark 
   ,[EditUser] = @EditUser 
   ,[EditDate] = GETDATE()  
WHERE 
    VendorSysNo = @VendorSysNo 
    AND PMSysNo In #PMSysNoIn
    AND CompanyCode=@CompanyCode
        
        ]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
      <!--<param name="@PMSysNo" dbType="Int32" />-->
      <param name="@EditUser" dbType="String" />
      <param name="@HoldMark" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <!--For Invoice Start-->

  <dataCommand name="IsHolderVendorByVendorSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
			  SELECT COUNT(1)
        FROM IPP3.dbo.Vendor v WITH(NOLOCK)
        WHERE v.SysNo=@VendorSysNo
        AND v.HoldMark=1
			]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="IsHolderVendorByPOSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
	        SELECT Count(1)
	        FROM  OverseaPOASNManagement.dbo.V_PM_POMaster po WITH (NOLOCK)
		           INNER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList v WITH(NOLOCK)
				        ON  po.VendorSysNo = v.SysNo
	        WHERE  po.SysNo = @POSysNo
		           AND v.HoldMark = 1
			]]>
    </commandText>
    <parameters>
      <param name="@POSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="IsHolderVendorByVendorSettleSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
	        SELECT Count(1)
	        FROM   OverseaPOASNManagement.dbo.V_PM_ConsignSettle cs WITH (NOLOCK)
		           LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList v WITH (NOLOCK)
				        ON  cs.VendorSysNo = v.SysNo
	        WHERE	cs.SysNo = @VendorSettleSysNo
			        AND v.HoldMark = 1
			]]>
    </commandText>
    <parameters>
      <param name="@VendorSettleSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="IsHolderVendorByCollectionSettlementSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
	       SELECT Count(1)
	        FROM   OverseaPOASNManagement.dbo.CollectionSettlement cls WITH (NOLOCK)
		           LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList v WITH (NOLOCK)
				        ON  cls.MerchantSysNo = v.SysNo
	        WHERE cls.SysNo = @CollectionSettlementSysNo
               AND v.HoldMark = 1
			]]>
    </commandText>
    <parameters>
      <param name="@CollectionSettlementSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="IsHolderVendorPMByPOSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
 SELECT
     COUNT(1)
 FROM   OverseaPOASNManagement.dbo.V_PM_POMaster po WITH (NOLOCK)
 LEFT JOIN OverseaPOASNManagement.dbo.Vendor_PM_HoldInfo pm WITH(NOLOCK)
     ON po.VendorSysNo=pm.VendorSysNo
 WHERE po.SysNo = @POSysNo
     AND pm.HoldMark = 1
     AND pm.PMSysNo=po.PMSysNo
			]]>
    </commandText>
    <parameters>
      <param name="@POSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="IsHolderVendorPMByVendorSettleSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
     SELECT
       COUNT(1)
   FROM   [IPP3].[dbo].[POConsign_Settle] cs WITH (NOLOCK)
   LEFT JOIN OverseaPOASNManagement.dbo.Vendor_PM_HoldInfo pm WITH(NOLOCK)
       ON cs.VendorSysNo=pm.VendorSysNo
   WHERE cs.SysNo = @VendorSettleSysNo
       AND pm.HoldMark = 1
       AND pm.PMSysNo=cs.PMSysno
			]]>
    </commandText>
    <parameters>
      <param name="@VendorSettleSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="CreateVendorStore" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
INSERT INTO [IPP3].[dbo].[Vendor_Store]
           ([VendorSysNo]
           ,[Name]
           ,[AreaSysNo]
           ,[Address]
           ,[MapAddress]
           ,[Telephone]
           ,[OtherContact]
           ,[OpeningHoursFrom]
           ,[OpeningHoursTo]
           ,[CreateDate]
           ,[CreateUser]         
           ,[CompanyCode]
           ,[StoreCompanyCode]
           ,[LanguageCode]
           ,CityBusLine
           ,CarPark
           ,FloorSetting)
     VALUES
           (@VendorSysNo
           ,@Name
           ,@AreaSysNo
           ,@Address
           ,@MapAddress
           ,@Telephone
           ,@OtherContact
           ,@OpeningHoursFrom
           ,@OpeningHoursTo
           ,GETDATE()
           ,@CreateUser           
           ,@CompanyCode
           ,@StoreCompanyCode
           ,'zh-CN'
           ,@CityBusLine
           ,@CarPark
           ,@FloorSetting)
           
      SELECT @SysNo = SCOPE_IDENTITY()
			]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
      <param name="@Name" dbType="String" />
      <param name="@AreaSysNo" dbType="Int32" />
      <param name="@Address" dbType="String" />
      <param name="@MapAddress" dbType="String" property="Address"/>
      <param name="@Telephone" dbType="String" />
      <param name="@CityBusLine" dbType="String" />
      <param name="@CarPark" dbType="String" />
      <param name="@FloorSetting" dbType="String" />
      <param name="@OtherContact" dbType="String" />
      <param name="@OpeningHoursFrom" dbType="String" />
      <param name="@OpeningHoursTo" dbType="String" />
      <param name="@CreateUser" dbType="String" property="[UserAcct]" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@StoreCompanyCode" dbType="AnsiStringFixedLength" property="CompanyCode"/>
      <param name="@SysNo" dbType="Int32" size="10" direction="Output"/>
    </parameters>
  </dataCommand>

  <dataCommand name="UpdateVendorStore" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE [IPP3].[dbo].[Vendor_Store] SET 
       [Name] = @Name
      ,[AreaSysNo] = @AreaSysNo
      ,[Address] = @Address
      ,[MapAddress] = @MapAddress
      ,[Telephone] = @Telephone
      ,[OtherContact] = @OtherContact
      ,[OpeningHoursFrom] = @OpeningHoursFrom
      ,[OpeningHoursTo] = @OpeningHoursTo      
      ,[EditDate] = GETDATE()
      ,[EditUser] = @EditUser   
      ,[CityBusLine] = @CityBusLine
      ,[CarPark] = @CarPark
      ,[FloorSetting] = @FloorSetting
 WHERE SysNo=@SysNo
			]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@Name" dbType="String" />
      <param name="@AreaSysNo" dbType="Int32" />
      <param name="@Address" dbType="String" />
      <param name="@MapAddress" dbType="String" property="Address"/>
      <param name="@Telephone" dbType="String" />
      <param name="@OtherContact" dbType="String" />
      <param name="@OpeningHoursFrom" dbType="String" />
      <param name="@OpeningHoursTo" dbType="String" />
      <param name="@EditUser" dbType="String" property="[UserAcct]"/>
      <param name="@CityBusLine" dbType="String" />
      <param name="@CarPark" dbType="String" />
      <param name="@FloorSetting" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="CheckVendorStoreNameExists" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT 
	 TOP 1 SysNo
FROM [IPP3].[dbo].[Vendor_Store] WITH(NOLOCK)
WHERE VendorSysNo=@VendorSysNo AND Name=@Name AND SysNo!=@SysNo
			]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
      <param name="@SysNo" dbType="Int32" />
      <param name="@Name" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="LoadVendorStoreBySysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT 
	  [SysNo]
	 ,[VendorSysNo]
   ,[Name]
   ,[AreaSysNo]
   ,[Address]
   ,[MapAddress]
   ,[Telephone]
   ,[OtherContact]
   ,[OpeningHoursFrom]
   ,[OpeningHoursTo]
   ,[CreateDate]
   ,[CreateUser]  
   ,[EditDate]
   ,[EditUser]              
   ,[CompanyCode]
   ,[StoreCompanyCode]
   ,[LanguageCode]
   ,CityBusLine
   ,CarPark
   ,FloorSetting
FROM [IPP3].[dbo].[Vendor_Store] WITH(NOLOCK)
WHERE SysNo=@SysNo
			]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetVendorStoreInfoList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT 
	  [SysNo]
	 ,[VendorSysNo]
   ,[Name]
   ,[AreaSysNo]
   ,[Address]
   ,[MapAddress]
   ,[Telephone]
   ,[OtherContact]
   ,[OpeningHoursFrom]
   ,[OpeningHoursTo]
   ,[CreateDate]
   ,[CreateUser]  
   ,[EditDate]
   ,[EditUser]              
   ,[CompanyCode]
   ,[StoreCompanyCode]
   ,[LanguageCode]
   ,CityBusLine
   ,CarPark
   ,FloorSetting
FROM [IPP3].[dbo].[Vendor_Store] WITH(NOLOCK)
WHERE VendorSysNo=@VendorSysNo
			]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>



  <dataCommand name="UpdateCommissionRuleTemplate" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
IF EXISTS(SELECT 1 FROM ECStore.dbo.CommissionRule WITH (NOLOCK) WHERE C3SysNo=@C3SysNo AND BrandSysNo=@BrandSysNo)

UPDATE ECStore.dbo.CommissionRule SET 
OrderCommissionFee=@OrderCommissionAmt,
SalesRule=@SalesRule,
DeliveryFee=@DeliveryFee,
RentFee=@RentFee,
[Status]=@Status,
EditUserSysNo=@EditUserSysNo,
EditUserName=@EditUserName,
EditDate=GETDATE() 
WHERE C3SysNo=@C3SysNo AND BrandSysNo=@BrandSysNo

ELSE
INSERT INTO [ECStore].[dbo].[CommissionRule]
           ([OrderCommissionFee]
           ,[SalesRule]
           ,[DeliveryFee]
           ,[RentFee]
           ,[Status]
           ,[BrandSysNo]
           ,[C1SysNo]
           ,[C2SysNo]
           ,[C3SysNo]
           ,[InUserSysNo]
           ,[InUserName]
           ,[InDate])
     VALUES
           (@OrderCommissionAmt,
           @SalesRule,
           @DeliveryFee, 
           @RentFee, 
           @Status, 
           @BrandSysNo,
           @C1SysNo,
           @C2SysNo,
           @C3SysNo, 
           @InUserSysNo,
           @InUserName, 
           GETDATE())
			]]>
    </commandText>
    <parameters>
      <param name="@OrderCommissionAmt" dbType="Decimal"  />
      <param name="@SalesRule" dbType="String" />
      <param name="@DeliveryFee" dbType="Decimal" />
      <param name="@RentFee" dbType="Decimal" />
      <param name="@Status" dbType="Int32"/>
      <param name="@BrandSysNo" dbType="Int32" />
      <param name="@C1SysNo" dbType="Int32" />
      <param name="@C2SysNo" dbType="Int32" />
      <param name="@C3SysNo" dbType="Int32" />
      <param name="@InUserSysNo" dbType="Int32" property="[UserSysNo]"/>
      <param name="@InUserName" dbType="String" property="[UserAcct]"/>
      <param name="@EditUserSysNo" dbType="Int32" property="[UserSysNo]"/>
      <param name="@EditUserName" dbType="String" property="[UserAcct]"/>
    </parameters>
  </dataCommand>


  <dataCommand name="SetCommissionRuleStatus" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE ECStore.dbo.CommissionRule SET 
[Status]=@Status
WHERE sysno in (#sysnos#)
			]]>
    </commandText>
    <parameters>
      <param name="@Status" dbType="String"/>
    </parameters>
  </dataCommand>

    <dataCommand name="GetCommissionRuleTemplateInfo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT  [SysNo]
      ,[OrderCommissionFee] as OrderCommissionAmt
      ,[SalesRule]
      ,[DeliveryFee]
      ,[RentFee]
      ,[Status]
      ,[BrandSysNo]
      ,[C1SysNo]
      ,[C2SysNo]
      ,[C3SysNo]
      ,[InUserSysNo]
      ,[InUserName]
      ,[InDate]
      ,[EditUserSysNo]
      ,[EditUserName]
      ,[EditDate]
  FROM [ECStore].[dbo].[CommissionRule]
  where sysno=@SysNo
			]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32"/>
    </parameters>
  </dataCommand>

  
  
  <dataCommand name="QueryCommissionRuleTemplateInfo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
 SELECT @TotalCount = COUNT(1)
        FROM  ECStore.[dbo].CommissionRule r WITH(NOLOCK)
        #StrWhere#

        SELECT
               [SysNo]
      ,[OrderCommissionFee] as OrderCommissionAmt
      ,[SalesRule]
      ,[DeliveryFee]
      ,[RentFee]
      ,[Status]
      ,[BrandSysNo]
      ,[C1SysNo]
      ,[C2SysNo]
      ,[C3SysNo]
      ,[InUserSysNo]
      ,[InUserName]
      ,[InDate]
      ,[EditUserSysNo]
      ,[EditUserName]
      ,[EditDate] 
      ,C1Name
      ,C2Name
      ,C3Name
      ,BrandName
        FROM
        (
      SELECT TOP (@EndNumber)
        r.[SysNo]
      ,r.[OrderCommissionFee]
      ,r.[SalesRule]
      ,r.[DeliveryFee]
      ,r.[RentFee]
      ,r.[Status]
      ,r.[BrandSysNo]
      ,r.[C1SysNo]
      ,r.[C2SysNo]
      ,r.[C3SysNo]
      ,r.[InUserSysNo]
      ,r.[InUserName]
      ,r.[InDate]
      ,r.[EditUserSysNo]
      ,r.[EditUserName]
      ,r.[EditDate]
      ,c1.C1Name
      ,c2.C2Name
      ,c3.C3Name
      ,Brand.BrandName_Ch as BrandName
      ,ROW_NUMBER() OVER(ORDER BY #SortColumnName#) AS RowNumber
	        FROM  ECStore.[dbo].CommissionRule as r WITH(NOLOCK)
            LEFT JOIN IPP3.dbo.Category1 c1 WITH (NOLOCK)
            on r.C1SysNo=c1.SysNo
            LEFT JOIN IPP3.dbo.Category2 c2 WITH (NOLOCK)
            on r.C2SysNo=c2.SysNo
            LEFT JOIN IPP3.dbo.Category3 c3 WITH (NOLOCK)
            on r.C3SysNo=c3.SysNo
            LEFT JOIN OverseaContentManagement.[dbo].[V_CM_Brand] Brand
            ON Brand.SysNo=r.BrandSysNo
	          #StrWhere#
      )RESULT where RowNumber > @StartNumber
			]]>
    </commandText>
  </dataCommand>

  <dataCommand name="QuerySecondDomain" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
 SELECT @TotalCount = COUNT(1)
        FROM  [IPP3].[dbo].[Vendor] v WITH(NOLOCK)
        #StrWhere#

 SELECT
       [SysNo]
      ,[VendorID]
      ,[VendorName]
      ,[Address]
      ,[Phone]
      ,[Email]
      ,[SecondDomain]
      ,[SecondDomainStatus]
      FROM
      (
      SELECT TOP (@EndNumber)
       v.[SysNo]
      ,v.[VendorID]
      ,v.[VendorName]
      ,v.[Address]
      ,v.[Phone]
      ,v.[Email]
      ,v.[SecondDomain]
      ,v.[SecondDomainStatus]
      ,ROW_NUMBER() OVER(ORDER BY #SortColumnName#) AS RowNumber
	    FROM  [IPP3].[dbo].[Vendor] as v WITH(NOLOCK)
	    #StrWhere#
      )RESULT where RowNumber > @StartNumber
			]]>
    </commandText>
  </dataCommand>

  <!--For Invoice End-->

  <dataCommand name="GetVendorPresetContent" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
 SELECT TOP 1 [Value] FROM  [IPP3].[dbo].[Sys_Configuration] WITH(NOLOCK)  WHERE [Key] = 'VendorPresetContent'
			]]>
    </commandText>
  </dataCommand>


  <dataCommand name="CreateStorePageInfo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
    INSERT INTO ECStore.dbo.StorePageInfo 
        (SellerSysNo,PageTypeKey,PageName,DataValue,LinkUrl,Status,InUserSysNo,InUserName,InDate) 
    VALUES 
        (@SellerSysNo,@PageTypeKey,@PageName,@DataValue,@LinkUrl,@Status,@InUserSysNo,@InUserName,GETDATE())

    SELECT @SysNo = SCOPE_IDENTITY(); 
    
      UPDATE ECStore.dbo.StorePageInfo
    SET LinkUrl = replace(LinkUrl, N'{StorePageSysNo}', @SysNo)
    WHERE SysNo = @SysNo

        ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" direction="Output"/>
      <param name="@SellerSysNo" dbType="Int32" />
      <param name="@PageTypeKey" dbType="AnsiStringFixedLength" />
      <param name="@PageName" dbType="String" />
      <param name="@DataValue" dbType="String" />
      <param name="@LinkUrl" dbType="String" />
      <param name="@Status" dbType="String" />
      <param name="@InUserSysNo" dbType="Int32" />
      <param name="@InUserName" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="CreatePublishedStorePageInfo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
    INSERT INTO ECStore.dbo.PublishedStorePageInfo 
        (SellerSysNo,PageName,DataValue,LinkUrl,Status,InUserSysNo,InUserName,InDate,StorePageSysNo,PageTypeKey) 
    VALUES 
        (@SellerSysNo,@PageName,@DataValue,@LinkUrl,@Status,@InUserSysNo,@InUserName,GETDATE(),@StorePageSysNo,@PageTypeKey)

    SELECT @SysNo = SCOPE_IDENTITY(); 
    
    UPDATE ECStore.dbo.PublishedStorePageInfo
    SET LinkUrl = replace(LinkUrl, N'{StorePageSysNo}', @SysNo)
    WHERE SysNo = @SysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" direction="Output"/>
      <param name="@SellerSysNo" dbType="Int32" />
      <param name="@PageName" dbType="String" />
      <param name="@DataValue" dbType="String" />
      <param name="@LinkUrl" dbType="String" />
      <param name="@Status" dbType="String" />
      <param name="@InUserSysNo" dbType="Int32" />
      <param name="@InUserName" dbType="AnsiStringFixedLength" />
      <param name="@StorePageSysNo" dbType="Int32" />
      <param name="@PageTypeKey" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>
  
  <!-- 创建店铺网页的Header信息。:ECStore.dbo.StorePageHeader -->
  <dataCommand name="CreateStorePageHeader" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
    INSERT INTO ECStore.dbo.StorePageHeader 
        (SellerSysNo,HeaderContent,InUserSysNo,InUserName,InDate) 
    VALUES 
        (@SellerSysNo,@HeaderContent,@InUserSysNo,@InUserName,GETDATE())

    SELECT @SysNo = SCOPE_IDENTITY(); 
        ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" direction="Output"/>
      <param name="@SellerSysNo" dbType="Int32" />
      <param name="@HeaderContent" dbType="String" />
      <param name="@InUserSysNo" dbType="Int32" />
      <param name="@InUserName" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <!-- 获取店铺网页的Header信息。:ECStore.dbo.StorePageHeader -->
  <dataCommand name="GetPageHeaderBySellerSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
    SELECT 
            SysNo, SellerSysNo, HeaderContent, InUserSysNo, InUserName, InDate, EditUserSysNo, EditUserName, EditDate 
            FROM ECStore.dbo.StorePageHeader WITH(NOLOCK) 
            WHERE SellerSysNo=@SellerSysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@SellerSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  
  <dataCommand name="GetStorePageInfoListBySeller" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT * FROM ECStore.dbo.StorePageInfo WITH(NOLOCK) where SellerSysNo=@SellerSysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@SellerSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
    
  <dataCommand name="GetPublishedStorePageInfoListBySeller" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT * FROM ECStore.dbo.PublishedStorePageInfo WITH(NOLOCK) where SellerSysNo=@SellerSysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@SellerSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  
  <dataCommand name="IsCreatedVendorUser" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT TOP 1 SysNo FROM IPP3.dbo.VendorUser WITH(NOLOCK) where VendorSysNo=@VendorSysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>


  <!-- 创建品牌报备:ECStore.dbo.StoreBrandFiling -->
  <dataCommand name="InsertStoreBrandFiling" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
if not exists (select 1 from ECStore.dbo.StoreBrandFiling (nolock) where SellerSysNo=@SellerSysNo and BrandSysNo=@BrandSysNo)
begin
INSERT INTO ECStore.dbo.StoreBrandFiling 
(SellerSysNo,BrandSysNo,InspectionNo,AgentLevel,Staus,InUserSysNo,InUserName,InDate) 
VALUES 
(@SellerSysNo,@BrandSysNo,@InspectionNo,@AgentLevel,@Staus,@InUserSysNo,@InUserName,GETDATE())
SELECT @SysNo = SCOPE_IDENTITY(); 
end
else
begin
select @SysNo=-1
end
        ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" direction="Output"/>
      <param name="@SellerSysNo" dbType="Int32" />
      <param name="@BrandSysNo" dbType="Int32" />
      <param name="@InspectionNo" dbType="AnsiString" />
      <param name="@AgentLevel" dbType="String" />
      <param name="@Staus" dbType="Int32" />
      <param name="@InUserSysNo" dbType="Int32" />
      <param name="@InUserName" dbType="AnsiStringFixedLength" />

    </parameters>
  </dataCommand>

  <!-- 更新品牌报备:ECStore.dbo.StoreBrandFiling -->
  <dataCommand name="UpdateStoreBrandFiling" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
    UPDATE ECStore.dbo.StoreBrandFiling SET 
        SellerSysNo=@SellerSysNo,
        BrandSysNo=@BrandSysNo,
        InspectionNo=@InspectionNo,
        AgentLevel=@AgentLevel,
        Staus=@Staus,
        EditUserSysNo=@EditUserSysNo,
        EditUserName=@EditUserName,
        EditDate=GETDATE() 
        WHERE SysNo=@SysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@SellerSysNo" dbType="Int32" />
      <param name="@BrandSysNo" dbType="Int32" />
      <param name="@InspectionNo" dbType="AnsiString" />
      <param name="@AgentLevel" dbType="String" />
      <param name="@Staus" dbType="Int32" />
      <param name="@EditUserSysNo" dbType="Int32" />
      <param name="@EditUserName" dbType="AnsiStringFixedLength" />

    </parameters>
  </dataCommand>
  
  <dataCommand name="DeleteStoreBrandFiling" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
    DELETE ECStore.dbo.StoreBrandFiling WHERE SellerSysNo = @SellerSysNo AND BrandSysNo = @BrandSysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@SellerSysNo" dbType="Int32" />
      <param name="@BrandSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
    
  <dataCommand name="IncrementStoreBrandInspectionSeed" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
IF EXISTS (SELECT TOP 1 1 FROM ECStore.dbo.StoreBrandInspectionSeed WITH(NOLOCK) WHERE SellerSysNo = @SellerSysNo)
BEGIN
	UPDATE ECStore.dbo.StoreBrandInspectionSeed
	SET CurrentBrandInspectionNo = CurrentBrandInspectionNo + 1
	WHERE SellerSysNo = @SellerSysNo
	
	SELECT TOP 1 CurrentBrandInspectionNo 
	FROM ECStore.dbo.StoreBrandInspectionSeed WITH(NOLOCK)
	WHERE SellerSysNo = @SellerSysNo
END
ELSE
BEGIN
	INSERT ECStore.dbo.StoreBrandInspectionSeed (SellerSysNo, CurrentBrandInspectionNo) VALUES (@SellerSysNo, 1)	
	
	SELECT 1 AS CurrentBrandInspectionNo
END
        ]]>
    </commandText>
    <parameters>
      <param name="@SellerSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
      
  <dataCommand name="IncrementStoreInspectionSeed" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
INSERT ECStore.dbo.StoreInspectionNoSeed ([SellerSysNo])
VALUES (@SellerSysNo)

SELECT SCOPE_IDENTITY(); 
        ]]>
    </commandText>
    <parameters>
      <param name="@SellerSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
        
  <dataCommand name="WriteStoreInspectionNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
IF NOT EXISTS ( SELECT TOP 1 1 FROM IPP3.dbo.Vendor_Customs_Info WITH(NOLOCK) WHERE MerchantSysNo = @SellerSysNo)
BEGIN
	INSERT IPP3.dbo.Vendor_Customs_Info (MerchantSysNo,InspectionCode, InDate, InUser)
  Values (@SellerSysNo,@InspectionNo, getdate(), @UserName)
END
ELSE
BEGIN
    UPDATE TOP(1) IPP3.dbo.Vendor_Customs_Info
	  SET InspectionCode = @InspectionNo,
      EditDate = getdate(),
      EditUser = @UserName
	  WHERE MerchantSysNo = @SellerSysNo
  END
        ]]>
    </commandText>
    <parameters>
      <param name="@InspectionNo" dbType="AnsiString" />
      <param name="@SellerSysNo" dbType="Int32" />
      <param name="@UserName" dbType="AnsiString" />
    </parameters>
  </dataCommand>
  
  <dataCommand name="CreateEmptyVendorCustomsInfo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
IF NOT EXISTS ( SELECT TOP 1 1 FROM IPP3.dbo.Vendor_Customs_Info WITH(NOLOCK) WHERE MerchantSysNo = @MerchantSysNo)
BEGIN
	INSERT IPP3.dbo.Vendor_Customs_Info (MerchantSysNo, InDate, InUser) Values (@MerchantSysNo, getdate(), @UserName)
END
        ]]>
    </commandText>
    <parameters>
      <param name="@MerchantSysNo" dbType="Int32" />
      <param name="@UserName" dbType="AnsiString" />
    </parameters>
  </dataCommand>  
  
  <dataCommand name="GetVendorCustomsInfo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
	SELECT TOP 1 * FROM IPP3.dbo.Vendor_Customs_Info WITH(NOLOCK) WHERE MerchantSysNo = @MerchantSysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@MerchantSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>


  <dataCommand name="CreateOrUpdateVendorCustomsInfo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
IF NOT EXISTS ( SELECT TOP 1 1 FROM IPP3.dbo.Vendor_Customs_Info WITH(NOLOCK) WHERE MerchantSysNo = @MerchantSysNo)
BEGIN
	INSERT INTO [IPP3].[dbo].[Vendor_Customs_Info]
			   ([MerchantSysNo]
			   ,[InspectionCode]
			   ,[KJTCode]
			   ,[CBTMerchantCode]
			   ,[CBTMerchantName]
			   ,[CBTSRC_NCode]
			   ,[CBTREC_NCode]
			   ,[EasiPaySecretKey]
			   ,[ReceiveCurrencyCode]
			   ,[PayCurrencyCode]
			   ,[FTAppId]
			   ,[FTAppSecretKey]
			   ,[CBTSODeclareSecretKey]
			   ,[CBTProductDeclareSecretKey]
			   ,[InspectionProductDeclareSecretKey]
			   ,[KJTAppId]
			   ,[KJTAppSecretKey]
			   ,[InDate]
			   ,[InUser])
		 VALUES
			   (@MerchantSysNo
			   ,@InspectionCode
			   ,@KJTCode
			   ,@CBTMerchantCode
			   ,@CBTMerchantName
			   ,@CBTSRC_NCode
			   ,@CBTREC_NCode
			   ,@EasiPaySecretKey
			   ,@ReceiveCurrencyCode
			   ,@PayCurrencyCode
			   ,@FTAppId
			   ,@FTAppSecretKey
			   ,@CBTSODeclareSecretKey
			   ,@CBTProductDeclareSecretKey
			   ,@InspectionProductDeclareSecretKey
			   ,@KJTAppId
			   ,@KJTAppSecretKey
			   ,GETDATE()
			   ,@User)
END
ELSE
BEGIN
	UPDATE TOP(1) [IPP3].[dbo].[Vendor_Customs_Info]
	   SET [InspectionCode] = @InspectionCode
		  ,[KJTCode] = @KJTCode
		  ,[CBTMerchantCode] = @CBTMerchantCode
		  ,[CBTMerchantName] = @CBTMerchantName
		  ,[CBTSRC_NCode] = @CBTSRC_NCode
		  ,[CBTREC_NCode] = @CBTREC_NCode
		  ,[EasiPaySecretKey] = @EasiPaySecretKey
		  ,[ReceiveCurrencyCode] = @ReceiveCurrencyCode
		  ,[PayCurrencyCode] = @PayCurrencyCode
		  ,[FTAppId] = @FTAppId
		  ,[FTAppSecretKey] = @FTAppSecretKey
		  ,[CBTSODeclareSecretKey] = @CBTSODeclareSecretKey
		  ,[CBTProductDeclareSecretKey] = @CBTProductDeclareSecretKey
		  ,[InspectionProductDeclareSecretKey] = @InspectionProductDeclareSecretKey
		  ,[KJTAppId] = @KJTAppId
		  ,[KJTAppSecretKey] = @KJTAppSecretKey
		  ,[EditDate] = GETDATE()
		  ,[EditUser] = @User
	 WHERE MerchantSysNo = @MerchantSysNo
END
        ]]>
    </commandText>
    <parameters>
      <param name="@MerchantSysNo" dbType="Int32" />
      <param name="@InspectionCode" dbType="String" />
      <param name="@KJTCode" dbType="String" />
      <param name="@CBTMerchantCode" dbType="String" />
      <param name="@CBTMerchantName" dbType="String" />
      <param name="@CBTSRC_NCode" dbType="String" property="CBTSRC_NCode" />
      <param name="@CBTREC_NCode" dbType="String" property="CBTREC_NCode" />
      <param name="@EasiPaySecretKey" dbType="String" />
      <param name="@ReceiveCurrencyCode" dbType="String" />
      <param name="@PayCurrencyCode" dbType="String" />
      <param name="@FTAppId" dbType="String" />
      <param name="@FTAppSecretKey" dbType="String" />
      <param name="@CBTSODeclareSecretKey" dbType="String" />
      <param name="@CBTProductDeclareSecretKey" dbType="String" />
      <param name="@InspectionProductDeclareSecretKey" dbType="String" />
      <param name="@KJTAppId" dbType="String" />
      <param name="@KJTAppSecretKey" dbType="String" />
      <param name="@User" dbType="String" property="[USERACCT]" />
    </parameters>
  </dataCommand>
    
  <dataCommand name="GetStorePageTemplate" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
	SELECT TOP 1 * FROM ECStore.dbo.PageTemplate WITH(NOLOCK) WHERE [Key] = @Key AND PageTypeKey = @PageTypeKey AND Status = 1
        ]]>
    </commandText>
    <parameters>
      <param name="@Key" dbType="AnsiStringFixedLength" />
      <param name="@PageTypeKey" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>


  <dataCommand name="CheckSecondDomainStatus" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
  SELECT SecondDomainStatus FROM [IPP3].[dbo].[Vendor]
  WHERE SysNo = @SysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="ChangeSecondDomainStatus" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
  UPDATE [IPP3].[dbo].[Vendor]
  SET SecondDomainStatus = @SecondDomainStatus
  WHERE SysNo = @SysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@SecondDomainStatus" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="SaveStockForKJ" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      
INSERT INTO [IPP3].[dbo].[Stock]
           ([SysNo]
           ,[StockID]
           ,[StockName]
           ,[Address]
           ,Contact
           ,Phone
           ,[CompanyCode]
           ,[LanguageCode]
           ,[StoreCompanyCode]
           ,[CountryCode]
           ,[MerchantSysNo]
           ,[Status])
     VALUES
           (@SysNo
           ,@StockID
           ,@StockName
           ,''
           ,''
           ,''
           ,@CompanyCode
           ,@LanguageCode
           ,@StoreCompanyCode
           ,@CountryCode
           ,@MerchantSysNo
           ,@Status)
        ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@StockID" dbType="String" />
      <param name="@StockName" dbType="String" />
      <param name="@CompanyCode" dbType="String" />
      <param name="@LanguageCode" dbType="String" />
      <param name="@StoreCompanyCode" dbType="String" />
      <param name="@CountryCode" dbType="String" />
      <param name="@MerchantSysNo" dbType="Int32" />
      <param name="@Status" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="NewStockSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
				INSERT INTO IPP3.dbo.Stock_Sequence(CreateTime) Values(GETDATE())
				SELECT SCOPE_IDENTITY() AS SysNo
      ]]>
    </commandText>
  </dataCommand>
<!--ChrisHe-->
  <dataCommand name="GetApplyForAttachment" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT  [Sysno]
      ,[Url]
      ,[FileName]
      ,[Status]
      ,[ApplicationType]
      ,[InDate]
      ,[InUser]
      ,[EditDate]
      ,[EditUser]
      ,[SellerSysNo]
  FROM [IPP3].[dbo].[SellerApplicationAttachment]
  WHERE SellerSysNo =  @VendorSysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <!--ChrisHe-->
  <dataCommand name="GetApplyForInfo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT [Sysno]
      ,[ApplicationType]
      ,[Status]
      ,[Memo]
      ,[InDate]
      ,[InUser]
      ,[EditDate]
      ,[EditUser]
      ,[SellerSysNo]
  FROM [IPP3].[dbo].[SellerApplication]
  WHERE SellerSysNo =  @VendorSysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
</dataOperations>
