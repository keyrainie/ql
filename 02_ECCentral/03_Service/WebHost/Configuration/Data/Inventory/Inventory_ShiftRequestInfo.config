<?xml version="1.0" encoding="utf-8" ?>
<dataOperations xmlns="http://oversea.newegg.com/DataOperation">
  <!--Query BEGIN-->
  <dataCommand name="Inventory_QueryShiftRequest" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT @TotalCount = COUNT(a.SysNo) 
	      FROM IPP3.dbo.St_Shift AS a WITH(NOLOCK) 
	      #JoinType_Count#
	      #StrWhere#

	      DECLARE @Temp TABLE
	      (
		      SysNo INT
	      )
	      INSERT INTO @Temp (SysNo)
	      SELECT TransferSysNumber FROM (
	      SELECT a.SYSNO AS TransferSysNumber,(ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber FROM
		      IPP3.dbo.st_shift a WITH(NOLOCK)
		      #JoinType_Count#
		      #SortByWeightCondition#
		      #StrWhere#
	      ) AS Result
	      WHERE RowNumber BETWEEN @StartNumber+1 AND @EndNumber

	      SELECT
		      a.SysNo 
	         ,a.ShiftID AS RequestID 
	         ,a.StockSysNoA AS SourceStockSysNo
	         ,a.StockSysNoB AS TargetStockSysNo
	         ,a.CreateTime AS CreateDate 
	         ,a.CreateUserSysNo AS CreateUserSysNo
	         ,a.AuditTime AS AuditDate
	         ,a.AuditUserSysNo AS AuditUserSysNo
	         ,a.OutTime AS OutStockDate 
	         ,a.OutUserSysNo AS OutStockUserSysNo
	         ,a.InTime AS InStockDate
	         ,a.InUserSysNo AS InStockUserSysNo
	         ,a.Status AS RequestStatus 
	         ,a.TotalAmt AS TotalAmount 
	         ,a.ShiftType AS ShiftType 
	         ,a.shipViaTerm AS ShiftShippingType
	         ,a.IsScanned AS IsScanned 
	         ,a.SpecialShiftType AS SpecialShiftType 
	         ,a.SpecialShiftSetTime AS SpecialShiftSetDate
	         ,cu.DisplayName AS CreateUserName 
	         ,cu.EmailAddress AS CreateUserEmail
	         ,au.DisplayName AS AuditUserName 
	         ,ou.DisplayName AS OutStockUserName 
	         ,iu.DisplayName AS InStockUserName
	         ,StockA.StockName AS SourceStockName
	         ,StockB.StockName AS TargetStockName
	         ,si.TotalWeight AS TotalWeight 
           ,a.SpecialShiftSetUser AS SpecialShiftSetUserSysNo
	         ,su.DisplayName AS SpecialShiftSetUserName 
	         ,AutoST.SOOutTime AS SOOutStockDate 
	         ,AutoST.SOSysNo AS SOSysNo 
	         ,AutoST.SOstatus AS SOStatus
	         ,a.SAPPostDate
	         ,a.SAPDocNo
	         ,a.SAPImportedStatus
	         ,a.SAPInFailedReason
	         ,a.CompanyCode
	         ,a.LanguageCode
	         ,a.CurrencySysNo
	         ,ISNull(a.ShipViaDesc,'N/A')+':'+ISNull(a.TrackingNumber,'N/A') AS TrackingNumber
	      FROM IPP3.dbo.st_shift a WITH (NOLOCK) 
	      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo cu WITH (NOLOCK) 
		      ON a.CreateUserSysNo = cu.UserSysNo 
	      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo au  WITH (NOLOCK) 
		      ON a.AuditUserSysNo = au.UserSysNo 
	      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo ou WITH (NOLOCK) 
		      ON  a.OutUserSysNo = ou.UserSysNo 
	      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo su WITH (NOLOCK) 
		      ON  a.SpecialShiftSetUser=su.UserSysNo 
	      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo iu WITH (NOLOCK) 
		      ON a.InUserSysNo = iu.UserSysNo  
	      LEFT JOIN ( 
			      SELECT 
				      ssi.ShiftSysNo 
			         ,SUM(ssi.ShiftQty*product.weight) AS TotalWeight 
			      FROM IPP3.dbo.St_Shift_Item  ssi WITH (NOLOCK) 
				      LEFT JOIN OverseaContentManagement.dbo.V_CM_ItemBasicInfo product WITH (NOLOCK) 
				      ON ssi.ProductSysNo=product.sysno 
			      GROUP BY ssi.ShiftSysNo 
		       )AS si
		      ON a.SysNo=si.ShiftSysNo 
	      LEFT JOIN IPP3.dbo.Stock StockA WITH (NOLOCK) 
		      ON a.StockSysNoA = StockA.sysno 
	      LEFT JOIN IPP3.dbo.Stock StockB WITH (NOLOCK) 
		      ON a.StockSysNoB = StockB.sysno 
	      #JoinType# ( 
		      SELECT 
			      DISTINCT 
			        sost.shiftsysno shiftsysno 
			       ,so.sysno SOSysno 
			       ,so.OutTime SOouttime 
			       ,so.status SOstatus  
			      FROM IPP3.dbo.SO_AutoShift sost WITH (NOLOCK) 
			      INNER JOIN IPP3.dbo.V_SO_Master so WITH (NOLOCK) 
			        ON so.SysNo = sost.SoSysNo 
			        AND sost.status=1 
			      ) AutoST 
		      ON AutoST.shiftsysno = a.sysno
	      WHERE EXISTS(SELECT SysNo FROM @Temp t WHERE t.SysNo = a.SysNo )
	      ORDER BY #SortColumnName#
      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="QueryCountData" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT 
            status 
           ,TotalCost=SUM(Cost) 
           ,TotalNum=COUNT(ShiftSysNo)  
        FROM (  
                SELECT  
                    ssi.ShiftSysNo 
                   ,ssi.Cost 
                   ,status  
                FROM IPP3.dbo.St_Shift a WITH(NOLOCK) 
                INNER JOIN ( 
                    SELECT 
                        ShiftSysNo 
                       ,Cost=SUM(ShiftQty*UnitCost)  
                    FROM  IPP3.dbo.St_Shift_Item WITH(NOLOCK) 
                    GROUP BY ShiftSysNo 
                 ) ssi 
                    ON ssi.ShiftSysNo=a.sysno 
                #JoinType_Count#
                #StrWhere#
             ) shift
             WHERE shift.status IN (3,4)
        GROUP BY status ;


        SELECT 
            COUNT(DISTINCT a.sysno) AS partlyNum 
           ,isnull(SUM(shiftqty*unitcost),0) AS outCost 
           ,isnull(SUM(instockqty*unitcost),0) AS inCost 
           ,isnull(SUM((shiftqty-isnull(instockqty,0))*unitcost),0) AS inWayCost 
        FROM dbo.st_shift a WITH(NOLOCK) 
        INNER JOIN dbo.st_shift_item b WITH(NOLOCK) 
            ON b.shiftsysno=a.sysno 
            AND a.status=5  
        #JoinType_Count#
        #StrWhere#
      ]]>
    </commandText>
  </dataCommand>
 
  <dataCommand name="Inventory_GetShiftRequestBySysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
          SELECT 
	          a.SysNo AS SysNo 
            ,a.POSysNo AS [RelatedPO.SysNo]
	          ,a.ShiftID AS RequestID 
	          ,a.StockSysNoA AS [SourceStock.SysNo]		
	          ,a.StockSysNoB AS [TargetStock.SysNo]
	          ,a.[Status] AS RequestStatus 
	          ,a.TotalAmt AS TotalAmount 
	          ,a.ShiftType AS ShiftType
	          ,a.Note AS Note
	          ,a.shipViaTerm AS ShiftShippingType 
	          ,a.IsScanned AS IsScanned 
	          ,a.IsConsign AS ConsignFlag 
	          ,a.SpecialShiftType AS SpecialShiftType 
	          ,a.RelatedShiftSysNo AS [RelatedShiftRequest.SysNo]
	          ,a.CreateUserSysNo AS [CreateUser.SysNo]
	          ,a.AuditUserSysNo AS [AuditUser.SysNo]
	          ,a.OutUserSysNo AS [OutStockUser.SysNo]
	          ,a.SpecialShiftSetUser AS [SpecialShiftSetUser.SysNo]
	          ,a.InUserSysNo AS [InStockUser.SysNo]
	          ,a.CreateTime AS CreateDate
	          ,a.AuditTime AS AuditDate
	          ,a.OutTime AS OutStockDate
	          ,a.InTime AS InStockDate
	          ,a.SpecialShiftSetTime AS SpecialShiftSetDate
	          ,a.CompanyCode	
	          ,a.CurrencySysNo
            ,a.CreateUserSysNo
          FROM IPP3.dbo.St_Shift AS a WITH (NOLOCK) 
          WHERE a.SysNo = @RequestSysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@RequestSysNo" dbType="Int32" />      
    </parameters>
  </dataCommand>

  <dataCommand name="Inventory_GetProductLineInfoByProductSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
         SELECT ProductLineSysNo FROM 
         OverseaContentManagement.dbo.V_CM_ProductLine_Items WITH (NOLOCK)
         where ProductSysNo=@ProductSysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  
  <dataCommand name="Inventory_GetShiftItemListByRequestSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT
          a.SysNo
	        ,a.ProductSysNo AS [ShiftProduct.SysNo]   
	        ,a.ShiftQty AS ShiftQuantity
	        ,a.InStockQty AS InStockQuantity
	        ,a.ShipCost AS ShippingCost
	        ,a.UnitCost AS ShiftUnitCost
	        ,a.UnitCostWithoutTax AS ShiftUnitCostWithoutTax	
	        ,a.CurrencySysNo
          ,a.ShiftQty * b.Weight AS TotalWeight 
        FROM  IPP3.dbo.St_Shift_Item AS a WITH (NOLOCK) 
        INNER JOIN OverseaContentManagement.dbo.V_CM_ItemBasicInfo AS b WITH (NOLOCK) 
          ON a.ProductSysNo = b.sysno 
        WHERE a.ShiftSysNo=@RequestSysNo
        
      ]]>
    </commandText>
    <parameters>
      <param name="@RequestSysNo" dbType="Int32" />  
    </parameters>
  </dataCommand>
  
  <dataCommand name="Inventory_QueryShiftRequestCreateUserList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT 
          DISTINCT 
	        a.CreateUserSysNo AS SysNo
         ,b.DisplayName AS UserDisplayName 
         ,b.LoginName AS UserID 
      FROM IPP3.dbo.St_Shift AS a WITH(NOLOCK) 
      INNER JOIN OverseaArchitecture.dbo.V_AR_UserInfo AS b WITH(NOLOCK) 
          ON a.CreateUserSysNo = b.UserSysNo 
          WHERE a.CompanyCode=@CompanyCode
      ORDER BY b.DisplayName
      ]]>
    </commandText>
    <parameters>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>
    
  <!--Query END-->

  <!--Maintain BEGIN-->
  
  <dataCommand name="Inventory_CreateShiftRequest" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        INSERT INTO [IPP3].[dbo].[St_Shift]
          (
            SysNo, 
            ShiftID, 
            StockSysNoA, 
            StockSysNoB, 
            CreateTime, 
            CreateUserSysNo, 
            Note,
            Status, 
            ShiftType,
            ShipViaTerm,
            IsScanned,            
			      IsConsign,
            CompanyCode,
            ProductLineSysno
          )
        VALUES
          (
            @RequestSysNo,
            @RequestID,
            @SourceStockSysNo,
            @TargetStockSysNo,
            @CreateDate,
            @CreateUserSysNo,
            @Note,
            @RequestStatus,
            @ShiftRequestType,
            @ShipViaTerm,
            0,            
			      @ConsignFlag,
            @CompanyCode,
            @ProductLineSysno
          )
          
        SELECT 
	          a.SysNo AS SysNo 
            ,a.POSysNo AS [RelatedPO.SysNo]
	          ,a.ShiftID AS RequestID 
	          ,a.StockSysNoA AS [SourceStock.SysNo]		
	          ,a.StockSysNoB AS [TargetStock.SysNo]
	          ,a.[Status] AS RequestStatus 
	          ,a.TotalAmt AS TotalAmount 
	          ,a.ShiftType AS ShiftType
	          ,a.Note AS Note
	          ,a.shipViaTerm AS ShiftShippingType 
	          ,a.IsScanned AS IsScanned 
	          ,a.IsConsign AS ConsignFlag 
	          ,a.SpecialShiftType AS SpecialShiftType 
	          ,a.RelatedShiftSysNo AS [RelatedShiftRequest.SysNo]
	          ,a.CreateUserSysNo AS [CreateUser.SysNo]
	          ,a.AuditUserSysNo AS [AuditUser.SysNo]
	          ,a.OutUserSysNo AS [OutStockUser.SysNo]
	          ,a.SpecialShiftSetUser AS [SpecialShiftSetUser.SysNo]
	          ,a.InUserSysNo AS [InStockUser.SysNo]
	          ,a.CreateTime AS CreateDate
	          ,a.AuditTime AS AuditDate
	          ,a.OutTime AS OutStockDate
	          ,a.InTime AS InStockDate
	          ,a.SpecialShiftSetTime AS SpecialShiftSetDate
	          ,a.CompanyCode	
	          ,a.CurrencySysNo
            ,a.ProductLineSysno
          FROM IPP3.dbo.St_Shift AS a WITH (NOLOCK) 
          WHERE a.SysNo = @RequestSysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@RequestSysNo" dbType="Int32" />
      <param name="@RequestID" dbType="String" />
      <param name="@SourceStockSysNo" dbType="Int32" />
      <param name="@TargetStockSysNo" dbType="Int32" />
      <param name="@ConsignFlag" dbType="Int32" />
      <param name="@CreateDate" dbType="DateTime" />
      <param name="@CreateUserSysNo" dbType="Int32" />
      <param name="@Note" dbType="String" />
      <param name="@RequestStatus" dbType="Int32" />
      <param name="@ShiftRequestType" dbType="Int32" />
      <param name="@ShipViaTerm" dbType="String" />
      <param name="@ProductLineSysno" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength"/>
    </parameters>
  </dataCommand>

  <dataCommand name="Inventory_UpdateShiftRequest" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        UPDATE 
          [IPP3].[dbo].[St_Shift] 
        SET
          Note = @Note,
          ProductLineSysno=@ProductLineSysno          
        WHERE
          SysNo = @RequestSysNo
          
        SELECT 
	          a.SysNo AS SysNo 
            ,a.POSysNo AS [RelatedPO.SysNo]
	          ,a.ShiftID AS RequestID 
	          ,a.StockSysNoA AS [SourceStock.SysNo]		
	          ,a.StockSysNoB AS [TargetStock.SysNo]
	          ,a.[Status] AS RequestStatus 
	          ,a.TotalAmt AS TotalAmount 
	          ,a.ShiftType AS ShiftType
	          ,a.Note AS Note
	          ,a.shipViaTerm AS ShiftShippingType 
	          ,a.IsScanned AS IsScanned 
	          ,a.IsConsign AS ConsignFlag 
	          ,a.SpecialShiftType AS SpecialShiftType 
	          ,a.RelatedShiftSysNo AS [RelatedShiftRequest.SysNo]
	          ,a.CreateUserSysNo AS [CreateUser.SysNo]
	          ,a.AuditUserSysNo AS [AuditUser.SysNo]
	          ,a.OutUserSysNo AS [OutStockUser.SysNo]
	          ,a.SpecialShiftSetUser AS [SpecialShiftSetUser.SysNo]
	          ,a.InUserSysNo AS [InStockUser.SysNo]
	          ,a.CreateTime AS CreateDate
	          ,a.AuditTime AS AuditDate
	          ,a.OutTime AS OutStockDate
	          ,a.InTime AS InStockDate
	          ,a.SpecialShiftSetTime AS SpecialShiftSetDate
	          ,a.CompanyCode	
	          ,a.CurrencySysNo
            ,a.ProductLineSysno
          FROM IPP3.dbo.St_Shift AS a WITH (NOLOCK) 
          WHERE a.SysNo = @RequestSysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@RequestSysNo" dbType="Int32" />
      <param name="@Note" dbType="String" />
      <param name="@ProductLineSysno" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="Inventory_UpdateSpecialShiftType" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        UPDATE 
          [IPP3].[dbo].[St_Shift] 
        SET
          SpecialShiftType = @SpecialShiftType,
          SpecialShiftSetUser = @SpecialShiftSetUserSysNo,
          SpecialShiftSetTime = @SpecialShiftSetDate
        WHERE
          SysNo = @RequestSysNo
          
        SELECT 
	          a.SysNo AS SysNo 
            ,a.POSysNo AS [RelatedPO.SysNo]
	          ,a.ShiftID AS RequestID 
	          ,a.StockSysNoA AS [SourceStock.SysNo]		
	          ,a.StockSysNoB AS [TargetStock.SysNo]
	          ,a.[Status] AS RequestStatus 
	          ,a.TotalAmt AS TotalAmount 
	          ,a.ShiftType AS ShiftType
	          ,a.Note AS Note
	          ,a.shipViaTerm AS ShiftShippingType 
	          ,a.IsScanned AS IsScanned 
	          ,a.IsConsign AS ConsignFlag 
	          ,a.SpecialShiftType AS SpecialShiftType 
	          ,a.RelatedShiftSysno AS [RelatedShiftRequest.SysNo]
	          ,a.CreateUserSysNo AS [CreateUser.SysNo]
	          ,a.AuditUserSysNo AS [AuditUser.SysNo]
	          ,a.OutUserSysNo AS [OutStockUser.SysNo]
	          ,a.SpecialShiftSetUser AS [SpecialShiftSetUser.SysNo]
	          ,a.InUserSysNo AS [InStockUser.SysNo]
	          ,a.CreateTime AS CreateDate
	          ,a.AuditTime AS AuditDate
	          ,a.OutTime AS OutStockDate
	          ,a.InTime AS InStockDate
	          ,a.SpecialShiftSetTime AS SpecialShiftSetDate
	          ,a.CompanyCode	
	          ,a.CurrencySysNo
          FROM IPP3.dbo.st_shift AS a WITH (NOLOCK) 
          WHERE a.SysNo = @RequestSysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@RequestSysNo" dbType="Int32" />
      <param name="@SpecialShiftType" dbType="Int32" />
      <param name="@SpecialShiftSetUserSysNo" dbType="Int32" />
      <param name="@SpecialShiftSetDate" dbType="DateTime" />      
    </parameters>
  </dataCommand>

  <dataCommand name="Inventory_UpdateShiftRequestStatus" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        UPDATE 
          [IPP3].[dbo].[St_Shift] 
        SET
          Status = @RequestStatus,
          AuditTime = @AuditDate,
          AuditUserSysNo = @AuditUserSysNo,
          OutTime =@OutStockDate,
          OutUserSysNo=@OutStockUserSysNo,
          InTime =@InStockDate,
          InUserSysNo=@InStockUserSysNo
        WHERE
          SysNo = @RequestSysNo
          
        SELECT 
	          a.SysNo AS SysNo 
            ,a.POSysNo AS [RelatedPO.SysNo]
	          ,a.ShiftID AS RequestID 
	          ,a.StockSysNoA AS [SourceStock.SysNo]		
	          ,a.StockSysNoB AS [TargetStock.SysNo]
	          ,a.[Status] AS RequestStatus 
	          ,a.TotalAmt AS TotalAmount 
	          ,a.ShiftType AS ShiftType
	          ,a.Note AS Note
	          ,a.shipViaTerm AS ShiftShippingType 
	          ,a.IsScanned AS IsScanned 
	          ,a.IsConsign AS ConsignFlag 
	          ,a.SpecialShiftType AS SpecialShiftType 
	          ,a.RelatedShiftSysno AS [RelatedShiftRequest.SysNo]
	          ,a.CreateUserSysNo AS [CreateUser.SysNo]
	          ,a.AuditUserSysNo AS [AuditUser.SysNo]
	          ,a.OutUserSysNo AS [OutStockUser.SysNo]
	          ,a.SpecialShiftSetUser AS [SpecialShiftSetUser.SysNo]
	          ,a.InUserSysNo AS [InStockUser.SysNo]
	          ,a.CreateTime AS CreateDate
	          ,a.AuditTime AS AuditDate
	          ,a.OutTime AS OutStockDate
	          ,a.InTime AS InStockDate
	          ,a.SpecialShiftSetTime AS SpecialShiftSetDate
	          ,a.CompanyCode	
	          ,a.CurrencySysNo
          FROM IPP3.dbo.St_Shift AS a WITH (NOLOCK) 
          WHERE a.SysNo = @RequestSysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@RequestSysNo" dbType="Int32" />
      <param name="@InStockDate" dbType="DateTime" />
      <param name="@InStockUserSysNo" dbType="Int32" />
      <param name="@OutStockDate" dbType="DateTime" />
      <param name="@OutStockUserSysNo" dbType="Int32" />
      <param name="@AuditDate" dbType="DateTime" />
      <param name="@AuditUserSysNo" dbType="Int32" />
      <param name="@RequestStatus" dbType="Int32" />      
    </parameters>
  </dataCommand>  
  
  <dataCommand name="Inventory_GetShiftRequestSequence" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        INSERT INTO IPP3.dbo.St_Shift_Sequence (CreateTime) Values (GETDATE())
        
        SELECT SCOPE_IDENTITY() AS SysNo
        ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="Inventory_CreateShiftItem" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        INSERT INTO [IPP3].[dbo].[St_Shift_Item]
          (
            ShiftSysNo, 
            ProductSysNo, 
            ShiftQty,
            UnitCost,
            UnitCostWithoutTax,
            CompanyCode
          )
        VALUES
          (
            @RequestSysNo,
            @ProductSysNo,
            @ShiftQuantity,
            @ShiftUnitCost,
            @ShiftUnitCostWithoutTax,
            '8601'
          )
          
        SELECT 
          SysNo, 
          ShiftSysNo AS RequestSysNo, 
          ProductSysNo AS [ShiftProduct.SysNo], 
          ShiftQty AS ShiftQuantity, 
          UnitCost AS ShiftUnitCost, 
          UnitCostWithoutTax AS ShiftUnitCostWithoutTax,
          ShipCost AS ShippingCost, 
          InStockQty AS InStockQuantity
        FROM
          [IPP3].[dbo].[St_Shift_Item] WITH(NOLOCK)
        WHERE
          SysNo = SCOPE_IDENTITY()
      ]]>
    </commandText>
    <parameters>
      <param name="@RequestSysNo" dbType="Int32" />
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@ShiftQuantity" dbType="Int32" />
      <param name="@ShiftUnitCost" dbType="Decimal" />
      <param name="@ShiftUnitCostWithoutTax" dbType="Decimal" />      
    </parameters>
  </dataCommand>

  <dataCommand name="Inventory_UpdateShiftItem" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        UPDATE
          [IPP3].[dbo].[St_Shift_Item]
        SET          
          ProductSysNo = @ProductSysNo,
          ShiftQty = @ShiftQuantity,
          UnitCost = @ShiftUnitCost,
          UnitCostWithoutTax = @ShiftUnitCostWithoutTax,
          InStockQty = @InStockQuantity,
          ShipCost = @ShippingCost
        WHERE
          SysNo = @ShiftItemSysNo          
        
        SELECT 
          SysNo, 
          ShiftSysNo AS RequestSysNo, 
          ProductSysNo AS [ShiftProduct.SysNo], 
          ShiftQty AS ShiftQuantity, 
          UnitCost AS ShiftUnitCost, 
          UnitCostWithoutTax AS ShiftUnitCostWithoutTax, 
          ShipCost AS ShippingCost, 
          InStockQty AS InStockQuantity
        FROM
          [IPP3].[dbo].[St_Shift_Item] WITH(NOLOCK)
        WHERE
          SysNo = @ShiftItemSysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@ShiftItemSysNo" dbType="Int32" />      
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@ShiftQuantity" dbType="Int32" />
      <param name="@InStockQuantity" dbType="Int32" />
      <param name="@ShiftUnitCost" dbType="Decimal" />
      <param name="@ShiftUnitCostWithoutTax" dbType="Decimal" />
      <param name="@ShippingCost" dbType="Decimal" />      
    </parameters>
  </dataCommand>

  <dataCommand name="Inventory_DeleteShiftItemByRequestSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        DELETE FROM [IPP3].[dbo].[St_Shift_Item] 
        WHERE ShiftSysNo = @RequestSysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@RequestSysNo" dbType="Int32" />      
    </parameters>
  </dataCommand>

  <dataCommand name="QueryShiftItemsForBatchAddGift" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT 
          [ItemCode] as [ShiftProduct.ProductID]
         ,[ItemSysNumber] as [ShiftProduct.SysNo]
         ,[ItemName] as [ShiftProduct.ProductName]
         ,[UnitPrice] as [ShiftUnitCost]
         ,[PMSysNumber]
         ,[Weight] as [ShiftWeight]
		 ,[IsConsign]
        FROM
        (
	        SELECT
            a.ProductID AS ItemCode
           ,a.SysNo AS ItemSysNumber
		   ,a.IsConsign AS IsConsign
           ,a.ProductName AS ItemName
           ,b.UnitCost AS UnitPrice
           ,a.PMUserSysNo AS PMSysNumber
           ,a.Weight AS Weight
	
	        FROM OverseaContentManagement.dbo.V_CM_ItemBasicInfo AS a WITH(NOLOCK) 
          LEFT JOIN OverseaContentManagement.dbo.V_CM_ItemPriceInfo AS b WITH(NOLOCK) 
            ON b.SysNo = a.SysNo
          LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList v WITH(NOLOCK) 
            ON a.MerchantSysNo = v.SysNo
	        #StrWhere#
        ) Result 
      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetAllGiftByStock" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT 
          DISTINCT
          p.sysno,
          sg.productsysno
        FROM 
	        IPP3.dbo.sale_gift sg WITH(NOLOCK)
        INNER JOIN 
	        OverseaContentManagement.dbo.V_IM_Product p  WITH(NOLOCK)
        ON 
	        p.sysno = sg.giftsysno
        WHERE 
	        sg.status = 0 
	        AND p.status =0 
	        AND sg.productsysno IN (#productSysNos#) 
          AND sg.CompanyCode = #CompanyCode#
      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetGiftByStock" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT 
          DISTINCT
	        p.sysno,
	        p.productid,
	        p.productname,
	        p.status,
	        p.weight,
	        ISNULL((i.availableqty+i.virtualqty+i.consignqty),0) as onlineqty,
          isnull(abs((select shiftqty from st_shift,st_shift_item where st_shift.sysno = st_shift_item.shiftsysno and st_shift.sysno = #shiftSysNo# and st_shift_item.productsysno = p.sysno )),0) as shiftqtyInDb, 
          0 as shiftqty,
	        --isnull(abs((select sum(shiftqty) as totalqty from sale_gift ,st_shift_item where st_shift_item.productsysno = sale_gift.productsysno and sale_gift.giftsysno = sg.giftsysno and sale_gift.status = 0 and st_shift_item.shiftsysno = #shiftSysNo#)),0) as totalqty 
          0 as totalqty
        FROM 
	        IPP3.dbo.sale_gift sg WITH(NOLOCK)
        INNER JOIN 
	        OverseaContentManagement.dbo.V_IM_Product p WITH(NOLOCK)
        ON 
	        p.sysno = sg.giftsysno
        INNER JOIN 
	        IPP3.dbo.inventory_Stock i WITH(NOLOCK)
        ON 
	        i.productsysno = p.sysno
        WHERE 
	        sg.status = 0 
          AND sg.CompanyCode = #CompanyCode#
	        AND p.status =0 
	        AND sg.productsysno = #productSysNo# 
	        AND i.stocksysno = #stockSysNo#
          
      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="Inventory_UpdateProductShiftItemGoldenTaxNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        UPDATE IPP3.dbo.St_Shift_Item
        SET GoldenTaxNo = @GoldenTaxNo
        WHERE SysNo = @ShiftItemSysNo 
      ]]>
    </commandText>
    <parameters>
      <param name="@ShiftItemSysNo" dbType="Int32"/>
      <param name="@GoldenTaxNo" dbType="String"/>
    </parameters>
  </dataCommand>
  
  <!--Maintain END-->

  <!--IM Domain Biz BEGIN-->

  <dataCommand name="Inventory_GetGiftByStock" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT 
          DISTINCT
	        p.sysno,
	        p.productid,
	        p.productname,
	        p.status,
	        p.weight,	        
          isnull(abs((select shiftqty from st_shift,st_shift_item where st_shift.sysno = st_shift_item.shiftsysno and st_shift.sysno = #shiftSysNo# and st_shift_item.productsysno = p.sysno )),0) as shiftqtyInDb, 
          0 as shiftqty,
	        --isnull(abs((select sum(shiftqty) as totalqty from sale_gift ,st_shift_item where st_shift_item.productsysno = sale_gift.productsysno and sale_gift.giftsysno = sg.giftsysno and sale_gift.status = 0 and st_shift_item.shiftsysno = #shiftSysNo#)),0) as totalqty 
          0 as totalqty
        FROM 
	        IPP3.dbo.sale_gift sg WITH(NOLOCK)
        INNER JOIN 
	        OverseaContentManagement.dbo.V_IM_Product p WITH(NOLOCK)
        ON 
	        p.sysno = sg.giftsysno
        INNER JOIN 
	        IPP3.dbo.inventory_Stock i WITH(NOLOCK)
        ON 
	        i.productsysno = p.sysno
        WHERE 
	        sg.status = 0 
          AND sg.CompanyCode = #CompanyCode#
	        AND p.status =0 
	        AND sg.productsysno = #productSysNo# 
	        AND i.stocksysno = #stockSysNo#
          
      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="Inventory_GetGiftbySysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT 
          DISTINCT
          sg.ProductSysNo,
	        p.sysno,
	        p.productid,
	        p.productname,
	        p.status,
	        p.weight
        FROM 
	        IPP3.dbo.sale_gift sg WITH(NOLOCK)
        INNER JOIN 
	        OverseaContentManagement.dbo.V_IM_Product p WITH(NOLOCK)
        ON 
	        p.sysno = sg.giftsysno
        WHERE 
          sg.giftsysno = #giftsysno# 
          AND sg.CompanyCode = #CompanyCode#
      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="Inventory_GetAllGiftByStock" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT 
          DISTINCT
          p.sysno,
          sg.productsysno
        FROM 
	        IPP3.dbo.sale_gift sg WITH(NOLOCK)
        INNER JOIN 
	        OverseaContentManagement.dbo.V_IM_Product p  WITH(NOLOCK)
        ON 
	        p.sysno = sg.giftsysno
        WHERE 
	        sg.status = 0 
	        AND p.status =0 
	        AND sg.productsysno IN (#productSysNos#) 
          AND sg.CompanyCode = #CompanyCode#
      ]]>
    </commandText>
  </dataCommand>
    
  <!--IM Domain Biz END-->
  
  <!--Other Biz BEGIN-->
  <dataCommand name="Inventory_QueryTransferCreateUsers" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT 
          DISTINCT 
	        a.CreateUserSysNo AS UserSysNumber
         ,b.DisplayName AS DisplayName 
         ,b.LoginName AS LoginName 
         ,b.CompanyCode AS CompanyCode 
         ,b.SourceDirectoryKey AS SourceDirectoryKey 
      FROM IPP3.dbo.St_Shift AS a WITH(NOLOCK) 
      INNER JOIN OverseaArchitecture.dbo.V_AR_UserInfo AS b WITH(NOLOCK) 
          ON a.CreateUserSysNo = b.UserSysNo 
          WHERE a.CompanyCode=@CompanyCode
      ]]>
    </commandText>
    <parameters>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>


  <dataCommand name="Inventory_IsAllowCreateShift" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT TOP 1 WareHouseNumber 
      FROM OverseaContentManagement.dbo.V_PM_PMList WITH(NOLOCK) 
      WHERE 
          PMUserSysNo=(
              SELECT TOP 1  
                  UserSysNo 
              FROM OverseaArchitecture.dbo.V_AR_UserInfo WITH(NOLOCK) 
              WHERE 
                  LoginName = '#LoginName#'
           
           ) AND CompanyCode=@CompanyCode
          --AND warehousenumber LIKE '%#stockSysNo#%';
      ]]>
    </commandText>
    <parameters>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="Inventory_QueryCountData" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT 
            status 
           ,TotalCost=SUM(Cost) 
           ,TotalNum=COUNT(ShiftSysNo)  
        FROM (  
                SELECT  
                    ssi.ShiftSysNo 
                   ,ssi.Cost 
                   ,status  
                FROM IPP3.dbo.St_Shift st WITH(NOLOCK) 
                INNER JOIN ( 
                    SELECT 
                        ShiftSysNo 
                       ,Cost=SUM(ShiftQty*UnitCost)  
                    FROM  IPP3.dbo.St_Shift_Item WITH(NOLOCK) 
                    GROUP BY ShiftSysNo 
                 ) ssi 
                    ON ssi.ShiftSysNo=st.sysno 
                #JoinType_Count#
                #StrWhere#
             ) shift
             WHERE shift.status IN (3,4)
        GROUP BY status ;


        SELECT 
            COUNT(DISTINCT st.sysno) AS partlyNum 
           ,isnull(SUM(shiftqty*unitcost),0) AS outCost 
           ,isnull(SUM(instockqty*unitcost),0) AS inCost 
           ,isnull(SUM((shiftqty-isnull(instockqty,0))*unitcost),0) AS inWayCost 
        FROM dbo.st_shift st WITH(NOLOCK) 
        INNER JOIN dbo.st_shift_item b WITH(NOLOCK) 
            ON b.shiftsysno=st.sysno 
            AND st.status=5  
        #JoinType_Count#
        #StrWhere#
      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="Inventory_GetTotalWeight" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT 
	        IPP3.dbo.St_Shift_Item.ShiftSysNo,
	        SUM(IPP3.dbo.St_Shift_Item.ShiftQty*product.weight) AS totalweight 
        FROM 
	        IPP3.dbo.St_Shift_Item WITH(NOLOCK) 
        LEFT JOIN 
	        OverseaContentManagement.dbo.V_CM_ItemBasicInfo AS product WITH(NOLOCK) 
        ON 
	        IPP3.dbo.St_Shift_Item.ProductSysNo=product.sysno 
        WHERE 
	        IPP3.dbo.St_Shift_Item.ShiftSysNo=#shiftSysno#
        GROUP BY
	        IPP3.dbo.St_Shift_Item.ShiftSysNo 
      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="Inventory_GetPMMaxWeight" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT 
          TOP 1
	        ITMaxWeightforPerOrder, 
	        ITMaxWeightforPerDay
        FROM 
	        OverseaContentManagement.dbo.V_PM_PMList WITH(NOLOCK)  
        WHERE status >= 0 AND PMUserSysNo=#userSysNo#
        AND CompanyCode=@CompanyCode
      ]]>
    </commandText>
    <parameters>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="Inventory_GetPMVerifiedWeightbyToday" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT 
	        SUM(b.totalweight) AS totalWeight,
	        a.AuditUserSysNo
        FROM 
	        IPP3.dbo.St_Shift a WITH(NOLOCK)
        LEFT JOIN 
        (
	        SELECT 
		        IPP3.dbo.St_Shift_Item.ShiftSysNo,
		        SUM(IPP3.dbo.St_Shift_Item.ShiftQty*product.weight) AS totalweight 
	        FROM 
		        IPP3.dbo.St_Shift_Item  WITH(NOLOCK)
	        LEFT JOIN 
		        OverseaContentManagement.dbo.V_CM_ItemBasicInfo AS product WITH(NOLOCK) 
	        ON 
		        IPP3.dbo.St_Shift_Item.ProductSysNo=product.sysno
          WHERE CompanyCode=@CompanyCode
	        GROUP BY 
		        IPP3.dbo.St_Shift_Item.ShiftSysNo 
        ) b on a.sysno=b.ShiftSysNo 
        WHERE 
	        a.AuditUserSysNo=#userSysNo# 
	        and convert(varchar(10),a.AuditTime ,120)='#DateTime#'  
	        and a.Status = 2
          and CompanyCode=@CompanyCode
        group by a.AuditUserSysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="Inventory_GetProductAmtByShiftSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT  
          D.ProductID AS 'ProductID', 
          C.AccountQty + C.ConsignQty AS 'ProductAmt'
        FROM   
          IPP3.dbo.St_Shift AS A WITH (NOLOCK) 
        INNER JOIN
            IPP3.dbo.St_Shift_Item AS B WITH (NOLOCK) 
        ON 
          A.SysNo = B.ShiftSysNo 
        INNER JOIN
            IPP3.dbo.Inventory_Stock AS C WITH (NOLOCK) 
        ON 
          B.ProductSysNo = C.ProductSysNo AND B.ShiftQty > C.AccountQty + C.ConsignQty 
        INNER JOIN
            OverseaContentManagement.dbo.V_CM_ItemBasicInfo AS D with(NOLOCK) 
        ON 
          C.ProductSysNo = D.SysNo
        WHERE  
          (A.SysNo =#ShiftSysNo#) AND (C.StockSysNo = A.StockSysNoA)
          AND A.CompanyCode=@CompanyCode
      ]]>
    </commandText>
    <parameters>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="Inventory_CheckSafetyInventoryDaysByCategory2" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT 
          ISNULL(SafetyInventoryDay,-1) AS SafetyInventoryDay 
      FROM OverseaContentManagement.dbo.V_CM_CategoryInfo 
      WHERE 
          Category2SysNo=@Category2SysNo 
          AND CompanyCode=@CompanyCode
      ]]>
    </commandText>
    <parameters>
      <param name="@Category2SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="Inventory_CheckSafetyInventoryDaysByCategory3" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT 
          ISNULL(SafetyInventoryDay,-1) AS SafetyInventoryDay 
      FROM OverseaContentManagement.dbo.V_CM_CategoryInfo 
      WHERE 
          Category3SysNo=@Category3SysNo 
          AND CompanyCode=@CompanyCode
      ]]>
    </commandText>
    <parameters>
      <param name="@Category3SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="Inventory_GetInventoryRate" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT WarehouseRate FROM IPP3.dbo.STOCK 
      WHERE 
      SysNo=@SysNumber 
      AND CompanyCode=@CompanyCode
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNumber" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="Inventory_CheckTransferConfig" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT 
          TOP 1 SysNo 
      FROM IPP3.dbo.StockShiftTimeInterval 
      WHERE 
          stockasysno=@OutWarehouseSysNumber 
          AND stockbsysno=@InWarehouseSysNumber
          AND CompanyCode=@CompanyCode
      ]]>
    </commandText>
    <parameters>
      <param name="@OutWarehouseSysNumber" dbType="Int32" />
      <param name="@InWarehouseSysNumber" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="Inventory_GetShiftBasketByQuery" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[			
      SELECT @TotalCount = COUNT(SysNo)
      FROM [OverSeaInventoryManagement].[dbo].[Shift_Basket] as a WITH(NOLOCK)
      #StrWhere#
          
      ;WITH Result AS 
      (SELECT           
            a.[SysNo],
            a.[ProductSysNo],
            a.[StockSysNoA],
            c.[StockName] as StockSysNoAName,
            a.[StockSysNoB],
            d.[StockName] as StockSysNoBName,
            a.[ShiftQty],
           a.[InDate],
            a.[InUser],
            a.[EditDate],
            a.[EditUser],
            a.[CompanyCode],
            a.[LanguageCode],
            a.[StoreCompanyCode]
            ,b.ProductID
          ,b.PMUserSysNo
          ,b.ProductName
		  ,b.IsConsign
      ,Row_Number() OVER (Order BY #SortColumnName#) AS RowNumber
FROM [OverSeaInventoryManagement].[dbo].[Shift_Basket] AS a WITH(NOLOCK)
LEFT JOIN  
        OverseaContentManagement.[dbo].[V_CM_ItemBasicInfo]AS b WITH (NOLOCK)
      ON 
        b.SysNo = a.ProductSysNo
        LEFT JOIN  
        [IPP3].[dbo].[Stock] AS c WITH (NOLOCK)
      ON 
        c.SysNo = a.StockSysNoA
        LEFT JOIN  
        [IPP3].[dbo].[Stock] AS d WITH (NOLOCK)
      ON 
        d.SysNo = a.StockSysNoB
#StrWhere#)

      SELECT
            [SysNo],
            [ProductSysNo],
            [StockSysNoA],
            [StockSysNoAName],
            [StockSysNoBName],
            [StockSysNoB],
            [ShiftQty],
            [InDate],
            [InUser],
            [EditDate],
            [EditUser],
            [CompanyCode],
            [LanguageCode],
            [StoreCompanyCode],
            ProductID,
            ProductName,
			IsConsign
      FROM Result a
      WHERE RowNumber>@StartNumber AND RowNumber<=@EndNumber
      Order BY RowNumber
      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="Inventory_GetRMAShift" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
     SELECT 
		a.shifttype
	   ,a.SysNo AS ShiftSysNo
	   ,a.Status
	   ,b.registersysno
	   ,c.productid
	   ,b.TargetBriefName
	   ,b.TargetProductQty
	   ,e.StockName AS ShippedWarehouseName
	   ,g.StockName AS StockSysNoAName
	   ,f.StockName AS StockSysNoBName 
	FROM rma.dbo.rma_stock_shift a (NOLOCK) 
	INNER JOIN IPP3.dbo.stock g (NOLOCK) 
		ON g.sysno=a.StockSysNoA 
	INNER JOIN IPP3.dbo.stock f (NOLOCK) 
		ON f.sysno=a.StockSysNoB 
	LEFT JOIN rma.dbo.rma_shift_register b (NOLOCK) 
		ON b.rmashiftsysno=a.sysno                 
	LEFT JOIN OverseaContentManagement.dbo.V_IM_Product c (NOLOCK) 
		ON c.sysno=b.targetproductsysno 
	LEFT JOIN IPP3.dbo.rma_register d (NOLOCK) 
		ON d.sysno=b.registersysno 
	LEFT JOIN IPP3.dbo.stock e (NOLOCK) 
		ON CAST(e.sysno AS nvarchar)=d.ShippedWarehouse 
	WHERE 
		a.sysno=@SysNo
		AND g.CompanyCode=@CompanyCode
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>


  <dataCommand name="Inventory_GetUnmarketable" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[   
      DECLARE @item_key varchar(25)
      Select @item_key =  ProductID From OverseaContentManagement.dbo.V_CM_ItemBasicInfo WITH(NOLOCK) WHERE  SysNo=@ProductSysNo And CompanyCode=@CompanyCode
      SELECT 
        ProductSysNo     = @productSysNo
       ,ProductID        = @item_key        --产品Item#
      ,DateRange
      ,SUMQuantity       =  SUM(Quantity)  
      ,SUMPrice          =  SUM(Quantity*UnitCost)
      ,MAXInStockDays    =  Max(InStockDays)
      FROM OverseaInventoryManagement.dbo.BI_Inventory_Actual_Aging With(Nolock)
      WHERE Item_key=@item_key
      GROUP By  Item_key,DateRange
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
    </parameters>
  </dataCommand>


  <dataCommand name="Inventory_GetIsBatchByItemSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[   
      SELECT ISNULL(IsBatch,'N')
      FROM OverseaContentManagement.dbo.V_IM_Product_Ex PEX With(Nolock)
      WHERE SysNo=@ProductSysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="Inventory_GetInventoryTransferItemforEmail" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT 
	        S.ShiftID,
	        S.StockSysNoA,
	        S.StockSysNoB,
	        P.ProductID,
	        P.ProductName,
	        I.ShiftQty,
          A.StockName AS StockNameA,
	        B.StockName as StockNameB,
	        U.EmailAddress
        FROM 
		      IPP3.dbo.St_Shift S WITH(NOLOCK)  
        LEFT JOIN 
		      IPP3.dbo.St_Shift_Item I WITH(NOLOCK) 
	      ON 
		      S.SysNo=I.ShiftSysNo
        LEFT JOIN 
		      OverseaContentManagement.dbo.V_CM_ItemBasicInfo P WITH(NOLOCK) 
	      ON 
		      I.ProductSysNo=P.sysno
        LEFT JOIN 
		      OverseaArchitecture.dbo.V_AR_UserInfo U WITH(NOLOCK) 
	      ON 
		      P.PMUserSysNo=U.UserSysNo
        INNER JOIN 
		      IPP3.dbo.Stock A WITH(NOLOCK) 
	      ON 
		      S.StockSysNoA=A.sysno
        INNER JOIN 
		      IPP3.dbo.Stock B WITH(NOLOCK) 
	      ON 
		      S.StockSysNoB=B.sysno
        WHERE
          S.SysNo = @InventoryTransferSysNumber AND S.CompanyCode = @CompanyCode
      ]]>
    </commandText>
    <parameters>
      <param name="@InventoryTransferSysNumber" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength"/>
    </parameters>
  </dataCommand>

  <dataCommand name="Inventory_InsertTransferIntoSAP" database="SAP" commandType="Text">
    <commandText>
      <![CDATA[
  INSERT INTO SAP.dbo.LEG_Fin_Shift
  (
  ShiftID
  ,StockA
  ,StockANumber
  ,StockB
  ,StockBNumber
  ,TotalAmt
  ,CreateUser
  ,CreateDate
  ,AuditUser
  ,AuditTime
  ,OutUser
  ,OutTime
  ,InUser
  ,InTime
  ,Status
  ,InvoiceNumber
  ,InStockAmt
  )
  VALUES
  (
   @shiftid
  ,@stocka
  ,@stockanumber
  ,@stockb
  ,@stockbnumber
  ,@totalamt
  ,@createuser
  ,@createdate
  ,@audituser
  ,@audittime
  ,@outuser
  ,@outtime
  ,@inuser
  ,@intime
  ,@status
  ,@invoicenumber
  ,@inStockAmt
  )
      ]]>
    </commandText>
    <parameters>
      <param name="@shiftid" dbType="String" />
      <param name="@stocka" dbType="String" />
      <param name="@stockanumber" dbType="AnsiStringFixedLength" />
      <param name="@stockb" dbType="String" />
      <param name="@stockbnumber" dbType="AnsiStringFixedLength" />
      <param name="@totalamt" dbType="Decimal" />
      <param name="@createuser" dbType="String" />
      <param name="@createdate" dbType="DateTime" />
      <param name="@audituser" dbType="String" />
      <param name="@audittime" dbType="DateTime" />
      <param name="@outuser" dbType="String" />
      <param name="@outtime" dbType="DateTime" />
      <param name="@inuser" dbType="String" />
      <param name="@intime" dbType="DateTime" />
      <param name="@status" dbType="String" />
      <param name="@invoicenumber" dbType="Int32" />
      <param name="@inStockAmt" dbType="Decimal" />
    </parameters>
  </dataCommand>

  <dataCommand name="Inventory_EmptySAP" database="SAP" commandType="Text">
    <commandText>
      <![CDATA[
      TRUNCATE TABLE SAP.dbo.LEG_Fin_Shift
      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="Inventory_GetInventoryTransferByCode" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT 
            st.SysNo AS InventoryTransferSysNumber 
           ,st.ShiftID AS InventoryTransferCode 
           ,st.StockSysNoA AS StockSysNumberA 
           ,st.StockSysNoB AS StockSysNumberB 
           ,st.Status AS Status 
           ,st.TotalAmt AS TotalAmt 
           ,st.ShiftType AS InventoryTransferType
           ,st.Note AS Note
           ,st.shipViaTerm AS ShipViaTerm 
           ,st.IsScanned AS IsScanned 
           ,st.SpecialShiftType AS SpecialInventoryTransferType 
           ,st.CreateTime
           ,st.AuditTime
           ,st.OutTime AS OutTime
           ,st.InTime AS InTime
           ,st.SpecialShiftSetTime AS SpecialInventoryTransferSetTime
        FROM 
            IPP3.dbo.st_shift AS st WITH (NOLOCK) 
        WHERE 
            IPP3.dbo.st.shiftid = @TransferCode AND CompanyCode = @CompanyCode
      ]]>
    </commandText>
    <parameters>
      <param name="@TransferCode" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength"/>
    </parameters>
  </dataCommand>

  <dataCommand name="Inventory_GetSpecialShiftManagerEmail" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT Value FROM IPP3.dbo.Sys_Configuration (NOLOCK) WHERE [Key] = '特殊移仓单负责人' And CompanyCode = @CompanyCode;
      ]]>
    </commandText>
    <parameters>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength"/>
    </parameters>
  </dataCommand>

  <dataCommand name="Inventory_DeletefromInventoryTransfertoWuHanPlanByProductSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        DELETE FROM [OverseaInventoryManagement].[dbo].[InventoryTransfertoWuHanPlan] WHERE ProductSysNo =@ProductSysNo AND CompanyCode = @CompanyCode;
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32"/>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetRMAShift" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
     SELECT 
		a.ShiftType
	   ,a.SysNo AS ShiftSysNo
	   ,a.Status
	   ,b.RegisterSysNo
	   ,c.ProductID
	   ,b.TargetBriefName
	   ,b.TargetProductQty
	   ,e.StockName AS ShippedWarehouseName
	   ,g.StockName AS StockSysNoAName
	   ,f.StockName AS StockSysNoBName 
	FROM rma.dbo.rma_stock_shift a (NOLOCK) 
	INNER JOIN IPP3.dbo.stock g (NOLOCK) 
		ON g.sysno=a.StockSysNoA 
	INNER JOIN IPP3.dbo.stock f (NOLOCK) 
		ON f.sysno=a.StockSysNoB 
	LEFT JOIN rma.dbo.rma_shift_register b (NOLOCK) 
		ON b.rmashiftsysno=a.sysno                 
	LEFT JOIN IPP3.dbo.product c (NOLOCK) 
		ON c.sysno=b.targetproductsysno 
	LEFT JOIN IPP3.dbo.rma_register d (NOLOCK) 
		ON d.sysno=b.registersysno 
	LEFT JOIN IPP3.dbo.stock e (NOLOCK) 
		ON CAST(e.sysno AS nvarchar)=d.ShippedWarehouse 
	WHERE 
		a.sysno=@SysNo
		AND g.CompanyCode=@CompanyCode
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <!--Other Biz END-->
  
</dataOperations>