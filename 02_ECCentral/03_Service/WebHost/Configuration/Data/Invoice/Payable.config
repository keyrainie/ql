<?xml version="1.0"?>
<dataOperations xmlns="http://oversea.newegg.com/DataOperation">
  <dataCommand name="GetAllPayList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[

DECLARE @TotalCount1 INT
DECLARE @TotalCount2 INT
DECLARE @TotalCount3 INT
DECLARE @TotalCount4 INT
DECLARE @TotalCount5 INT
DECLARE @TotalCount6 INT
DECLARE @TotalCount7 INT
DECLARE @TotalCount8 INT
DECLARE @TotalCount9 INT
  SELECT @TotalCount1 = Count(pay.SysNo)
    FROM
      ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
      INNER JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock po WITH (NOLOCK)
        ON pay.OrderSysNo = po.SysNo
      LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON po.vendorsysno = vendor.SysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON po.createusersysno = sysuser.UserSysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysPOBelongPMUser WITH (NOLOCK)
        ON po.pmsysno = sysPOBelongPMUser.UserSysNo
      LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
        ON po.PayStockSysNo=stock.SysNo
    #StrWhere1#

SELECT  @TotalCount2 = Count(pay.SysNo)
FROM ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
      INNER JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettle vendorsettle WITH (NOLOCK)
        ON Pay.OrderSysNo = VendorSettle.SysNo
      LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        on vendorsettle.VendorSysNo = Vendor.SysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON vendorsettle.CreateUserSysno = sysUser.UserSysNo
      LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
        ON vendorsettle.StockSysno=stock.SysNo
   #StrWhere2#

SELECT  @TotalCount3= Count(pay.SysNo)
    FROM
      ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
      INNER JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettleBalance balancesettle WITH (NOLOCK)
        ON pay.OrderSysNo = balancesettle.SysNo
      LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON balancesettle.VendorSysNo = vendor.SysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON balancesettle.CreateUserSysNo = sysUser.UserSysNo
      LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
        on balancesettle.StockSysno=stock.SysNo
     #StrWhere3#

  SELECT @TotalCount4 = Count(pay.SysNo)
   FROM   IPP3.dbo.finance_pay pay WITH (NOLOCK)
       INNER JOIN EIMS.dbo.EIMSInvoiceInfo EIMS WITH (NOLOCK)
            ON  pay.OrderSysNo = EIMS.InvoiceNumber
       LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
            ON  EIMS.VendorNumber = vendor.sysno
    #StrWhere4#

  SELECT @TotalCount5 = Count(pay.SysNo)
    FROM
            ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
    LEFT JOIN OverseaServiceManagement.dbo.V_SM_RMAVendorRefundMaster RMAPOR WITH (NOLOCK)
      ON  RMAPOR.SysNo = pay.OrderSysNo
    LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
      on RMAPOR.vendorsysno = vendor.SysNo
    LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
      on RMAPOR.PMDUserSysNo = sysUser.UserSysNo
    #StrWhere5#

    SELECT @TotalCount6 = Count(pay.SysNo)
    FROM ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
    INNER JOIN OverseaPOASNManagement.dbo.V_CollectionSettlement collectionSettlement WITH (NOLOCK)
      ON Pay.OrderSysNo = collectionSettlement.SysNo
    LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
      ON collectionSettlement.MerchantSysNo = Vendor.SysNo
    LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
      ON collectionSettlement.StockSysno=stock.SysNo
    #StrWhere6#

    SELECT @TotalCount7 = Count(pay.SysNo)
    FROM ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
    INNER JOIN OverseaPOASNManagement.dbo.V_Commission_Master commission WITH (NOLOCK)
     ON Pay.OrderSysNo = commission.SysNo
    LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
     ON commission.MerchantSysNo = Vendor.SysNo
     #StrWhere7#

  SELECT @TotalCount8 = COUNT(pay.SysNo)
    FROM
    IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
    INNER JOIN OverseaPOASNManagement.dbo.V_POCollectionPayment_Settle paymentsettle WITH (NOLOCK)
      ON pay.OrderSysNo = paymentsettle.SysNo
    LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
      ON paymentsettle.VendorSysNo = vendor.SysNo
    LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK) 
      ON paymentsettle.CreateUserSysNo = sysUser.UserSysNo     
    LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK) 
      on paymentsettle.StockSysno=stock.SysNo
    #StrWhere8#
    
  SELECT @TotalCount9 = COUNT(pay.SysNo)
    FROM
    IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
    INNER JOIN OverseaPOASNManagement.dbo.CostChange cc WITH (NOLOCK)
      ON pay.OrderSysNo = cc.SysNo
    LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
      ON cc.VendorSysNo = vendor.SysNo
    LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK) 
      ON cc.InUser = sysUser.UserSysNo     
    #StrWhere9#
    
SELECT  @TotalCount=@TotalCount1 + @TotalCount2 + @TotalCount3 + @TotalCount4 + @TotalCount5 + @TotalCount6 + @TotalCount7 + @TotalCount8 + @TotalCount9

SELECT
  PaySysNo,
  OrderSysNo,
  OrderID,
  BatchNumber,
  OrderType,
  CreateDate,
  PayableAmt,
  AlreadyPayAmt,
  CurrencySysNo,
   Currency,
  VendorName,
  VendorSysNo,
  PayPeriodType,
  PayTypeSysNo,
  UserName,
  POBelongPMName,
  OrderStatus,
  PayStatus,
  InvoiceStatus,
  InvoiceFactStatus,
  Note,
  POMemo,
  Bank,
  Account,
  ReturnPoint,
  WarehouseName,
  WarehouseNumber,
  InvoiceNumber,
  CompanyCode,
  SapImportedStatus,
  SAPDocNo,
  SAPPostDate,
  SapInFailedReason,
  EGP,
  ETP,
  PaySettleCompany,
  InstockAmt,
  EIMSNoList,
  PayStyle
FROM(
SELECT TOP (@EndNumber)
  PaySysNo,
  OrderSysNo,
  OrderID,
  BatchNumber,
  OrderType,
  CreateDate,
  PayableAmt,
  AlreadyPayAmt,
  CurrencySysNo,
   Currency,
  VendorName,
  VendorSysNo,
  PayPeriodType,
  PayTypeSysNo,
  UserName,
  POBelongPMName,
  OrderStatus,
  PayStatus,
  InvoiceStatus,
  InvoiceFactStatus,
  Note,
  POMemo,
  Bank,
  Account,
  ReturnPoint,
  WarehouseName,
  WarehouseNumber,
  InvoiceNumber,
  CompanyCode,
  SapImportedStatus,
  SAPDocNo,
  SAPPostDate,
  SapInFailedReason,
  EGP,
  ETP,
  PaySettleCompany,
  InstockAmt,
  EIMSNoList,
  PayStyle,
 (ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
FROM(
SELECT
      PaySysNo = pay.SysNo,
      OrderSysNo = pay.OrderSysNo,
      OrderID = po.POID,
      BatchNumber=isnull(pay.BatchNumber,1),
      OrderType = pay.OrderType,
      CreateDate = pay.OrderDate,
      PayableAmt = ISNULL(pay.OrderAmt,0),
      AlreadyPayAmt = pay.AlreadyPayAmt,
      CurrencySysNo = pay.CurrencySysNo,
       Currency=c.[CurrencySymbol]+c.[CurrencyName],
      VendorName = vendor.VendorName,
      VendorSysNo = vendor.SysNo,
      PayPeriodType = vendor.PayPeriodType,
      PayTypeSysNo = po.PayTypeSysNo,
      UserName = sysUser.DisplayName,
      POBelongPMName = sysPOBelongPMUser.DisplayName,
      OrderStatus = po.Status,
      PayStatus = pay.PayStatus,
      InvoiceStatus = pay.InvoiceStatus,
      InvoiceFactStatus = pay.InvoiceFactStatus,
      Note = pay.Note,
      POMemo = po.Memo,
      Bank = vendor.Bank,
      Account = vendor.Account,
      ReturnPoint=ISNULL(pay.EIMSAmt,0),
      WarehouseName=stock.StockName,
      WarehouseNumber=stock.SysNo,
      InvoiceNumber=pay.Note,
      CompanyCode = pay.CompanyCode,
      SapImportedStatus=pay.SapImportedStatus,
      SAPDocNo=pay.SAPDocNo,
      SAPPostDate = pay.SAPPostDate,
      SapInFailedReason = pay.SapInFailedReason,
      EGP = pay.EGP,
      ETP = pay.ETP,
      PaySettleCompany = vendor.PaySettleCompany,
      InstockAmt = pay.InstockAmt,
      PayStyle =(
		    SELECT TOP 1 PayStyle FROM ipp3.dbo.Finance_Pay_Item WITH(NOLOCK)
		    WHERE PaySysNo = pay.SysNo AND Status <> -1),
      EIMSNoList = (
      SELECT CAST(EIMSNo AS VARCHAR)+','
      FROM OverseaPOASNManagement.dbo.V_PO_EIMSInfo WITH(NOLOCK)
      WHERE POSysNo = pay.OrderSysNo AND pay.OrderType = 0
      FOR XML PATH(''))
    FROM
      IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
       LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
      INNER JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock po WITH (NOLOCK)
        ON pay.OrderSysNo = po.SysNo
      LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON po.vendorsysno = vendor.SysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON po.createusersysno = sysUser.UserSysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysPOBelongPMUser WITH (NOLOCK)
        ON po.pmsysno = sysPOBelongPMUser.UserSysNo
      LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
        on po.PayStockSysNo=stock.SysNo
    #StrWhere1#
  UNION ALL
  SELECT
    PaySysNo = pay.Sysno,
      OrderSysNo = pay.OrderSysNo,
    OrderID = vendorsettle.SettleID,
      BatchNumber=1,
    OrderType = pay.OrderType,
    CreateDate = pay.OrderDate,
    PayableAmt = pay.OrderAmt,
    AlreadyPayAmt = pay.AlreadyPayAmt,
    CurrencySysNo = pay.CurrencySysNo,
    Currency=c.[CurrencySymbol]+c.[CurrencyName],
    VendorName = vendor.VendorName,
        VendorSysNo = Vendor.SysNo,
        PayPeriodType = Vendor.PayPeriodType,
    PayTypeSysNo = NULL,
        UserName = sysUser.DisplayName,
    POBelongPMName='',
        OrderStatus = vendorsettle.Status,
    PayStatus = pay.PayStatus,
    InvoiceStatus = pay.InvoiceStatus,
    InvoiceFactStatus = pay.InvoiceFactStatus,
    Note = pay.Note,
        POMemo = '',
        Bank = vendor.Bank,
        Account = vendor.Account,
    ReturnPoint=ISNULL(vendorsettle.UsingReturnPoint,0),
    WarehouseName=stock.StockName,
    WarehouseNumber=stock.SysNo,
    InvoiceNumber=pay.Note,
      CompanyCode = pay.CompanyCode,
      SapImportedStatus=pay.SapImportedStatus,
    SAPDocNo=pay.SAPDocNo,
    SAPPostDate = pay.SAPPostDate,
    SapInFailedReason=pay.SapInFailedReason,
    EGP = pay.EGP,
    ETP = pay.ETP,
    PaySettleCompany = vendor.PaySettleCompany,
    InstockAmt=pay.OrderAmt,
    PayStyle =(
		  SELECT TOP 1 PayStyle FROM ipp3.dbo.Finance_Pay_Item WITH(NOLOCK)
		  WHERE PaySysNo = pay.SysNo AND Status <> -1),
  CONVERT(VARCHAR(50),pay.EIMSNo) AS EIMSNoList
FROM IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
 LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
      INNER JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettle vendorsettle WITH (NOLOCK)
        ON Pay.OrderSysNo = VendorSettle.SysNo
      LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        on vendorsettle.VendorSysNo = Vendor.SysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON vendorsettle.CreateUserSysno = sysUser.UserSysNo
      LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
        ON vendorsettle.StockSysno=stock.SysNo
#StrWhere2#
UNION ALL
SELECT
            PaySysNo = pay.SysNo,
            OrderSysNo = pay.OrderSysNo,
            OrderID = balancesettle.SettleBalanceID,
            BatchNumber=1,
            OrderType = pay.OrderType,
            CreateDate = pay.OrderDate,
            PayableAmt = pay.OrderAmt,
            AlreadyPayAmt = pay.AlreadyPayAmt,
            CurrencySysNo = pay.CurrencySysNo,
            Currency=c.[CurrencySymbol]+c.[CurrencyName],
            VendorName = vendor.VendorName,
            VendorSysNo = vendor.SysNo,
            PayPeriodType = vendor.PayPeriodType,
            PayTypeSysNo = NULL,
            UserName = sysUser.DisplayName,
    POBelongPMName='',
            OrderStatus = balancesettle.Status,
    PayStatus = pay.PayStatus,
            InvoiceStatus = pay.InvoiceStatus,
        InvoiceFactStatus = pay.InvoiceFactStatus,
        Note = pay.Note,
            POMemo = '',
            Bank = vendor.Bank,
            Account = vendor.Account,
            ReturnPoint=null,
            WarehouseName=stock.StockName,
            WarehouseNumber=stock.SysNo,
            InvoiceNumber=pay.Note,
            CompanyCode = pay.CompanyCode,
            SapImportedStatus=pay.SapImportedStatus,
        SAPDocNo=pay.SAPDocNo,
        SAPPostDate = pay.SAPPostDate,
        SapInFailedReason= pay.SapInFailedReason,
        EGP = pay.EGP,
        ETP = pay.ETP,
        PaySettleCompany = vendor.PaySettleCompany,
        0.00 as InstockAmt,
        PayStyle =(
		      SELECT TOP 1 PayStyle FROM ipp3.dbo.Finance_Pay_Item WITH(NOLOCK)
		      WHERE PaySysNo = pay.SysNo AND Status <> -1),
        EIMSNoList = NULL
    FROM
      IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
      LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
      INNER JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettleBalance balancesettle WITH (NOLOCK)
        ON pay.OrderSysNo = balancesettle.SysNo
      LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON balancesettle.VendorSysNo = vendor.SysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON balancesettle.CreateUserSysNo = sysUser.UserSysNo
      LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
        on balancesettle.StockSysno=stock.SysNo
    #StrWhere3#
  UNION ALL
  SELECT
       PaySysNo = pay.SysNo,
       OrderSysNo = pay.OrderSysNo,
       OrderID = CAST(pay.OrderSysNo AS VARCHAR),
       BatchNumber = pay.BatchNumber,
       OrderType = pay.OrderType,
       CreateDate = pay.OrderDate,
       PayableAmt = pay.OrderAmt,
       AlreadyPayAmt = pay.AlreadyPayAmt,
       CurrencySysNo = pay.CurrencySysNo,
       Currency=c.[CurrencySymbol]+c.[CurrencyName],
       VendorName = vendor.VendorName,
       VendorSysNo = EIMS.VendorNumber,
       PayPeriodType = Vendor.PayPeriodType,
       PayTypeSysNo = NULL,
       UserName = EIMS.CreateUser,
       POBelongPMName='',
       OrderStatus = pay.paystatus,
       PayStatus = pay.PayStatus,
       InvoiceStatus = pay.InvoiceStatus,
       InvoiceFactStatus = pay.InvoiceFactStatus,
       Note = pay.Note,
       POMemo = '',
       Bank = vendor.Bank,
       Account = vendor.Account,
       ReturnPoint = NULL,
       WarehouseName = NULL,
       WarehouseNumber = NULL,
       InvoiceNumber = pay.Note,
       CompanyCode = pay.CompanyCode,
       SapImportedStatus = pay.SapImportedStatus,
       SAPDocNo = pay.SAPDocNo,
       SAPPostDate = pay.SAPPostDate,
       SapInFailedReason = pay.SapInFailedReason,
       EGP = pay.EGP,
       ETP = pay.ETP,
       PaySettleCompany = vendor.PaySettleCompany,
       0.00 as InstockAmt,
       PayStyle =(
	      SELECT TOP 1 PayStyle FROM ipp3.dbo.Finance_Pay_Item WITH(NOLOCK)
	      WHERE PaySysNo = pay.SysNo AND Status <> -1),
       EIMSNoList = NULL
FROM   IPP3.dbo.finance_pay pay WITH (NOLOCK)
LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
       INNER JOIN EIMS.dbo.EIMSInvoiceInfo EIMS WITH (NOLOCK)
            ON  pay.OrderSysNo = EIMS.InvoiceNumber
       LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
            ON  EIMS.VendorNumber = vendor.sysno
     #StrWhere4#
    UNION ALL
    SELECT
            PaySysno = pay.SysNo,
            OrderSysno = pay.OrderSysNo,
        OrderID = CAST(pay.OrderSysNo AS VARCHAR),
            BatchNumber=1,
        OrderType = pay.ordertype,
        CreateDate = pay.OrderDate,
        PayableAmt = pay.orderamt,
        AlreadyPayAmt = pay.alreadypayamt,
        CurrencySysno = pay.currencysysno,
        Currency=c.[CurrencySymbol]+c.[CurrencyName],
        VendorName = vendor.vendorname,
            VendorSysno = Vendor.sysno,
        PayPeriodType = Vendor.PayPeriodType,
        PayTypeSysNo = NULL,
            UserName = sysUser.DisplayName,
    POBelongPMName='',
            OrderStatus = RMAPOR.status,
    PayStatus = pay.paystatus,
        InvoiceStatus = pay.invoicestatus,
        InvoiceFactStatus = pay.InvoiceFactStatus,
        Note = pay.Note,
            POMemo = RMAPOR.Note,
            Bank = vendor.Bank,
            Account = vendor.Account,
        ReturnPoint=null,
        WarehouseName=(SELECT StockName FROM OverseaInventoryManagement.dbo.V_INM_Stock with(nolock) where sysno=51),
        WarehouseNumber=51,
        InvoiceNumber=pay.Note,
        CompanyCode = pay.CompanyCode,
        SapImportedStatus=pay.SapImportedStatus,
        SAPDocNo=pay.SAPDocNo,
        SAPPostDate = pay.SAPPostDate,
        SapInFailedReason=pay.SapInFailedReason,
        EGP = pay.EGP,
        ETP = pay.ETP,
        PaySettleCompany = vendor.PaySettleCompany,
        InstockAmt=pay.orderamt,
        PayStyle =(
		      SELECT TOP 1 PayStyle FROM ipp3.dbo.Finance_Pay_Item WITH(NOLOCK)
		      WHERE PaySysNo = pay.SysNo AND Status <> -1),
    EIMSNoList = NULL
    FROM
            IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
            LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
    LEFT JOIN OverseaServiceManagement.dbo.V_SM_RMAVendorRefundMaster RMAPOR WITH (NOLOCK)
      ON  RMAPOR.SysNo = pay.OrderSysNo
    LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
      on RMAPOR.vendorsysno = vendor.SysNo
    LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
      on RMAPOR.PMDUserSysNo = sysUser.UserSysNo
    #StrWhere5#
    UNION ALL
    SELECT
      PaySysNo = pay.Sysno,
      OrderSysNo = pay.OrderSysNo,
      OrderID = CONVERT(VARCHAR,collectionSettlement.SysNo),
      BatchNumber = 1,
      OrderType = pay.OrderType,
      CreateDate = pay.OrderDate,
      PayableAmt = pay.OrderAmt,
      AlreadyPayAmt = pay.AlreadyPayAmt,
      CurrencySysNo = pay.CurrencySysNo,
      Currency=c.[CurrencySymbol]+c.[CurrencyName],
      VendorName = vendor.VendorName,
      VendorSysNo = Vendor.SysNo,
      PayPeriodType = Vendor.PayPeriodType,
      PayTypeSysNo = NULL,
      UserName = SUBSTRING(collectionSettlement.InUser ,0,CHARINDEX('\',collectionSettlement.InUser)),--sysUser.DisplayName,
      POBelongPMName='',
      OrderStatus = CASE collectionSettlement.Status
                        WHEN 'ABD' THEN 1   --作废
                        WHEN 'ORG' THEN 2   --待结算
                        WHEN 'AUD' THEN 3   --已审核
                        WHEN 'SET' THEN 4   --已结算
                        ELSE -1 END,
      PayStatus = pay.PayStatus,
      InvoiceStatus = pay.InvoiceStatus,
      InvoiceFactStatus = pay.InvoiceFactStatus,
      Note = pay.Note,
      POMemo = '',
      Bank = vendor.Bank,
      Account = vendor.Account,
      ReturnPoint=null,
      WarehouseName=stock.StockName,
      WarehouseNumber=stock.SysNo,
      InvoiceNumber=pay.Note,
      CompanyCode = pay.CompanyCode,
      SapImportedStatus=pay.SapImportedStatus,
      SAPDocNo=pay.SAPDocNo,
      SAPPostDate = pay.SAPPostDate,
      SapInFailedReason=pay.SapInFailedReason,
      EGP = pay.EGP,
      ETP = pay.ETP,
      PaySettleCompany = vendor.PaySettleCompany,
      pay.OrderAmt as InstockAmt,
      PayStyle =(
		    SELECT TOP 1 PayStyle FROM ipp3.dbo.Finance_Pay_Item WITH(NOLOCK)
		    WHERE PaySysNo = pay.SysNo AND Status <> -1),
      EIMSNoList = NULL
    FROM ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
    LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
    INNER JOIN OverseaPOASNManagement.dbo.V_CollectionSettlement collectionSettlement WITH (NOLOCK)
     ON Pay.OrderSysNo = collectionSettlement.SysNo
    LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
     ON collectionSettlement.MerchantSysNo = Vendor.SysNo
    LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
      ON collectionSettlement.StockSysno=stock.SysNo
      #StrWhere6#
    UNION ALL
    SELECT
      PaySysNo = pay.Sysno,
      OrderSysNo = pay.OrderSysNo,
      OrderID = CONVERT(VARCHAR,commission.SysNo),
      BatchNumber = 1,
      OrderType = pay.OrderType,
      CreateDate = pay.OrderDate,
      PayableAmt = pay.OrderAmt,
      AlreadyPayAmt = pay.AlreadyPayAmt,
      CurrencySysNo = pay.CurrencySysNo,
      Currency=c.[CurrencySymbol]+c.[CurrencyName],
      VendorName = vendor.VendorName,
      VendorSysNo = Vendor.SysNo,
      PayPeriodType = Vendor.PayPeriodType,
      PayTypeSysNo = NULL,
      UserName = SUBSTRING(commission.InUser ,0,CHARINDEX('\',commission.InUser)),  --sysUser.DisplayName,
      POBelongPMName='',
      OrderStatus = CASE commission.Status
                        WHEN 'ORG' THEN 1   --(Origin):已创建
                        WHEN 'SET' THEN 2   --(Settled):已结算
                        WHEN 'CLS' THEN 3   --(Close)：已关闭
                        ELSE -1 END,
      PayStatus = pay.PayStatus,
      InvoiceStatus = pay.InvoiceStatus,
      InvoiceFactStatus = pay.InvoiceFactStatus,
      Note = pay.Note,
      POMemo = '',
      Bank = vendor.Bank,
      Account = vendor.Account,
      ReturnPoint=null,
      WarehouseName=NULL,
      WarehouseNumber=NULL,
      InvoiceNumber=pay.Note,
      CompanyCode = pay.CompanyCode,
      SapImportedStatus=pay.SapImportedStatus,
      SAPDocNo=pay.SAPDocNo,
      SAPPostDate = pay.SAPPostDate,
      SapInFailedReason=pay.SapInFailedReason,
      EGP = pay.EGP,
      ETP = pay.ETP,
      PaySettleCompany = vendor.PaySettleCompany,
      0.00 as InstockAmt,
      PayStyle =(
		    SELECT TOP 1 PayStyle FROM ipp3.dbo.Finance_Pay_Item WITH(NOLOCK)
		    WHERE PaySysNo = pay.SysNo AND Status <> -1),
      EIMSNoList = NULL
    FROM ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
    LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
    INNER JOIN OverseaPOASNManagement.dbo.V_Commission_Master commission WITH (NOLOCK)
     ON Pay.OrderSysNo = commission.SysNo
    LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
     ON commission.MerchantSysNo = Vendor.SysNo
    #StrWhere7#
    
     UNION ALL
SELECT  PaySysNo = pay.Sysno ,
        OrderSysNo = pay.OrderSysNo ,
        OrderID = paymentsettle.SettleID ,
        BatchNumber = 1 ,
        OrderType = pay.OrderType ,
        CreateDate = pay.OrderDate ,
        PayableAmt = pay.OrderAmt ,
        AlreadyPayAmt = pay.AlreadyPayAmt ,
        CurrencySysNo = pay.CurrencySysNo ,
        Currency=c.[CurrencySymbol]+c.[CurrencyName],
        VendorName = vendor.VendorName ,
        VendorSysNo = Vendor.SysNo ,
        PayPeriodType = Vendor.PayPeriodType ,
        PayTypeSysNo = NULL ,
        UserName = sysUser.DisplayName ,
        POBelongPMName = '' ,
        OrderStatus = paymentsettle.Status ,
        PayStatus = pay.PayStatus ,
        InvoiceStatus = pay.InvoiceStatus ,
        InvoiceFactStatus = pay.InvoiceFactStatus ,
        Note = pay.Note ,
        POMemo = '' ,
        Bank = vendor.Bank ,
        Account = vendor.Account ,
        ReturnPoint = ISNULL(pay.EIMSAmt, 0) ,
        WarehouseName = stock.StockName ,
        WarehouseNumber = stock.SysNo ,
        InvoiceNumber = pay.Note ,
        CompanyCode = pay.CompanyCode ,
        SapImportedStatus = pay.SapImportedStatus ,
        SAPDocNo = pay.SAPDocNo ,
        SAPPostDate = pay.SAPPostDate ,
        SapInFailedReason = pay.SapInFailedReason ,
        EGP = pay.EGP ,
        ETP = pay.ETP ,
        PaySettleCompany = vendor.PaySettleCompany,
        InstockAmt = 0.00,
        PayStyle = ( SELECT TOP 1
                            PayStyle
                     FROM   ipp3.dbo.Finance_Pay_Item
                            WITH ( NOLOCK )
                     WHERE  PaySysNo = pay.SysNo
                   ) ,
        CONVERT(VARCHAR(50), pay.EIMSNo) AS EIMSNoList
FROM    IPP3.dbo.Finance_Pay pay WITH ( NOLOCK )
        LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
        INNER JOIN OverseaPOASNManagement.dbo.V_POCollectionPayment_Settle paymentsettle
        WITH ( NOLOCK ) ON pay.OrderSysNo = paymentsettle.SysNo
        LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH ( NOLOCK ) ON paymentsettle.VendorSysNo = vendor.SysNo
        LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH ( NOLOCK ) ON paymentsettle.CreateUserSysNo = sysUser.UserSysNo
        LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH ( NOLOCK ) ON paymentsettle.StockSysno = stock.SysNo
       #StrWhere8# 
       
     UNION ALL
SELECT  PaySysNo = pay.Sysno ,
        OrderSysNo = pay.OrderSysNo ,
        OrderID = CONVERT(VARCHAR,cc.SysNo) ,
        BatchNumber = 1 ,
        OrderType = pay.OrderType ,
        CreateDate = pay.OrderDate ,
        PayableAmt = pay.OrderAmt ,
        AlreadyPayAmt = pay.AlreadyPayAmt ,
        CurrencySysNo = pay.CurrencySysNo ,
        Currency=c.[CurrencySymbol]+c.[CurrencyName],
        VendorName = vendor.VendorName ,
        VendorSysNo = Vendor.SysNo ,
        PayPeriodType = Vendor.PayPeriodType ,
        PayTypeSysNo = NULL ,
        UserName = sysUser.DisplayName ,
        POBelongPMName = '' ,
        OrderStatus = cc.Status ,
        PayStatus = pay.PayStatus ,
        InvoiceStatus = pay.InvoiceStatus ,
        InvoiceFactStatus = pay.InvoiceFactStatus ,
        Note = pay.Note ,
        POMemo = '' ,
        Bank = vendor.Bank ,
        Account = vendor.Account ,
        ReturnPoint = ISNULL(pay.EIMSAmt, 0) ,
        WarehouseName = '' ,
        WarehouseNumber = 51 ,
        InvoiceNumber = pay.Note ,
        CompanyCode = pay.CompanyCode ,
        SapImportedStatus = pay.SapImportedStatus ,
        SAPDocNo = pay.SAPDocNo ,
        SAPPostDate = pay.SAPPostDate ,
        SapInFailedReason = pay.SapInFailedReason ,
        EGP = pay.EGP ,
        ETP = pay.ETP ,
        PaySettleCompany = vendor.PaySettleCompany,
        InstockAmt = 0.00,
        PayStyle = ( SELECT TOP 1
                            PayStyle
                     FROM   ipp3.dbo.Finance_Pay_Item
                            WITH ( NOLOCK )
                     WHERE  PaySysNo = pay.SysNo
                   ) ,
        CONVERT(VARCHAR(50), pay.EIMSNo) AS EIMSNoList
		FROM IPP3.dbo.Finance_Pay pay WITH(NOLOCK)
		LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
		INNER JOIN OverseaPOASNManagement.dbo.CostChange cc WITH (NOLOCK) ON pay.OrderSysNo = cc.SysNo
        LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH ( NOLOCK ) ON cc.VendorSysNo = vendor.SysNo
        LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH ( NOLOCK ) ON cc.InUser = sysUser.UserSysNo
       #StrWhere9# 
) A
) Result
WHERE RowNumber > @StartNumber

SELECT
   @PUSum=ISNULL(SUM(round(PayableAmt,2)),0),
   @APSum=ISNULL(SUM(round(AlreadyPayAmt,2)),0),
   @SapSum=ISNULL(SUM(round(SAPAmt,2)),0)
FROM(
SELECT
      PayableAmt = ISNULL(pay.OrderAmt,0),
      AlreadyPayAmt = pay.AlreadyPayAmt,
      SAPAmt = isnull(pay.InstockAmt,0) - ISNULL(pay.EIMSAmt,0)
    FROM
      IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
      LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
      INNER JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock po WITH (NOLOCK)
        ON pay.OrderSysNo = po.SysNo
      LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON po.vendorsysno = vendor.SysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON po.createusersysno = sysUser.UserSysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysPOBelongPMUser WITH (NOLOCK)
        ON po.pmsysno = sysPOBelongPMUser.UserSysNo
      LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
        on po.PayStockSysNo=stock.SysNo
  #StrWhere1#
  AND pay.PayStatus <> -1
  UNION ALL
  SELECT
    PayableAmt = pay.OrderAmt,
    AlreadyPayAmt = pay.AlreadyPayAmt,
    SAPAmt = pay.OrderAmt
FROM IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
      INNER JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettle vendorsettle WITH (NOLOCK)
        ON Pay.OrderSysNo = VendorSettle.SysNo
      LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        on vendorsettle.VendorSysNo = Vendor.SysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON vendorsettle.CreateUserSysno = sysUser.UserSysNo
      LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
        ON vendorsettle.StockSysno=stock.SysNo
#StrWhere2#
AND pay.PayStatus <> -1
UNION ALL
SELECT
    PayableAmt = pay.OrderAmt,
    AlreadyPayAmt = pay.AlreadyPayAmt,
    SAPAmt = 0
    FROM
      IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
      LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
      INNER JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettleBalance balancesettle WITH (NOLOCK)
        ON pay.OrderSysNo = balancesettle.SysNo
      LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON balancesettle.VendorSysNo = vendor.SysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON balancesettle.CreateUserSysNo = sysUser.UserSysNo
      LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
        on balancesettle.StockSysno=stock.SysNo
#StrWhere3#
AND pay.PayStatus <> -1
  UNION ALL
  SELECT
            PayableAmt = pay.OrderAmt,
            AlreadyPayAmt = pay.AlreadyPayAmt,
            SAPAmt = 0
      FROM  IPP3.dbo.finance_pay pay WITH (NOLOCK)
      LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
               INNER JOIN EIMS.dbo.EIMSInvoiceInfo EIMS WITH (NOLOCK)
                        ON  pay.OrderSysNo = EIMS.InvoiceNumber
               LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
                        ON  EIMS.VendorNumber = vendor.sysno
  #StrWhere4#
  AND pay.PayStatus <> -1
    UNION ALL
    SELECT
        PayableAmt = pay.orderamt,
        AlreadyPayAmt = pay.alreadypayamt,
        SAPAmt = pay.orderamt
    FROM
            IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
            LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
    LEFT JOIN OverseaServiceManagement.dbo.V_SM_RMAVendorRefundMaster RMAPOR WITH (NOLOCK)
      ON  RMAPOR.SysNo = pay.OrderSysNo
    LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
      on RMAPOR.vendorsysno = vendor.SysNo
    LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
      on RMAPOR.PMDUserSysNo = sysUser.UserSysNo
  #StrWhere5#
  AND pay.PayStatus <> -1
    UNION ALL
    SELECT
        PayableAmt = pay.orderamt,
        AlreadyPayAmt = pay.alreadypayamt,
        SAPAmt = pay.orderamt
    FROM ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
    LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
    INNER JOIN OverseaPOASNManagement.dbo.V_CollectionSettlement collectionSettlement WITH (NOLOCK)
      ON Pay.OrderSysNo = collectionSettlement.SysNo
    LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
      ON collectionSettlement.MerchantSysNo = Vendor.SysNo
    LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
      ON collectionSettlement.StockSysno=stock.SysNo
  #StrWhere6#
  AND pay.PayStatus <> -1
    UNION ALL
    SELECT
        PayableAmt = pay.orderamt,
        AlreadyPayAmt = pay.alreadypayamt,
        SAPAmt = pay.orderamt
    FROM ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
    LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
    INNER JOIN OverseaPOASNManagement.dbo.V_Commission_Master commission WITH (NOLOCK)
     ON Pay.OrderSysNo = commission.SysNo
    LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
     ON commission.MerchantSysNo = Vendor.SysNo
   #StrWhere7#
   AND pay.PayStatus <> -1
   
   UNION ALL   
   SELECT 
       PayableAmt = pay.orderamt,
        AlreadyPayAmt = pay.alreadypayamt,
        SAPAmt = ISNULL( pay.OrderAmt ,0)
    FROM
      IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
      INNER JOIN OverseaPOASNManagement.dbo.V_POCollectionPayment_Settle paymentsettle WITH (NOLOCK) 
        ON pay.OrderSysNo = paymentsettle.SysNo
      LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK) 
        ON paymentsettle.VendorSysNo = vendor.SysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK) 
        ON paymentsettle.CreateUserSysNo = sysUser.UserSysNo     
      LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK) 
        on paymentsettle.StockSysno=stock.SysNo
    #StrWhere8#
    AND pay.PayStatus <> -1
    
    UNION ALL   
    SELECT 
       PayableAmt = pay.orderamt,
        AlreadyPayAmt = pay.alreadypayamt,
        SAPAmt = ISNULL( pay.OrderAmt ,0)
    FROM
      IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
      INNER JOIN OverseaPOASNManagement.dbo.CostChange cc WITH (NOLOCK) 
        ON pay.OrderSysNo = cc.SysNo
      LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK) 
        ON cc.VendorSysNo = vendor.SysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK) 
        ON cc.InUser = sysUser.UserSysNo     
    #StrWhere9#
	  AND pay.PayStatus <> -1
) B

			  ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetPOPayList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT @TotalCount = COUNT(pay.SysNo)
FROM
IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
INNER JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock po WITH (NOLOCK)
  ON pay.OrderSysNo = po.SysNo
LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
  ON po.vendorsysno = vendor.SysNo
LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysuser WITH (NOLOCK)
  ON po.createusersysno = sysUser.UserSysNo
LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysPOBelongPMUser WITH (NOLOCK)
  ON po.pmsysno = sysPOBelongPMUser.UserSysNo
LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
  on po.PayStockSysNo=stock.SysNo
#StrWhere#

SELECT
  PaySysNo,
  OrderSysNo,
  OrderID,
  BatchNumber,
  OrderType,
  CreateDate,
  PayableAmt,
  AlreadyPayAmt,
  CurrencySysNo,
  Currency,
  VendorName,
  VendorSysNo,
  PayPeriodType,
  PayTypeSysNo,
  UserName,
  POBelongPMName,
  OrderStatus,
  PayStatus,
  InvoiceStatus,
  InvoiceFactStatus,
  Note,
  POMemo,
  Bank,
  Account,
  ReturnPoint,
  CreateUserSysNo,
  WarehouseName,
  WarehouseNumber,
  InvoiceNumber,
  CompanyCode,
  SapImportedStatus ,
  SAPDocNo,
  SAPPostDate,
  SapInFailedReason,
  EGP,
  ETP,
  PaySettleCompany,
  InstockAmt,
  EIMSNo,
  EIMSNoList,
  PayStyle,
  InStockTime
FROM (
    SELECT TOP (@EndNumber)
      PaySysNo = pay.SysNo,
      OrderSysNo = pay.OrderSysNo,
      OrderID = po.POID,
	  BatchNumber=isnull(pay.BatchNumber,1),
      OrderType = pay.OrderType,
      CreateDate = pay.OrderDate,
      PayableAmt = ISNULL(pay.OrderAmt,0),
      AlreadyPayAmt = pay.AlreadyPayAmt,
      CurrencySysNo = pay.CurrencySysNo,
      Currency=c.[CurrencySymbol]+c.[CurrencyName],
      VendorName = vendor.VendorName,
      VendorSysNo = vendor.SysNo,
      PayPeriodType = vendor.PayPeriodType,
      PayTypeSysNo = po.PayTypeSysNo,
      UserName = sysUser.DisplayName,
      POBelongPMName = sysPOBelongPMUser.DisplayName,
      OrderStatus = po.Status,
      PayStatus = pay.PayStatus,
      InvoiceStatus = pay.InvoiceStatus,
      InvoiceFactStatus = pay.InvoiceFactStatus,
      Note = pay.Note,
      POMemo = po.Memo,
      Bank = vendor.Bank,
      Account = vendor.Account,
      ReturnPoint=ISNULL(pay.EIMSAmt,0),
      CreateUserSysNo=sysUser.UserSysNo,
      WarehouseName=stock.StockName,
      WarehouseNumber=stock.SysNo,
      InvoiceNumber=pay.Note,
      CompanyCode = pay.CompanyCode,
	    SapImportedStatus = pay.SapImportedStatus,
      SAPDocNo = pay.SAPDocNo,
      SAPPostDate = pay.SAPPostDate,
      SapInFailedReason = pay.SapInFailedReason,
      EGP = pay.EGP,
      ETP = pay.ETP,
      PaySettleCompany = vendor.PaySettleCompany,
      InstockAmt = pay.InstockAmt,
	  pay.EIMSNo,
    InStockTime=po.InTime,
    EIMSNoList = (
      SELECT CAST(EIMSNo AS VARCHAR)+','
      FROM OverseaPOASNManagement.dbo.V_PO_EIMSInfo WITH(NOLOCK)
      WHERE POSysNo = pay.OrderSysNo AND pay.OrderType = 0
      FOR XML PATH('')),
    PayStyle =(
		  SELECT TOP 1 PayStyle FROM ipp3.dbo.Finance_Pay_Item WITH(NOLOCK)
		  WHERE PaySysNo = pay.SysNo AND Status <> -1),
      (ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
    FROM
      IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
      LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
      INNER JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock po WITH (NOLOCK)
        ON pay.OrderSysNo = po.SysNo
      LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON po.vendorsysno = vendor.SysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON po.createusersysno = sysUser.UserSysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysPOBelongPMUser WITH (NOLOCK)
        ON po.pmsysno = sysPOBelongPMUser.UserSysNo
      LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
        on po.PayStockSysNo=stock.SysNo
    #StrWhere#
) Result
WHERE RowNumber > @StartNumber

    SELECT
      @PUSum = ISNULL(SUM( round(ISNULL(pay.OrderAmt,0),2)),0),
      @APSum = ISNULL(SUM( round( pay.AlreadyPayAmt,2)),0),
      @SapSum = ISNULL(SUM( round( ISNULL(pay.InstockAmt,0) - ISNULL(pay.EIMSAmt,0),2)),0)
    FROM
      IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
      LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
      INNER JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock po WITH (NOLOCK)
        ON pay.OrderSysNo = po.SysNo
      LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON po.vendorsysno = vendor.SysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON po.createusersysno = sysUser.UserSysNo
     LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysPOBelongPMUser WITH (NOLOCK)
        ON po.pmsysno = sysPOBelongPMUser.UserSysNo
      LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
        on po.PayStockSysNo=stock.SysNo
    #StrWhere#
    AND pay.PayStatus <> -1
]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetVendorSettleOrderPayList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT @TotalCount = COUNT(pay.SysNo)
FROM IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
	INNER JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettle vendorSettle WITH (NOLOCK)
	  ON Pay.OrderSysNo = VendorSettle.SysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  ON vendorSettle.VendorSysNo = Vendor.SysNo
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysuser WITH (NOLOCK)
	  ON vendorSettle.CreateUserSysno = sysUser.UserSysNo
	LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
	  ON vendorSettle.StockSysno=stock.SysNo
	#StrWhere#
SELECT
    PaySysNo,
    OrderSysNo,
    OrderID,
    BatchNumber,
    OrderType ,
    CreateDate,
    PayableAmt,
    AlreadyPayAmt,
    CurrencySysNo,
    Currency,
    VendorName,
    VendorSysNo,
    PayPeriodType,
    PayTypeSysNo,
    UserName,
    OrderStatus,
    PayStatus,
    InvoiceStatus,
    InvoiceFactStatus,
    Note,
    POMemo,
    Bank,
    Account,
    ReturnPoint,
    CreateUserSysNo,
    WarehouseName,
    WarehouseNumber,
    InvoiceNumber,
    CompanyCode,
	  SapImportedStatus,
    SAPDocNo,
    SAPPostDate,
    SapInFailedReason,
    EGP,
    ETP,
    PaySettleCompany,
    InstockAmt,
	EIMSNo,
  EIMSNoList,
  PayStyle,
  InStockTime
FROM
(SELECT  TOP (@EndNumber)
    PaySysNo = pay.Sysno,
	  OrderSysNo = pay.OrderSysNo,
    OrderID = vendorsettle.SettleID,
    BatchNumber=1,
    OrderType = pay.OrderType,
    CreateDate = pay.OrderDate,
    PayableAmt = pay.OrderAmt,
    AlreadyPayAmt = pay.AlreadyPayAmt,
    CurrencySysNo = pay.CurrencySysNo,
    Currency=c.[CurrencySymbol]+c.[CurrencyName],
    VendorName = vendor.VendorName,
	  VendorSysNo = Vendor.SysNo,
	  PayPeriodType = Vendor.PayPeriodType,
    PayTypeSysNo = NULL,
	  UserName = sysUser.DisplayName,
    OrderStatus = vendorsettle.Status,
	  PayStatus = pay.PayStatus,
    InvoiceStatus = pay.InvoiceStatus,
    InvoiceFactStatus = pay.InvoiceFactStatus,
    Note = pay.Note,
	  POMemo = '',
	  Bank = vendor.Bank,
	  Account = vendor.Account,
    ReturnPoint=ISNULL(vendorsettle.UsingReturnPoint,0),
    CreateUserSysNo=sysUser.UserSysNo,
    WarehouseName=stock.StockName,
    WarehouseNumber=stock.SysNo,
    InvoiceNumber=pay.Note,
    CompanyCode = pay.CompanyCode,
	  SapImportedStatus=pay.SapImportedStatus,
    SAPDocNo=pay.SAPDocNo,
    SAPPostDate = pay.SAPPostDate,
    SapInFailedReason=pay.SapInFailedReason,
     EGP = pay.EGP,
     ETP = pay.ETP,
     PaySettleCompany = vendor.PaySettleCompany,
     pay.OrderAmt as InstockAmt,
	  pay.EIMSNo,
    InStockTime=NULL,
    CONVERT(VARCHAR(50),pay.EIMSNo) AS EIMSNoList,
    PayStyle =(
		  SELECT TOP 1 PayStyle FROM ipp3.dbo.Finance_Pay_Item WITH(NOLOCK)
		  WHERE PaySysNo = pay.SysNo AND Status <> -1),
    (ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
FROM ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
	INNER JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettle vendorsettle WITH (NOLOCK)
	  ON Pay.OrderSysNo = VendorSettle.SysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  on vendorsettle.VendorSysNo = Vendor.SysNo
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	  ON vendorsettle.CreateUserSysno = sysUser.UserSysNo
	LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
	  ON vendorsettle.StockSysno=stock.SysNo
#StrWhere#
) Result
WHERE RowNumber > @StartNumber

SELECT
    @PUSum = ISNULL(SUM(round(pay.OrderAmt,2)),0),
    @APSum = ISNULL(SUM(round(pay.AlreadyPayAmt,2)),0),
    @SapSum = ISNULL(SUM(round(pay.Orderamt,2)),0)
FROM ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
	INNER JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettle vendorsettle WITH (NOLOCK)
	  ON Pay.OrderSysNo = VendorSettle.SysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  on vendorsettle.VendorSysNo = Vendor.SysNo
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	  ON vendorsettle.CreateUserSysno = sysUser.UserSysNo
	LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
	  ON vendorsettle.StockSysno=stock.SysNo
  #StrWhere#
  AND pay.PayStatus <> -1
			      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetReturnPointCashSettlePayList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT @TotalCount = COUNT(pay.SysNo)
 FROM   IPP3.dbo.finance_pay pay WITH (NOLOCK)
 LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
       INNER JOIN EIMS.dbo.EIMSInvoiceInfo EIMS WITH (NOLOCK)
            ON  pay.OrderSysNo = EIMS.InvoiceNumber
       LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
            ON  EIMS.VendorNumber = vendor.sysno
#StrWhere#
SELECT
  PaySysNo,
  OrderSysNo,
  OrderID,
  BatchNumber,
  OrderType,
  CreateDate,
  PayableAmt,
  AlreadyPayAmt,
  CurrencySysNo,
  Currency,
  VendorName,
  VendorSysNo,
  PayPeriodType,
  PayTypeSysNo,
  UserName,
  OrderStatus,
  PayStatus,
  InvoiceStatus,
  InvoiceFactStatus,
  Note,
  POMemo,
  Bank,
  Account,
  ReturnPoint,
  CreateUserSysNo,
  WarehouseName,
  WarehouseNumber,
  InvoiceNumber,
  CompanyCode,
  SapImportedStatus,
  SAPDocNo,
  SAPPostDate,
  SapInFailedReason,
  EGP,
  ETP,
  PaySettleCompany,
  InstockAmt,
	EIMSNo,
  EIMSNoList,
  PayStyle
FROM (
SELECT TOP (@EndNumber)
		      PaySysNo = pay.SysNo,
       OrderSysNo = pay.OrderSysNo,
       OrderID = CAST(pay.OrderSysNo AS VARCHAR),
       BatchNumber = pay.BatchNumber,
       OrderType = pay.OrderType,
       CreateDate = pay.OrderDate,
       PayableAmt = pay.OrderAmt,
       AlreadyPayAmt = pay.AlreadyPayAmt,
       CurrencySysNo = pay.CurrencySysNo,
       Currency=c.[CurrencySymbol]+c.[CurrencyName],
       VendorName = vendor.VendorName,
       VendorSysNo = EIMS.VendorNumber,
       PayPeriodType = Vendor.PayPeriodType,
       PayTypeSysNo = NULL,
       UserName = EIMS.CreateUser,
       OrderStatus = pay.paystatus,
       PayStatus = pay.PayStatus,
       InvoiceStatus = pay.InvoiceStatus,
       InvoiceFactStatus = pay.InvoiceFactStatus,
       Note = pay.Note,
       POMemo = '',
       Bank = vendor.Bank,
       Account = vendor.Account,
       ReturnPoint = NULL,
       CreateUserSysNo = NULL,
       WarehouseName = NULL,
       WarehouseNumber = NULL,
       InvoiceNumber = pay.Note,
       CompanyCode = pay.CompanyCode,
       PRDPoint = NULL,
       SapImportedStatus = pay.SapImportedStatus,
       SAPDocNo = pay.SAPDocNo,
       SAPPostDate = pay.SAPPostDate,
       SapInFailedReason = pay.SapInFailedReason,
       EGP=pay.EGP,
       ETP=pay.ETP,
       PaySettleCompany = vendor.PaySettleCompany,
       0.00 as InstockAmt,
	   pay.EIMSNo,
     EIMSNoList = NULL,
     PayStyle =(
		  SELECT TOP 1 PayStyle FROM ipp3.dbo.Finance_Pay_Item WITH(NOLOCK)
		  WHERE PaySysNo = pay.SysNo AND Status <> -1),
	   (ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
FROM   IPP3.dbo.finance_pay pay WITH (NOLOCK)
LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
       INNER JOIN EIMS.dbo.EIMSInvoiceInfo EIMS WITH (NOLOCK)
            ON  pay.OrderSysNo = EIMS.InvoiceNumber
       LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
            ON  EIMS.VendorNumber = vendor.sysno
    #StrWhere#
) Result
WHERE RowNumber > @StartNumber

SELECT
     @PUSum = ISNULL(SUM(round(pay.OrderAmt,2)),0),
     @APSum = ISNULL(SUM(round( pay.AlreadyPayAmt,2)),0),
     @SapSum = 0
FROM  IPP3.dbo.finance_pay pay WITH (NOLOCK)
LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
       INNER JOIN EIMS.dbo.EIMSInvoiceInfo EIMS WITH (NOLOCK)
            ON  pay.OrderSysNo = EIMS.InvoiceNumber
       LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
            ON  EIMS.VendorNumber = vendor.sysno
#StrWhere#
AND pay.PayStatus <> -1
			  ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetRMAPORPayList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT @TotalCount = COUNT(pay.SysNo)
FROM
	ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
  LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
  LEFT JOIN OverseaServiceManagement.dbo.V_SM_RMAVendorRefundMaster RMAPOR WITH (NOLOCK)
    ON  RMAPOR.SysNo = pay.OrderSysNo
  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
    on RMAPOR.vendorsysno = vendor.SysNo
  LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
    on RMAPOR.PMDUserSysNo = sysUser.UserSysNo
#StrWhere#
SELECT
  PaySysNo,
  OrderSysNo,
  OrderID,
  BatchNumber,
  OrderType,
  CreateDate,
  PayableAmt,
  AlreadyPayAmt,
  CurrencySysNo,
  Currency,
  VendorName,
  VendorSysNo,
  PayPeriodType,
  PayTypeSysNo,
  UserName,
  OrderStatus,
  PayStatus,
  InvoiceStatus,
  InvoiceFactStatus,
  Note,
  POMemo,
  Bank,
  Account,
  ReturnPoint,
  CreateUserSysNo,
  WarehouseName,
  WarehouseNumber,
  InvoiceNumber,
  CompanyCode,
  SapImportedStatus,
    SAPDocNo,
    SAPPostDate,
    SapInFailedReason,
    EGP,
    ETP,
    PaySettleCompany,
    InstockAmt,
	EIMSNo,
  EIMSNoList = NULL,
  PayStyle,
  InStockTime
  
FROM (
SELECT TOP (@EndNumber)
		PaySysno = pay.SysNo,
    OrderSysno = pay.OrderSysNo,
    OrderID = CAST(pay.OrderSysNo AS VARCHAR),
    BatchNumber= 1,
    OrderType = pay.ordertype,
    CreateDate = pay.OrderDate,
    PayableAmt = pay.orderamt,
    AlreadyPayAmt = pay.alreadypayamt,
    CurrencySysno = pay.currencysysno,
    Currency=c.[CurrencySymbol]+c.[CurrencyName],
    VendorName = vendor.vendorname,
    VendorSysno = Vendor.sysno,
    PayPeriodType = Vendor.PayPeriodType,
    PayTypeSysNo = NULL,
    UserName = sysUser.DisplayName,
    OrderStatus = RMAPOR.status,
    PayStatus = pay.paystatus,
    InvoiceStatus = pay.invoicestatus,
    InvoiceFactStatus = pay.InvoiceFactStatus,
    Note = pay.Note,
    POMemo = RMAPOR.Note,
    Bank = vendor.Bank,
    Account = vendor.Account,
    ReturnPoint=null,
    CreateUserSysNo=sysUser.UserSysNo,
    WarehouseName=(SELECT StockName FROM OverseaInventoryManagement.dbo.V_INM_Stock with(nolock) where sysno=51),
    WarehouseNumber=51,
    InvoiceNumber=pay.Note,
    CompanyCode = pay.CompanyCode,
    SapImportedStatus=pay.SapImportedStatus,
    SAPDocNo=pay.SAPDocNo,
    SAPPostDate = pay.SAPPostDate,
    SapInFailedReason=pay.SapInFailedReason,
     EGP = pay.EGP,
     ETP = pay.ETP,
     PaySettleCompany = vendor.PaySettleCompany,
     pay.orderamt as InstockAmt,
	 pay.EIMSNo,
   EIMSNoList = NULL,
    InStockTime=NULL,
   PayStyle =(
		  SELECT TOP 1 PayStyle FROM ipp3.dbo.Finance_Pay_Item WITH(NOLOCK)
		  WHERE PaySysNo = pay.SysNo AND Status <> -1),
    (ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
 FROM
	  ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
    LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
    LEFT JOIN OverseaServiceManagement.dbo.V_SM_RMAVendorRefundMaster RMAPOR WITH (NOLOCK)
      ON  RMAPOR.SysNo = pay.OrderSysNo
    LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
      on RMAPOR.vendorsysno = vendor.SysNo
    LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
      on RMAPOR.PMDUserSysNo = sysUser.UserSysNo
    #StrWhere#
) Result
WHERE RowNumber > @StartNumber

SELECT
     @PUSum = ISNULL(SUM(round( pay.OrderAmt,2)),0),
     @APSum = ISNULL(SUM(round( pay.AlreadyPayAmt,2)),0),
     @SapSum = ISNULL(SUM(round(pay.orderamt,2)),0)
 FROM
	  ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
    LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
    LEFT JOIN OverseaServiceManagement.dbo.V_SM_RMAVendorRefundMaster RMAPOR WITH (NOLOCK)
      ON  RMAPOR.SysNo = pay.OrderSysNo
    LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
      on RMAPOR.vendorsysno = vendor.SysNo
    LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
      on RMAPOR.PMDUserSysNo = sysUser.UserSysNo
    #StrWhere#
    AND pay.PayStatus <> -1
			  ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetCollectionSettlementPayList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
              SELECT @TotalCount = COUNT(pay.SysNo)
              FROM ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
              LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
              INNER JOIN OverseaPOASNManagement.dbo.V_CollectionSettlement collectionSettlement WITH (NOLOCK)
               ON Pay.OrderSysNo = collectionSettlement.SysNo
              LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
               ON collectionSettlement.MerchantSysNo = Vendor.SysNo
              LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
                ON CHARINDEX('\'+CONVERT(VARCHAR,sysUser.UserSysNo)+'\', '\'+collectionSettlement.InUser+'\') > 0
              LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
                ON collectionSettlement.StockSysno=stock.SysNo
              #StrWhere#

              SELECT
                PaySysNo,
                OrderSysNo,
                OrderID,
                BatchNumber,
                OrderType,
                CreateDate,
                PayableAmt,
                AlreadyPayAmt,
                CurrencySysNo,
                Currency,
                VendorName,
                VendorSysNo,
                PayPeriodType,
                PayTypeSysNo,
                UserName,
                OrderStatus,
                PayStatus,
                InvoiceStatus,
                InvoiceFactStatus,
                Note,
                POMemo,
                Bank,
                Account,
                ReturnPoint,
                WarehouseName,
                WarehouseNumber,
                InvoiceNumber,
                CompanyCode,
                SapImportedStatus ,
                SAPDocNo,
                SAPPostDate,
                SapInFailedReason,
                EGP,
                ETP,
                PaySettleCompany,
                InstockAmt,
                PayStyle,
                EIMSNoList,
                InStockTime
              FROM (
                SELECT TOP (@EndNumber)
                  PaySysNo = pay.Sysno,
                  OrderSysNo = pay.OrderSysNo,
                  OrderID = CONVERT(VARCHAR,collectionSettlement.SysNo),
                  BatchNumber = 1,
                  OrderType = pay.OrderType,
                  CreateDate = pay.OrderDate,
                  PayableAmt = pay.OrderAmt,
                  AlreadyPayAmt = pay.AlreadyPayAmt,
                  CurrencySysNo = pay.CurrencySysNo,
                  Currency=c.[CurrencySymbol]+c.[CurrencyName],
                  VendorName = vendor.VendorName,
                  VendorSysNo = Vendor.SysNo,
                  PayPeriodType = Vendor.PayPeriodType,
                  PayTypeSysNo = NULL,
                  UserName = SUBSTRING(collectionSettlement.InUser ,0,CHARINDEX('\',collectionSettlement.InUser)),--sysUser.DisplayName,
                  OrderStatus = CASE collectionSettlement.Status
                                    WHEN 'ABD' THEN 1   --作废
                                    WHEN 'ORG' THEN 2   --待结算
                                    WHEN 'AUD' THEN 3   --已审核
                                    WHEN 'SET' THEN 4   --已结算
                                    ELSE -1 END,
                  PayStatus = pay.PayStatus,
                  InvoiceStatus = pay.InvoiceStatus,
                  InvoiceFactStatus = pay.InvoiceFactStatus,
                  Note = pay.Note,
                  POMemo = '',
                  Bank = vendor.Bank,
                  Account = vendor.Account,
                  ReturnPoint=null,
                  WarehouseName=stock.StockName,
                  WarehouseNumber=stock.SysNo,
                  InvoiceNumber=pay.Note,
                  CompanyCode = pay.CompanyCode,
                  SapImportedStatus=pay.SapImportedStatus,
                  SAPDocNo=pay.SAPDocNo,
                  SAPPostDate = pay.SAPPostDate,
                  SapInFailedReason=pay.SapInFailedReason,
                  EGP = pay.EGP,
                  ETP = pay.ETP,
                  PaySettleCompany = vendor.PaySettleCompany,
                  pay.OrderAmt as InstockAmt,
                  InStockTime=NULL,
                  PayStyle =(
		                SELECT TOP 1 PayStyle FROM ipp3.dbo.Finance_Pay_Item WITH(NOLOCK)
		                WHERE PaySysNo = pay.SysNo AND Status <> -1),
                  EIMSNoList = NULL,
                  (ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
                FROM ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
                LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
                INNER JOIN OverseaPOASNManagement.dbo.V_CollectionSettlement collectionSettlement WITH (NOLOCK)
                 ON Pay.OrderSysNo = collectionSettlement.SysNo
                LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
                 ON collectionSettlement.MerchantSysNo = Vendor.SysNo
                LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
                  ON collectionSettlement.StockSysno=stock.SysNo
                #StrWhere#
              ) Result
              WHERE RowNumber > @StartNumber

              SELECT
                @PUSum = ISNULL(SUM( round(ISNULL(pay.OrderAmt,0),2)),0),
                @APSum = ISNULL(SUM( round( pay.AlreadyPayAmt,2)),0),
                @SapSum = ISNULL(SUM(round(pay.OrderAmt,2)),0)
              FROM ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
              LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
              INNER JOIN OverseaPOASNManagement.dbo.V_CollectionSettlement collectionSettlement WITH (NOLOCK)
                ON Pay.OrderSysNo = collectionSettlement.SysNo
              LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
                ON collectionSettlement.MerchantSysNo = Vendor.SysNo
              LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
                ON collectionSettlement.StockSysno=stock.SysNo
              #StrWhere#
              AND pay.PayStatus <> -1
			      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetCommissionPayList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
              SELECT @TotalCount = COUNT(pay.SysNo)
              FROM ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
              LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
                INNER JOIN OverseaPOASNManagement.dbo.V_Commission_Master commission WITH (NOLOCK)
                 ON Pay.OrderSysNo = commission.SysNo
                LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
                 ON commission.MerchantSysNo = Vendor.SysNo
              #StrWhere#

              SELECT
                PaySysNo,
                OrderSysNo,
                OrderID,
                BatchNumber,
                OrderType,
                CreateDate,
                PayableAmt,
                AlreadyPayAmt,
                CurrencySysNo,
                Currency,
                VendorName,
                VendorSysNo,
                PayPeriodType,
                PayTypeSysNo,
                UserName,
                OrderStatus,
                PayStatus,
                InvoiceStatus,
                InvoiceFactStatus,
                Note,
                POMemo,
                Bank,
                Account,
                ReturnPoint,
                WarehouseName,
                WarehouseNumber,
                InvoiceNumber,
                CompanyCode,
                SapImportedStatus ,
                SAPDocNo,
                SAPPostDate,
                SapInFailedReason,
                EGP,
                ETP,
                PaySettleCompany,
                InstockAmt,
                EIMSNo,
                EIMSNoList,
                PayStyle,
                InStockTime
              FROM (
                SELECT TOP (@EndNumber)
                  PaySysNo = pay.Sysno,
                  OrderSysNo = pay.OrderSysNo,
                  OrderID = CONVERT(VARCHAR,commission.SysNo),
                  BatchNumber = 1,
                  OrderType = pay.OrderType,
                  CreateDate = pay.OrderDate,
                  PayableAmt = pay.OrderAmt,
                  AlreadyPayAmt = pay.AlreadyPayAmt,
                  CurrencySysNo = pay.CurrencySysNo,
                  Currency=c.[CurrencySymbol]+c.[CurrencyName],
                  VendorName = vendor.VendorName,
                  VendorSysNo = Vendor.SysNo,
                  PayPeriodType = Vendor.PayPeriodType,
                  PayTypeSysNo = NULL,
                  UserName = SUBSTRING(commission.InUser ,0,CHARINDEX('\',commission.InUser)),--sysUser.DisplayName,
                  OrderStatus = CASE commission.Status
                                    WHEN 'ORG' THEN 1   --(Origin):已创建
                                    WHEN 'SET' THEN 2   --(Settled):已结算
                                    WHEN 'CLS' THEN 3   --(Close)：已关闭
                                    ELSE -1 END,
                  PayStatus = pay.PayStatus,
                  InvoiceStatus = pay.InvoiceStatus,
                  InvoiceFactStatus = pay.InvoiceFactStatus,
                  Note = pay.Note,
                  POMemo = '',
                  Bank = vendor.Bank,
                  Account = vendor.Account,
                  ReturnPoint=null,
                  WarehouseName=NULL,
                  WarehouseNumber=NULL,
                  InvoiceNumber=pay.Note,
                  CompanyCode = pay.CompanyCode,
                  SapImportedStatus=pay.SapImportedStatus,
                  SAPDocNo=pay.SAPDocNo,
                  SAPPostDate = pay.SAPPostDate,
                  SapInFailedReason=pay.SapInFailedReason,
                  EGP = pay.EGP,
                  ETP = pay.ETP,
                  PaySettleCompany = vendor.PaySettleCompany,
                  0.00 as InstockAmt,
                  pay.EIMSNo,
                  EIMSNoList = NULL,
                  InStockTime=NULL,
                  PayStyle =(
		                SELECT TOP 1 PayStyle FROM ipp3.dbo.Finance_Pay_Item WITH(NOLOCK)
		                WHERE PaySysNo = pay.SysNo AND Status <> -1),
                  (ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
                FROM ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
                LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
                INNER JOIN OverseaPOASNManagement.dbo.V_Commission_Master commission WITH (NOLOCK)
                 ON Pay.OrderSysNo = commission.SysNo
                LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
                 ON commission.MerchantSysNo = Vendor.SysNo
                #StrWhere#
              ) Result
              WHERE RowNumber > @StartNumber

              SELECT
                @PUSum = ISNULL(SUM( round(ISNULL(pay.OrderAmt,0),2)),0),
                @APSum = ISNULL(SUM( round( pay.AlreadyPayAmt,2)),0),
                @SapSum = ISNULL(SUM( round(ISNULL(pay.OrderAmt,0),2)),0)
              FROM ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
              LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
                INNER JOIN OverseaPOASNManagement.dbo.V_Commission_Master commission WITH (NOLOCK)
                 ON Pay.OrderSysNo = commission.SysNo
                LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
                 ON commission.MerchantSysNo = Vendor.SysNo
              #StrWhere#
              AND pay.PayStatus <> -1
			      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetCollectionPaymentList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT @TotalCount = COUNT(pay.SysNo)
FROM
IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
INNER JOIN OverseaPOASNManagement.dbo.V_POCollectionPayment_Settle paymentsettle WITH (NOLOCK)
  ON pay.OrderSysNo = paymentsettle.SysNo
LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
  ON paymentsettle.VendorSysNo = vendor.SysNo
LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK) 
  ON paymentsettle.CreateUserSysNo = sysUser.UserSysNo     
LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK) 
  on paymentsettle.StockSysno=stock.SysNo
#StrWhere#
SELECT
  PaySysNo,
  OrderSysNo,
  OrderID,
  OrderType,
  CreateDate,
  PayableAmt,
  AlreadyPayAmt,
  CurrencySysNo,
  Currency,
  VendorName,
  VendorSysNo,
  PayPeriodType,
  PayTypeSysNo,
  UserName,
  OrderStatus,
  PayStatus,
  InvoiceStatus,
  InvoiceFactStatus,
  Note,
  POMemo,
  Bank,
  Account,
  ReturnPoint,
  CreateUserSysNo,
  WarehouseName,
  WarehouseNumber,
  InvoiceNumber,  
  CompanyCode,
  SapImportedStatus,
    SAPDocNo,
    SAPPostDate,
    SapInFailedReason,
    EGP,
    ETP,
    PaySettleCompany,
    InstockAmt,
	EIMSNo,
  EIMSNoList,
  PayStyle,
  InStockTime
FROM (
SELECT TOP (@EndNumber)
		PaySysNo = pay.SysNo,
		OrderSysNo = pay.OrderSysNo, 
		OrderID = paymentsettle.SettleID,
    BatchNumber=null,
		OrderType = pay.OrderType,
		CreateDate = pay.OrderDate,
		PayableAmt = pay.OrderAmt,
		AlreadyPayAmt = pay.AlreadyPayAmt,
		CurrencySysNo = pay.CurrencySysNo,
    Currency = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
		VendorName = vendor.VendorName, 
		VendorSysNo = vendor.SysNo,
		PayPeriodType = vendor.PayPeriodType,
		PayTypeSysNo = NULL,
		UserName = sysUser.DisplayName,
		OrderStatus = paymentsettle.Status,
		PayStatus = pay.PayStatus, 
		InvoiceStatus = pay.InvoiceStatus,
    InvoiceFactStatus = pay.InvoiceFactStatus,
    Note = pay.Note,
		POMemo = '',
		Bank = vendor.Bank,
		Account = vendor.Account,
		ReturnPoint=null,
		CreateUserSysNo=sysUser.UserSysNo,
		WarehouseName=stock.StockName,
		WarehouseNumber=stock.SysNo,
		InvoiceNumber=pay.Note,		
    CompanyCode = pay.CompanyCode,
    SapImportedStatus=pay.SapImportedStatus,
    SAPDocNo=pay.SAPDocNo,
    SAPPostDate = pay.SAPPostDate,
    SapInFailedReason=pay.SapInFailedReason,
    EGP = pay.EGP,
    ETP = pay.ETP,
    PaySettleCompany = vendor.PaySettleCompany,
    0.00 as InstockAmt,
	  pay.EIMSNo,
    EIMSNoList = NULL,
    InStockTime=NULL,
    PayStyle =(
		  SELECT TOP 1 PayStyle FROM ipp3.dbo.Finance_Pay_Item WITH(NOLOCK) 
		  WHERE PaySysNo = pay.SysNo),
    (ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
    FROM
      IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
      INNER JOIN OverseaPOASNManagement.dbo.V_POCollectionPayment_Settle paymentsettle WITH (NOLOCK) 
        ON pay.OrderSysNo = paymentsettle.SysNo
        LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
       ON curreny.SysNo = pay.CurrencySysNo 
      LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK) 
        ON paymentsettle.VendorSysNo = vendor.SysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK) 
        ON paymentsettle.CreateUserSysNo = sysUser.UserSysNo     
      LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK) 
        on paymentsettle.StockSysno=stock.SysNo
    #StrWhere#
) Result
WHERE RowNumber > @StartNumber

    SELECT 
       @PUSum = ISNULL(SUM(round(pay.OrderAmt,2)),0),
       @APSum = ISNULL(SUM(round(pay.AlreadyPayAmt,2)),0),
       @SapSum = ISNULL(SUM(round(pay.OrderAmt,2)),0)
    FROM
      IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
      INNER JOIN OverseaPOASNManagement.dbo.V_POCollectionPayment_Settle paymentsettle WITH (NOLOCK) 
        ON pay.OrderSysNo = paymentsettle.SysNo
      LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK) 
        ON paymentsettle.VendorSysNo = vendor.SysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK) 
        ON paymentsettle.CreateUserSysNo = sysUser.UserSysNo     
      LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK) 
        on paymentsettle.StockSysno=stock.SysNo
    #StrWhere#
    AND pay.PayStatus <> -1
      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetCCPayList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
          SELECT @TotalCount = COUNT(pay.SysNo)
          FROM
          IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
          INNER JOIN OverseaPOASNManagement.dbo.CostChange cc WITH (NOLOCK)
            ON pay.OrderSysNo = cc.SysNo
          LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
            ON cc.VendorSysNo = vendor.SysNo
          LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK) 
            ON cc.InUser = sysUser.UserSysNo     
          #StrWhere#
          SELECT          
            PaySysNo,
            OrderSysNo,
            OrderID,
            OrderType,
            BatchNumber=1,
            CreateDate,
            PayableAmt,
            AlreadyPayAmt,
            CurrencySysNo,
            Currency,
            VendorName,
            VendorSysNo,
            PayPeriodType,
            PayTypeSysNo,
            UserName,
            OrderStatus,
            PayStatus,
            InvoiceStatus,
            InvoiceFactStatus,
            Note,
            POMemo,
            Bank,
            Account,
            ReturnPoint,
            CreateUserSysNo,
            WarehouseName,
            WarehouseNumber,
            InvoiceNumber,  
            CompanyCode,
            SapImportedStatus,
              SAPDocNo,
              SAPPostDate,
              SapInFailedReason,
              EGP,
              ETP,
              PaySettleCompany,
              InstockAmt,
	          EIMSNo,
            EIMSNoList,
            PayStyle,
            InStockTime
          FROM (
          SELECT TOP (@EndNumber)
		          PaySysNo = pay.SysNo,
		          OrderSysNo = pay.OrderSysNo, 
		          OrderID = CONVERT(VARCHAR,cc.SysNo),
		          BatchNumber=null,
		          OrderType = pay.OrderType,
		          CreateDate = pay.OrderDate,
		          PayableAmt = pay.OrderAmt,
		          AlreadyPayAmt = pay.AlreadyPayAmt,
		          CurrencySysNo = pay.CurrencySysNo,
		          Currency = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
		          VendorName = vendor.VendorName, 
		          VendorSysNo = vendor.SysNo,
		          PayPeriodType = vendor.PayPeriodType,
		          PayTypeSysNo = NULL,
		          UserName = sysUser.DisplayName,
		          OrderStatus = cc.Status,
		          PayStatus = pay.PayStatus, 
		          InvoiceStatus = pay.InvoiceStatus,
		          InvoiceFactStatus = pay.InvoiceFactStatus,
		          Note = pay.Note,
		          POMemo = '',
		          Bank = vendor.Bank,
		          Account = vendor.Account,
		          ReturnPoint=null,
		          CreateUserSysNo=sysUser.UserSysNo,
		          WarehouseName='',
		          WarehouseNumber=51,
		          InvoiceNumber=pay.Note,		
		          CompanyCode = pay.CompanyCode,
		          SapImportedStatus=pay.SapImportedStatus,
		          SAPDocNo=pay.SAPDocNo,
		          SAPPostDate = pay.SAPPostDate,
		          SapInFailedReason=pay.SapInFailedReason,
		          EGP = pay.EGP,
		          ETP = pay.ETP,
		          PaySettleCompany = vendor.PaySettleCompany,
		          0.00 as InstockAmt,
		          pay.EIMSNo,
		          EIMSNoList = NULL,
              InStockTime=NULL,
		          PayStyle =(
			            SELECT TOP 1 PayStyle FROM ipp3.dbo.Finance_Pay_Item WITH(NOLOCK) 
			            WHERE PaySysNo = pay.SysNo),
		          (ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
              FROM IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
		          INNER JOIN OverseaPOASNManagement.dbo.CostChange cc WITH (NOLOCK) 
                  ON pay.OrderSysNo = cc.SysNo
                  LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
		          ON curreny.SysNo = pay.CurrencySysNo 
		          LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK) 
                  ON cc.VendorSysNo = vendor.SysNo
		          LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK) 
                  ON cc.InUser = sysUser.UserSysNo
              #StrWhere#
          ) Result
          WHERE RowNumber > @StartNumber

              SELECT 
                 @PUSum = ISNULL(SUM(round(pay.OrderAmt,2)),0),
                 @APSum = ISNULL(SUM(round(pay.AlreadyPayAmt,2)),0),
                 @SapSum = ISNULL(SUM(round(pay.OrderAmt,2)),0)
              FROM
                IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
                INNER JOIN OverseaPOASNManagement.dbo.CostChange cc WITH (NOLOCK) 
                  ON pay.OrderSysNo = cc.SysNo
                LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK) 
                  ON cc.VendorSysNo = vendor.SysNo
                LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK) 
                  ON cc.InUser = sysUser.UserSysNo     
              #StrWhere#
              AND pay.PayStatus <> -1
      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetPOConsignSettleItem" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
			  SELECT TOP 1 1 FROM OverseaPOASNManagement.dbo.V_POConsign_Settle_Item WITH(NOLOCK)
          WHERE SettleSysNo = @SettleSysNo AND POConsignToAccLogSysNo IS NOT NULL
			]]>
    </commandText>
    <parameters>
      <param name="@SettleSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetCommonOrderPayList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT @TotalCount = COUNT(pay.SysNo)
FROM
IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
INNER JOIN OverseaInvoiceReceiptManagement.dbo.V_PayBizAdapter biz WITH (NOLOCK)
  ON pay.OrderSysNo = biz.OrderSysNo and biz.orderType=pay.OrderType
LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
  ON biz.VendorSysNo = vendor.SysNo
LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
  ON biz.InUser = sysUser.UserSysNo
LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
  on biz.StockSysno=stock.SysNo
#StrWhere#
SELECT
  PaySysNo,
  OrderSysNo,
  OrderID,
  BatchNumber,
  OrderType,
  CreateDate,
  PayableAmt,
  AlreadyPayAmt,
  CurrencySysNo,
  Currency,
  VendorName,
  VendorSysNo,
  PayPeriodType,
  PayTypeSysNo,
  UserName,
  OrderStatus,
  PayStatus,
  InvoiceStatus,
  InvoiceFactStatus,
  Note,
  POMemo,
  Bank,
  Account,
  ReturnPoint,
  CreateUserSysNo,
  WarehouseName,
  WarehouseNumber,
  InvoiceNumber,
  CompanyCode,
  SapImportedStatus,
    SAPDocNo,
    SAPPostDate,
    SapInFailedReason,
    EGP,
    ETP,
    PaySettleCompany,
    InstockAmt,
	EIMSNo,
  EIMSNoList,
  PayStyle,
  InStockTime
FROM (
SELECT TOP (@EndNumber)
		PaySysNo = pay.SysNo,
		OrderSysNo = pay.OrderSysNo,
		OrderID = pay.OrderSysNo,
    BatchNumber=1,
		OrderType = pay.OrderType,
		CreateDate = pay.OrderDate,
		PayableAmt = pay.OrderAmt,
		AlreadyPayAmt = pay.AlreadyPayAmt,
		CurrencySysNo = pay.CurrencySysNo,
    Currency=c.[CurrencySymbol]+c.[CurrencyName],
		VendorName = vendor.VendorName,
		VendorSysNo = vendor.SysNo,
		PayPeriodType = vendor.PayPeriodType,
		PayTypeSysNo = NULL,
		UserName = sysUser.DisplayName,
		OrderStatus = biz.Status,
		PayStatus = pay.PayStatus,
		InvoiceStatus = pay.InvoiceStatus,
    InvoiceFactStatus = pay.InvoiceFactStatus,
    Note = pay.Note,
		POMemo = '',
		Bank = vendor.Bank,
		Account = vendor.Account,
		ReturnPoint=null,
		CreateUserSysNo=sysUser.UserSysNo,
		WarehouseName=stock.StockName,
		WarehouseNumber=stock.SysNo,
		InvoiceNumber=pay.Note,
    CompanyCode = pay.CompanyCode,
    SapImportedStatus=pay.SapImportedStatus,
    SAPDocNo=pay.SAPDocNo,
    SAPPostDate = pay.SAPPostDate,
    SapInFailedReason=pay.SapInFailedReason,
    EGP = pay.EGP,
    ETP = pay.ETP,
    PaySettleCompany = vendor.PaySettleCompany,
    0.00 as InstockAmt,
	  pay.EIMSNo,
    EIMSNoList = NULL,
    InStockTime=NULL,
    PayStyle =(
		  SELECT TOP 1 PayStyle FROM ipp3.dbo.Finance_Pay_Item WITH(NOLOCK)
		  WHERE PaySysNo = pay.SysNo AND Status <> -1),
    (ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
    FROM
      IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
      LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
      INNER JOIN OverseaInvoiceReceiptManagement.dbo.V_PayBizAdapter biz WITH (NOLOCK)
        ON pay.OrderSysNo = biz.OrderSysNo and biz.orderType=pay.OrderType
      LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON biz.VendorSysNo = vendor.SysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON biz.InUser = sysUser.UserSysNo
      LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
        on biz.StockSysno=stock.SysNo
    #StrWhere#
) Result
WHERE RowNumber > @StartNumber

    SELECT
       @PUSum = ISNULL(SUM(round(pay.OrderAmt,2)),0),
       @APSum = ISNULL(SUM(round(pay.AlreadyPayAmt,2)),0),
       @SapSum = 0
    FROM
      IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
      LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency c WITH (NOLOCK) ON pay.CurrencySysNo= c.SysNo
      INNER JOIN OverseaInvoiceReceiptManagement.dbo.V_PayBizAdapter biz WITH (NOLOCK)
        ON pay.OrderSysNo = biz.OrderSysNo and biz.orderType=pay.OrderType
      LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON biz.VendorSysNo = vendor.SysNo
      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON biz.InUser = sysUser.UserSysNo
      LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH (NOLOCK)
        on biz.StockSysno=stock.SysNo
    #StrWhere#
    AND pay.PayStatus <> -1
			  ]]>
    </commandText>
    <parameters>
      <param name="@OrderType" dbType="Int32" />    
    </parameters>
  </dataCommand>

  <dataCommand name="UpdatePayableInvoive" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE IPP3.dbo.Finance_Pay
SET
	InvoiceStatus = @InvoiceStatus,
  InvoiceFactStatus = @InvoiceFactStatus,
  InvoiceUpdateTime = GETDATE(),
  Note = @Note,
  UpdateInvoiceUserSysNo = @UpdateInvoiceUserSysNo
WHERE SysNo = @SysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@InvoiceStatus" dbType="Int32" />
      <param name="@InvoiceFactStatus" dbType="Int32" />
      <param name="@Note" dbType="String" />
      <param name="@UpdateInvoiceUserSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetPayableList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT TOP 1000
	[SysNo]
  ,[OrderSysNo]
  ,[CurrencySysNo]
  ,[OrderAmt]
  ,[AlreadyPayAmt]
  ,[PayStatus]
  ,[InvoiceStatus]
  ,[Note]
  ,[OrderType]
  ,[InvoiceUpdateTime]
  ,[UpdateInvoiceUserSysNo]
  ,[InvoiceFactStatus]
  ,[CompanyCode]
  ,BatchNumber
  ,AuditUserSysNo
  ,AuditDatetime
  ,AuditStatus
  ,Memo
FROM [IPP3].[dbo].[Finance_Pay] WITH(NOLOCK)
#StrWhere#
      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="UpdatePayableStatus" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE IPP3.dbo.Finance_Pay SET
	 PayStatus = @PayStatus
WHERE SysNo = @SysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@PayStatus" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdatePayableStatusAndAlreadyPayAmt" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE IPP3.dbo.Finance_Pay
SET
	PayStatus = @PayStatus,
  AlreadyPayAmt = @AlreadyPayAmt
WHERE SysNo = @SysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@PayStatus" dbType="Int32" />
      <param name="@AlreadyPayAmt" dbType="Decimal" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdatePayableStatusAndOrderAmt" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE IPP3.dbo.Finance_Pay
SET
	OrderAmt = @OrderAmt,
	PayStatus = @PayStatus,
	EIMSNo = @EIMSNo,
	ETP = @ETP,
  InStockAmt = @InStockAmt,
  RawOrderAmt = @RawOrderAmt,
  EIMSAmt = @EIMSAmt,
	Indate=getdate()
WHERE SysNo = @SysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@OrderAmt" dbType="Decimal" />
      <param name="@InStockAmt" dbType="Decimal" />
      <param name="@RawOrderAmt" dbType="Decimal" />
      <param name="@EIMSAmt" dbType="Decimal" />
      <param name="@PayStatus" dbType="Int32" />
      <param name="@EIMSNo" dbType="Int32" />
      <param name="@ETP" dbType="DateTime" property="EstimatedTimeOfPay"/>
    </parameters>
  </dataCommand>

  <dataCommand name="InsertPayable" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
DECLARE @SysNo int
IF NOT EXISTS(SELECT TOP 1 1 FROM IPP3.dbo.Finance_Pay where OrderType=@OrderType
  AND OrderSysNo=@OrderSysNo AND BatchNumber=@BatchNumber)
BEGIN
INSERT INTO IPP3.dbo.Finance_Pay
(
	[OrderSysNo]
	,[CurrencySysNo]
	,[OrderAmt]
	,[AlreadyPayAmt]
	,[PayStatus]
	,[InvoiceStatus]
	,[Note]
	,[OrderType]
	,[UpdateInvoiceUserSysNo]
	,[InvoiceFactStatus]
  ,[CompanyCode]
  ,[InStockAmt]
  ,[ETP]
  ,[BatchNumber]
  ,[RawOrderAmt]
  ,[EIMSAmt]
  ,[OrderStatus]
  ,[EGP]
  ,[EIMSNo]
)
VALUES
(
	@OrderSysNo,
	@CurrencySysNo,
	@OrderAmt,
	@AlreadyPayAmt,
	@PayStatus,
	@InvoiceStatus,
	@Note,
	@OrderType,
	@UpdateInvoiceUserSysNo,
	@InvoiceFactStatus,
  @CompanyCode,
  @InStockAmt,
  @ETP,
  @BatchNumber,
  @RawOrderAmt,
  @EIMSAmt,
  @OrderStatus,
  @EGP,
  @EIMSNo
)
END
SELECT @SysNo=SCOPE_IDENTITY()
SELECT CASE WHEN @SysNo is null THEN 0 else @SysNo END
      ]]>
    </commandText>
    <parameters>
      <param name="@OrderSysNo" dbType="Int32" />
      <param name="@CurrencySysNo" dbType="Int32" />
      <param name="@OrderAmt" dbType="Decimal" />
      <param name="@AlreadyPayAmt" dbType="Decimal" />
      <param name="@PayStatus" dbType="Int32" />
      <param name="@InvoiceStatus" dbType="Int32" />
      <param name="@Note" dbType="String" />
      <param name="@OrderType" dbType="Int32" />
      <param name="@UpdateInvoiceUserSysNo" dbType="Int32" property="[UserSysNo]"/>
      <param name="@InvoiceFactStatus" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@InStockAmt" dbType="Decimal" />
      <param name="@ETP" dbType="DateTime" property="EstimatedTimeOfPay"/>
      <param name="@BatchNumber" dbType="Decimal" />
      <param name="@RawOrderAmt" dbType="Decimal" />
      <param name="@EIMSAmt" dbType="Decimal" />
      <param name="@OrderStatus" dbType="Int32" />
      <param name="@EGP" dbType="DateTime" property="[Now]"  />
      <param name="@EIMSNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdatePayableAuditInfo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      UPDATE IPP3.dbo.Finance_Pay
      SET
	      AuditUserSysNo = @AuditUserSysNo,
        AuditStatus = @AuditStatus,
        AuditDatetime = getdate()
      WHERE SysNo = @SysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@AuditUserSysNo" dbType="Int32" />
      <param name="@AuditStatus" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdatePayableETP" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        UPDATE IPP3.dbo.Finance_Pay
        SET
          ETP = @ETP
        WHERE SysNo = @SysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@ETP" dbType="DateTime" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetPayGatherItemStatusByOrderNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT
          COUNT(PayItem.[Status])
        FROM
          OverseaInvoiceReceiptManagement.[dbo].[V_IM_Pay] AS Pay WITH(NOLOCK)
         ,OverseaInvoiceReceiptManagement.[dbo].[V_IM_PayItem] AS PayItem WITH(NOLOCK)
        WHERE
          PayItem.[PaySysNo] = Pay.[SysNo] AND PayItem.[Status]<>-1 AND pay.OrderType = 10 AND Pay.[OrderSysNo] = @SysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetVendorPayBalanceByVendorSysNo" database="NCService"  commandType="Text">
    <commandText>
      <![CDATA[
      SELECT vp.VendorSysNo,
	      vp.TotalPayBalance
      FROM OverseaInvoiceReceiptManagement.dbo.V_IM_VendorPayBalance vp WITH(NOLOCK)
      WHERE vp.VendorSysNo=@VendorSysNo
			]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="QueryStorePageType" database="NCService"  commandType="Text">
    <commandText>
      <![CDATA[
SELECT [Key]
      ,[Name]
      ,[Desc]
      ,[AllowMultiPage]
      ,[AllowSetTemplate]
      ,[IsForStoreWebsite]
      ,[IsForMasterWebsite]
      ,[PageIDType]
      ,[WebsiteID]
      ,[Status]
      ,[Memo]
  FROM [ECStore].[dbo].[PageType]
			]]>
    </commandText>
  </dataCommand>

  <!--<dataCommand name="QueryStorePageInfo" database="NCService"  commandType="Text">
    <commandText>
      <![CDATA[
      SELECT @TotalCount = COUNT(1)
        FROM [ECStore].[dbo].[PublishedStorePageInfo] ps WITH(NOLOCK)
  LEFT JOIN [IPP3].[dbo].[Vendor] v WITH(NOLOCK)
  ON ps.SellerSysNo = v.SysNo
  LEFT JOIN [ECStore].[dbo].[StorePageInfo] sp WITH(NOLOCK)
  ON sp.SysNo = ps.StorePageSysNo
  LEFT JOIN [ECStore].[dbo].[PageType] pt WITH(NOLOCK)
  ON pt.[Key] = sp.[PageTypeKey]
        #StrWhere#
      
 SELECT 
 * 
 FROM
(
    SELECT TOP (@EndNumber)
      ps.[SysNo]
      ,ps.[SellerSysNo]
      ,ps.[DataValue]
      ,ps.[LinkUrl]
      ,ps.[Status]
      ,ps.[InUserSysNo]
      ,ps.[InUserName]
      ,ps.[InDate]
      ,ps.[EditUserSysNo]
      ,ps.[EditUserName]
      ,ps.[EditDate]
      ,ps.[StorePageSysNo]
      ,ps.[PageName]
      ,v.[VendorName]
      ,pt.[Name] AS [PageTypeName]
       ,(ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
  FROM [ECStore].[dbo].[PublishedStorePageInfo] ps WITH(NOLOCK)
  LEFT JOIN [IPP3].[dbo].[Vendor] v WITH(NOLOCK)
  ON ps.SellerSysNo = v.SysNo
  LEFT JOIN [ECStore].[dbo].[StorePageInfo] sp WITH(NOLOCK)
  ON sp.SysNo = ps.StorePageSysNo
  LEFT JOIN [ECStore].[dbo].[PageType] pt WITH(NOLOCK)
  ON pt.[Key] = sp.[PageTypeKey]
  #StrWhere#
  )RESULT where RowNumber > @StartNumber
			]]>
    </commandText>
  </dataCommand>-->

  <dataCommand name="QueryStorePageInfo" database="NCService"  commandType="Text">
    <commandText>
      <![CDATA[
      SELECT @TotalCount = COUNT(1)
      FROM [ECStore].[dbo].[StorePageInfo] sp WITH(NOLOCK)
      LEFT JOIN [ECStore].[dbo].[PublishedStorePageInfo] ps WITH(NOLOCK) ON sp.SysNo = ps.StorePageSysNo
      LEFT JOIN [IPP3].[dbo].[Vendor] v WITH(NOLOCK) ON ps.SellerSysNo = v.SysNo
      LEFT JOIN [ECStore].[dbo].[PageType] pt WITH(NOLOCK) ON pt.[Key] = sp.[PageTypeKey]
      #StrWhere#
      
 SELECT 
 * 
 FROM
(
    SELECT TOP (@EndNumber)
      sp.[SysNo]
      ,sp.[SellerSysNo]
      ,sp.[DataValue]
      ,sp.[LinkUrl]
      ,CASE sp.[Status] WHEN 1 THEN '草稿'
        WHEN 2 THEN '待审核'
        WHEN 3 THEN '已审核'
        ELSE '审核未通过'
       END AS Status
      ,sp.[InUserSysNo]
      ,sp.[InUserName]
      ,sp.[InDate]
      ,sp.[EditUserSysNo]
      ,sp.[EditUserName]
      ,sp.[EditDate]
      ,ps.[StorePageSysNo]
      ,sp.[PageName]
      ,v.[VendorName]
      ,pt.[Name] AS [PageTypeName]
       ,(ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
  FROM [ECStore].[dbo].[StorePageInfo] sp WITH(NOLOCK)
  LEFT JOIN [ECStore].[dbo].[PublishedStorePageInfo] ps WITH(NOLOCK) ON sp.SysNo = ps.StorePageSysNo
  LEFT JOIN [IPP3].[dbo].[Vendor] v WITH(NOLOCK) ON ps.SellerSysNo = v.SysNo
  LEFT JOIN [ECStore].[dbo].[PageType] pt WITH(NOLOCK) ON pt.[Key] = sp.[PageTypeKey]
  #StrWhere#
  )RESULT where RowNumber > @StartNumber
			]]>
    </commandText>
  </dataCommand>

  <dataCommand name="BatchDeleteStorePageInfo" database="NCService"  commandType="Text">
    <commandText>
      <![CDATA[
      DELETE [ECStore].[dbo].[PublishedStorePageInfo]
      WHERE StorePageSysNo = @SysNo
      
      DELETE FROM [ECStore].[dbo].[StorePageInfo]
      WHERE SysNo = @SysNo
  		]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="CheckStorePageInfo" database="NCService"  commandType="Text">
    <commandText>
      <![CDATA[
      UPDATE [ECStore].[dbo].[StorePageInfo]
      SET Status = @Status
      ,DataValue = REPLACE(DataValue,SUBSTRING(DataValue,CHARINDEX('Status', DataValue)-1,10),'"Status":' + CONVERT(char(1), @Status))
      WHERE SysNo = @SysNo
  		]]>
    </commandText>
    <parameters>
      <param name="@Status" dbType="Int32" />
      <param name="@SysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetPOPrepay" database="NCService"  commandType="Text">
    <commandText>
      <![CDATA[
      SELECT
	      item.OrderSysNo
	      ,item.Status
      FROM ipp3.dbo.Finance_Pay_Item item WITH(nolock)
      WHERE item.PayStyle = 1
      AND item.OrderSysNo = @PoSysNO
      AND item.OrderType = 0
  		]]>
    </commandText>
    <parameters>
      <param name="@PoSysNO" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetFirstPay" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        Select
          SysNo
          ,OrderAmt
          ,EGP
          ,ETP AS EstimatedTimeOfPay
        From ipp3.[dbo].[Finance_Pay] with(nolock)
		    Where OrderType=@OrderType
		    AND OrderSysNo=@OrderSysno
		    AND (BatchNumber=1 or BatchNumber is null)
		    AND PayStatus=2
    ]]>
    </commandText>
    <parameters>
      <param name="@OrderType" dbType="Int32" />
      <param name="@OrderSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdateFirstPay" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      UPDATE ipp3.[dbo].[Finance_Pay]
      Set
        BatchNumber=1,
        PayStatus=@PayStatus,
        OrderStatus=@OrderStatus,
        InStockAmt=@InStockAmt,
        OrderAmt = @OrderAmt,
        EIMSAmt=@EIMSAmt,
        RawOrderAmt=@RawOrderAmt
      Where SysNo=@SysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@PayStatus" dbType="Int32" />
      <param name="@OrderStatus" dbType="Int32" />
      <param name="@InStockAmt" dbType="Decimal" />
      <param name="@OrderAmt" dbType="Decimal" />
      <param name="@EIMSAmt" dbType="Decimal" />
      <param name="@RawOrderAmt" dbType="Decimal" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdatePayableInvoiceStatus" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE IPP3.dbo.Finance_Pay
SET
	InvoiceStatus = @InvoiceStatus,
  InvoiceFactStatus = @InvoiceFactStatus,
  InvoiceUpdateTime = GETDATE(),
  Note = @Note,
  UpdateInvoiceUserSysNo = @UpdateInvoiceUserSysNo
WHERE SysNo = @SysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@InvoiceStatus" dbType="Int32" />
      <param name="@InvoiceFactStatus" dbType="Int32" />
      <param name="@Note" dbType="String" />
      <param name="@UpdateInvoiceUserSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdatePayableInvoiceStatusWithETP" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE IPP3.dbo.Finance_Pay
SET
	InvoiceStatus = @InvoiceStatus,
  InvoiceFactStatus = @InvoiceFactStatus,
  InvoiceUpdateTime = GETDATE(),
  Note = @Note,
  UpdateInvoiceUserSysNo = @UpdateInvoiceUserSysNo,
  ETP=@ETP
WHERE SysNo = @SysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@InvoiceStatus" dbType="Int32" />
      <param name="@InvoiceFactStatus" dbType="Int32" />
      <param name="@Note" dbType="String" />
      <param name="@UpdateInvoiceUserSysNo" dbType="Int32" />
      <param name="@ETP" dbType="DateTime" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetUnPayPayableList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
       SELECT pay.SysNo,
               pay.OrderType,
               pay.OrderSysNo,
               pay.BatchNumber,
               pay.PayStatus,
               pay.CompanyCode
        FROM   IPP3.dbo.Finance_Pay pay WITH (NOLOCK)
        WHERE  pay.OrderType = 0
               AND pay.PayStatus = 0

        UNION
        SELECT pay.SysNo,
               pay.OrderType,
               pay.OrderSysNo,
               pay.BatchNumber,
               pay.PayStatus,
               pay.CompanyCode
        FROM   ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
        WHERE  pay.OrderType = 1
               AND pay.PayStatus = 0

        UNION
        SELECT pay.SysNo,
               pay.OrderType,
               pay.OrderSysNo,
               pay.BatchNumber,
               pay.PayStatus,
               pay.CompanyCode
        FROM   ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
        WHERE  pay.OrderType = 10
               AND pay.PayStatus = 0
			]]>
    </commandText>
  </dataCommand>
  <dataCommand name="GetAllVendorPayTerms" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT  PayTermsNo AS Code
             ,PayTermsName AS Name
      FROM OverseaInvoiceReceiptManagement.dbo.VendorPayTerms WITH(NOLOCK)
	    WHERE CompanyCode=@CompanyCode
      ORDER BY IsConsignmentExt,PayTermsName
			]]>
    </commandText>
    <parameters>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50"/>
    </parameters>
  </dataCommand>

  <dataCommand name="GetPayItemStatusByOrderNoNew" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT 
          COUNT(PayItem.[Status])
        FROM 
          OverseaInvoiceReceiptManagement.[dbo].[V_IM_Pay] AS Pay WITH(NOLOCK)
         ,OverseaInvoiceReceiptManagement.[dbo].[V_IM_PayItem] AS PayItem WITH(NOLOCK) 
        WHERE 		
          PayItem.[PaySysNo] = Pay.[SysNo] 
		  AND PayItem.[Status]<>-1 
		  AND Pay.PayStatus<>-1
		  AND pay.OrderType = 1 AND 
		  Pay.[OrderSysNo] = @SysNo  
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <dataCommand name="QueryPayable" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT TOP 1000
	        [SysNo]
          ,[OrderSysNo]
          ,[CurrencySysNo]
          ,[OrderAmt]
          ,[AlreadyPayAmt]
          ,[PayStatus]
          ,[InvoiceStatus]
          ,[Note]
          ,[OrderType]
          ,[InvoiceUpdateTime]
          ,[UpdateInvoiceUserSysNo]
          ,[InvoiceFactStatus]
          ,[CompanyCode]
          ,BatchNumber
          ,AuditUserSysNo
          ,AuditDatetime
          ,AuditStatus
          ,Memo
        FROM [IPP3].[dbo].[Finance_Pay] WITH(NOLOCK)
        #StrWhere#
      ]]>
    </commandText>
  </dataCommand>
  <dataCommand name="QueryPayItems" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[     
        SELECT TOP 1000
          SysNo
          ,[PaySysNo]
	        ,[PayStyle]
	        ,[PayAmt]
	        ,[CreateTime]
	        ,[CreateUserSysNo]
	        ,[EstimatePayTime]
	        ,[ReferenceID]
	        ,[PayTime]
	        ,[PayUserSysNo]
	        ,[Note]
	        ,[Status]
	        ,AvailableAmt
	        ,OrderType
	        ,OrderSysNo
	        ,PaySysNo
          ,BankGLAccount
          ,[CompanyCode]
        FROM IPP3.dbo.Finance_Pay_Item WITH(NOLOCK)
        #StrWhere#

        Select @TotalCount = @@RowCount
      ]]>
    </commandText>
  </dataCommand>
  <dataCommand name="Invoice_GetInvoiceStatusByPaySysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[	       
          DECLARE @OrderSysNo  int
          SELECT TOP(1) @OrderSysNo=OrderSysNo FROM [IPP3].[dbo].[Finance_Pay] WITH(NOLOCK) 
                 WHERE SysNo=@PaySysNo AND OrderType IN(0,1,6,7,8)

          SELECT TOP(1) [Status] FROM [EIMS].[dbo].[EIMSInvoiceInfo] WITH(NOLOCK)
          WHERE InvoiceNumber=@OrderSysNo
			]]>
    </commandText>
    <parameters>
      <param name="@PaySysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <dataCommand name="UpdatePayableEGPAndETP" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        UPDATE IPP3.dbo.Finance_Pay
        SET	
	        EGP = @EGP, 
          ETP = @ETP
        WHERE SysNo = @SysNo 
        --AND CompanyCode = @CompanyCode
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />

      <param name="@EGP" dbType="DateTime" />
      <param name="@ETP" dbType="DateTime" />
    </parameters>
  </dataCommand>
</dataOperations>
