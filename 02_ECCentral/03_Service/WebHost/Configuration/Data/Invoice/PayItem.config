<?xml version="1.0" encoding="utf-8" ?>
<dataOperations xmlns="http://oversea.newegg.com/DataOperation">

  <dataCommand name="GetPayItemList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[

SELECT TOP 1000
  SysNo
  ,[PaySysNo]
	,[PayStyle]
	,[PayAmt]
	,[CreateTime]
	,[CreateUserSysNo]
	,[EstimatePayTime]
	,[ReferenceID]
	,[PayTime]
	,[PayUserSysNo]
	,[Note]
	,[Status]
	,AvailableAmt
	,OrderType
	,OrderSysNo
	,PaySysNo
  ,BankGLAccount
  ,[CreateTime]
  ,[CompanyCode]
FROM IPP3.dbo.Finance_Pay_Item WITH(NOLOCK)
#StrWhere#

Select @TotalCount = @@RowCount
      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="UpdatePayItemReferenceID" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE IPP3.dbo.Finance_Pay_Item SET
  ReferenceID = @ReferenceID
WHERE SysNo = @SysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@ReferenceID" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdatePayItemStatus" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE IPP3.dbo.Finance_Pay_Item
SET
	PayUserSysNo = ISNULL(@PayUserSysNo,PayUserSysNo),
  PayTime = CASE WHEN @Status = 1 THEN GETDATE() ELSE NULL END,
  Status = @Status,
  Note = @Note,
  BankGLAccount = @BankGLAccount
WHERE SysNo = @SysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@Status" dbType="Int32" />
      <param name="@PayUserSysNo" dbType="Int32" />
      <param name="@Note" dbType="String" />
      <param name="@BankGLAccount" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="InsertPayItem" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
INSERT INTO IPP3.dbo.Finance_Pay_Item
(
	[PaySysNo]
	,[PayStyle]
	,[PayAmt]
	,[CreateTime]
	,[CreateUserSysNo]
	,[EstimatePayTime]
	,[ReferenceID]
	,[Note]
	,[Status]
  ,[CurrencySysNo]
  ,[CompanyCode]
  ,OrderSysNo
  ,OrderType
  ,AvailableAmt
)
VALUES
(
	@PaySysNo,
	@PayStyle,
	@PayAmt,
	GETDATE(),
	@CreateUserSysNo,
	@EstimatePayTime,
	@ReferenceID,
	@Note,
	@Status,
  @CurrencySysNo,
  @CompanyCode,
  @OrderSysNo,
  @OrderType,
  @AvailableAmt
)
SELECT SCOPE_IDENTITY()
      ]]>
    </commandText>
    <parameters>
      <param name="@PaySysNo" dbType="Int32" />
      <param name="@PayStyle" dbType="Int32" />
      <param name="@PayAmt" dbType="Decimal" />
      <param name="@CreateUserSysNo" dbType="Int32" property="[UserSysNo]" />
      <param name="@EstimatePayTime" dbType="DateTime" />
      <param name="@ReferenceID" dbType="String" />
      <param name="@Note" dbType="String" />
      <param name="@Status" dbType="Int32" />
      <param name="@CurrencySysNo" dbType="Int32" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@OrderSysNo" dbType="Int32" />
      <param name="@OrderType" dbType="Int32" />
      <param name="@AvailableAmt" dbType="Decimal" />
    </parameters>
  </dataCommand>

  <dataCommand name="InsertPayEx" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
     INSERT INTO [IPP3].[dbo].[Finance_Pay_Ex]
           ([PaySysNo]
           ,[PayItemSysNo]
           ,[PayedAmt]
           ,[STATUS]
		   ,[CompanyCode])
     VALUES
           (@PaySysNo,
           @PayItemSysNo,
           @PayedAmt,
           @STATUS,
		   @CompanyCode
          )
      ]]>
    </commandText>
    <parameters>
      <param name="@PaySysNo" dbType="Int32" />
      <param name="@PayItemSysNo" dbType="Int32" />
      <param name="@PayedAmt" dbType="Decimal" />
      <param name="@Status" dbType="AnsiStringFixedLength" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>

  <dataCommand name="SetPayItemAbandonOfFullPay" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE IPP3.dbo.Finance_Pay_Item
SET [Status] = @AbandonStatus
FROM IPP3.dbo.Finance_Pay_Item item WITH(NOLOCK)
WHERE
    item.[Status] = @OriginStatus
    AND item.SysNo = @SysNo
    AND EXISTS (
            SELECT 1
            FROM IPP3.dbo.Finance_Pay_Item pay WITH(NOLOCK)
            WHERE
                pay.SysNo = item.PaySysNo
                AND pay.OrderSysNo = @OrderSysNo)
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@AbandonStatus" dbType="Int32" />
      <param name="@OriginStatus" dbType="Int32" />
      <param name="@OrderSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetSystemUserSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
				SELECT TOP 1 SysNo
				FROM OverseaControlPanel.dbo.V_Sys_User WITH(NOLOCK)
				WHERE username='System'
	  ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="UpdatePayItem" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE IPP3.dbo.Finance_Pay_Item SET
	PayAmt = @PayAmt,
	EstimatePayTime = @EstimatePayTime,
  ReferenceID = @ReferenceID,
  Note = @Note
WHERE SysNo = @SysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@EstimatePayTime" dbType="DateTime" />
      <param name="@PayAmt" dbType="Decimal" />
      <param name="@ReferenceID" dbType="String" />
      <param name="@Note" dbType="String" />
    </parameters>
  </dataCommand>

  <dataCommand name="IsLastUnAbandonPayItem" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
				SELECT COUNT(1) FROM ipp3.dbo.Finance_Pay_item A
				WHERE Status<>-1
				AND	EXISTS
				(SELECT TOP 1 1 FROM ipp3.dbo.Finance_Pay_item B
				WHERE PaySysNo=@PaySysNo
				AND A.OrderType=B.OrderType
				AND A.OrderSysNo=b.OrderSysNo
				AND A.PaySysNo=B.PaySysNo
				AND A.SysNo<>@SysNo)
			]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@PaySysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdatePayItemStatusAndEditUser" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      UPDATE IPP3.dbo.Finance_Pay_Item
      SET
	      EditUser = @EditUser,
        EditTime = GETDATE(),
        Status = @Status
      WHERE SysNo = @SysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" />
      <param name="@Status" dbType="Int32" />
      <param name="@EditUser" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetPayItemListByStatus" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT payitem.SysNo,
               payitem.PaySysNo,
               payitem.[Status],
               pay.OrderType,
               pay.OrderSysNo,
               pay.CompanyCode
        FROM   IPP3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
               INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
                    ON  payitem.SysNo = fpe.PayItemSysNo
               INNER JOIN ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
                    ON  fpe.PaySysNo = pay.SysNo
        WHERE  pay.OrderType = 0
               AND pay.PayStatus IN (0, 1)
               AND payitem.[Status] = @PayItemStatus
        UNION
        SELECT payitem.SysNo,
               payitem.PaySysNo,
               payitem.[Status],
               pay.OrderType,
               pay.OrderSysNo,
               pay.CompanyCode
        FROM   IPP3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
               INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
                    ON  payitem.SysNo = fpe.PayItemSysNo
               INNER JOIN ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
                    ON  fpe.PaySysNo = pay.SysNo
        WHERE  pay.OrderType = 1
               AND pay.PayStatus IN (0, 1)
               AND payitem.[Status] = @PayItemStatus
        UNION
        SELECT payitem.SysNo,
               payitem.PaySysNo,
               payitem.[Status],
               pay.OrderType,
               pay.OrderSysNo,
               pay.CompanyCode
        FROM   IPP3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
               INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
                    ON  payitem.SysNo = fpe.PayItemSysNo
               INNER JOIN ipp3.dbo.Finance_Pay pay WITH (NOLOCK)
                    ON  fpe.PaySysNo = pay.SysNo
        WHERE  pay.OrderType = 10
               AND pay.PayStatus IN (0, 1)
               AND payitem.[Status] = @PayItemStatus
			]]>
    </commandText>
    <parameters>
      <param name="@PayItemStatus" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdatePayItemAvailableAmt" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
     UPDATE ipp3.dbo.Finance_Pay_Item
	 Set AvailableAmt=@AvailableAmt
	 Where OrderType=@OrderType AND OrderSysNo=@OrderSysno
	 AND Status=1
      ]]>
    </commandText>
    <parameters>
      <param name="@OrderType" dbType="Int32" />
      <param name="@OrderSysNo" dbType="Int32" />
      <param name="@AvailableAmt" dbType="Decimal" />
    </parameters>
  </dataCommand>

  <dataCommand name="PayItemIsAdvanced" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
    SELECT COUNT(1) FROM [IPP3].[dbo].[Finance_Pay_Item] WITH(NOLOCK)
    WHERE OrderType=@OrderType
    AND OrderSysNo=@OrderSysNo
    AND PayStyle =1
    AND Status <> -1
      ]]>
    </commandText>
    <parameters>
      <param name="@OrderType" dbType="Int32" />
      <param name="@OrderSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="LockOrUnLockPayItemBySysNoList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      UPDATE IPP3.dbo.Finance_Pay_Item
      SET
	      EditUser = @EditUser,
        EditTime = GETDATE(),
        Status = @Status
      WHERE SysNo In #SysNoList

      SELECT
          SysNo
         ,[PaySysNo]
         ,[PayStyle]
         ,[PayAmt]
         ,[CreateTime]
         ,[CreateUserSysNo]
         ,[EstimatePayTime]
         ,[ReferenceID]
         ,[PayTime]
         ,[PayUserSysNo]
         ,[Note]
         ,[Status]
         ,AvailableAmt
         ,OrderType
         ,OrderSysNo
         ,PaySysNo
         ,BankGLAccount
         ,[CompanyCode]
      FROM IPP3.dbo.Finance_Pay_Item WITH(NOLOCK)
      WHERE
          SysNo IN #SysNoList
      ORDER BY SysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@Status" dbType="Int32" />
      <param name="@EditUser" dbType="Int32" />
    </parameters>
  </dataCommand>

  <!---No BizQuery START-->
  <dataCommand name="GetAllPayItemList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
DECLARE @TotalCount1 INT
DECLARE @TotalCount2 INT
DECLARE @TotalCount3 INT
DECLARE @TotalCount4 INT
DECLARE @TotalCount5 INT
DECLARE @TotalCount6 INT
DECLARE @TotalCount7 INT
DECLARE @TotalCount8 INT
DECLARE @TotalCount9 INT

  SELECT @TotalCount1 = Count(payitem.SysNo)
    FROM
     ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	   INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	  LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	    ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock po WITH (NOLOCK)
	    ON pay.OrderSysNo = po.SysNo
	  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	    ON po.VendorSysNo = vendor.SysNo
    #StrWhere1#

SELECT  @TotalCount2 = Count(payitem.SysNo)
FROM
ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettle vendorsettle WITH (NOLOCK)
	  ON pay.OrderSysNo = vendorsettle.SysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  ON vendorsettle.VendorSysNo = vendor.SysNo
#StrWhere2#

SELECT  @TotalCount3= Count(payitem.SysNo)
    FROM
      ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	    INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	    LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	    ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	    LEFT JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettleBalance balancesettle WITH (NOLOCK)
	    ON pay.OrderSysNo = balancesettle.SysNo
	    LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	    ON balancesettle.VendorSysNo = vendor.SysNo
    #StrWhere3#

  SELECT @TotalCount4 = Count(payitem.SysNo)
    FROM
			  ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
		 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
			ON payitem.SysNo=fpe.PayItemSysNo
		  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
			ON fpe.PaySysNo=pay.SysNo
		LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
		  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
		LEFT JOIN EIMS.dbo.EIMSInvoiceInfo invoice WITH(NOLOCK)
		  ON pay.OrderSysNo = invoice.InvoiceNumber
		LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
		  ON invoice.VendorNumber = vendor.SysNo
    #StrWhere4#

  SELECT @TotalCount5 = Count(payitem.SysNo)
    FROM ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
   INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
    INNER JOIN OverseaServiceManagement.dbo.V_SM_RMAVendorRefundMaster RMAPOR WITH (NOLOCK)
        ON  RMAPOR.SysNo = pay.OrderSysNo
    INNER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON vendor.sysno = RMAPOR.VendorSysNo
    LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
    #StrWhere5#

    SELECT @TotalCount6 = COUNT(payitem.SysNo)
    FROM ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
    INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
      ON payitem.SysNo=fpe.PayItemSysNo
    INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
      ON fpe.PaySysNo=pay.SysNo
    LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
      ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
    LEFT JOIN OverseaPOASNManagement.dbo.V_CollectionSettlement collectionSettle WITH (NOLOCK)
      ON pay.OrderSysNo = collectionSettle.SysNo
    LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
      ON collectionSettle.MerchantSysNo = vendor.SysNo
    #StrWhere6#

    SELECT @TotalCount7 = COUNT(payitem.SysNo)
    FROM ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
    INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
      ON payitem.SysNo=fpe.PayItemSysNo
    INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
      ON fpe.PaySysNo=pay.SysNo
    LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
      ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
    LEFT JOIN OverseaPOASNManagement.dbo.V_Commission_Master commissionMaster WITH (NOLOCK)
      ON pay.OrderSysNo = commissionMaster.SysNo
    LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
      ON commissionMaster.MerchantSysNo = vendor.SysNo
    #StrWhere7#
    
    SELECT @TotalCount8 = COUNT(payitem.SysNo)
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK) 
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_POCollectionPayment_Settle paymentsettle WITH (NOLOCK) 
	  ON pay.OrderSysNo = paymentsettle.SysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK) 
	  ON paymentsettle.VendorSysNo = vendor.SysNo	
    #StrWhere8#
    
    SELECT @TotalCount9 = COUNT(payitem.SysNo)
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK) 
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT JOIN OverseaPOASNManagement.dbo.CostChange cc WITH (NOLOCK) 
	  ON pay.OrderSysNo = cc.SysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK) 
	  ON cc.VendorSysNo = vendor.SysNo	
    #StrWhere9#
    
SELECT @TotalCount = @TotalCount1 + @TotalCount2 + @TotalCount3 + @TotalCount4 + @TotalCount5 + @TotalCount6 + @TotalCount7 + @TotalCount8 + @TotalCount9

SELECT
   PaySysNo,
	  PayItemSysNo,
    OrderSysNo,
    OrderType,
    OrderID,
	BatchNumber,
	CurrencySysNo,
  CurrencyDesc,
    PayAmt,
    PaySettleCompany,
    PayStyle,
    VendorName,
	  VendorSysNo,
	  Status,
    CreateTime,
    EstimatePayTime,
    PayTime,
    ReferenceID,
    InvoiceStatus,
    InvoiceFactStatus,
	  InvoiceUpdateTime,
	  UpdateInvoiceUserName,
	  Note,
    InvoiceNumber,
    ReturnPoint,
    CompanyCode,
    BankGLAccount,
    IsSAPImported,
    SAPImportedDate,
    SAPDocNo,
    SAPPostDate,
    SapImportedStatus,
    SapInFailedReason,
    (CASE
        WHEN settleItem.SettleSysNo IS NOT NULL THEN 1
        ELSE 0
    END)AS IsOldConsignSettle
FROM(
SELECT TOP (@EndNumber)
    PaySysNo,
	  PayItemSysNo,
    OrderSysNo,
    OrderType,
    OrderID,
	BatchNumber,
	CurrencySysNo,
  CurrencyDesc,
    PayAmt,
    PaySettleCompany,
    PayStyle,
    VendorName,
	  VendorSysNo,
	  Status,
    CreateTime,
    EstimatePayTime,
    PayTime,
    ReferenceID,
    InvoiceStatus,
    InvoiceFactStatus,
	  InvoiceUpdateTime,
	  UpdateInvoiceUserName,
	  Note,
    InvoiceNumber,
    ReturnPoint,
    CompanyCode,
    BankGLAccount,
    IsSAPImported,
    SAPImportedDate,
    SAPDocNo,
    SAPPostDate,
    SapImportedStatus,
    SapInFailedReason,
    (ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
FROM(
SELECT
      PaySysNo = pay.SysNo,
	    PayItemSysNo = payitem.SysNo,
      OrderSysNo = po.SysNo,
      OrderType = pay.OrderType,
      OrderID = po.poid,
	  BatchNumber=pay.BatchNumber,
	  CurrencySysNo = pay.CurrencySysNo,
    CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
      PayAmt = ISNULL(payitem.PayAmt,0),
      PaySettleCompany = ISNULL(vendor.PaySettleCompany,0),
      PayStyle = payitem.PayStyle,
      VendorName = vendor.VendorName,
	    VendorSysNo = Vendor.SysNo,
	    Status = payitem.Status,
      payitem.CreateTime,
      payitem.EstimatePayTime,
      PayTime = payitem.PayTime,
      ReferenceID = payitem.ReferenceID,
      InvoiceStatus = pay.InvoiceStatus,
      InvoiceFactStatus = pay.InvoiceFactStatus,
	    InvoiceUpdateTime = pay.InvoiceUpdateTime,
	    UpdateInvoiceUserName = sysUser.DisplayName,
	    Note = payitem.Note,
      InvoiceNumber = pay.Note,
      ReturnPoint=ISNULL(pay.EIMSAmt,0),
      CompanyCode = payitem.CompanyCode   ,
      payitem.BankGLAccount,
      payitem.IsSAPImported,
      payitem.SAPImportedDate,
      payitem.SAPDocNo,
      payitem.SAPPostDate,
      payitem.SapImportedStatus,
      payitem.SapInFailedReason
  FROM
	  ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	   INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	  LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	  LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock po WITH (NOLOCK)
	  ON pay.OrderSysNo = po.SysNo
	  LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  ON po.VendorSysNo = vendor.SysNo
    LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
    ON curreny.SysNo = pay.CurrencySysNo
    #StrWhere1#
  UNION ALL
  SELECT
     PaySysNo = pay.SysNo,
	    PayItemSysNo = payitem.SysNo,
      OrderSysNo = vendorsettle.SysNo,
      OrderType = pay.OrderType,
      OrderID = vendorsettle.SettleID,
	  BatchNumber=null,
	  CurrencySysNo = pay.CurrencySysNo,
    CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
      PayAmt = payitem.PayAmt,
      PaySettleCompany = ISNULL(vendor.PaySettleCompany,0),
      PayStyle = payitem.PayStyle,
      VendorName = vendor.VendorName,
	    VendorSysNo = vendor.Sysno,
	    Status = payitem.Status,
      CreateTime = vendorsettle.SettleTime,
      EstimatePayTime = payitem.EstimatePayTime,
      PayTime = payitem.PayTime,
      ReferenceID = payitem.ReferenceID,
      InvoiceStatus = pay.InvoiceStatus,
      InvoiceFactStatus = pay.InvoiceFactStatus,
	    InvoiceUpdateTime = pay.InvoiceUpdateTime,
	    UpdateInvoiceUserName = sysUser.DisplayName,
	    Note = payitem.Note,
      InvoiceNumber=pay.Note,
      ReturnPoint=ISNULL(vendorsettle.UsingReturnPoint,0),
      CompanyCode = payitem.CompanyCode ,
      payitem.BankGLAccount,
      payitem.IsSAPImported,
      payitem.SAPImportedDate,
      payitem.SAPDocNo,
      payitem.SAPPostDate,
      payitem.SapImportedStatus,
      payitem.SapInFailedReason
  FROM
	  ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	  INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	  LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	    ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	  LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettle vendorsettle WITH (NOLOCK)
	    ON pay.OrderSysNo = vendorsettle.SysNo
	  LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	    ON vendorsettle.VendorSysNo = vendor.SysNo
    LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
    ON curreny.SysNo = pay.CurrencySysNo
  #StrWhere2#
  UNION ALL
  SELECT
		  PaySysNo = pay.SysNo,
	    PayItemSysNo = payitem.SysNo,
      OrderSysNo = balancesettle.SysNo,
      OrderType = pay.OrderType,
      OrderID = balancesettle.SettleBalanceID,
	  BatchNumber=null,
	  CurrencySysNo = pay.CurrencySysNo,
    CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
      PayAmt = payitem.PayAmt,
      PaySettleCompany = ISNULL(vendor.PaySettleCompany,0),
      PayStyle = payitem.PayStyle,
      VendorName = vendor.VendorName,
	    VendorSysNo = vendor.Sysno,
	    Status = payitem.Status,
      CreateTime =  balancesettle.CreateTime,
      EstimatePayTime = payitem.EstimatePayTime,
      PayTime = payitem.PayTime,
      ReferenceID = payitem.ReferenceID,
      InvoiceStatus = pay.InvoiceStatus,
      InvoiceFactStatus = pay.InvoiceFactStatus,
	    InvoiceUpdateTime = pay.InvoiceUpdateTime,
	    UpdateInvoiceUserName = sysUser.DisplayName,
	    Note = payitem.Note,
      InvoiceNumber=pay.Note,
      ReturnPoint=NULL,
      CompanyCode = payitem.CompanyCode ,
      payitem.BankGLAccount,
      payitem.IsSAPImported,
      payitem.SAPImportedDate,
      payitem.SAPDocNo,
      payitem.SAPPostDate,
      payitem.SapImportedStatus,
      payitem.SapInFailedReason
  FROM
	  ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	   INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	  LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	    ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	  LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettleBalance balancesettle WITH (NOLOCK)
	    ON pay.OrderSysNo = balancesettle.SysNo
	  LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	    ON balancesettle.VendorSysNo = vendor.SysNo
    LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
    ON curreny.SysNo = pay.CurrencySysNo
  #StrWhere3#
  UNION ALL
  SELECT
		PaySysNo = pay.SysNo,
	  PayItemSysNo = payitem.SysNo,
    OrderSysNo = invoice.InvoiceNumber,
    OrderType = pay.OrderType,
    OrderID = CAST(invoice.InvoiceNumber AS VARCHAR),
	  BatchNumber= pay.BatchNumber,
	  CurrencySysNo = pay.CurrencySysNo,
    CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
    PayAmt = payitem.PayAmt,
    PaySettleCompany = ISNULL(vendor.PaySettleCompany,0),
    PayStyle = payitem.PayStyle,
    VendorName = vendor.VendorName,
	  VendorSysNo = vendor.Sysno,
	  Status = payitem.Status,
    CreateTime =  invoice.CreateDate,
    EstimatePayTime = payitem.EstimatePayTime,
    PayTime = payitem.PayTime,
    ReferenceID = payitem.ReferenceID,
    InvoiceStatus = pay.InvoiceStatus,
    InvoiceFactStatus = pay.InvoiceFactStatus,
	  InvoiceUpdateTime = pay.InvoiceUpdateTime,
	  UpdateInvoiceUserName = sysUser.DisplayName,
	  Note = payitem.Note,
    InvoiceNumber=pay.Note,
    ReturnPoint=NULL,
    CompanyCode = payitem.CompanyCode ,
      payitem.BankGLAccount,
      payitem.IsSAPImported,
      payitem.SAPImportedDate,
      payitem.SAPDocNo,
      payitem.SAPPostDate,
      payitem.SapImportedStatus,
      payitem.SapInFailedReason
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT OUTER JOIN EIMS.dbo.EIMSInvoiceInfo invoice WITH(NOLOCK)
      ON pay.OrderSysNo = invoice.InvoiceNumber
	LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  ON invoice.VendorNumber = vendor.SysNo
  LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
    ON curreny.SysNo = pay.CurrencySysNo
  #StrWhere4#
  UNION ALL
  SELECT
    PaySysno = pay.SysNo,
    PayItemSysno = payitem.SysNo,
    OrderSysno = pay.OrderSysNo,
    OrderType = pay.OrderType,
    OrderID = CAST(pay.OrderSysNo AS VARCHAR),
	BatchNumber=null,
    CurrencySysNo = pay.CurrencySysNo,
    CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
    PayAmt = ISNULL(payitem.PayAmt,0),
    PaySettleCompany = ISNULL(vendor.PaySettleCompany,0),
    PayStyle = payitem.PayStyle,
    VendorName = vendor.VendorName,
    VendorSysno = Vendor.SysNo,
    PayStatus = payitem.Status,
    CreateTime = RMAPOR.PMDAuditTime,
    EstimatePayTime = payitem.EstimatePayTime,
    PayTime = payitem.PayTime,
    ReferenceID = payitem.ReferenceID,
    InvoiceStatus = pay.InvoiceStatus,
    InvoiceFactStatus = pay.InvoiceFactStatus,
    InvoiceUpdateTime = pay.InvoiceUpdateTime,
    UpdateInvoiceUserName = sysUser.DisplayName,
    Note = payitem.Note,
    InvoiceNumber=pay.Note,
    ReturnPoint=NULL,
    CompanyCode = payitem.CompanyCode ,
      payitem.BankGLAccount,
      payitem.IsSAPImported,
      payitem.SAPImportedDate,
      payitem.SAPDocNo,
      payitem.SAPPostDate,
      payitem.SapImportedStatus,
      payitem.SapInFailedReason
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
     INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
    INNER JOIN OverseaServiceManagement.dbo.V_SM_RMAVendorRefundMaster RMAPOR WITH (NOLOCK)
        ON  RMAPOR.SysNo = pay.OrderSysNo
    INNER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON vendor.sysno = RMAPOR.VendorSysNo
    LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
    LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
       ON curreny.SysNo = pay.CurrencySysNo
     #StrWhere5#
     UNION ALL
     SELECT
        PaySysNo = pay.SysNo,
        PayItemSysNo = payitem.SysNo,
        OrderSysNo = collectionSettle.SysNo,
        OrderType = pay.OrderType,
        OrderID = CONVERT(VARCHAR,pay.OrderSysNo),
        BatchNumber=null,
        CurrencySysNo = pay.CurrencySysNo,
        CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
        PayAmt = payitem.PayAmt,
        PaySettleCompany = ISNULL(vendor.PaySettleCompany,0),
        PayStyle = payitem.PayStyle,
        VendorName = vendor.VendorName,
        VendorSysNo = vendor.Sysno,
        Status = payitem.Status,
        CreateTime = collectionSettle.SettleDate,
        EstimatePayTime = payitem.EstimatePayTime,
        PayTime = payitem.PayTime,
        ReferenceID = payitem.ReferenceID,
        InvoiceStatus = pay.InvoiceStatus,
        InvoiceFactStatus = pay.InvoiceFactStatus,
        InvoiceUpdateTime = pay.InvoiceUpdateTime,
        UpdateInvoiceUserName = sysUser.DisplayName,
        Note = payitem.Note,
        InvoiceNumber=pay.Note,
        ReturnPoint=ISNULL(pay.EIMSAmt,0),
        CompanyCode = payitem.CompanyCode ,
      payitem.BankGLAccount,
      payitem.IsSAPImported,
      payitem.SAPImportedDate,
      payitem.SAPDocNo,
      payitem.SAPPostDate,
      payitem.SapImportedStatus,
      payitem.SapInFailedReason
      FROM ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
      INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
        ON payitem.SysNo=fpe.PayItemSysNo
      INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
        ON fpe.PaySysNo=pay.SysNo
      LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
      LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_CollectionSettlement collectionSettle WITH (NOLOCK)
        ON pay.OrderSysNo = collectionSettle.SysNo
      LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON collectionSettle.MerchantSysNo = vendor.SysNo
      LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
        ON curreny.SysNo = pay.CurrencySysNo
      #StrWhere6#
      UNION ALL
      SELECT
        PaySysNo = pay.SysNo,
        PayItemSysNo = payitem.SysNo,
        OrderSysNo = commissionMaster.SysNo,
        OrderType = pay.OrderType,
        OrderID = CONVERT(VARCHAR,pay.OrderSysNo),
        BatchNumber=null,
        CurrencySysNo = pay.CurrencySysNo,
        CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
        PayAmt = payitem.PayAmt,
        PaySettleCompany = ISNULL(vendor.PaySettleCompany,0),
        PayStyle = payitem.PayStyle,
        VendorName = vendor.VendorName,
        VendorSysNo = vendor.Sysno,
        Status = payitem.Status,
        CreateTime = commissionMaster.InDate,
        EstimatePayTime = payitem.EstimatePayTime,
        PayTime = payitem.PayTime,
        ReferenceID = payitem.ReferenceID,
        InvoiceStatus = pay.InvoiceStatus,
        InvoiceFactStatus = pay.InvoiceFactStatus,
        InvoiceUpdateTime = pay.InvoiceUpdateTime,
        UpdateInvoiceUserName = sysUser.DisplayName,
        Note = payitem.Note,
        InvoiceNumber=pay.Note,
        ReturnPoint=ISNULL(pay.EIMSAmt,0),
        CompanyCode = payitem.CompanyCode ,
      payitem.BankGLAccount,
      payitem.IsSAPImported,
      payitem.SAPImportedDate,
      payitem.SAPDocNo,
      payitem.SAPPostDate,
      payitem.SapImportedStatus,
      payitem.SapInFailedReason
      FROM ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
      INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
        ON payitem.SysNo=fpe.PayItemSysNo
      INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
        ON fpe.PaySysNo=pay.SysNo
      LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
      LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_Commission_Master commissionMaster WITH (NOLOCK)
        ON pay.OrderSysNo = commissionMaster.SysNo
      LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON commissionMaster.MerchantSysNo = vendor.SysNo
      LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
        ON curreny.SysNo = pay.CurrencySysNo
      #StrWhere7#
      
       UNION ALL
      SELECT 
    PaySysNo = pay.SysNo,
	    PayItemSysNo = payitem.SysNo, 
      OrderSysNo = paymentsettle.SysNo, 
      OrderType = pay.OrderType,
      OrderID = paymentsettle.SettleID,
	  BatchNumber=null,
	  CurrencySysNo = pay.CurrencySysNo, 
    CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
      PayAmt = payitem.PayAmt, 
      PaySettleCompany = ISNULL(vendor.PaySettleCompany,0),
      PayStyle = payitem.PayStyle,
      VendorName = vendor.VendorName,
	    VendorSysNo = vendor.Sysno,
	    Status = payitem.Status, 
      CreateTime = paymentsettle.SettleTime, 
      EstimatePayTime = payitem.EstimatePayTime, 
      PayTime = payitem.PayTime, 
      ReferenceID = payitem.ReferenceID,
      InvoiceStatus = pay.InvoiceStatus,
        InvoiceFactStatus = pay.InvoiceFactStatus,
	    InvoiceUpdateTime = pay.InvoiceUpdateTime,
	    UpdateInvoiceUserName = sysUser.DisplayName,
	    Note = payitem.Note,
      InvoiceNumber=pay.Note,
      ReturnPoint=ISNULL(pay.EIMSAmt,0),
      CompanyCode = payitem.CompanyCode ,
      payitem.BankGLAccount,
      payitem.IsSAPImported,
      payitem.SAPImportedDate,
      payitem.SAPDocNo,
      payitem.SAPPostDate,
      payitem.SapImportedStatus,
      payitem.SapInFailedReason 	
FROM 
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK) 
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_POCollectionPayment_Settle paymentsettle WITH (NOLOCK) 
	  ON pay.OrderSysNo = paymentsettle.SysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK) 
	  ON paymentsettle.VendorSysNo = vendor.SysNo	
  LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
    ON curreny.SysNo = pay.CurrencySysNo
#StrWhere8#

    UNION ALL
    SELECT 
		PaySysNo = pay.SysNo,
		PayItemSysNo = payitem.SysNo, 
      OrderSysNo = cc.SysNo, 
      OrderType = pay.OrderType,
      OrderID = CONVERT(VARCHAR,cc.SysNo),
	  BatchNumber=null,
	  CurrencySysNo = pay.CurrencySysNo, 
      CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
      PayAmt = payitem.PayAmt, 
      PaySettleCompany = ISNULL(vendor.PaySettleCompany,0),
      PayStyle = payitem.PayStyle,
      VendorName = vendor.VendorName,
	    VendorSysNo = vendor.Sysno,
	    Status = payitem.Status, 
      CreateTime = cc.AuditDate, 
      EstimatePayTime = payitem.EstimatePayTime, 
      PayTime = payitem.PayTime, 
      ReferenceID = payitem.ReferenceID,
      InvoiceStatus = pay.InvoiceStatus,
        InvoiceFactStatus = pay.InvoiceFactStatus,
	    InvoiceUpdateTime = pay.InvoiceUpdateTime,
	    UpdateInvoiceUserName = sysUser.DisplayName,
	    Note = payitem.Note,
      InvoiceNumber=pay.Note,
      ReturnPoint=ISNULL(pay.EIMSAmt,0),
      CompanyCode = payitem.CompanyCode ,
      payitem.BankGLAccount,
      payitem.IsSAPImported,
      payitem.SAPImportedDate,
      payitem.SAPDocNo,
      payitem.SAPPostDate,
      payitem.SapImportedStatus,
      payitem.SapInFailedReason 	
FROM 
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK) 
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT JOIN OverseaPOASNManagement.dbo.CostChange cc WITH (NOLOCK) 
	  ON pay.OrderSysNo = cc.SysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK) 
	  ON cc.VendorSysNo = vendor.SysNo	
  LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
    ON curreny.SysNo = pay.CurrencySysNo
#StrWhere9#
) A
) Result
LEFT OUTER JOIN (
    SELECT
        SettleSysNo
    FROM OverseaPOASNManagement.dbo.V_POConsign_Settle_Item  WITH(NOLOCK)
    WHERE
        POConsignToAccLogSysNo IS NOT NULL
    GROUP BY SettleSysNo
 ) settleitem
     ON settleitem.SettleSysNo = RESULT.OrderSysNo
WHERE RowNumber > @StartNumber


SELECT
     @AllPayAmt = SUM(PayAmt)
FROM(
SELECT
      PayAmt = ISNULL(payitem.PayAmt,0)
  FROM
	  ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	   INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	  LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock po WITH (NOLOCK)
	  ON pay.OrderSysNo = po.SysNo
	  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  ON po.VendorSysNo = vendor.SysNo
    #StrWhere1#
  UNION ALL
  SELECT
      PayAmt = payitem.PayAmt
  FROM
	  ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	  INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	  LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	    ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettle vendorsettle WITH (NOLOCK)
	    ON pay.OrderSysNo = vendorsettle.SysNo
	  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	    ON vendorsettle.VendorSysNo = vendor.SysNo
  #StrWhere2#
  UNION ALL
  SELECT
      PayAmt = payitem.PayAmt
  FROM
	  ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	   INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	  LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	    ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettleBalance balancesettle WITH (NOLOCK)
	    ON pay.OrderSysNo = balancesettle.SysNo
	  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	    ON balancesettle.VendorSysNo = vendor.SysNo
  #StrWhere3#
  UNION ALL
  SELECT
    PayAmt = payitem.PayAmt
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT JOIN EIMS.dbo.EIMSInvoiceInfo invoice WITH(NOLOCK)
       ON pay.OrderSysNo = invoice.InvoiceNumber
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  ON invoice.VendorNumber = vendor.SysNo
  #StrWhere4#
  UNION ALL
  SELECT
    PayAmt = ISNULL(payitem.PayAmt,0)
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
     INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
    INNER JOIN OverseaServiceManagement.dbo.V_SM_RMAVendorRefundMaster RMAPOR WITH (NOLOCK)
        ON  RMAPOR.SysNo = pay.OrderSysNo
    INNER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON vendor.sysno = RMAPOR.VendorSysNo
    LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
     #StrWhere5#
  UNION ALL
     SELECT
        PayAmt = ISNULL(payitem.PayAmt,0)
    FROM ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
    INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
      ON payitem.SysNo=fpe.PayItemSysNo
    INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
      ON fpe.PaySysNo=pay.SysNo
    LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
      ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
    LEFT JOIN OverseaPOASNManagement.dbo.V_CollectionSettlement collectionSettle WITH (NOLOCK)
      ON pay.OrderSysNo = collectionSettle.SysNo
    LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
      ON collectionSettle.MerchantSysNo = vendor.SysNo
  #StrWhere6#
  UNION ALL
  SELECT
      PayAmt = ISNULL(payitem.PayAmt,0)
  FROM ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
  INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
    ON payitem.SysNo=fpe.PayItemSysNo
  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
    ON fpe.PaySysNo=pay.SysNo
  LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
    ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
  LEFT JOIN OverseaPOASNManagement.dbo.V_Commission_Master commissionMaster WITH (NOLOCK)
    ON pay.OrderSysNo = commissionMaster.SysNo
  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
    ON commissionMaster.MerchantSysNo = vendor.SysNo
  #StrWhere7#
  
  UNION ALL
  SELECT
      PayAmt = ISNULL(payitem.PayAmt,0)
  FROM ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
  INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
    ON payitem.SysNo=fpe.PayItemSysNo
  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
    ON fpe.PaySysNo=pay.SysNo
  LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
    ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_POCollectionPayment_Settle paymentsettle WITH (NOLOCK) 
	  ON pay.OrderSysNo = paymentsettle.SysNo
  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
    ON paymentsettle.VendorSysNo = vendor.SysNo
  #StrWhere8#

  UNION ALL
  SELECT
      PayAmt = ISNULL(payitem.PayAmt,0)
  FROM ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
  INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
    ON payitem.SysNo=fpe.PayItemSysNo
  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
    ON fpe.PaySysNo=pay.SysNo
  LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
    ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
  LEFT JOIN OverseaPOASNManagement.dbo.CostChange cc WITH (NOLOCK)
    ON pay.OrderSysNo = cc.SysNo
  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
    ON cc.VendorSysNo = vendor.SysNo
  #StrWhere9#
) B
			  ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetCommonPayItemList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT @TotalCount = COUNT(payitem.SysNo)
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
    INNER JOIN OverseaInvoiceReceiptManagement.dbo.V_PayBizAdapter biz WITH (NOLOCK)
  ON pay.OrderSysNo = biz.OrderSysNo and biz.orderType=pay.OrderType
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo  
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	ON biz.VendorSysNo = vendor.SysNo
#StrWhere#

SELECT
	  PaySysNo,
	  PayItemSysNo,
    OrderSysNo,
    OrderType,
    OrderID,
    BatchNumber,
	  CurrencySysNo,
    CurrencyDesc,
    PayAmt,
    PaySettleCompany,
    PayStyle,
    VendorName,
	  VendorSysNo,
	  Status,
    CreateTime,
    EstimatePayTime,
    PayTime,
    ReferenceID,
    InvoiceStatus,
    InvoiceFactStatus,
	  InvoiceUpdateTime,
	  UpdateInvoiceUserName,
	  Note,
    InvoiceNumber,
    ReturnPoint,
    CompanyCode,
      BankGLAccount,
      IsSAPImported,
      SAPImportedDate,
      SAPDocNo,
      SAPPostDate,
      SapImportedStatus,
      SapInFailedReason
FROM (
SELECT TOP (@EndNumber)
    PaySysNo = pay.SysNo,
	  PayItemSysNo = payitem.SysNo,
    OrderSysNo = biz.OrderSysNo,
    OrderType = pay.OrderType,
    OrderID = biz.OrderSysNo,
    BatchNumber =  null,
	  CurrencySysNo = pay.CurrencySysNo,
    CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
    PayAmt = payitem.PayAmt,
    PaySettleCompany = vendor.PaySettleCompany,
    PayStyle = payitem.PayStyle,
    VendorName = vendor.VendorName,
	  VendorSysNo = vendor.Sysno,
	  Status = payitem.Status,
    CreateTime =  payitem.CreateTime,
    EstimatePayTime = payitem.EstimatePayTime,
    PayTime = payitem.PayTime,
    ReferenceID = payitem.ReferenceID,
    InvoiceStatus = pay.InvoiceStatus,
    InvoiceFactStatus = pay.InvoiceFactStatus,
	  InvoiceUpdateTime = pay.InvoiceUpdateTime,
	  UpdateInvoiceUserName = sysUser.DisplayName,
	  Note = payitem.Note,
    InvoiceNumber=pay.Note,
    ReturnPoint=NULL,
    CompanyCode = payitem.CompanyCode,
      payitem.BankGLAccount,
      payitem.IsSAPImported,
      payitem.SAPImportedDate,
      payitem.SAPDocNo,
      payitem.SAPPostDate,
      payitem.SapImportedStatus,
      payitem.SapInFailedReason ,
	  (ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
    INNER JOIN OverseaInvoiceReceiptManagement.dbo.V_PayBizAdapter biz WITH (NOLOCK)
  ON pay.OrderSysNo = biz.OrderSysNo and biz.orderType=pay.OrderType
	LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo	
	LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  ON biz.VendorSysNo = vendor.SysNo
  LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
    ON curreny.SysNo = pay.CurrencySysNo
#StrWhere#
) Result
WHERE RowNumber > @StartNumber

SELECT
    @AllPayAmt = SUM(round(payitem.PayAmt,2))
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
    INNER JOIN OverseaInvoiceReceiptManagement.dbo.V_PayBizAdapter biz WITH (NOLOCK)
  ON pay.OrderSysNo = biz.OrderSysNo and biz.orderType=pay.OrderType
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo	
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  ON biz.VendorSysNo = vendor.SysNo
#StrWhere#
			  ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetCommissionMasterOrderPayItemList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT @TotalCount = COUNT(payitem.SysNo)
        FROM ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	      INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		      ON payitem.SysNo=fpe.PayItemSysNo
	      INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		      ON fpe.PaySysNo=pay.SysNo
	      LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
		      ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	      LEFT JOIN OverseaPOASNManagement.dbo.V_Commission_Master commissionMaster WITH (NOLOCK)
		      ON pay.OrderSysNo = commissionMaster.SysNo
	      LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
		      ON commissionMaster.MerchantSysNo = vendor.SysNo
        #StrWhere#

        SELECT
	          PaySysNo,
	          PayItemSysNo,
            OrderSysNo,
            OrderType,
            OrderID,
            BatchNumber,
	          CurrencySysNo,
            CurrencyDesc,
            PayAmt,
            PaySettleCompany,
            PayStyle,
            VendorName,
  	        VendorSysNo,
	          Status,
            CreateTime,
            EstimatePayTime,
            PayTime,
            ReferenceID,
            InvoiceStatus,
            InvoiceFactStatus,
	          InvoiceUpdateTime,
	          UpdateInvoiceUserName,
	          Note,
            InvoiceNumber,
            ReturnPoint,
            CompanyCode,
      BankGLAccount,
      IsSAPImported,
      SAPImportedDate,
      SAPDocNo,
      SAPPostDate,
      SapImportedStatus,
      SapInFailedReason
        FROM (
          SELECT TOP (@EndNumber)
            PaySysNo = pay.SysNo,
            PayItemSysNo = payitem.SysNo,
            OrderSysNo = commissionMaster.SysNo,
            OrderType = pay.OrderType,
            OrderID = CONVERT(VARCHAR,commissionMaster.SysNo),
            BatchNumber =  null,
            CurrencySysNo = pay.CurrencySysNo,
            CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
            PayAmt = payitem.PayAmt,
            PaySettleCompany = vendor.PaySettleCompany,
            PayStyle = payitem.PayStyle,
            VendorName = vendor.VendorName,
            VendorSysNo = vendor.Sysno,
            Status = payitem.Status,
            CreateTime = commissionMaster.InDate,
            EstimatePayTime = payitem.EstimatePayTime,
            PayTime = payitem.PayTime,
            ReferenceID = payitem.ReferenceID,
            InvoiceStatus = pay.InvoiceStatus,
            InvoiceFactStatus = pay.InvoiceFactStatus,
            InvoiceUpdateTime = pay.InvoiceUpdateTime,
            UpdateInvoiceUserName = sysUser.DisplayName,
            Note = payitem.Note,
            InvoiceNumber=pay.Note,
            ReturnPoint=ISNULL(pay.EIMSAmt,0),
            CompanyCode = payitem.CompanyCode,
      payitem.BankGLAccount,
      payitem.IsSAPImported,
      payitem.SAPImportedDate,
      payitem.SAPDocNo,
      payitem.SAPPostDate,
      payitem.SapImportedStatus,
      payitem.SapInFailedReason  ,
            (ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
          FROM ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
          INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
            ON payitem.SysNo=fpe.PayItemSysNo
          INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
            ON fpe.PaySysNo=pay.SysNo
          LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
            ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
          LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_Commission_Master commissionMaster WITH (NOLOCK)
            ON pay.OrderSysNo = commissionMaster.SysNo
          LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
            ON commissionMaster.MerchantSysNo = vendor.SysNo
          LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
            ON curreny.SysNo = pay.CurrencySysNo
          #StrWhere#
        ) Result
        WHERE RowNumber > @StartNumber

          SELECT
              @AllPayAmt = SUM(round(payitem.PayAmt,2))
          FROM ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
          INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
            ON payitem.SysNo=fpe.PayItemSysNo
          INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
            ON fpe.PaySysNo=pay.SysNo
          LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
            ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
          LEFT JOIN OverseaPOASNManagement.dbo.V_Commission_Master commissionMaster WITH (NOLOCK)
            ON pay.OrderSysNo = commissionMaster.SysNo
          LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
            ON commissionMaster.MerchantSysNo = vendor.SysNo
          #StrWhere#
			  ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetCollectionSettleOrderPayItemList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT @TotalCount = COUNT(payitem.SysNo)
        FROM ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
        INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
          ON payitem.SysNo=fpe.PayItemSysNo
        INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
          ON fpe.PaySysNo=pay.SysNo
        LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
          ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
        LEFT JOIN OverseaPOASNManagement.dbo.V_CollectionSettlement collectionSettle WITH (NOLOCK)
          ON pay.OrderSysNo = collectionSettle.SysNo
        LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
          ON collectionSettle.MerchantSysNo = vendor.SysNo
        #StrWhere#

        SELECT
	          PaySysNo,
	          PayItemSysNo,
            OrderSysNo,
            OrderType,
            OrderID,
            BatchNumber,
	          CurrencySysNo,
            CurrencyDesc,
            PayAmt,
            PaySettleCompany,
            PayStyle,
            VendorName,
  	        VendorSysNo,
	          Status,
            CreateTime,
            EstimatePayTime,
            PayTime,
            ReferenceID,
            InvoiceStatus,
            InvoiceFactStatus,
	          InvoiceUpdateTime,
	          UpdateInvoiceUserName,
	          Note,
            InvoiceNumber,
            ReturnPoint,
            CompanyCode,
      BankGLAccount,
      IsSAPImported,
      SAPImportedDate,
      SAPDocNo,
      SAPPostDate,
      SapImportedStatus,
      SapInFailedReason
        FROM (
          SELECT TOP (@EndNumber)
	          PaySysNo = pay.SysNo,
	          PayItemSysNo = payitem.SysNo,
	          OrderSysNo = collectionSettle.SysNo,
	          OrderType = pay.OrderType,
	          OrderID = CONVERT(VARCHAR,collectionSettle.SysNo),
            BatchNumber = null,
	          CurrencySysNo = pay.CurrencySysNo,
            CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
	          PayAmt = payitem.PayAmt,
            PaySettleCompany = vendor.PaySettleCompany,
	          PayStyle = payitem.PayStyle,
	          VendorName = vendor.VendorName,
	          VendorSysNo = vendor.Sysno,
	          Status = payitem.Status,
	          CreateTime = collectionSettle.SettleDate,
	          EstimatePayTime = payitem.EstimatePayTime,
	          PayTime = payitem.PayTime,
	          ReferenceID = payitem.ReferenceID,
	          InvoiceStatus = pay.InvoiceStatus,
            InvoiceFactStatus = pay.InvoiceFactStatus,
	          InvoiceUpdateTime = pay.InvoiceUpdateTime,
	          UpdateInvoiceUserName = sysUser.DisplayName,
	          Note = payitem.Note,
	          InvoiceNumber=pay.Note,
	          ReturnPoint=ISNULL(pay.EIMSAmt,0),
	          CompanyCode = payitem.CompanyCode,
      payitem.BankGLAccount,
      payitem.IsSAPImported,
      payitem.SAPImportedDate,
      payitem.SAPDocNo,
      payitem.SAPPostDate,
      payitem.SapImportedStatus,
      payitem.SapInFailedReason,
            (ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
          FROM ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
          INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
	          ON payitem.SysNo=fpe.PayItemSysNo
          INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
	          ON fpe.PaySysNo=pay.SysNo
          LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	          ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
          LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_CollectionSettlement collectionSettle WITH (NOLOCK)
	          ON pay.OrderSysNo = collectionSettle.SysNo
          LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	          ON collectionSettle.MerchantSysNo = vendor.SysNo
          LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
            ON curreny.SysNo = pay.CurrencySysNo
          #StrWhere#
        ) Result
        WHERE RowNumber > @StartNumber

          SELECT
              @AllPayAmt = SUM(round(payitem.PayAmt,2))
          FROM ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
          INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
	          ON payitem.SysNo=fpe.PayItemSysNo
          INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
	          ON fpe.PaySysNo=pay.SysNo
          LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	          ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
          LEFT JOIN OverseaPOASNManagement.dbo.V_CollectionSettlement collectionSettle WITH (NOLOCK)
	          ON pay.OrderSysNo = collectionSettle.SysNo
          LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	          ON collectionSettle.MerchantSysNo = vendor.SysNo
          #StrWhere#
			  ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetRMAPORPayItemList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT @TotalCount = COUNT(payitem.SysNo)
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
     INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
    INNER JOIN OverseaServiceManagement.dbo.V_SM_RMAVendorRefundMaster RMAPOR WITH (NOLOCK)
        ON  RMAPOR.SysNo = pay.OrderSysNo
    INNER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON vendor.sysno = RMAPOR.VendorSysNo
    LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
#StrWhere#

SELECT
	  PaySysNo,
	  PayItemSysNo,
    OrderSysNo,
    OrderType,
    OrderID,
    BatchNumber,
	  CurrencySysNo,
    CurrencyDesc,
    PayAmt,
    PaySettleCompany,
    PayStyle,
    VendorName,
	  VendorSysNo,
	  Status,
    CreateTime,
    EstimatePayTime,
    PayTime,
    ReferenceID,
    InvoiceStatus,
    InvoiceFactStatus,
	  InvoiceUpdateTime,
	  UpdateInvoiceUserName,
	  Note,
    InvoiceNumber,
    ReturnPoint,
    CompanyCode,
      BankGLAccount,
      IsSAPImported,
      SAPImportedDate,
      SAPDocNo,
      SAPPostDate,
      SapImportedStatus,
      SapInFailedReason
FROM (
SELECT TOP (@EndNumber)
    PaySysno = pay.SysNo,
    PayItemSysno = payitem.SysNo,
    OrderSysno = pay.OrderSysNo,
    OrderType = pay.OrderType,
    OrderID = CAST(pay.OrderSysNo AS VARCHAR),
    BatchNumber =  null,
    CurrencySysNo = pay.CurrencySysNo,
    CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
    PayAmt = ISNULL(payitem.PayAmt,0),
    PaySettleCompany = ISNULL(vendor.PaySettleCompany,0),
    PayStyle = payitem.PayStyle,
    VendorName = vendor.VendorName,
    VendorSysno = Vendor.SysNo,
    Status = payitem.Status,
    CreateTime = RMAPOR.PMDAuditTime,
    EstimatePayTime = payitem.EstimatePayTime,
    PayTime = payitem.PayTime,
    ReferenceID = payitem.ReferenceID,
    InvoiceStatus = pay.InvoiceStatus,
    InvoiceFactStatus = pay.InvoiceFactStatus,
    InvoiceUpdateTime = pay.InvoiceUpdateTime,
    UpdateInvoiceUserName = sysUser.DisplayName,
    Note = payitem.Note,
    InvoiceNumber=pay.Note,
    ReturnPoint=NULL,
    CompanyCode = payitem.CompanyCode,
      payitem.BankGLAccount,
      payitem.IsSAPImported,
      payitem.SAPImportedDate,
      payitem.SAPDocNo,
      payitem.SAPPostDate,
      payitem.SapImportedStatus,
      payitem.SapInFailedReason,
	  (ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
     INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
    INNER JOIN OverseaServiceManagement.dbo.V_SM_RMAVendorRefundMaster RMAPOR WITH (NOLOCK)
        ON  RMAPOR.SysNo = pay.OrderSysNo
    INNER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON vendor.sysno = RMAPOR.VendorSysNo
    LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
       ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
    LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
       ON curreny.SysNo = pay.CurrencySysNo
#StrWhere#
) Result
WHERE RowNumber > @StartNumber

SELECT
    @AllPayAmt = SUM(round( ISNULL(payitem.PayAmt,0),2))
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
     INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
    INNER JOIN OverseaServiceManagement.dbo.V_SM_RMAVendorRefundMaster RMAPOR WITH (NOLOCK)
        ON  RMAPOR.SysNo = pay.OrderSysNo
    INNER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON vendor.sysno = RMAPOR.VendorSysNo
    LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
#StrWhere#
			  ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetReturnPointCashSettlePayItemList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT @TotalCount = COUNT(payitem.SysNo)
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	INNER JOIN EIMS.dbo.EIMSInvoiceInfo invoice WITH(NOLOCK)
      ON pay.OrderSysNo = invoice.InvoiceNumber
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	    ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	    ON invoice.VendorNumber = vendor.SysNo
#StrWhere#

SELECT
	  PaySysNo,
	  PayItemSysNo,
    OrderSysNo,
    OrderType,
    OrderID,
    BatchNumber,
	  CurrencySysNo,
    CurrencyDesc,
    PayAmt,
    PaySettleCompany,
    PayStyle,
    VendorName,
	  VendorSysNo,
	  Status,
    CreateTime,
    EstimatePayTime,
    PayTime,
    ReferenceID,
    InvoiceStatus,
    InvoiceFactStatus,
	  InvoiceUpdateTime,
	  UpdateInvoiceUserName,
	  Note,
    InvoiceNumber,
    ReturnPoint,
    CompanyCode,
      BankGLAccount,
      IsSAPImported,
      SAPImportedDate,
      SAPDocNo,
      SAPPostDate,
      SapImportedStatus,
      SapInFailedReason
FROM (
SELECT TOP (@EndNumber)
    PaySysNo = pay.SysNo,
	  PayItemSysNo = payitem.SysNo,
    OrderSysNo = invoice.InvoiceNumber,
    OrderType = pay.OrderType,
    OrderID = invoice.InvoiceNumber,
    BatchNumber = pay.BatchNumber,
	  CurrencySysNo = pay.CurrencySysNo,
    CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
    PayAmt = payitem.PayAmt,
    PaySettleCompany = vendor.PaySettleCompany,
    PayStyle = payitem.PayStyle,
    VendorName = vendor.VendorName,
	  VendorSysNo = vendor.Sysno,
	  Status = payitem.Status,
    CreateTime =  invoice.CreateDate,
    EstimatePayTime = payitem.EstimatePayTime,
    PayTime = payitem.PayTime,
    ReferenceID = payitem.ReferenceID,
    InvoiceStatus = pay.InvoiceStatus,
    InvoiceFactStatus = pay.InvoiceFactStatus,
	  InvoiceUpdateTime = pay.InvoiceUpdateTime,
	  UpdateInvoiceUserName = sysUser.DisplayName,
	  Note = payitem.Note,
    InvoiceNumber=pay.Note,
    ReturnPoint=NULL,
    CompanyCode = payitem.CompanyCode,
      payitem.BankGLAccount,
      payitem.IsSAPImported,
      payitem.SAPImportedDate,
      payitem.SAPDocNo,
      payitem.SAPPostDate,
      payitem.SapImportedStatus,
      payitem.SapInFailedReason,
	(ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	INNER JOIN EIMS.dbo.EIMSInvoiceInfo invoice WITH(NOLOCK)
      ON pay.OrderSysNo = invoice.InvoiceNumber
	LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  ON invoice.VendorNumber = vendor.SysNo
  LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
    ON curreny.SysNo = pay.CurrencySysNo
#StrWhere#
) Result
WHERE RowNumber > @StartNumber

SELECT
    @AllPayAmt = SUM(round(payitem.PayAmt,2))
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT JOIN EIMS.dbo.EIMSInvoiceInfo invoice WITH(NOLOCK)
      ON pay.OrderSysNo = invoice.InvoiceNumber
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  ON invoice.VendorNumber = vendor.SysNo
#StrWhere#

			  ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetVendorSettleOrderPayItemList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT @TotalCount = COUNT(payitem.SysNo)
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettle vendorsettle WITH (NOLOCK)
	  ON pay.OrderSysNo = vendorsettle.SysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  ON vendorsettle.VendorSysNo = vendor.SysNo
#StrWhere#

SELECT
	  PaySysNo,
	  PayItemSysNo,
    OrderSysNo,
    OrderType,
    OrderID,
    BatchNumber,
	  CurrencySysNo,
    CurrencyDesc,
    PayAmt,
    PaySettleCompany,
    PayStyle,
    VendorName,
  	VendorSysNo,
	  Status,
    CreateTime,
    EstimatePayTime,
    PayTime,
    ReferenceID,
    InvoiceStatus,
    InvoiceFactStatus,
	  InvoiceUpdateTime,
	  UpdateInvoiceUserName,
	  Note,
    InvoiceNumber,
    ReturnPoint,
    CompanyCode,
      BankGLAccount,
      IsSAPImported,
      SAPImportedDate,
      SAPDocNo,
      SAPPostDate,
      SapImportedStatus,
      SapInFailedReason,
      IsOldConsignSettle
FROM (
SELECT TOP (@EndNumber)
    PaySysNo = pay.SysNo,
	  PayItemSysNo = payitem.SysNo,
    OrderSysNo = vendorsettle.SysNo,
    OrderType = pay.OrderType,
    OrderID = vendorsettle.SettleID,
    BatchNumber = null,
	  CurrencySysNo = pay.CurrencySysNo,
    CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
    PayAmt = payitem.PayAmt,
    PaySettleCompany = vendor.PaySettleCompany,
    PayStyle = payitem.PayStyle,
    VendorName = vendor.VendorName,
	  VendorSysNo = vendor.Sysno,
	  Status = payitem.Status,
    CreateTime = vendorsettle.SettleTime,
    EstimatePayTime = payitem.EstimatePayTime,
    PayTime = payitem.PayTime,
    ReferenceID = payitem.ReferenceID,
    InvoiceStatus = pay.InvoiceStatus,
    InvoiceFactStatus = pay.InvoiceFactStatus,
	  InvoiceUpdateTime = pay.InvoiceUpdateTime,
	  UpdateInvoiceUserName = sysUser.DisplayName,
	  Note = payitem.Note,
    InvoiceNumber=pay.Note,
    ReturnPoint=ISNULL(vendorsettle.UsingReturnPoint,0),
    CompanyCode = payitem.CompanyCode,
      payitem.BankGLAccount,
      payitem.IsSAPImported,
      payitem.SAPImportedDate,
      payitem.SAPDocNo,
      payitem.SAPPostDate,
      payitem.SapImportedStatus,
      payitem.SapInFailedReason,
     CASE WHEN EXISTS  (SELECT TOP 1 1 FROM OverseaPOASNManagement.dbo.V_POConsign_Settle_Item  WITH(NOLOCK)
      WHERE SettleSysNo = vendorsettle.SysNo AND POConsignToAccLogSysNo IS NOT NULL)
      THEN 1 ELSE 0
     END AS IsOldConsignSettle,
	(ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettle vendorsettle WITH (NOLOCK)
	  ON pay.OrderSysNo = vendorsettle.SysNo
	LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  ON vendorsettle.VendorSysNo = vendor.SysNo
  LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
    ON curreny.SysNo = pay.CurrencySysNo
#StrWhere#
) Result
WHERE RowNumber > @StartNumber

SELECT
    @AllPayAmt = SUM(round(payitem.PayAmt,2))
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettle vendorsettle WITH (NOLOCK)
	  ON pay.OrderSysNo = vendorsettle.SysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  ON vendorsettle.VendorSysNo = vendor.SysNo
#StrWhere#
			      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetPOPayItemList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT @TotalCount = COUNT(payitem.SysNo)
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	    ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock po WITH (NOLOCK)
	    ON pay.OrderSysNo = po.SysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	    ON po.VendorSysNo = vendor.SysNo
#StrWhere#

SELECT
	  PaySysNo,
	  PayItemSysNo,
    OrderSysNo,
    OrderType,
    OrderID,
    BatchNumber,
	  CurrencySysNo,
    CurrencyDesc,
    PayAmt,
    PaySettleCompany,
    PayStyle,
    VendorName,
	  VendorSysNo,
	  Status,
    CreateTime,
    EstimatePayTime,
    PayTime,
    ReferenceID,
    InvoiceStatus,
    InvoiceFactStatus,
	  InvoiceUpdateTime,
	  UpdateInvoiceUserName,
	  Note,
    InvoiceNumber,
    ReturnPoint,
    CompanyCode,
      BankGLAccount,
      IsSAPImported,
      SAPImportedDate,
      SAPDocNo,
      SAPPostDate,
      SapImportedStatus,
      SapInFailedReason
FROM (
SELECT TOP (@EndNumber)
    PaySysNo = pay.SysNo,
	  PayItemSysNo = payitem.SysNo,
    OrderSysNo = po.SysNo,
    OrderType = pay.OrderType,
    OrderID = po.poid,
    BatchNumber =pay.BatchNumber,
	  CurrencySysNo = pay.CurrencySysNo,
    CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
    PayAmt = ISNULL(payitem.PayAmt,0),
    PaySettleCompany = ISNULL(vendor.PaySettleCompany,0),
    PayStyle = payitem.PayStyle,
    VendorName = vendor.VendorName,
	  VendorSysNo = Vendor.SysNo,
	  Status = payitem.Status,
    payitem.CreateTime,
    EstimatePayTime = payitem.EstimatePayTime,
    PayTime = payitem.PayTime,
    ReferenceID = payitem.ReferenceID,
    InvoiceStatus = pay.InvoiceStatus,
    InvoiceFactStatus = pay.InvoiceFactStatus,
	  InvoiceUpdateTime = pay.InvoiceUpdateTime,
	  UpdateInvoiceUserName = sysUser.DisplayName,
	  Note = payitem.Note,
    InvoiceNumber = pay.Note,
    ReturnPoint=ISNULL(pay.EIMSAmt,0),
    CompanyCode = payitem.CompanyCode,
      payitem.BankGLAccount,
      payitem.IsSAPImported,
      payitem.SAPImportedDate,
      payitem.SAPDocNo,
      payitem.SAPPostDate,
      payitem.SapImportedStatus,
      payitem.SapInFailedReason  ,
	  (ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	    ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock po WITH (NOLOCK)
	    ON pay.OrderSysNo = po.SysNo
	LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	    ON po.VendorSysNo = vendor.SysNo
  LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
    ON curreny.SysNo = pay.CurrencySysNo
#StrWhere#
) Result
WHERE RowNumber > @StartNumber

SELECT
    @AllPayAmt = SUM(round( ISNULL(payitem.PayAmt,0),2))
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	    ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock po WITH (NOLOCK)
	    ON pay.OrderSysNo = po.SysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	    ON po.VendorSysNo = vendor.SysNo
#StrWhere#
]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetCCPayItemList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
        SELECT @TotalCount = COUNT(payitem.SysNo)
        FROM ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
        INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
          ON payitem.SysNo=fpe.PayItemSysNo
        INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
          ON fpe.PaySysNo=pay.SysNo
        LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
          ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
        LEFT JOIN OverseaPOASNManagement.dbo.CostChange cc WITH (NOLOCK)
          ON pay.OrderSysNo = cc.SysNo
        LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
          ON cc.VendorSysNo = vendor.SysNo
        #StrWhere#

        SELECT
	          PaySysNo,
	          PayItemSysNo,
            OrderSysNo,
            OrderType,
            OrderID,
            BatchNumber,
	          CurrencySysNo,
            CurrencyDesc,
            PayAmt,
            PaySettleCompany,
            PayStyle,
            VendorName,
  	        VendorSysNo,
	          Status,
            CreateTime,
            EstimatePayTime,
            PayTime,
            ReferenceID,
            InvoiceStatus,
            InvoiceFactStatus,
	          InvoiceUpdateTime,
	          UpdateInvoiceUserName,
	          Note,
            InvoiceNumber,
            ReturnPoint,
            CompanyCode,
            BankGLAccount,
            IsSAPImported,
            SAPImportedDate,
            SAPDocNo,
            SAPPostDate,
            SapImportedStatus,
            SapInFailedReason
        FROM (
          SELECT TOP (@EndNumber)
	          PaySysNo = pay.SysNo,
	          PayItemSysNo = payitem.SysNo,
	          OrderSysNo = cc.SysNo,
	          OrderType = pay.OrderType,
	          OrderID = CONVERT(VARCHAR,cc.SysNo),
            BatchNumber = null,
	          CurrencySysNo = pay.CurrencySysNo,
            CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
	          PayAmt = payitem.PayAmt,
            PaySettleCompany = vendor.PaySettleCompany,
	          PayStyle = payitem.PayStyle,
	          VendorName = vendor.VendorName,
	          VendorSysNo = vendor.Sysno,
	          Status = payitem.Status,
	          CreateTime = cc.AuditDate,
	          EstimatePayTime = payitem.EstimatePayTime,
	          PayTime = payitem.PayTime,
	          ReferenceID = payitem.ReferenceID,
	          InvoiceStatus = pay.InvoiceStatus,
            InvoiceFactStatus = pay.InvoiceFactStatus,
	          InvoiceUpdateTime = pay.InvoiceUpdateTime,
	          UpdateInvoiceUserName = sysUser.DisplayName,
	          Note = payitem.Note,
	          InvoiceNumber=pay.Note,
	          ReturnPoint=ISNULL(pay.EIMSAmt,0),
	          CompanyCode = payitem.CompanyCode,
            payitem.BankGLAccount,
            payitem.IsSAPImported,
            payitem.SAPImportedDate,
            payitem.SAPDocNo,
            payitem.SAPPostDate,
            payitem.SapImportedStatus,
            payitem.SapInFailedReason,
            (ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
          FROM ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
          INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
	          ON payitem.SysNo=fpe.PayItemSysNo
          INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
	          ON fpe.PaySysNo=pay.SysNo
          LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	          ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
          LEFT OUTER JOIN OverseaPOASNManagement.dbo.CostChange cc WITH (NOLOCK)
	          ON pay.OrderSysNo = cc.SysNo
          LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	          ON cc.VendorSysNo = vendor.SysNo
          LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
            ON curreny.SysNo = pay.CurrencySysNo
          #StrWhere#
        ) Result
        WHERE RowNumber > @StartNumber

          SELECT
              @AllPayAmt = SUM(round(payitem.PayAmt,2))
          FROM ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
          INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
	          ON payitem.SysNo=fpe.PayItemSysNo
          INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
	          ON fpe.PaySysNo=pay.SysNo
          LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH(NOLOCK)
	          ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
          LEFT OUTER JOIN OverseaPOASNManagement.dbo.CostChange cc WITH(NOLOCK)
	          ON pay.OrderSysNo = cc.SysNo
          LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH(NOLOCK)
	          ON cc.VendorSysNo = vendor.SysNo
          #StrWhere#
			  ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetPOETPPayItemList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[

SELECT @TotalCount = COUNT(PayItemSysNo)
FROM
(
SELECT
	  PayItemSysNo = payitem.SysNo,
	  VendorSysno = Vendor.SysNo
  FROM
	  ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	  INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	  LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock po WITH (NOLOCK)
	  ON pay.OrderSysNo = po.SysNo
	  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  ON po.VendorSysNo = vendor.SysNo
    #StrWhere1#
  UNION ALL
  SELECT
	   PayItemSysNo = payitem.SysNo,
	   VendorSysno = Vendor.SysNo
  FROM
	  ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	  INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	  LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	    ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock po WITH (NOLOCK)
	    ON pay.OrderSysNo = po.SysNo
	  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	    ON po.VendorSysNo = vendor.SysNo
  #StrWhere3#
  UNION ALL
  SELECT
	  PayItemSysNo = payitem.SysNo,
	  VendorSysno = Vendor.SysNo
  FROM
	  ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	  INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	  LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	    ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettle vendorsettle WITH (NOLOCK)
	    ON pay.OrderSysNo = vendorsettle.SysNo
	  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	    ON vendorsettle.VendorSysNo = vendor.SysNo

  #StrWhere2#
  UNION ALL
  SELECT
	 PayItemSysNo = payitem.SysNo,
	 VendorSysno = Vendor.SysNo
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	  INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT JOIN EIMS.dbo.EIMSInvoiceInfo invoice WITH(NOLOCK)
      ON pay.OrderSysNo = invoice.InvoiceNumber
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  ON invoice.VendorNumber = vendor.SysNo
  #StrWhere4#
  UNION ALL
  SELECT
    PayItemSysno = payitem.SysNo,
    VendorSysno = Vendor.SysNo

FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	  INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
    INNER JOIN OverseaServiceManagement.dbo.V_SM_RMAVendorRefundMaster RMAPOR WITH (NOLOCK)
        ON  RMAPOR.SysNo = pay.OrderSysNo
    INNER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON vendor.sysno = RMAPOR.VendorSysNo
    LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
     #StrWhere5#
) A WHERE NOT EXISTS
(SELECT PO.VendorSysNo
FROM ipp3.dbo.Finance_Pay Pay with (nolock)
	  INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON pay.SysNo=fpe.PaySysNo
	  inner join ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
		ON fpe.PayItemSysNo=payitem.SysNo
INNER join OverseaPOASNManagement.dbo.V_PM_POPayStock PO with (nolock) on Pay.OrderSysNo=PO.SysNo
WHERE Pay.OrderType=0 and Pay.PayStatus=2 and Pay.InvoiceStatus=0 AND  A.VendorSysNo = PO.VendorSysNo
GROUP by PO.VendorSysNo, Pay.OrderSysNo having Max(PayItem.PayTime)<getdate()-30
UNION ALL
SELECT  PO.VendorSysNo
FROM ipp3.dbo.Finance_Pay Pay with (nolock)
	  INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON pay.SysNo=fpe.PaySysNo
	  inner join ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
		ON fpe.PayItemSysNo=payitem.SysNo
INNER JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock PO with (nolock) on Pay.OrderSysNo=PO.SysNo
WHERE Pay.OrderType=0 and Pay.PayStatus= 2 and PO.Status= 3 AND A.VendorSysNo = PO.VendorSysNo
GROUP by PO.VendorSysNo, Pay.OrderSysNo having Max(PayItem.PayTime)<getdate()-7
)

SELECT
   PaySysNo,
	  PayItemSysNo,
    OrderSysNo,
    OrderType,
    OrderID,
    BatchNumber,
	  CurrencySysNo,
    CurrencyDesc,
    PayAmt,
    PaySettleCompany,
    PayStyle,
    VendorName,
	  VendorSysNo,
	  Status,
    CreateTime,
    EstimatePayTime,
    PayTime,
    ReferenceID,
    InvoiceStatus,
    InvoiceFactStatus,
	  InvoiceUpdateTime,
	  UpdateInvoiceUserName,
	  Note,
    InvoiceNumber,
    ReturnPoint,
    CompanyCode
FROM(
SELECT TOP (@EndNumber)
    PaySysNo,
	PayItemSysNo,
    OrderSysNo,
    OrderType,
    OrderID,
    BatchNumber =  null,
	CurrencySysNo,
  CurrencyDesc,
    PayAmt,
    PaySettleCompany,
    PayStyle,
    VendorName,
	VendorSysNo,
	Status,
    CreateTime,
    EstimatePayTime,
    PayTime,
    ReferenceID,
    InvoiceStatus,
    InvoiceFactStatus,
	InvoiceUpdateTime,
	UpdateInvoiceUserName,
	Note,
    InvoiceNumber,
    ReturnPoint,
    CompanyCode,
    (ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
FROM(
SELECT
      PaySysNo = pay.SysNo,
	  PayItemSysNo = payitem.SysNo,
      OrderSysNo = po.SysNo,
      OrderType = pay.OrderType,
      OrderID = po.poid,
	    BatchNumber=pay.BatchNumber,
	    CurrencySysNo = pay.CurrencySysNo,
      CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
      PayAmt = ISNULL(payitem.PayAmt,0),
      PaySettleCompany = ISNULL(vendor.PaySettleCompany,0),
      PayStyle = payitem.PayStyle,
      VendorName = vendor.VendorName,
	  VendorSysNo = Vendor.SysNo,
	  Status = payitem.Status,
      CreateTime = po.InTime,
      EstimatePayTime = pay.ETP,
      PayTime = payitem.PayTime,
      ReferenceID = payitem.ReferenceID,
      InvoiceStatus = pay.InvoiceStatus,
      InvoiceFactStatus = pay.InvoiceFactStatus,
	  InvoiceUpdateTime = pay.InvoiceUpdateTime,
	  UpdateInvoiceUserName = sysUser.DisplayName,
	  Note = payitem.Note,
      InvoiceNumber = pay.Note,
      ReturnPoint=ISNULL(pay.EIMSAmt,0),
      CompanyCode = payitem.CompanyCode
  FROM
	  ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	  INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	  LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	  LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock po WITH (NOLOCK)
	  ON pay.OrderSysNo = po.SysNo
	  LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  ON po.VendorSysNo = vendor.SysNo
     LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
    ON curreny.SysNo = pay.CurrencySysNo
    #StrWhere1#
  UNION ALL
  SELECT
	  PaySysNo = pay.SysNo,
	  PayItemSysNo = payitem.SysNo,
      OrderSysNo = po.SysNo,
      OrderType = pay.OrderType,
      OrderID = po.poid,
	    BatchNumber=null,
	    CurrencySysNo = pay.CurrencySysNo,
      CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
      PayAmt = ISNULL(payitem.PayAmt,0),
      PaySettleCompany = ISNULL(vendor.PaySettleCompany,0),
      PayStyle = payitem.PayStyle,
      VendorName = vendor.VendorName,
	  VendorSysNo = Vendor.SysNo,
	  Status = payitem.Status,
      CreateTime = po.InTime,
      EstimatePayTime = payitem.EstimatePayTime,
      PayTime = payitem.PayTime,
      ReferenceID = payitem.ReferenceID,
      InvoiceStatus = pay.InvoiceStatus,
      InvoiceFactStatus = pay.InvoiceFactStatus,
	  InvoiceUpdateTime = pay.InvoiceUpdateTime,
	  UpdateInvoiceUserName = sysUser.DisplayName,
	  Note = payitem.Note,
      InvoiceNumber = pay.Note,
      ReturnPoint=ISNULL(pay.EIMSAmt,0),
      CompanyCode = payitem.CompanyCode
  FROM
	  ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	  LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	    ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	  LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock po WITH (NOLOCK)
	    ON pay.OrderSysNo = po.SysNo
	  LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	    ON po.VendorSysNo = vendor.SysNo
    LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
     ON curreny.SysNo = pay.CurrencySysNo
  #StrWhere3#
  UNION ALL
  SELECT
      PaySysNo = pay.SysNo,
	  PayItemSysNo = payitem.SysNo,
      OrderSysNo = vendorsettle.SysNo,
      OrderType = pay.OrderType,
      OrderID = vendorsettle.SettleID,
	    BatchNumber=null,
	    CurrencySysNo = pay.CurrencySysNo,
      CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
      PayAmt = payitem.PayAmt,
      PaySettleCompany = ISNULL(vendor.PaySettleCompany,0),
      PayStyle = payitem.PayStyle,
      VendorName = vendor.VendorName,
	  VendorSysNo = vendor.Sysno,
	  Status = payitem.Status,
      CreateTime = vendorsettle.SettleTime,
      EstimatePayTime = payitem.EstimatePayTime,
      PayTime = payitem.PayTime,
      ReferenceID = payitem.ReferenceID,
      InvoiceStatus = pay.InvoiceStatus,
      InvoiceFactStatus = pay.InvoiceFactStatus,
	  InvoiceUpdateTime = pay.InvoiceUpdateTime,
	  UpdateInvoiceUserName = sysUser.DisplayName,
	  Note = payitem.Note,
      InvoiceNumber=pay.Note,
      ReturnPoint=ISNULL(pay.EIMSAmt,0),
      CompanyCode = payitem.CompanyCode
  FROM
	  ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	  LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	    ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	  LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettle vendorsettle WITH (NOLOCK)
	    ON pay.OrderSysNo = vendorsettle.SysNo
	  LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	    ON vendorsettle.VendorSysNo = vendor.SysNo
    LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
      ON curreny.SysNo = pay.CurrencySysNo
  #StrWhere2#
  UNION ALL
  SELECT
	PaySysNo = pay.SysNo,
	PayItemSysNo = payitem.SysNo,
    OrderSysNo = invoice.InvoiceNumber,
    OrderType = pay.OrderType,
    OrderID = CAST(invoice.InvoiceNumber AS VARCHAR),
	  BatchNumber=null,
	  CurrencySysNo = pay.CurrencySysNo,
    CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
    PayAmt = payitem.PayAmt,
    PaySettleCompany = ISNULL(vendor.PaySettleCompany,0),
    PayStyle = payitem.PayStyle,
    VendorName = vendor.VendorName,
	VendorSysNo = vendor.Sysno,
	Status = payitem.Status,
    CreateTime =  invoice.CreateDate,
    EstimatePayTime = payitem.EstimatePayTime,
    PayTime = payitem.PayTime,
    ReferenceID = payitem.ReferenceID,
    InvoiceStatus = pay.InvoiceStatus,
    InvoiceFactStatus = pay.InvoiceFactStatus,
	InvoiceUpdateTime = pay.InvoiceUpdateTime,
	UpdateInvoiceUserName = sysUser.DisplayName,
	Note = payitem.Note,
    InvoiceNumber=pay.Note,
    ReturnPoint=NULL,
    CompanyCode = payitem.CompanyCode
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT OUTER JOIN EIMS.dbo.EIMSInvoiceInfo invoice WITH(NOLOCK)
      ON pay.OrderSysNo = invoice.InvoiceNumber
	LEFT OUTER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  ON invoice.VendorNumber = vendor.SysNo
  LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
    ON curreny.SysNo = pay.CurrencySysNo
  #StrWhere4#
  UNION ALL
  SELECT
    PaySysno = pay.SysNo,
    PayItemSysno = payitem.SysNo,
    OrderSysno = pay.OrderSysNo,
    OrderType = pay.OrderType,
    OrderID = CAST(pay.OrderSysNo AS VARCHAR),
	  BatchNumber=null,
    CurrencySysno = pay.CurrencySysNo,
    CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
    PayAmt = ISNULL(payitem.PayAmt,0),
    PaySettleCompany = ISNULL(vendor.PaySettleCompany,0),
    PayStyle = payitem.PayStyle,
    VendorName = vendor.VendorName,
    VendorSysno = Vendor.SysNo,
    PayStatus = payitem.Status,
    CreateTime = RMAPOR.PMDAuditTime,
    EstimatePayTime = payitem.EstimatePayTime,
    PayTime = payitem.PayTime,
    ReferenceID = payitem.ReferenceID,
    InvoiceStatus = pay.InvoiceStatus,
    InvoiceFactStatus = pay.InvoiceFactStatus,
    InvoiceUpdateTime = pay.InvoiceUpdateTime,
    UpdateInvoiceUserName = sysUser.DisplayName,
    Note = payitem.Note,
    InvoiceNumber=pay.Note,
    ReturnPoint=NULL,
    CompanyCode = payitem.CompanyCode
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
    INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
    INNER JOIN OverseaServiceManagement.dbo.V_SM_RMAVendorRefundMaster RMAPOR WITH (NOLOCK)
        ON  RMAPOR.SysNo = pay.OrderSysNo
    INNER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON vendor.sysno = RMAPOR.VendorSysNo
    LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
    LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
       ON curreny.SysNo = pay.CurrencySysNo
     #StrWhere5#
) A WHERE NOT EXISTS
(SELECT PO.VendorSysNo
FROM ipp3.dbo.Finance_Pay Pay with (nolock)
INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON pay.SysNo=fpe.PaySysNo
	  inner join ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
		ON fpe.PayItemSysNo=payitem.SysNo
INNER join OverseaPOASNManagement.dbo.V_PM_POPayStock PO with (nolock) on Pay.OrderSysNo=PO.SysNo
WHERE Pay.OrderType=0 and Pay.PayStatus=2 and Pay.InvoiceStatus=0 AND A.VendorSysNo = PO.VendorSysNo
GROUP by PO.VendorSysNo, Pay.OrderSysNo having Max(PayItem.PayTime)<getdate()-30
UNION ALL
SELECT  PO.VendorSysNo
FROM ipp3.dbo.Finance_Pay Pay with (nolock)
INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON pay.SysNo=fpe.PaySysNo
	  inner join ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
		ON fpe.PayItemSysNo=payitem.SysNo	 INNER JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock PO with (nolock) on Pay.OrderSysNo=PO.SysNo
WHERE Pay.OrderType=0 and Pay.PayStatus= 2 and PO.Status= 3 AND A.VendorSysNo = PO.VendorSysNo
GROUP by PO.VendorSysNo, Pay.OrderSysNo having Max(PayItem.PayTime)<getdate()-7
)

) Result
WHERE RowNumber > @StartNumber

SELECT
    @AllPayAmt = SUM(round(PayAmt,2))
FROM
(
  SELECT
      PayAmt = ISNULL(payitem.PayAmt,0),
	  VendorSysNo=vendor.SysNo
  FROM
	  ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	  INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	  LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock po WITH (NOLOCK)
	  ON pay.OrderSysNo = po.SysNo
	  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  ON po.VendorSysNo = vendor.SysNo
    #StrWhere1#
  UNION ALL
  SELECT
      PayAmt = ISNULL(payitem.PayAmt,0),
	  VendorSysNo=vendor.SysNo
  FROM
	  ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	  LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	    ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock po WITH (NOLOCK)
	    ON pay.OrderSysNo = po.SysNo
	  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	    ON po.VendorSysNo = vendor.SysNo
  #StrWhere3#
  UNION ALL
  SELECT
      PayAmt = payitem.PayAmt,
	  VendorSysNo=vendor.SysNo
  FROM
	  ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	  LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	    ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_ConsignSettle vendorsettle WITH (NOLOCK)
	    ON pay.OrderSysNo = vendorsettle.SysNo
	  LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	    ON vendorsettle.VendorSysNo = vendor.SysNo
  #StrWhere2#
  UNION ALL
  SELECT
    PayAmt = payitem.PayAmt,
	VendorSysNo=vendor.SysNo
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT JOIN EIMS.dbo.EIMSInvoiceInfo invoice WITH(NOLOCK)
      ON pay.OrderSysNo = invoice.InvoiceNumber
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
	  ON invoice.VendorNumber = vendor.SysNo
  #StrWhere4#
  UNION ALL
  SELECT
    PayAmt = ISNULL(payitem.PayAmt,0),
	VendorSysNo=vendor.SysNo
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
    INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
    INNER JOIN OverseaServiceManagement.dbo.V_SM_RMAVendorRefundMaster RMAPOR WITH (NOLOCK)
        ON  RMAPOR.SysNo = pay.OrderSysNo
    INNER JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK)
        ON vendor.sysno = RMAPOR.VendorSysNo
    LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK)
        ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
     #StrWhere5#
) A WHERE NOT EXISTS
(
    SELECT PO.VendorSysNo
	FROM ipp3.dbo.Finance_Pay Pay with (nolock)
	INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
			ON pay.SysNo=fpe.PaySysNo
		  inner join ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
			ON fpe.PayItemSysNo=payitem.SysNo
	INNER join OverseaPOASNManagement.dbo.V_PM_POPayStock PO with (nolock) on Pay.OrderSysNo=PO.SysNo
	WHERE Pay.OrderType=0 and Pay.PayStatus=2 and Pay.InvoiceStatus=0 AND A.VendorSysNo = PO.VendorSysNo
	GROUP by PO.VendorSysNo, Pay.OrderSysNo having Max(PayItem.PayTime)<getdate()-30
	UNION ALL
	SELECT  PO.VendorSysNo
	FROM ipp3.dbo.Finance_Pay Pay with (nolock)
	INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
			ON pay.SysNo=fpe.PaySysNo
		  inner join ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
			ON fpe.PayItemSysNo=payitem.SysNo	 INNER JOIN OverseaPOASNManagement.dbo.V_PM_POPayStock PO with (nolock) on Pay.OrderSysNo=PO.SysNo
	WHERE Pay.OrderType=0 and Pay.PayStatus= 2 and PO.Status= 3 AND A.VendorSysNo = PO.VendorSysNo
	GROUP by PO.VendorSysNo, Pay.OrderSysNo having Max(PayItem.PayTime)<getdate()-7
)
			  ]]>
    </commandText>
  </dataCommand>
  <!---No BizQuery END -->

  <dataCommand name="GetFinacePayItemByPOSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
 SELECT TOP 1 [SysNo]
      ,[PaySysNo]
      ,[PayStyle]
      ,[Status]
      ,[AvailableAmt]
      ,[OrderSysNo]
    ,[CompanyCode]
    ,[LanguageCode]
    ,[StoreCompanyCode]
  FROM [IPP3].[dbo].[Finance_Pay_Item] fpi WITH(nolock)
WHERE fpi.OrderType = 0
AND fpi.PayStyle = 1
AND fpi.Status = 1
AND fpi.OrderSysNo=@OrderSysNo
			]]>
    </commandText>
    <parameters>
      <param name="@OrderSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="InsertFinancePayAndItem" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
BEGIN TRY
BEGIN TRANSACTION

DECLARE @NewPaySysNo INT
DECLARE @NewPayItemSysNo INT
INSERT INTO IPP3.DBO.Finance_Pay
(
    [OrderSysNo]
    ,[CurrencySysNo]
    ,[OrderAmt]
    ,[AlreadyPayAmt]
    ,[PayStatus]
    ,[InvoiceStatus]
    ,[Note]
    ,[OrderType]
    ,[CompanyCode]
    ,[LanguageCode]
    ,[StoreCompanyCode]
    ,[ETP]
    ,[EGP]
    ,[InDate]
    ,[OrderDate]
)
VALUES
(
    @OrderSysNo
    ,1
    ,@PayAmt
    ,0
    ,0
    ,0
    ,'Job Auto create when abandon expired PO'
    ,5
    ,@CompanyCode
    ,@LanguageCode
    ,@StoreCompanyCode
    ,getdate()
    ,getdate()
    ,getdate()
    ,getdate()
)

SELECT @NewPaySysNo = SCOPE_IDENTITY()

INSERT INTO [IPP3].[dbo].[Finance_Pay_Item]
           ([PaySysNo]
           ,[PayStyle]
           ,[PayAmt]
           ,[CreateTime]
           ,[CreateUserSysNo]
           ,[Note]
           ,[Status]
           ,[CompanyCode]
           ,[LanguageCode]
           ,[CurrencySysNo]
           ,[StoreCompanyCode]
           ,[OrderSysNo]
           ,[OrderType]
          )
     VALUES
           (@NewPaySysNo
           ,0
           ,@PayAmt
           ,getdate()
           ,@CreateUserSysNo
           ,'Job Auto create when abandon expired PO'
           ,0
           ,@CompanyCode
           ,@LanguageCode
           ,1
           ,@StoreCompanyCode
           ,@OrderSysNo
           ,5
         )

SELECT @NewPayItemSysNo = SCOPE_IDENTITY()

INSERT INTO [IPP3].[dbo].[Finance_Pay_Ex]
           ([PaySysNo]
           ,[PayItemSysNo]
           ,[PayedAmt]
           ,[STATUS]
           ,[CompanyCode]
           ,[CurrencyCode]
           ,[LanguageCode]
           ,[StoreCompanyCode])
     VALUES
           (@NewPaySysNo
           ,@NewPayItemSysNo
           ,@PayAmt
           ,'A'
           ,@CompanyCode
           ,1
           ,@LanguageCode
           ,@StoreCompanyCode)

UPDATE [IPP3].[dbo].[Finance_Pay_Item]
SET AvailableAmt = 0.00
WHERE SysNo=@PrePayItemSysNo

COMMIT TRANSACTION
END TRY
BEGIN CATCH
ROLLBACK TRANSACTION
END CATCH
  ]]>
    </commandText>
    <parameters>
      <param name="@OrderSysNo" dbType="Int32" />
      <param name="@PrePayItemSysNo" dbType="Int32" />
      <param name="@CreateUserSysNo" dbType="Int32" />
      <param name="@PayAmt" dbType="Decimal" />
      <param name="@CompanyCode" dbType="StringFixedLength" />
      <param name="@LanguageCode" dbType="StringFixedLength" />
      <param name="@StoreCompanyCode" dbType="String" />

    </parameters>
  </dataCommand>

  <dataCommand name="GetCollectionPaymentPayItemList" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT @TotalCount = COUNT(payitem.SysNo)
FROM
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK) 
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_POCollectionPayment_Settle paymentsettle WITH (NOLOCK) 
	  ON pay.OrderSysNo = paymentsettle.SysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK) 
	  ON paymentsettle.VendorSysNo = vendor.SysNo	
#StrWhere#

SELECT 
	  PaySysNo,
	  PayItemSysNo, 
    OrderSysNo, 
    OrderType,
    OrderID,
    BatchNumber=null,
	  CurrencySysNo, 
    CurrencyDesc,
    PayAmt, 
    PaySettleCompany,
    PayStyle,
    VendorName,
  	VendorSysNo,
	  Status, 
    CreateTime, 
    EstimatePayTime, 
    PayTime, 
    ReferenceID,
    InvoiceStatus,
	  InvoiceUpdateTime,
	  UpdateInvoiceUserName,
	  Note,
    InvoiceNumber,
    ReturnPoint,
    CompanyCode,
      BankGLAccount,
      IsSAPImported,
      SAPImportedDate,
      SAPDocNo,
      SAPPostDate,
      SapImportedStatus,
      SapInFailedReason  
FROM (
SELECT TOP (@EndNumber)
    PaySysNo = pay.SysNo,
	  PayItemSysNo = payitem.SysNo, 
    OrderSysNo = paymentsettle.SysNo, 
    OrderType = pay.OrderType,
    OrderID = paymentsettle.SettleID,
	  CurrencySysNo = pay.CurrencySysNo, 
    CurrencyDesc = curreny.CurrencySymbol + ' ' + curreny.CurrencyName,
    PayAmt = payitem.PayAmt, 
    PaySettleCompany = vendor.PaySettleCompany,
    PayStyle = payitem.PayStyle,
    VendorName = vendor.VendorName,
	  VendorSysNo = vendor.Sysno,
	  Status = payitem.Status, 
    CreateTime = paymentsettle.SettleTime, 
    EstimatePayTime = payitem.EstimatePayTime, 
    PayTime = payitem.PayTime, 
    ReferenceID = payitem.ReferenceID,
    InvoiceStatus = pay.InvoiceStatus,
	  InvoiceUpdateTime = pay.InvoiceUpdateTime,
	  UpdateInvoiceUserName = sysUser.DisplayName,
	  Note = payitem.Note,
    InvoiceNumber=pay.Note,
    ReturnPoint=ISNULL(pay.EIMSAmt,0),
    CompanyCode = payitem.CompanyCode,
      payitem.BankGLAccount,
      payitem.IsSAPImported,
      payitem.SAPImportedDate,
      payitem.SAPDocNo,
      payitem.SAPPostDate,
      payitem.SapImportedStatus,
      payitem.SapInFailedReason , 
	(ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
FROM 
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
    LEFT OUTER JOIN OverseaControlPanel.dbo.V_CP_Currency curreny WITH(NOLOCK)
       ON curreny.SysNo = pay.CurrencySysNo
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK) 
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_POCollectionPayment_Settle paymentsettle WITH (NOLOCK) 
	  ON pay.OrderSysNo = paymentsettle.SysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK) 
	  ON paymentsettle.VendorSysNo = vendor.SysNo	
#StrWhere#
) Result
WHERE RowNumber > @StartNumber


SELECT 
    @AllPayAmt = SUM(round(payitem.PayAmt,2)) 
FROM 
	ipp3.dbo.Finance_Pay_Item payitem WITH (NOLOCK)
	 INNER JOIN ipp3.dbo.Finance_Pay_Ex fpe WITH (NOLOCK)
		ON payitem.SysNo=fpe.PayItemSysNo
	  INNER JOIN ipp3.dbo.Finance_Pay pay  WITH (NOLOCK)
		ON fpe.PaySysNo=pay.SysNo
	LEFT JOIN OverseaArchitecture.dbo.V_AR_UserInfo sysUser WITH (NOLOCK) 
	  ON pay.UpdateInvoiceUserSysNo = sysUser.UserSysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_POCollectionPayment_Settle paymentsettle WITH (NOLOCK) 
	  ON pay.OrderSysNo = paymentsettle.SysNo
	LEFT JOIN OverseaPOASNManagement.dbo.V_PM_VendorList vendor WITH (NOLOCK) 
	  ON paymentsettle.VendorSysNo = vendor.SysNo	
#StrWhere#
			      ]]>
    </commandText>
  </dataCommand>

</dataOperations>
