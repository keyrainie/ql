<?xml version="1.0" encoding="utf-8" ?>
<dataOperations xmlns="http://oversea.newegg.com/DataOperation">

  <dataCommand name="GetShipFee" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT
          @TotalAmount=ISNULL(SUM(ISNULL(PremiumAmt, 0) + ISNULL(ShippingCharge, 0) + ISNULL(ExtraAmt, 0)),0)
         ,@PremiumAmount=ISNULL(PremiumAmt,0)
         ,@ShippingCharge=ISNULL(ShippingCharge,0)
         ,@PayPrice=ISNULL(ExtraAmt,0)
      FROM OverseaInvoiceReceiptManagement.[dbo].[Invoice_Master] WITH(NOLOCK)
      WHERE
          SONumber = @SONumber
          AND WarehouseNumber = @StockSysNo
      GROUP BY [PremiumAmt], [ShippingCharge], [ExtraAmt]

      ]]>
    </commandText>
    <parameters>
      <param name="@SONumber" dbType="Int32" />
      <param name="@StockSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="InsertInvoiceMaster" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
DECLARE @InvoiceNumber  INT

INSERT INTO [OverseaInvoiceReceiptManagement].[dbo].[Invoice_Master]
          ([CustomerID]
          ,[SONumber]
          ,[InvoiceDate]
          ,[InvoiceAmount]
          ,[Type]
          ,[PayTermsCode]
          ,[PayTerms]
          ,[RMANumber]
          ,[OriginalInvoiceNumber]
          ,[InvoiceMemo]
          ,[ShippingCharge]
          ,[Version]
          ,[SpecialComment]
          ,[ReferenceSONumber]
          ,[WarehouseNumber]
          ,[OrderDate]
          ,[DeliveryDate]
          ,[SalesManSysNo]
          ,[IsWholeSale]
          ,[IsPremium]
          ,[PremiumAmt]
          ,[ShipTypeSysNo]
          ,[ExtraAmt]
          ,[SOAmt]
          ,[DiscountAmt]
          ,[PointAmt]
          ,[CashPaid]
          ,[PointPaid]
          ,[PrepayAmt]
          ,[PromotionAmt]
          ,[ReceiveAreaSysNo]
          ,[ReceiveContact]
          ,[ReceiveName]
          ,[ReceivePhone]
          ,[ReceiveCellPhone]
          ,[ReceiveAddress]
          ,[ReceiveZip]
          ,[InvoiceNote]
          ,[FinanceNote]
          ,[InvoiceNo]
          ,[PromotionCustomerSysNo]
          ,[PromotionCodeSysNo]
          ,[IsUseCheckPay]
          ,[CompanyCode]
          ,[CustomerSysNo]
          ,[GiftCardPayAmt]
          ,[LanguageCode]
          ,[CurrencyCode]
          ,[StoreCompanyCode]
)
VALUES
(
          @CustomerID
          ,@SONumber
          ,@InvoiceDate
          ,@InvoiceAmount
          ,'SO'
          ,@PayTermsCode
          ,@PayTerms
          ,@RMANumber
          ,@OriginalInvoiceNumber
          ,@InvoiceMemo
          ,@ShippingCharge
          ,'1.00'
          ,@SpecialComment
          ,@ReferenceSONumber
          ,@WarehouseNumber
          ,@OrderDate
          ,@DeliveryDate
          ,@SalesManSysNo
          ,@IsWholeSale
          ,@IsPremium
          ,@PremiumAmt
          ,@ShipTypeSysNo
          ,@ExtraAmt
          ,@SOAmt
          ,@DiscountAmt
          ,@GainPoint
          ,@CashPaid
          ,@PointPaid
          ,@PrepayAmt
          ,@PromotionAmt
          ,@ReceiveAreaSysNo
          ,@ReceiveContact
          ,@ReceiveName
          ,@ReceivePhone
          ,@ReceiveCellPhone
          ,@ReceiveAddress
          ,@ReceiveZip
          ,@InvoiceNote
          ,@FinanceNote
          ,@InvoiceNo
          ,@PromotionCustomerSysNo
          ,@PromotionCodeSysNo
          ,@IsUseCheckPay
          ,@CompanyCode
          ,@CustomerSysNo
          ,@GiftCardPayAmt
          ,'zh-CN'
          ,'1'
          ,'8601'
)
 DECLARE @UniqueInvoiceNumber VARCHAR(200)
 SET @InvoiceNumber=SCOPE_IDENTITY()
 SET @UniqueInvoiceNumber=REPLACE(@CompanyCode, ' ', '')+'-'
        +REPLACE(@CompanyCode, ' ', '')+'-'
        + cast(@InvoiceNumber AS VARCHAR(20))

 UPDATE TOP(10) [OverseaInvoiceReceiptManagement].[dbo].[Invoice_Master]
  SET UniqueInvoiceNumber=@UniqueInvoiceNumber
 WHERE InvoiceNumber=@InvoiceNumber

 SELECT @InvoiceNumber
      ]]>
    </commandText>
    <parameters>
      <param name="@CustomerID" dbType="String" />
      <param name="@SONumber"  dbType="Int32" />
      <param name="@InvoiceDate"  dbType="DateTime" />
      <param name="@InvoiceAmount"  dbType="Decimal" property="InvoiceAmt"/>
      <param name="@PayTermsCode"  dbType="Int32" property="PayTypeSysNo"/>
      <param name="@PayTerms"  dbType="String" property="PayTypeName"/>
      <param name="@RMANumber"  dbType="String" />
      <param name="@OriginalInvoiceNumber"  dbType="String" />
      <param name="@InvoiceMemo"  dbType="String" />
      <param name="@ShippingCharge"  dbType="Decimal" />
      <param name="@SpecialComment"  dbType="String" />
      <param name="@ReferenceSONumber"  dbType="AnsiStringFixedLength" size="20" />
      <param name="@WarehouseNumber"  dbType="Int32" property="StockSysNo"/>
      <param name="@OrderDate"  dbType="DateTime" />
      <param name="@DeliveryDate" dbType="DateTime"/>
      <param name="@SalesManSysNo" dbType="Int32"/>
      <param name="@IsWholeSale" dbType="Int32" />
      <param name="@IsPremium" dbType="Int32" />
      <param name="@PremiumAmt" dbType="Decimal" />
      <param name="@ShipTypeSysNo" dbType="Int32" />
      <param name="@ExtraAmt" dbType="Decimal" />
      <param name="@SOAmt" dbType="Decimal" />
      <param name="@DiscountAmt" dbType="Decimal" />
      <param name="@GainPoint" dbType="Int32"/>
      <param name="@CashPaid" dbType="Decimal" />
      <param name="@PointPaid" dbType="Decimal" />
      <param name="@PrepayAmt" dbType="Decimal" />
      <param name="@PromotionAmt" dbType="Decimal" />
      <param name="@ReceiveAreaSysNo" dbType="Int32" />
      <param name="@ReceiveContact" dbType="String" />
      <param name="@ReceiveName" dbType="String" />
      <param name="@ReceivePhone" dbType="String" />
      <param name="@ReceiveCellPhone" dbType="String" />
      <param name="@ReceiveAddress" dbType="String" />
      <param name="@ReceiveZip" dbType="String" />
      <param name="@InvoiceNote" dbType="String" />
      <param name="@FinanceNote" dbType="String" />
      <param name="@InvoiceNo" dbType="String" />
      <param name="@PromotionCustomerSysNo" dbType="Int32" />
      <param name="@PromotionCodeSysNo" dbType="Int32" />
      <param name="@IsUseCheckPay" dbType="Int32" property="IsUseChequesPay"/>
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" size="50" />
      <param name="@CustomerSysNo" dbType="Int32" />
      <param name="@GiftCardPayAmt" dbType="Decimal" />
    </parameters>
  </dataCommand>

  <dataCommand name="InsertInvoiceTransaction" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
INSERT INTO [OverseaInvoiceReceiptManagement].[dbo].[Invoice_Transaction]
           ([InvoiceNumber]
           ,[UniqueInvoiceNumber]
           ,[ItemCode]
           ,[PrintDescription]
           ,[ItemType]
           ,[UnitPrice]
           ,[Quantity]
           ,[ExtendPrice]
           ,[Indate]
           ,[ReferenceSONumber]
           ,[Weight]
           ,[Point]
           ,[PointType]
           ,[PremiumAmt]
           ,[ShippingCharge]
           ,[ExtraAmt]
           ,[CashPaid]
           ,[PointPaid]
           ,[DiscountAmt]
           ,[PrepayAmt]
           ,[Warranty]
           ,[GiftSysNo]
           ,[BriefName]
           ,[OriginalPrice]
           ,[PromotionDiscount]
           ,[MasterProductSysNo]
           ,[UnitCost]
           ,[UnitCostWithoutTax]
           ,[IsMemberPrice]
           ,[CompanyCode]
           ,[ProductSysNo]
           ,[GiftCardPayAmt]
           ,[LanguageCode]
           ,[CurrencyCode]
           ,[StoreCompanyCode]
)
VALUES
(
    @MasterSysNo
           ,REPLACE(@CompanyCode, ' ', '')+'-'+REPLACE(@CompanyCode, ' ', '')+'-'  + cast(@MasterSysNo AS VARCHAR(20))
           ,@ItemCode
           ,@PrintDescription
           ,@ItemType
           ,@UnitPrice
           ,@Quantity
           ,@ExtendPrice
           ,GETDATE()
           ,@ReferenceSONumber
           ,@Weight
           ,@GainPoint
           ,@PayType
           ,@PremiumAmt
           ,@ShippingCharge
           ,@ExtraAmt
           ,@CashPaid
           ,@PointPaid
           ,@DiscountAmt
           ,@PrepayAmt
           ,@Warranty
           ,@GiftSysNo
           ,@BriefName
           ,@OriginalPrice
           ,@PromotionDiscount
           ,@MasterProductSysNo
           ,@UnitCost
           ,@UnitCostWithoutTax
           ,@PriceType
           ,@CompanyCode
           ,@ProductSysNo
           ,@GiftCardPayAmt
           ,'zh-CN'
           ,'1'
           ,'8601'
)
      ]]>
    </commandText>
    <parameters>
      <param name="@MasterSysNo" dbType="Int32" />
      <param name="@ItemCode" dbType="AnsiStringFixedLength" size="30" />
      <param name="@PrintDescription" dbType="StringFixedLength" />
      <param name="@ItemType" dbType="Int32" />
      <param name="@UnitPrice" dbType="Decimal" />
      <param name="@Quantity" dbType="Int32" />
      <param name="@ExtendPrice" dbType="Decimal" />
      <param name="@ReferenceSONumber" dbType="StringFixedLength" size="20"/>
      <param name="@Weight" dbType="Int32" />
      <param name="@GainPoint" dbType="Int32" />
      <param name="@PayType" dbType="Int32" />
      <param name="@PremiumAmt" dbType="Decimal" />
      <param name="@ShippingCharge" dbType="Decimal" />
      <param name="@ExtraAmt" dbType="Decimal" />
      <param name="@CashPaid" dbType="Decimal" />
      <param name="@PointPaid" dbType="Decimal" />
      <param name="@DiscountAmt" dbType="Decimal" />
      <param name="@PrepayAmt" dbType="Decimal" />
      <param name="@Warranty" dbType="String" />
      <param name="@GiftSysNo" dbType="Int32" />
      <param name="@BriefName" dbType="String" />
      <param name="@OriginalPrice" dbType="Decimal" />
      <param name="@PromotionDiscount" dbType="Decimal" />
      <param name="@MasterProductSysNo" dbType="String" />
      <param name="@UnitCost" dbType="Decimal" />
      <param name="@UnitCostWithoutTax" dbType="Decimal" />
      <param name="@PriceType" dbType="Int32" />
      <param name="@CompanyCode" dbType="StringFixedLength" size="50"/>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@GiftCardPayAmt" dbType="Decimal" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetInvoiceMasterBySysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT [CustomerID]
          ,[SONumber]
          ,[InvoiceDate]
          ,[InvoiceAmount] AS InvoiceAmt
          ,[Type]
          ,[PayTermsCode] AS PayTypeSysNo
          ,[PayTerms] AS PayTypeName
          ,[RMANumber]
          ,[OriginalInvoiceNumber]
          ,[InvoiceMemo]
          ,[ShippingCharge]
          ,[Version]
          ,[SpecialComment]
          ,[ReferenceSONumber]
          ,[SAPImportRequired]
          ,[SAPImportDate]
          ,[WarehouseNumber] AS StockSysNo
          ,[OrderDate]
          ,[DeliveryDate]
          ,[SalesManSysNo]
          ,[IsWholeSale]
          ,[IsPremium]
          ,[PremiumAmt]
          ,[ShipTypeSysNo]
          ,[ExtraAmt]
          ,[SOAmt]
          ,[DiscountAmt]
          ,[PointAmt] AS GainPoint
          ,[CashPaid]
          ,[PointPaid]
          ,[PrepayAmt]
          ,[PromotionAmt]
          ,[ReceiveAreaSysNo]
          ,[ReceiveContact]
          ,[ReceiveName]
          ,[ReceivePhone]
          ,[ReceiveCellPhone]
          ,[ReceiveAddress]
          ,[ReceiveZip]
          ,[InvoiceNote]
          ,[FinanceNote]
          ,[InvoiceNo]
          ,[PromotionCustomerSysNo]
          ,[PromotionCodeSysNo]
          ,[IsUseCheckPay] AS IsUseChequesPay
          ,[CurrencyCode]
          ,[LanguageCode]
          ,[CompanyCode]
          ,[StoreCompanyCode]
          ,[CustomerSysNo]
          --,[SapCoCode]
          ,[GiftCardPayAmt]
          ,[CompanyCode]
  FROM [OverseaInvoiceReceiptManagement].[dbo].[Invoice_Master] WITH(NOLOCK)
  WHERE InvoiceNumber=@InvoiceNumber
      ]]>
    </commandText>
    <parameters>
      <param name="@InvoiceNumber" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetInvoiceTransactionListByMasterSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT [InvoiceNumber] AS MasterSysNo
           ,[UniqueInvoiceNumber]
           ,[ItemCode]
           ,[PrintDescription]
           ,[ItemType]
           ,[UnitPrice]
           ,[Quantity]
           ,[ExtendPrice]
           ,[Indate]
           ,[ReferenceSONumber]
           ,[Weight]
           ,[Point] AS GainPoint
           ,[PointType] AS PayType
           ,[PremiumAmt]
           ,[ShippingCharge]
           ,[ExtraAmt]
           ,[CashPaid]
           ,[PointPaid]
           ,[DiscountAmt]
           ,[PrepayAmt]
           ,[Warranty]
           ,[GiftSysNo]
           ,[BriefName]
           ,[OriginalPrice]
           ,[PromotionDiscount]
           ,[MasterProductSysNo]
           ,[UnitCost]
           ,[UnitCostWithoutTax]
           ,[IsMemberPrice] AS PriceType
           ,[LanguageCode]
           ,[CurrencyCode]
           ,[CompanyCode]
           ,[StoreCompanyCode]
           ,[ProductSysNo]
           ,[GiftCardPayAmt]
  FROM [OverseaInvoiceReceiptManagement].[dbo].[Invoice_Transaction] WITH(NOLOCK)
  WHERE InvoiceNumber=@MasterInvoiceNumber
      ]]>
    </commandText>
    <parameters>
      <param name="@MasterInvoiceNumber" dbType="Int32" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetInvoiceMasterListBySOSysNo" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
SELECT [CustomerID]
          ,[SONumber]
          ,[InvoiceDate]
          ,[InvoiceAmount] AS InvoiceAmt
          ,[Type]
          ,[PayTermsCode] AS PayTypeSysNo
          ,[PayTerms] AS PayTypeName
          ,[RMANumber]
          ,[OriginalInvoiceNumber]
          ,[InvoiceMemo]
          ,[ShippingCharge]
          ,[Version]
          ,[SpecialComment]
          ,[ReferenceSONumber]
          ,[SAPImportRequired]
          ,[SAPImportDate]
          ,[WarehouseNumber] AS StockSysNo
          ,[OrderDate]
          ,[DeliveryDate]
          ,[SalesManSysNo]
          ,[IsWholeSale]
          ,[IsPremium]
          ,[PremiumAmt]
          ,[ShipTypeSysNo]
          ,[ExtraAmt]
          ,[SOAmt]
          ,[DiscountAmt]
          ,[PointAmt] AS GainPoint
          ,[CashPaid]
          ,[PointPaid]
          ,[PrepayAmt]
          ,[PromotionAmt]
          ,[ReceiveAreaSysNo]
          ,[ReceiveContact]
          ,[ReceiveName]
          ,[ReceivePhone]
          ,[ReceiveCellPhone]
          ,[ReceiveAddress]
          ,[ReceiveZip]
          ,[InvoiceNote]
          ,[FinanceNote]
          ,[InvoiceNo]
          ,[PromotionCustomerSysNo]
          ,[PromotionCodeSysNo]
          ,[IsUseCheckPay] AS IsUseChequesPay
          ,[CurrencyCode]
          ,[LanguageCode]
          ,[CompanyCode]
          ,[StoreCompanyCode]
          ,[CustomerSysNo]
          ,[GiftCardPayAmt]
          ,[CompanyCode]
  FROM [OverseaInvoiceReceiptManagement].[dbo].[Invoice_Master] WITH(NOLOCK)
  WHERE SONumber=@SOSysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@SOSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <!--NoBizQuery 开始-->

  <dataCommand name="GetInvoiceAll" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
       #tempTab1#

 IF OBJECT_ID(N'tempdb..#GetInvoiceAll') IS NOT NULL
 DROP TABLE #GetInvoiceAll
;

SELECT
    SAPPostDate
   ,SAPDocNo
   ,SapImportedStatus
   ,SapInFailedReason
   ,SysNo
   ,CompanyCode
   ,CustomerSysNo
   ,OrderSysNo
   ,OrderType
   ,IncomeStyle
   ,PrepayAmt
   ,OrderID
   ,OutTime
   ,OutUserSysNo
   ,IncomeUserSysNo
   ,IncomeTime
   ,ConfirmUserSysNo
   ,ConfirmTime
   ,IncomeStatus
   ,WarehouseName
   ,WarehouseNumber
   ,SapCoCode
   ,InvoiceAmt
   ,InvoiceNo
   ,PayTypeSysNo
   ,SOSysNo
   ,ShippingCharge
   ,InvoiceCreateTime
   ,SOStatus
   ,IsOutStock
   ,NewOrderSysNo
   ,RefundPayTypeSysNo
   ,OrderAmt
   ,GiftCardPayAmt
   ,UnionAmt
   ,SOTotalAmt
   ,IncomeAmt
INTO  #GetInvoiceAll
FROM (
        SELECT
                   M.SAPPostDate
                  ,M.SAPDocNo
                  ,M.SapImportedStatus
                  ,M.SapInFailedReason
                  ,SO.SysNo
                  ,SO.CompanyCode
                  ,SO.CustomerSysNo
                  ,M.SONumber as OrderSysNo
                  ,1 as OrderType
                  ,SO.IncomeStyle
                  ,ISNULL(-M.PrepayAmt,0) AS PrepayAmt
                  ,SO.orderid AS OrderID
                  ,M.InvoiceDate AS OutTime
                  ,SO.OutUserSysNo
                  ,SO.IncomeUserSysNo
                  ,SO.IncomeTime
                  ,SO.ConfirmUserSysNo
                  ,SO.ConfirmTime
                  ,SO.status AS IncomeStatus
                  ,stock.StockName AS WarehouseName
                  ,M.WarehouseNumber
                  ,M.SapCoCode
                  ,M.InvoiceAmount AS InvoiceAmt
                  ,M.InvoiceNo
                  ,SO.PayTypeSysNo
                  ,SO.fsOrderSysNo AS SOSysNo
                  ,( CASE
                       WHEN SO.ShipTypeSysNo=19 THEN M.ShippingCharge
                       ELSE 0
                   END) AS ShippingCharge
                  ,M.InvoiceCreateDate AS InvoiceCreateTime
                  ,SO.SOStatus AS SOStatus
                  ,CASE
                       WHEN SO.SOStatus=4 THEN '是'
                       ELSE '否'
                   END AS IsOutStock
                  ,0 AS NewOrderSysNo
                  ,NULL AS RefundPayTypeSysNo
				          ,SO.OrderAmt
				          ,SO.GiftCardPayAmt
				          , UnionAmt= case sc.SOType when 6 then (SELECT sum(isnull(price,0)) FROM OverseaOrderManagement.dbo.V_OM_Sub_SO_Item item WITH  (NOLOCK)
					          WHERE item.ProductSysNo IN(140206,140207,140208)
					          AND item.SOSysNo=M.SONumber)
					          ELSE 0 END
                  ,isnull( subSo.SOTotalAmt,0.00) AS SOTotalAmt
                  ,isnull( subSo.SOTotalAmt,0.00) - ISNULL(-M.PrepayAmt,0.00) - isnull(SO.GiftCardPayAmt,0.00) AS IncomeAmt
               FROM OverseaInvoiceReceiptManagement.dbo.Invoice_Master M WITH(NOLOCK)
               LEFT JOIN OverseaInvoiceReceiptManagement.dbo.V_IM_SOIncomeSO SO WITH(NOLOCK)
                    ON M.SONumber = SO.OrderSysNo  AND SO.OrderType=1
               LEFT JOIN overseaOrderManagement.dbo.V_OM_Sub_SO_Master subSo WITH(nolock)
                    ON subSo.SOSysNo = M.SONumber  AND subSo.WareHouseNumber = M.WarehouseNumber
               LEFT JOIN OverseaOrderManagement.dbo.V_OM_SO_CheckShipping SC WITH(NOLOCK)
	                  ON M.SONumber = SC.SOSysNo AND M.Type ='SO'
               LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH(NOLOCK)
                    ON stock.sysno = M.WarehouseNumber  #StrWhere1# #tempTab2#

              UNION ALL

                SELECT
                  DISTINCT
                  SO.RefundSAPPostDate AS SAPPostDate
                 ,SO.RefundSAPDocNo   AS SAPDocNo
                 ,SO.RefundSapImportedStatus AS SapImportedStatus
                 ,SO.SapInFailedReason
                 ,SO.sysno
                 ,SO.CompanyCode
                 ,SO.CustomerSysNo
                 ,SO.ordersysno
                 ,SO.ordertype
                 ,SO.incomeStyle
                 ,isnull(SO.PrepayAmt,0) AS prepayAmt
                 ,SO.orderid AS OrderID
                 ,NULL AS OutTime
                 ,-999999 AS OutUserSysNo
                 ,SO.IncomeUserSysNo
                 ,SO.incometime
                 ,SO.ConfirmUserSysNo
                 ,SO.confirmtime
                 ,SO.status AS incomestatus
                 ,stock.StockName AS WarehouseName
                 ,rr.OwnByWarehouse WarehouseNumber
	               ,NULL AS SapCoCode
                 ,SO.OrderAmt - (case  
                      when sc.SOType=6 
                        then (SELECT -sum(isnull(price,0)) FROM OverseaOrderManagement.dbo.V_OM_Sub_SO_Item item WITH  (NOLOCK)
                              WHERE item.ProductSysNo IN(140206,140207,140208)                                
                              AND item.SOSysNo=SO.SOSysNo
                              ) + ISNULL(SO.GiftCardPayAmt,0)
                      WHEN sc.SOType = 9 
                        then (SELECT TOP(1) -ISNULL(sm.SOAmt,0) FROM OverseaOrderManagement.dbo.V_OM_SO_Master sm WITH(NOLOCK)
		                        WHERE sm.SysNo=SO.SOSysNo
                            ) + ISNULL(SO.GiftCardPayAmt,0)
                      WHEN sc.StockType='MET' AND sc.ShippingType IN ('NEG','MET') AND sc.InvoiceType='MET'
                        then (SELECT TOP(1) -ISNULL(sm.SOAmt,0) FROM OverseaOrderManagement.dbo.V_OM_SO_Master sm WITH(NOLOCK)
		                        WHERE sm.SysNo=SO.SOSysNo
                            ) + ISNULL(SO.GiftCardPayAmt,0)
                      ELSE 0 END)  AS InvoiceAmt
                 ,SO.InvoiceNo
                 ,-999999 AS PayTypeSysNo
                 ,SO.SOSysNo
                 ,0.0 AS ShippingCharge
                 ,SO.InvoiceCreateTime
                 ,NULL AS SOStatus
                 ,NULL AS IsOutStock
                 ,0 AS NewOrderSysNo
                 ,SO.refundpaytype AS RefundPayTypeSysNo
	               ,SO.OrderAmt
                 ,SO.GiftCardPayAmt
				         ,UnionAmt= case sc.SOType when 6 then (SELECT -sum(isnull(price,0)) FROM OverseaOrderManagement.dbo.V_OM_Sub_SO_Item item WITH  (NOLOCK)
					          WHERE item.ProductSysNo IN(140206,140207,140208)
					          AND item.SOSysNo=SO.SOSysNo)
					          ELSE 0 END
                 ,SOTotalAmt = SO.OrderAmt - (case  
                      when sc.SOType=6 
                        then (SELECT -sum(isnull(price,0)) FROM OverseaOrderManagement.dbo.V_OM_Sub_SO_Item item WITH  (NOLOCK)
                              WHERE item.ProductSysNo IN(140206,140207,140208)                                
                              AND item.SOSysNo=SO.SOSysNo
                              ) + ISNULL(SO.GiftCardPayAmt,0)
                      WHEN sc.SOType = 9 
                        then (SELECT TOP(1) -ISNULL(sm.SOAmt,0) FROM OverseaOrderManagement.dbo.V_OM_SO_Master sm WITH(NOLOCK)
		                        WHERE sm.SysNo=SO.SOSysNo
                            ) + ISNULL(SO.GiftCardPayAmt,0)
                      WHEN sc.StockType='MET' AND sc.ShippingType IN ('NEG','MET') AND sc.InvoiceType='MET'
                        then (SELECT TOP(1) -ISNULL(sm.SOAmt,0) FROM OverseaOrderManagement.dbo.V_OM_SO_Master sm WITH(NOLOCK)
		                        WHERE sm.SysNo=SO.SOSysNo
                            ) + ISNULL(SO.GiftCardPayAmt,0)
                      ELSE 0 END)
                 ,0.00 AS IncomeAmt
              FROM OverseaInvoiceReceiptManagement.dbo.V_IM_SOIncomeSM SO WITH(NOLOCK)
              INNER JOIN OverseaServiceManagement.dbo.V_SM_RMARefundTransaction rmi WITH(NOLOCK)
                  ON rmi.RefundSysNo = SO.fsOrderSysNo
              INNER JOIN OverseaServiceManagement.dbo.V_SM_RMARegister rr WITH(NOLOCK)
                  ON rr.sysno=rmi.registersysno
              LEFT JOIN OverseaOrderManagement.dbo.V_OM_SO_CheckShipping SC WITH(NOLOCK)
	                ON SO.SOSysNo = SC.SOSysNo
              LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH(NOLOCK)
                  ON stock.sysno = CAST(rr.OwnByWarehouse AS int) #StrWhere2#

              UNION ALL

             SELECT
                DISTINCT
                SO.BalanceSAPPostDate AS SAPPostDate
               ,SO.BalanceSAPDocNo   AS SAPDocNo
               ,SO.SapImportedStatus
               ,SO.SapInFailedReason
               ,SO.sysno
               ,SO.CompanyCode
               ,SO.CustomerSysNo
               ,SO.ordersysno
               ,SO.ordertype
               ,SO.incomeStyle
               ,ISNULL(SO.PrepayAmt,0) AS prepayAmt
               ,CAST(SO.fsOrderSysNo AS nvarchar) AS OrderID
               ,NULL AS outtime
               ,-999999 AS OutUserSysNo
               ,SO.IncomeUserSysNo
               ,SO.incometime
               ,SO.confirmUserSysNo
               ,SO.confirmtime
               ,SO.status AS incomestatus
               ,stock.StockName AS WarehouseName
               ,rr.OwnByWarehouse WarehouseNumber
               ,NULL AS SapCoCode
               ,SO.orderamt AS InvoiceAmt
               ,SO.InvoiceNo
               ,-999999 AS PayTypeSysNo
               ,SO.SOSysNo
               ,0.0 AS ShippingCharge
               ,SO.InvoiceCreateTime
               ,NULL AS SOStatus
               ,NULL AS IsOutStock
               ,SO.NewOrderSysNo
               ,SO.refundpaytype AS RefundPayTypeSysNo
               ,SO.OrderAmt
               ,SO.GiftCardPayAmt
			         ,UnionAmt=null
               ,SOTotalAmt = SO.orderamt
               ,0.00 AS IncomeAmt
            FROM OverseaInvoiceReceiptManagement.dbo.V_IM_SOIncomeROBalance SO WITH(NOLOCK)
            INNER JOIN OverseaServiceManagement.dbo.V_SM_RMARefundTransaction rmi WITH(NOLOCK)
                ON rmi.RefundSysNo = SO.fsOrderSysNo01
            INNER JOIN OverseaServiceManagement.dbo.V_SM_RMARegister rr WITH(NOLOCK)
                ON rr.sysno=rmi.registersysno
            LEFT JOIN OverseaOrderManagement.dbo.V_OM_SO_CheckShipping SC WITH(NOLOCK)
	              ON SO.SOSysNo = SC.SOSysNo
            LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH(NOLOCK)
                ON stock.sysno = CAST(rr.OwnByWarehouse AS int) #StrWhere3#
            )B

        SELECT
            @TotalCount = COUNT(1)
        FROM    #GetInvoiceAll

        SELECT
            SAPPostDate
           ,SAPDocNo
           ,SapImportedStatus
           ,SapInFailedReason
           ,SysNo
           ,CompanyCode
           ,CustomerSysNo
           ,OrderSysNo
           ,OrderType
           ,IncomeStyle
           ,PrepayAmt
           ,OrderID
           ,OutTime
           ,OutUserSysNo
           ,OutUser
           ,IncomeUserSysNo
           ,IncomeUser
           ,IncomeTime
           ,ConfirmUserSysNo
           ,ConfirmUser
           ,ConfirmTime
           ,IncomeStatus
           ,WarehouseName AS StockName
           ,WarehouseNumber AS StockID
           ,SapCoCode
           ,InvoiceAmt
           ,InvoiceNo
           ,PayTypeSysNo
           ,SOSysNo
           ,ShippingCharge
           ,InvoiceCreateTime
           ,SOStatus
           ,IsOutStock
           ,NewOrderSysNo
           ,RefundPayTypeSysNo
		       ,OrderAmt
		       ,GiftCardPayAmt
		       ,UnionAmt
           ,SOTotalAmt
           ,IncomeAmt
           ,RowNumber
        FROM (
                SELECT TOP
                    (@EndNumber)
                    SAPPostDate
                   ,SAPDocNo
                   ,SapImportedStatus
                   ,SapInFailedReason
                   ,SysNo
                   ,fs.CompanyCode
                   ,CustomerSysNo
                   ,OrderSysNo
                   ,OrderType
                   ,IncomeStyle
                   ,PrepayAmt
                   ,OrderID
                   ,OutTime
                   ,OutUserSysNo
                   ,m1.DisplayName AS OutUser
                   ,IncomeUserSysNo
                   ,m2.DisplayName AS IncomeUser
                   ,IncomeTime
                   ,ConfirmUserSysNo
                   ,m3.DisplayName AS ConfirmUser
                   ,ConfirmTime
                   ,IncomeStatus
                   ,WarehouseName
                   ,WarehouseNumber
                   ,SapCoCode
                   ,InvoiceAmt
                   ,InvoiceNo
                   ,PayTypeSysNo
                   ,SOSysNo
                   ,ShippingCharge
                   ,InvoiceCreateTime
                   ,SOStatus
                   ,IsOutStock
                   ,NewOrderSysNo
                   ,RefundPayTypeSysNo
				           ,OrderAmt
				           ,GiftCardPayAmt
				           ,UnionAmt
                   ,SOTotalAmt
                   ,IncomeAmt
                   ,(ROW_NUMBER() OVER(
                ORDER BY #SortColumnName#)) AS RowNumber
                FROM #GetInvoiceAll fs
                LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo m1 WITH(NOLOCK)
                  ON m1.UserSysNo=fs.OutUserSysNo
                LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo m2 WITH(NOLOCK)
                  ON m2.UserSysNo=fs.IncomeUserSysNo
                LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo m3 WITH(NOLOCK)
                  ON m3.UserSysNo=fs.ConfirmUserSysNo
             ) A
        WHERE
            RowNumber > @StartNumber

 IF OBJECT_ID(N'tempdb..#GetInvoiceAll') IS NOT NULL
 DROP TABLE #GetInvoiceAll
      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetInvoiceAllAmount" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
    #tempTab1#
    WITH AllInvoice AS(
       SELECT
         SUM(OrderAmt) - SUM(UnionAmt) - SUM(SOAmt) + SUM(GiftCardPayAmt) as TotalAmt,
         SUM(PrepayAmt) as PrepayAmt,
         SUM(UnionAmt) as UnionAmt
         ,SUM(SOAmt) AS SOAmt
       FROM  (SELECT
                SO.SysNo,
                SO.OrderAmt,
                SO.PrepayAmt,
                UnionAmt=case sc.SOType when 6 then (SELECT -sum(isnull(price,0)) FROM OverseaOrderManagement.dbo.V_OM_Sub_SO_Item item WITH  (NOLOCK)
					        WHERE item.ProductSysNo IN(140206,140207,140208)
					        AND item.SOSysNo=SO.SOSysNo)
				          ELSE 0 END
                ,SOAmt=(--模式5、6的商品金额在统计时需要去除
                  CASE 
                  WHEN sc.StockType='MET' AND sc.ShippingType IN ('NEG','MET') AND sc.InvoiceType='MET'
                      then (SELECT TOP(1) -ISNULL(sm.SOAmt,0) FROM OverseaOrderManagement.dbo.V_OM_SO_Master sm WITH(NOLOCK)
                          WHERE sm.SysNo=SO.SOSysNo
                          )
                  ELSE 0
                  END
              )
              ,GiftCardPayAmt = ( case
						                WHEN  sc.SOType = 6 THEN ISNULL(SO.GiftCardPayAmt,0)
						                WHEN  sc.SOType = 9 THEN ISNULL(SO.GiftCardPayAmt,0)
                            WHEN sc.StockType='MET' AND sc.ShippingType IN ('NEG','MET') AND sc.InvoiceType='MET'
                              THEN ISNULL(SO.GiftCardPayAmt,0)
						                ELSE 0 END
                            )
            FROM OverseaInvoiceReceiptManagement.dbo.V_IM_SOIncome SO WITH (NOLOCK)
        	  LEFT JOIN OverseaOrderManagement.dbo.V_OM_SO_CheckShipping SC WITH(NOLOCK)
	          ON SO.SOSysNo = SC.SOSysNo
          #StrWhere#
         AND SO.ordertype = 2
       ) result

      UNION ALL

      SELECT
        SUM(OrderAmt) as TotalAmt,
        0.0 AS PrepayAmt,
	      SUM(UnionAmt) as UnionAmt
        ,SUM(SOAmt) AS SOAmt
      FROM  (SELECT
              SO.sysno,
              SO.orderamt,
			        UnionAmt=0
              ,SOAmt=0
          FROM OverseaInvoiceReceiptManagement.dbo.V_IM_SOIncome SO WITH (NOLOCK)
        	LEFT JOIN OverseaOrderManagement.dbo.V_OM_SO_CheckShipping SC WITH(NOLOCK)
	     ON SO.SOSysNo = SC.SOSysNo
        #StrWhere#
        AND SO.ordertype = 4
       ) result
 )

      SELECT
          SUM(isnull(TotalAmt,0.00)) AS TotalAmt
         ,SUM(isnull(PrepayAmt,0.00)) AS PrepayAmt
         ,SUM(isnull(UnionAmt,0.00)) AS UnionAmt
         ,SUM(isnull(TotalAmt,0.00)) + SUM(isnull(UnionAmt,0.00)) AS TSOTotalAmt
         ,0.00 AS TotalAmtForSOOnly
         ,0.00 AS GiftCardPayAmt
         ,0.00 AS IncomeAmt
      FROM AllInvoice
      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetInvoiceSO" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      IF OBJECT_ID(N'tempdb..#GetInvoiceSO') IS NOT NULL
         DROP TABLE #GetInvoiceSO
      ;
      #tempTab1#

               SELECT
                   M.SAPPostDate
                  ,M.SAPDocNo
                  ,M.SapImportedStatus
                  ,M.SapInFailedReason
                  ,SO.SysNo
                  ,SO.CompanyCode
                  ,SO.CustomerSysNo
                  ,M.SONumber as OrderSysNo
                  ,1 as OrderType
                  ,SO.IncomeStyle
                  ,ISNULL(-M.PrepayAmt,0) AS PrepayAmt
                  ,SO.orderid AS OrderID
                  ,M.InvoiceDate AS OutTime
                  ,SO.OutUserSysNo
                  ,SO.IncomeUserSysNo
                  ,SO.IncomeTime
                  ,SO.ConfirmUserSysNo
                  ,SO.ConfirmTime
                  ,SO.status AS IncomeStatus
                  ,stock.StockName AS WarehouseName
                  ,M.WarehouseNumber
                  ,M.SapCoCode
                  ,M.InvoiceAmount AS InvoiceAmt
                  ,M.InvoiceNo
                  ,SO.PayTypeSysNo
                  ,SO.fsOrderSysNo AS SOSysNo
                  ,( CASE
                       WHEN SO.ShipTypeSysNo=19 THEN M.ShippingCharge
                       ELSE 0
                   END) AS ShippingCharge
                  ,M.InvoiceCreateDate AS InvoiceCreateTime
                  ,SO.SOStatus AS SOStatus
                  ,CASE
                       WHEN SO.SOStatus=4 THEN '是'
                       ELSE '否'
                   END AS IsOutStock
                  ,0 AS NewOrderSysNo
                  ,NULL AS RefundPayTypeSysNo
				          ,SO.OrderAmt
				          ,SO.GiftCardPayAmt
                  ,UnionAmt=case sc.SOType when 6 then (SELECT sum(isnull(price,0)) FROM OverseaOrderManagement.dbo.V_OM_Sub_SO_Item item WITH  (NOLOCK)
					          WHERE item.ProductSysNo IN(140206,140207,140208)
					          AND item.SOSysNo=M.SONumber)
				            ELSE 0 END
                 ,isnull(subSo.SOTotalAmt,0.00) AS SOTotalAmt
               INTO #GetInvoiceSO
			   FROM OverseaInvoiceReceiptManagement.dbo.Invoice_Master M WITH(NOLOCK)
               LEFT JOIN OverseaInvoiceReceiptManagement.dbo.V_IM_SOIncomeSO SO WITH(NOLOCK)
			              ON M.SONumber = SO.OrderSysNo  AND SO.OrderType = 1
               LEFT JOIN overseaOrderManagement.dbo.V_OM_Sub_SO_Master subSo WITH(nolock)
                   ON subSo.SOSysNo = M.SONumber  AND subSo.WareHouseNumber = M.WarehouseNumber
               LEFT JOIN OverseaOrderManagement.dbo.V_OM_SO_CheckShipping SC WITH(NOLOCK)
	                  ON M.SONumber = SC.SOSysNo AND M.Type ='SO'
               LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH(NOLOCK)
                   ON stock.sysno = M.WarehouseNumber
                   #StrWhere#

               SELECT
                  @TotalCount =  COUNT(1)
               FROM #GetInvoiceSO

              SELECT
                  *
              FROM (
              SELECT TOP (@EndNumber)
                  SAPPostDate
                 ,SAPDocNo
                 ,SapImportedStatus
                 ,SapInFailedReason
                 ,SysNo
                 ,fs.CompanyCode
                 ,CustomerSysNo
                 ,OrderSysNo
                 ,OrderType
                 ,IncomeStyle
                 ,PrepayAmt
                 ,OrderID
                 ,OutTime
                 ,OutUserSysNo
                 ,m1.DisplayName AS OutUser
                 ,IncomeUserSysNo
                 ,m2.DisplayName AS IncomeUser
                 ,IncomeTime
                 ,ConfirmUserSysNo
                 ,m3.DisplayName AS ConfirmUser
                 ,ConfirmTime
                 ,IncomeStatus
                 ,WarehouseName AS StockName
                 ,WarehouseNumber AS StockID
                 ,SapCoCode
                 ,InvoiceAmt
                 ,InvoiceNo
                 ,PayTypeSysNo
                 ,SOSysNo
                 ,ShippingCharge
                 ,InvoiceCreateTime
                 ,SOStatus
                 ,IsOutStock
                 ,NewOrderSysNo
                 ,RefundPayTypeSysNo
				         ,OrderAmt
				         ,GiftCardPayAmt
				         ,UnionAmt
                 ,SOTotalAmt
                 ,ISNULL(SOTotalAmt,0.00)-ISNULL(PrepayAmt,0.00)-ISNULL(GiftCardPayAmt,0.00) AS IncomeAmt
                 ,(ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
              FROM #GetInvoiceSO fs
                LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo m1 WITH(NOLOCK)
                  ON m1.UserSysNo=fs.OutUserSysNo
                LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo m2 WITH(NOLOCK)
                  ON m2.UserSysNo=fs.IncomeUserSysNo
                LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo m3 WITH(NOLOCK)
                  ON m3.UserSysNo=fs.ConfirmUserSysNo
           ) result
            WHERE
              RowNumber >@StartNumber;

      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetInvoiceSOAmount" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
       #tempTab1#
         SELECT
            isnull(SUM(isnull(PrepayAmt,0)),0) AS PrepayAmt
           ,isnull(SUM(isnull(IncomeAmt,0)),0)-isnull(SUM(isnull(SOAmt,0)),0) AS IncomeAmt
           ,isnull(SUM(isnull(InvoiceAmt,0)),0) AS TotalAmt
           ,isnull(SUM(isnull(GiftCardPayAmt,0)),0) AS GiftCardPayAmt
           ,isnull(SUM(isnull(UnionAmt,0)),0) AS UnionAmt
           ,isnull(SUM(isnull(TotalSOTotalAmt,0)),0) AS TSOTotalAmt
           ,isnull(SUM(isnull(InvoiceAmt,0)),0) AS TotalAmtForSOOnly
         FROM (
                 SELECT
                     SO.CompanyCode
                    ,SO.fsOrderSysNo AS SOSysNo
                    ,SO.OrderType
                    ,M.WarehouseNumber
                    ,SO.OrderSysNo
                    ,M.InvoiceAmount InvoiceAmt
                    ,ISNULL(-M.PrepayAmt,0) AS PrepayAmt
                    ,SO.GiftCardPayAmt
                    ,UnionAmt=CASE sc.SOType
                         WHEN 6 THEN ( SELECT SUM(isnull(price,0)) FROM OverseaOrderManagement.dbo.V_OM_Sub_SO_Item item WITH  (NOLOCK)
                             WHERE item.ProductSysNo IN(140206,140207,140208)
                             AND item.SOSysNo=M.SONumber)
                         ELSE 0 END
                    ,SOAmt=(--模式5、6的商品金额在统计时需要去除
                          CASE 
                          WHEN sc.StockType='MET' AND sc.ShippingType IN ('NEG','MET') AND sc.InvoiceType='MET'
                              then (SELECT TOP(1) -ISNULL(sm.SOAmt,0) FROM OverseaOrderManagement.dbo.V_OM_SO_Master sm WITH(NOLOCK)
                                  WHERE sm.SysNo=SO.SOSysNo
                                  )
                          ELSE 0
                          END
                      )
                     ,TotalSOTotalAmt = isnull(subSo.SOTotalAmt,0.00)
					           ,IncomeAmt = isnull(subSo.SOTotalAmt,0.00)-ISNULL(-M.PrepayAmt,0.00)-ISNULL(SO.GiftCardPayAmt,0.00)
                 FROM  OverseaInvoiceReceiptManagement.dbo.Invoice_Master M WITH(NOLOCK)
                 LEFT JOIN OverseaInvoiceReceiptManagement.dbo.V_IM_SOIncomeSO SO WITH(NOLOCK)
                     ON M.SONumber = SO.OrderSysNo
                     AND SO.OrderType=1
                 LEFT JOIN overseaOrderManagement.dbo.V_OM_Sub_SO_Master subSo WITH(NOLOCK)
                     ON subSo.SOSysNo = M.SONumber
                     AND subSo.WareHouseNumber = M.WarehouseNumber
                 LEFT JOIN OverseaOrderManagement.dbo.V_OM_SO_CheckShipping SC WITH(NOLOCK)
                     ON M.SONumber = SC.SOSysNo
                     AND M.Type ='SO'
         LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH(NOLOCK)
                 ON stock.sysno = M.WarehouseNumber
         #StrWhere#
         )tmp
      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetInvoiceRO" database="NCService" commandType="Text"  >
    <commandText>
      <![CDATA[
         IF OBJECT_ID(N'tempdb..#GetInvoiceRO') IS NOT NULL
 DROP TABLE #GetInvoiceRO
;

  SELECT DISTINCT
      SO.RefundSAPPostDate AS SAPPostDate
     ,SO.RefundSAPDocNo   AS SAPDocNo
     ,SO.RefundSapImportedStatus AS SapImportedStatus
     ,SO.SapInFailedReason
     ,SO.sysno
     ,SO.CompanyCode
     ,SO.CustomerSysNo
     ,SO.ordersysno
     ,SO.ordertype
     ,SO.incomeStyle
     ,isnull(SO.PrepayAmt,0) AS prepayAmt
     ,SO.orderid AS OrderID
     ,NULL AS OutTime
     ,-999999 AS OutUserSysNo
     ,SO.IncomeUserSysNo
     ,SO.incometime
     ,SO.ConfirmUserSysNo
     ,SO.confirmtime
     ,SO.status AS incomestatus
     ,stock.StockName AS WarehouseName
     ,rr.OwnByWarehouse WarehouseNumber
     ,(SO.OrderAmt - (case  
                      when sc.SOType=6 
                        then (SELECT -sum(isnull(price,0)) FROM OverseaOrderManagement.dbo.V_OM_Sub_SO_Item item WITH  (NOLOCK)
                              WHERE item.ProductSysNo IN(140206,140207,140208)                                
                              AND item.SOSysNo=SO.SOSysNo
                              ) + ISNULL(SO.GiftCardPayAmt,0)
                      WHEN sc.SOType = 9 
                        then (SELECT TOP(1) -ISNULL(sm.SOAmt,0) FROM OverseaOrderManagement.dbo.V_OM_SO_Master sm WITH(NOLOCK)
		                        WHERE sm.SysNo=SO.SOSysNo
                            ) + ISNULL(SO.GiftCardPayAmt,0)
                      WHEN sc.StockType='MET' AND sc.ShippingType IN ('NEG','MET') AND sc.InvoiceType='MET'
                        then (SELECT TOP(1) -ISNULL(sm.SOAmt,0) FROM OverseaOrderManagement.dbo.V_OM_SO_Master sm WITH(NOLOCK)
		                        WHERE sm.SysNo=SO.SOSysNo
                            ) + ISNULL(SO.GiftCardPayAmt,0)
                      ELSE 0 END)) AS InvoiceAmt 
     ,SO.InvoiceNo
     ,-999999 AS PayTypeSysNo
     ,SO.SOSysNo
     ,0.0 AS ShippingCharge
     ,SO.InvoiceCreateTime
     ,NULL AS SOStatus
     ,NULL AS IsOutStock
     ,0 AS NewOrderSysNo
     ,SO.refundpaytype AS RefundPayTypeSysNo
     ,NULL AS SapCoCode
	   ,SO.OrderAmt
     ,SO.GiftCardPayAmt
	   ,UnionAmt=case sc.SOType when 6 then (SELECT -sum(isnull(price,0)) FROM OverseaOrderManagement.dbo.V_OM_Sub_SO_Item item WITH  (NOLOCK)
					WHERE item.ProductSysNo IN(140206,140207,140208)
					AND item.SOSysNo=SO.SOSysNo)
		ELSE 0 END
  INTO #GetInvoiceRO
  FROM OverseaInvoiceReceiptManagement.dbo.V_IM_SOIncomeSM SO WITH(NOLOCK)
  INNER JOIN OverseaServiceManagement.dbo.V_SM_RMARefundTransaction rmi WITH(NOLOCK)
      ON rmi.RefundSysNo = SO.fsOrderSysNo
  INNER JOIN OverseaServiceManagement.dbo.V_SM_RMARegister rr WITH(NOLOCK)
      ON rr.sysno=rmi.registersysno
  LEFT JOIN OverseaOrderManagement.dbo.V_OM_SO_CheckShipping SC WITH(NOLOCK)
	    ON SO.SOSysNo = SC.SOSysNo
  LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH(NOLOCK)
      ON stock.sysno = CAST(rr.OwnByWarehouse AS int) #StrWhere#

       SELECT
           SAPPostDate
          ,SAPDocNo
          ,SapImportedStatus
          ,SapInFailedReason
          ,SysNo
          ,CompanyCode
          ,CustomerSysNo
          ,OrderSysNo
          ,OrderType
          ,IncomeStyle
          ,PrepayAmt
          ,OrderID
          ,OutTime
          ,OutUserSysNo
          ,OutUser
          ,IncomeUserSysNo
          ,IncomeUser
          ,IncomeTime
          ,ConfirmUserSysNo
          ,ConfirmUser
          ,ConfirmTime
          ,IncomeStatus
          ,WarehouseName AS StockName
          ,WarehouseNumber AS StockID
          ,InvoiceAmt
          ,InvoiceNo
          ,PayTypeSysNo
          ,SOSysNo
          ,ShippingCharge
          ,InvoiceCreateTime
          ,SOStatus
          ,IsOutStock
          ,NewOrderSysNo
          ,RefundPayTypeSysNo
		  ,OrderAmt
		  ,GiftCardPayAmt
		  ,UnionAmt
      ,SOTotalAmt
      ,0.00 AS IncomeAmt
       FROM (
               SELECT TOP (@EndNumber)
                   SAPPostDate
                  ,SAPDocNo
                  ,SapImportedStatus
                  ,SapInFailedReason
                  ,SysNo
                  ,fs.CompanyCode
                  ,CustomerSysNo
                  ,OrderSysNo
                  ,OrderType
                  ,IncomeStyle
                  ,PrepayAmt
                  ,OrderID
                  ,OutTime
                  ,OutUserSysNo
                  ,m1.DisplayName AS OutUser
                  ,IncomeUserSysNo
                  ,m2.DisplayName AS IncomeUser
                  ,IncomeTime
                  ,ConfirmUserSysNo
                  ,m3.DisplayName AS ConfirmUser
                  ,ConfirmTime
                  ,IncomeStatus
                  ,WarehouseName
                  ,WarehouseNumber
                  ,InvoiceAmt = InvoiceAmt -- UnionAmt
                  ,InvoiceNo
                  ,PayTypeSysNo
                  ,SOSysNo
                  ,ShippingCharge
                  ,InvoiceCreateTime
                  ,SOStatus
                  ,IsOutStock
                  ,NewOrderSysNo
                  ,RefundPayTypeSysNo
				          ,OrderAmt
				          ,GiftCardPayAmt
				          ,UnionAmt
                  ,SOTotalAmt = InvoiceAmt
                  ,(ROW_NUMBER() OVER(
               ORDER BY #SortColumnName#)) AS RowNumber
               FROM #GetInvoiceRO fs
                LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo m1 WITH(NOLOCK)
                  ON m1.UserSysNo=fs.OutUserSysNo
                LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo m2 WITH(NOLOCK)
                  ON m2.UserSysNo=fs.IncomeUserSysNo
                LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo m3 WITH(NOLOCK)
                  ON m3.UserSysNo=fs.ConfirmUserSysNo
            ) A
            WHERE RowNumber > @StartNumber

        SELECT
            @TotalCount = COUNT(DISTINCT sysno)
        FROM #GetInvoiceRO

 IF OBJECT_ID(N'tempdb..#GetInvoiceRO') IS NOT NULL
 DROP TABLE #GetInvoiceRO ;

      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetInvoiceROAmount" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT
        SUM(OrderAmt)-sum(UnionAmt)-SUM(SOAmt)-SUM(GiftCardPayAmt) as TotalAmt,
        SUM(PrepayAmt) as PrepayAmt,
	      SUM(UnionAmt) as UnionAmt,
        SUM(OrderAmt)-sum(UnionAmt)-SUM(SOAmt)-SUM(GiftCardPayAmt)  AS TSOTotalAmt
      FROM  (SELECT
          SO.SysNo,
          SO.OrderAmt,
          SO.PrepayAmt
          ,UnionAmt=case sc.SOType when 6 then (SELECT -sum(isnull(price,0)) FROM OverseaOrderManagement.dbo.V_OM_Sub_SO_Item item WITH  (NOLOCK)
					  WHERE item.ProductSysNo IN(140206,140207,140208)
					  AND item.SOSysNo=SO.SOSysNo)
		        ELSE 0 END
            ,SOAmt=(--模式5、6的商品金额在统计时需要去除
                          CASE 
                          WHEN sc.StockType='MET' AND sc.ShippingType IN ('NEG','MET') AND sc.InvoiceType='MET'
                              then (SELECT TOP(1) -ISNULL(sm.SOAmt,0) FROM OverseaOrderManagement.dbo.V_OM_SO_Master sm WITH(NOLOCK)
                                  WHERE sm.SysNo=SO.SOSysNo
                                  )
                          ELSE 0
                          END
                      ),
            GiftCardPayAmt = ( case
			                WHEN  sc.SOType = 6 THEN ISNULL(SO.GiftCardPayAmt,0)
			                WHEN  sc.SOType = 9 THEN ISNULL(SO.GiftCardPayAmt,0)
                WHEN sc.StockType='MET' AND sc.ShippingType IN ('NEG','MET') AND sc.InvoiceType='MET'
                  THEN ISNULL(SO.GiftCardPayAmt,0)
			                ELSE 0 END
                )
        FROM OverseaInvoiceReceiptManagement.dbo.V_IM_SOIncomeSM SO WITH(NOLOCK)
		LEFT JOIN OverseaOrderManagement.dbo.V_OM_SO_CheckShipping SC WITH(NOLOCK)
	     ON SO.SOSysNo = SC.SOSysNo
        #StrWhere#
       ) result
      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name ="GetInvoiceROBalance" database ="NCService" commandType="Text">
    <commandText>
      <![CDATA[
         IF OBJECT_ID(N'tempdb..#GetInvoiceROBalance') IS NOT NULL
 DROP TABLE #GetInvoiceROBalance
;
SELECT
    DISTINCT
    SO.BalanceSAPPostDate AS SAPPostDate
   ,SO.BalanceSAPDocNo   AS SAPDocNo
   ,SO.SapImportedStatus
   ,SO.SapInFailedReason
   ,SO.sysno
   ,SO.CompanyCode
   ,SO.CustomerSysNo
   ,SO.ordersysno
   ,SO.ordertype
   ,SO.incomeStyle
   ,ISNULL(SO.PrepayAmt,0) AS prepayAmt
   ,CAST(SO.fsOrderSysNo AS nvarchar) AS OrderID
   ,NULL AS outtime
   ,-999999 AS OutUserSysNo
   ,SO.IncomeUserSysNo
   ,SO.incometime
   ,SO.confirmUserSysNo
   ,SO.confirmtime
   ,SO.status AS incomestatus
   ,stock.StockName AS WarehouseName
   ,rr.OwnByWarehouse WarehouseNumber
   ,SO.orderamt AS InvoiceAmt
   ,SO.InvoiceNo
   ,-999999 AS PayTypeSysNo
   ,SO.SOSysNo
   ,0.0 AS ShippingCharge
   ,SO.InvoiceCreateTime
   ,NULL AS SOStatus
   ,NULL AS IsOutStock
   ,SO.NewOrderSysNo
   ,SO.refundpaytype AS RefundPayTypeSysNo
   ,NULL AS SapCoCode
   ,SO.OrderAmt
   ,SO.GiftCardPayAmt
INTO #GetInvoiceROBalance
FROM OverseaInvoiceReceiptManagement.dbo.V_IM_SOIncomeROBalance SO WITH(NOLOCK)
INNER JOIN OverseaServiceManagement.dbo.V_SM_RMARefundTransaction rmi WITH(NOLOCK)
    ON rmi.RefundSysNo = SO.fsOrderSysNo01
INNER JOIN OverseaServiceManagement.dbo.V_SM_RMARegister rr WITH(NOLOCK)
    ON rr.sysno=rmi.registersysno
LEFT JOIN OverseaOrderManagement.dbo.V_OM_SO_CheckShipping SC WITH(NOLOCK)
	  ON SO.SOSysNo = SC.SOSysNo
LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH(NOLOCK)
    ON stock.sysno = CAST(rr.OwnByWarehouse AS int) #StrWhere#

      SELECT
          @TotalCount = COUNT(sysno)
      FROM #GetInvoiceROBalance

      SELECT
          SAPPostDate
         ,SAPDocNo
         ,SapImportedStatus
         ,SapInFailedReason
         ,SysNo
         ,CompanyCode
         ,CustomerSysNo
         ,OrderSysNo
         ,OrderType
         ,IncomeStyle
         ,PrepayAmt
         ,OrderID
         ,OutTime
         ,OutUserSysNo
         ,OutUser
         ,IncomeUserSysNo
         ,IncomeUser
         ,IncomeTime
         ,ConfirmUserSysNo
         ,ConfirmUser
         ,ConfirmTime
         ,IncomeStatus
         ,WarehouseName AS StockName
         ,WarehouseNumber AS StockID
         ,InvoiceAmt
         ,InvoiceNo
         ,PayTypeSysNo
         ,SOSysNo
         ,ShippingCharge
         ,InvoiceCreateTime
         ,SOStatus
         ,IsOutStock
         ,NewOrderSysNo
         ,RefundPayTypeSysNo
		 ,OrderAmt
		 ,GiftCardPayAmt
     ,SOTotalAmt
     ,0.00 AS IncomeAmt
      FROM (
              SELECT TOP
                  (@EndNumber)
                  SAPPostDate
                 ,SAPDocNo
                 ,SapImportedStatus
                 ,SapInFailedReason
                 ,SysNo
                 ,fs.CompanyCode
                 ,CustomerSysNo
                 ,OrderSysNo
                 ,OrderType
                 ,IncomeStyle
                 ,PrepayAmt
                 ,OrderID
                 ,OutTime
                 ,OutUserSysNo
                 ,m1.DisplayName AS OutUser
                 ,IncomeUserSysNo
                 ,m2.DisplayName AS IncomeUser
                 ,IncomeTime
                 ,ConfirmUserSysNo
                 ,m3.DisplayName AS ConfirmUser
                 ,ConfirmTime
                 ,IncomeStatus
                 ,WarehouseName
                 ,WarehouseNumber
                 ,InvoiceAmt
                 ,InvoiceNo
                 ,PayTypeSysNo
                 ,SOSysNo
                 ,ShippingCharge
                 ,InvoiceCreateTime
                 ,SOStatus
                 ,IsOutStock
                 ,NewOrderSysNo
                 ,RefundPayTypeSysNo
				         ,OrderAmt
				         ,GiftCardPayAmt
                 ,SOTotalAmt = InvoiceAmt
                 ,(ROW_NUMBER() OVER(
              ORDER BY #SortColumnName#)) AS RowNumber
              FROM #GetInvoiceROBalance fs
                LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo m1 WITH(NOLOCK)
                  ON m1.UserSysNo=fs.OutUserSysNo
                LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo m2 WITH(NOLOCK)
                  ON m2.UserSysNo=fs.IncomeUserSysNo
                LEFT OUTER JOIN OverseaArchitecture.dbo.V_AR_UserInfo m3 WITH(NOLOCK)
                  ON m3.UserSysNo=fs.ConfirmUserSysNo
           ) temp
      WHERE
          RowNumber > @StartNumber

 IF OBJECT_ID(N'tempdb..#GetInvoiceROBalance') IS NOT NULL
 DROP TABLE #GetInvoiceROBalance
;
      ]]>
    </commandText>
  </dataCommand>

  <dataCommand name="GetInvoiceROBalanceAmount" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT
        SUM(OrderAmt) as TotalAmt,
        0.0 as PrepayAmt,
        SUM(OrderAmt) as TSOTotalAmt
      FROM  (SELECT
            SO.sysno,
            SO.orderamt
        FROM
        OverseaInvoiceReceiptManagement.dbo.V_IM_SOIncomeROBalance SO WITH(NOLOCK)
        INNER JOIN OverseaServiceManagement.dbo.V_SM_RMARefundTransaction rmi WITH(NOLOCK)
            ON rmi.RefundSysNo = SO.fsOrderSysNo01
        INNER JOIN OverseaServiceManagement.dbo.V_SM_RMARegister rr WITH(NOLOCK)
            ON rr.sysno=rmi.registersysno
        LEFT JOIN OverseaInventoryManagement.dbo.V_INM_Stock stock WITH(NOLOCK)
            ON stock.sysno = CAST(rr.OwnByWarehouse AS int)
        LEFT JOIN OverseaOrderManagement.dbo.V_OM_SO_CheckShipping SC WITH(NOLOCK)
	          ON SO.SOSysNo = SC.SOSysNo
        #StrWhere#
        GROUP BY
        SO.SysNo,
        SO.OrderAmt) result
      ]]>
    </commandText>
  </dataCommand>

  <!--排除测试和作废的数据-->
  <dataCommand name="GetTestCustomerSysNos" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[11873621,3886320,3888160,2573981,2063961,10441021,7336761,4602227,1526327,831550,2431568,12501462]]>
    </commandText>
  </dataCommand>

  <dataCommand name="UpdateSOInvoice" database="SAPService" commandType="Text">
    <commandText>
      <![CDATA[
        UPDATE  [Opc].[dbo].[Shipping_InvoiceLog]  
        SET InvoiceNo = @InvoiceNo 
        ,InvoiceCreateTime =GETDATE()
        WHERE 
            SONumber=@SONumber
            AND WarehouseNumber=@WarehouseNumber
            AND CompanyCode = @CompanyCode
      ]]>
    </commandText>
    <parameters>
      <param name="@SONumber" dbType="Int32"/>
      <param name="@WarehouseNumber" dbType="AnsiStringFixedLength" size="4"/>
      <param name="@InvoiceNo" dbType="String" size="200"/>
      <param name="@CompanyCode" dbType="Int32"/>
    </parameters>
  </dataCommand>



  <!--NoBizQuery 结束-->

  <!--Customer Domain调用 DB私有化-->
  <dataCommand name="Invoice.AdjustPoint" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[EXEC @returnCode=OverseaInvoiceReceiptManagement.dbo.UP_UpdatePointForCustomer
            @CustomerSysno=@CustomerSysno,  
            @Point=@Point,
            @PointType=@PointType,
            @Source=@Source,
            @Memo=@Memo,
            @InUser=@InUser,
            @OperationType=@OperationType,
            @SoSysNo=@SoSysNo,
            @ExpireDate=@ExpireDate,
            @CompanyCode='8601']]>
    </commandText>
    <parameters>
      <param name="@InUser" dbType="Int32"/>
    </parameters>
  </dataCommand>

  <dataCommand name="Invoice.AdjustPointPreCheck" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[EXEC @returnCode=OverseaInvoiceReceiptManagement.dbo.UP_PreUpdatePointForCustomer
            @CustomerSysno=@CustomerSysno,  
            @Point=@Point,
            @PointType=@PointType,
            @Source=@Source,
            @Memo=@Memo,
            @InUser=@InUser,
            @OperationType=@OperationType,
            @SoSysNo=@SoSysNo,
            @CompanyCode='8601']]>
    </commandText>
    <parameters>
      <param name="@InUser" dbType="Int32"/>
    </parameters>
  </dataCommand>

  <dataCommand name="Invoice.AddNewPointForSplitSO" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[  EXEC @returnCode=OverseaInvoiceReceiptManagement.dbo.UP_AddNewPointForSplitSO
                @CustomerSysno=@CustomerSysno,  
                @Point=@Point,
                @ObtainType=@ObtainType,  
                @IsFromSysAccount =0 ,         
                @Memo=@Memo,
                @InUser=@InUser,         
                @SoSysNo=@SoSysNo,
                @CompanyCode=@CompanyCode]]>
    </commandText>
    <parameters>
      <param name="@InUser" dbType="Int32"/>
    </parameters>
  </dataCommand>

  <dataCommand name="Invoice.ConsumePointForSplitSO" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[  EXEC @returnCode=OverseaInvoiceReceiptManagement.dbo.UP_ConsumePointForSplitSO
                      @CustomerSysno = @CustomerSysno, 
	                    @Point = @Point,
	                    @SoSysNo= @SoSysNo,
	                    @ConsumeType =@ConsumeType,
	                    @InUser = @InUser,
	                    @Memo =@Memo,
                      @CompanyCode=@CompanyCode]]>
    </commandText>
    <parameters>
      <param name="@InUser" dbType="Int32"/>
    </parameters>
  </dataCommand>

  <!--查询对账单-->
  <dataCommand name="GetInvoiceReconciliation" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT * INTO #TEMP FROM(
	    SELECT T1.SysNo 
	    ,T1.OrderSysNo
	    ,T1.OrderAmt
	    ,T1.IncomeAmt
	    ,T2.TotalAmount
	    ,T1.IncomeTime
	    ,T1.ConfirmTime
      ,T2.SerialNo
        FROM [IPP3].[dbo].[Finance_SOIncome](NOLOCK) T1 
        LEFT JOIN [OverseaInvoiceReceiptManagement].dbo.TransactionCheckBill(NOLOCK) T2 
        ON T1.OrderType = T2.TransactionType AND T1.ExternalKey = T2.SerialNo 
        #StrWhere#
        UNION 
        SELECT T1.SysNo 
        ,T1.OrderSysNo
        ,T1.OrderAmt
        ,T1.IncomeAmt
        ,T2.TotalAmount
        ,T1.IncomeTime
        ,T1.ConfirmTime
        ,T2.SerialNo
        FROM [OverseaInvoiceReceiptManagement].dbo.TransactionCheckBill(NOLOCK) T2 
        LEFT JOIN [IPP3].[dbo].[Finance_SOIncome](NOLOCK) T1 
        ON T1.OrderType = T2.TransactionType AND T1.ExternalKey = T2.SerialNo 
        #StrWhere#
) T
    
    SELECT @TotalCount =  COUNT(1) FROM #TEMP
    
    SELECT *  FROM (
	  SELECT  TOP (@EndNumber)
	  SysNo
	  ,OrderSysNo
	  ,OrderAmt
	  ,IncomeAmt
	  ,TotalAmount
	  ,IncomeTime
	  ,ConfirmTime
    ,SerialNo
	  ,(ROW_NUMBER() OVER(ORDER BY SysNo)) AS RowNumber 
	  FROM #TEMP
    ) result WHERE
    RowNumber >@StartNumber;

      ]]>
    </commandText>
  </dataCommand>

  <!--Customer Domain调用 DB私有化-->

  <!--创建东方支付账单-->
  <dataCommand name="Invoice.InsertTransactionCheckBill" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
      IF(NOT EXISTS(SELECT 1 FROM [OverseaInvoiceReceiptManagement].[dbo].[TransactionCheckBill](NOLOCK)
WHERE [TransactionType] = @TransactionType AND [SerialNo] = @SerialNo))
BEGIN
INSERT INTO [OverseaInvoiceReceiptManagement].[dbo].[TransactionCheckBill]
           ([TransactionType]
           ,[SoSysNo]
           ,[SerialNo]
           ,[SubOrderTime]
           ,[ProcessingTime]
           ,[TotalAmount]
           ,[ProductAmount]
           ,[ForexCurrency]
           ,[ForexAmount]
           ,[Exchange]
           ,[Tariff]
           ,[FareAmount]
           ,[FareCurrency]
           ,[SubtotalAmount]
           ,[MerchantName]
           ,[InDate]
           ,[InUser])
     VALUES
           (@TransactionType
           ,@SoSysNo
           ,@SerialNo
           ,@SubOrderTime
           ,@ProcessingTime
           ,@TotalAmount
           ,@ProductAmount
           ,@ForexCurrency
           ,@ForexAmount
           ,@Exchange
           ,@Tariff
           ,@FareAmount
           ,@FareCurrency
           ,@SubtotalAmount
           ,@MerchantName
           ,GETDATE()
           ,'IPPSYSTEMADMIN')
END
      ]]>
    </commandText>
    <parameters>
      <param name="@TransactionType" dbType="Int32"/>
      <param name="@SoSysNo" dbType="Int32"/>
      <param name="@SerialNo" dbType="String"/>
      <param name="@SubOrderTime" dbType="String"/>
      <param name="@ProcessingTime" dbType="String"/>
      <param name="@TotalAmount" dbType="Decimal"/>
      <param name="@ProductAmount" dbType="Decimal"/>
      <param name="@ForexCurrency" dbType="String"/>
      <param name="@ForexAmount" dbType="Decimal"/>
      <param name="@Exchange" dbType="Decimal"/>
      <param name="@Tariff" dbType="Decimal"/>
      <param name="@FareAmount" dbType="Decimal"/>
      <param name="@FareCurrency" dbType="String"/>
      <param name="@SubtotalAmount" dbType="Decimal"/>
      <param name="@MerchantName" dbType="String"/>
    </parameters>
  </dataCommand>


  <dataCommand name="SOOutStockInvoiceSync" database="NCService" commandType="Text">
    <commandText>
      <![CDATA[
DECLARE @InvoiceNumber INT
,@Rval	INT
			--Verify Pre-Generate Data
			EXEC @Rval = OverseaInvoiceReceiptManagement.dbo.UP_Invoice_VerifyInvoice
				@SONumber
				,@WarehouseNumber		
				,@InvoiceNo
				,@CreateDate
				,@CompanyCode
			IF(@Rval <> 1099)
				BEGIN
					EXEC OverseaInvoiceReceiptManagement.dbo.UP_Invoice_ADDInvoice
						@SONumber
						,@WarehouseNumber
						,@CreateDate
						,@InvoiceNo
						,@CompanyCode
						,@InvoiceNumber OUTPUT
				
					EXEC OverseaInvoiceReceiptManagement.dbo.UP_Invoice_AddAR
						@SONumber
						,@WarehouseNumber
						,@InvoiceNumber	
				END
			]]>
    </commandText>
    <parameters>
      <param name="@SONumber" dbType="Int32"/>
      <param name="@WarehouseNumber" dbType="String"/>
      <param name="@InvoiceNo" dbType="String"/>
      <param name="@CreateDate" dbType="DateTime"/>
      <param name="@CompanyCode" dbType="String"/>
    </parameters>
  </dataCommand>
  
</dataOperations>