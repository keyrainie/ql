<?xml version="1.0" encoding="utf-8" ?>
<dataOperations xmlns="http://oversea.ECommerce.com/DataOperation">
  <!--创建商品基础信息-->
  <dataCommand name="CreateProductBasicInfo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT @ManufacturerSysNo = ManufacturerSysNo FROM OverseaContentManagement.dbo.Brand(NOLOCK) 
      WHERE SysNo = @BrandSysNo 
      DECLARE @ProductCommonInfoSysno INT;
      --创建商品组
      INSERT INTO OverseaContentManagement.dbo.ProductGroupInfo
			         (ProductName
			         ,BrandSysno
			         ,C3SysNo
			         ,ProductModel
			         ,[Type]
			         ,InDate
			         ,InUser
			         ,CompanyCode
			         ,StoreCompanyCode
			         ,LanguageCode)
		       VALUES
			         (@ProductName
			         ,@BrandSysNo
			         ,@C3SysNo
			         ,N''
			         ,'S'
			         ,GETDATE()
			         ,@InUserName
			         ,@CompanyCode
			         ,@CompanyCode
			         ,@LanguageCode)
         SELECT @ProductGroupSysNo = SCOPE_IDENTITY();
   
      --创建CommonInfo
      DECLARE @StrIsTakePictures CHAR(1);
      SET @StrIsTakePictures = 'N';
      IF(@IsTakePictures = 1)
      BEGIN
	      SET @StrIsTakePictures = 'Y';
      END
      DECLARE @nIsLarge CHAR(1);
      SET @nIsLarge = 0;
      IF(@IsLarge = 'Y')
      BEGIN
	      SET @nIsLarge = 1;
      END
      
      DECLARE @nProductType INT;
      SET @nProductType = 0;
      IF(@ProductType = 'V')
      BEGIN
	      SET @nProductType = 3;
      END
      
      INSERT INTO [OverseaContentManagement].[dbo].[ProductCommonInfo]
                 ([CommonSKUNumber]
                 ,[ProductGroupSysno]
                 ,[UPCCode]
                 ,[ProductName]
                 ,[PromotionTitle]
                 ,[BriefName]
                 ,[Keywords]
                 ,[PMUserSysNo]
                 ,[ProductModel]
                 ,[ProductType]
                 ,[IsTakePictures]
                 ,[PackageList]
                 ,[ProductLink]
                 ,[Attention]
                 ,[Note]
                 ,[CompanyBelongs]
                 ,[OnlyForRank]
                 ,[PicNumber]
                 ,[HostWarrantyDay]
                 ,[PartWarrantyDay]
                 ,[Warranty]
                 ,[ServicePhone]
                 ,[ServiceInfo]
                 ,[IsOfferInvoice]
                 ,[Weight]
                 ,[IsLarge]
                 ,[Length]
                 ,[Width]
                 ,[Height]
                 ,[MinPackNumber]
                 ,[InDate]
                 ,[InUser]
                 ,[EditDate]
                 ,[EditUser]
                 ,[CompanyCode]
                 ,[StoreCompanyCode]
                 ,[LanguageCode]
                 ,[Is360Show]
                 ,[IsVideo]
                 ,[ProductDesc]
                 ,[MaterialNumber]
                 ,[BMCode])
           VALUES
                 (@ProductID
                 ,@ProductGroupSysNo
                 ,@UPCCode
                 ,@ProductName
                 ,N''
                 ,@BriefName
                 ,@Keywords
                 ,@PMUserSysNo
                 ,N''
                 ,@ProductType
                 ,@StrIsTakePictures
                 ,@PackageList
                 ,@ProductLink
                 ,@Attention
                 ,@Note
                 ,'N'
                 ,0
                 ,0
                 ,0
                 ,0
                 ,NULL
                 ,NULL
                 ,NULL
                 ,'N'
                 ,@Weight
                 ,@IsLarge
                 ,0
                 ,0
                 ,0
                 ,0
                 ,GETDATE()
                 ,@InUserName
                 ,NULL
                 ,NULL
                 ,@CompanyCode
                 ,@CompanyCode
                 ,@LanguageCode
                 ,'N'
                 ,'N'
                 ,@ProductDesc
                 ,NULL
                 ,@BMCode)			   
         SELECT @ProductCommonInfoSysno = SCOPE_IDENTITY();
      INSERT INTO [OverseaContentManagement].[dbo].[ProductCommonInfo_Ex]
                 ([SysNo]
                 ,[Performance]
                 ,[ProductDescLong]
                 ,[ProductPhotoDesc]
                 ,[IsGroupProduct]
                 ,[Origin]
                 ,[FrontCategorySysNo]
                 ,[ProductTradeType])
           VALUES
                 (@ProductCommonInfoSysno
                 ,@Performance
                 ,@ProductDescLong
                 ,@ProductPhotoDesc
                 ,@IsGroupProduct
                 ,@OriginCode
                 ,@FrontCategorySysNo
                 ,@ProductTradeType)   
           
      --创建Product	
      INSERT INTO [IPP3].[dbo].[Product_Sequence]
                 ([CreateTime])
           VALUES
                 (GETDATE())
         SELECT @ProductSysNo = SCOPE_IDENTITY();
      INSERT INTO [IPP3].[dbo].[Product]
                 ([SysNo]
                 ,[ProductID]
                 ,[ProductMode]
                 ,[ProductType]
                 ,[ProductName]
                 ,[ProductDesc]
                 ,[ProductDescLong]
                 ,[Performance]
                 ,[Warranty]
                 ,[PackageList]
                 ,[Weight]
                 ,[C3SysNo]
                 ,[ManufacturerSysNo]
                 ,[ProductLink]
                 ,[MultiPicNum]
                 ,[PMUserSysNo]
                 ,[PPMUserSysNo]
                 ,[CreateUserSysNo]
                 ,[CreateTime]
                 ,[Attention]
                 ,[Note]
                 ,[BarCode]
                 ,[Status]
                 ,[IsLarge]
                 ,[OrderByDateTime]
                 ,[BriefName]
                 ,[RemarkCount]
                 ,[RemarkScore]
                 ,[IsConsign]
                 ,[OwnerList]
                 ,[PromotionTitle]
                 ,[ProductTitle]
                 ,[ProductLine]
                 ,[BriefNameAddition]
                 ,[IsHaveValidGift]
                 ,[CompanyCode]
                 ,[LanguageCode]
                 ,[CurrencySysNo]
                 ,[StoreCompanyCode]
                 ,[ProductPhotoDesc]
                 ,[VFItem]
                 ,[BrandSysNo]
                 ,[ProductCommonInfoSysno]
                 ,[MerchantSysNo]
                 ,[DefaultImage]
                 ,[SourceProductID]
                 ,[MaterialNumber]
                 ,[InventoryType]
                 ,[ERPProductID]
                 ,[MerchantProductID]
                 ,[TaxNo]
                 ,[EntryRecord]
                 ,[TariffPrice]
                 ,[ShipType])
           VALUES
                 (@ProductSysNo
                 ,@ProductID
                 ,NULL
                 ,@nProductType
                 ,@ProductName
                 ,@ProductDesc
                 ,@ProductDescLong
                 ,@Performance
                 ,@Warranty
                 ,@PackageList
                 ,@Weight
                 ,@C3SysNo
                 ,@ManufacturerSysNo
                 ,@ProductLink
                 ,0
                 ,@PMUserSysNo
                 ,@PPMUserSysNo
                 ,@InUserSysNo
                 ,GETDATE()
                 ,@Attention
                 ,@Note
                 ,@BMCode
                 ,3
                 ,@nIsLarge
                 ,NULL
                 ,@BriefName
                 ,NULL
                 ,NULL
                 ,1
                 ,NULL
                 ,N''
                 ,@ProductTitle
                 ,@BriefName
                 ,NULL
                 ,0
                 ,@CompanyCode
                 ,@LanguageCode
                 ,@CurrencySysNo
                 ,@CompanyCode
                 ,@ProductPhotoDesc
                 ,NULL
                 ,@BrandSysNo
                 ,@ProductCommonInfoSysno
                 ,@MerchantSysNo
                 ,NULL
                 ,NULL
                 ,NULL
                 ,0
                 ,NULL
                 ,@ProductID
                 ,NULL
                 ,NULL
                 ,NULL
                 ,NULL)
      INSERT INTO [IPP3].[dbo].[Product_Ex]
                 ([SysNo]
                 ,[IsPermitRefund]
                 ,[IsOfferValueAddedInvoice]
                 ,[DMSValue]
                 ,[SaleDays]
                 ,[InventoryDays]
                 ,[CompanyProduct]
                 ,[PreviousProductSysNo]
                 ,[BuyOnlyForRank]
                 ,[IsInstalmentProduct]
                 ,[InstalmentPhase]
                 ,[HoldMark]
                 ,[HoldDate]
                 ,[HoldUser]
                 ,[HoldReason]
                 ,[NoInventoryDays]
                 ,[AccessoriesIsShow]
                 ,[AccessoriesMemo]
                 ,[Keywords]
                 ,[IsTakePictures]
                 ,[ProductNotifyTimes]
                 ,[ProductColor]
                 ,[HostWarrantyDay]
                 ,[PartWarrantyDay]
                 ,[ServicePhone]
                 ,[ServiceInfo]
                 ,[WeighupByWMS]
                 ,[IsChangeStylewithTemplate]
                 ,[VirtualType]
                 ,[CompanyCode]
                 ,[LanguageCode]
                 ,[StoreCompanyCode]
                 ,[PromotionType]
                 ,[AutoAdjustPrice]
                 ,[UnshownAllowSearch]
                 ,[AutoPricingStartDate]
                 ,[AutoPricingEndDate]
                 ,[ImageVersion]
                 ,[EditDate]
                 ,[EditUser]
                 ,[Is360Show]
                 ,[IsVideo]
                 ,[MinPackNumber]
                 ,[IsAutoShowSecHand]
                 ,[PO_Memo]
                 ,[Keywords0]
                 ,[IsBatch]
                 ,[ProductInfoFinishStatus]
                 ,[GiftVoucherType]
                 ,[IsSyncShopPrice]
                 ,[ContractCode]
                 ,[FrontCategorySysNo]
                 ,[ProductTradeType])
           VALUES
                 (@ProductSysNo
                 ,1
                 ,0
                 ,0
                 ,0
                 ,0
                 ,0
                 ,NULL
                 ,0
                 ,0
                 ,0
                 ,NULL
                 ,NULL
                 ,NULL
                 ,NULL
                 ,0
                 ,0
                 ,NULL
                 ,@Keywords
                 ,@IsTakePictures
                 ,0
                 ,NULL
                 ,0
                 ,0
                 ,N''
                 ,N''
                 ,NULL
                 ,1
                 ,NULL
                 ,@CompanyCode
                 ,@LanguageCode
                 ,@CompanyCode
                 ,NULL
                 ,0
                 ,NULL
                 ,NULL
                 ,NULL
                 ,NULL
                 ,NULL
                 ,NULL
                 ,'D'
                 ,'D'
                 ,1
                 ,'D'
                 ,NULL
                 ,NULL
                 ,'N'
                 ,'Y'
                 ,0
                 ,1
                 ,NULL
                 ,@FrontCategorySysNo
                 ,@ProductTradeType)
       INSERT INTO [IPP3].[dbo].[Product_Status]
           ([ProductSysNo]
           ,[InfoStatus]
           ,[InfoUserSysNo]
           ,[InfoTime]
           ,[PicStatus]
           ,[PicUserSysNo]
           ,[PicTime]
           ,[WarrantyStatus]
           ,[WarrantyUserSysNo]
           ,[WarrantyTime]
           ,[PriceStatus]
           ,[PriceUserSysNo]
           ,[PriceTime]
           ,[WeightStatus]
           ,[WeightUserSysNo]
           ,[WeightTime]
           ,[AllowStatus]
           ,[AllowUserSysNo]
           ,[AllowTime]
           ,[FirstOnlineTime]
           ,[LastOnlineTime]
           ,[virtualPicStatus]
           ,[AccessoryStatus]
           ,[CompanyCode]
           ,[LanguageCode]
           ,[StoreCompanyCode])
     VALUES
           (@ProductSysNo
           ,1
           ,NULL
           ,NULL
           ,1
           ,NULL
           ,NULL
           ,1
           ,NULL
           ,NULL
           ,1
           ,NULL
           ,NULL
           ,1
           ,NULL
           ,NULL
           ,1
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,1
           ,1
           ,@CompanyCode
           ,@LanguageCode
           ,@CompanyCode)
           
INSERT INTO [IPP3].[dbo].[Inventory]
           ([ProductSysNo],[AccountQty],[AvailableQty],[AllocatedQty],[OrderQty],[PurchaseQty],
           [VirtualQty],[ConsignQty],[ShiftQty],[CompanyCode],[LanguageCode],[StoreCompanyCode],
           [ReservedQty],[InvalidQty],[ChannelQty])
     VALUES(@ProductSysNo,0,0,0,0,0,0,0,0,@CompanyCode,@LanguageCode,@CompanyCode,0,0,0)
     
     
INSERT INTO [IPP3].[dbo].[Product_Price]
           ([ProductSysNo],[BasicPrice],[CurrentPrice],[UnitCost],[Discount]
           ,[PointType],[MaxPerOrder],[IsWholeSale],[Q1],[P1],[Q2],[P2],[Q3]
           ,[P3],[CashRebate],[Point],[ClearanceSale],[CreateTime]
           ,[UnitCostWithoutTax],[IsExistRankPrice],[PMMemo],[TLMemo],[LastOnSaleTime]
           ,[CompanyCode],[LanguageCode],[CurrencySysNo],[StoreCompanyCode],[ReservedMaxPerOrder]
           ,[VirtualPrice],[SupplyMemo],[SupplyPrice],[MinCommission],[IsUseAlipayVipPrice]
           ,[AlipayVipPrice],[MinCountPerOrder],[ERPZKDSysNo],[UnitCostCurrencySysNo])
     VALUES(@ProductSysNo
           ,0,0,0,0,1,1,0,NULL,NULL,NULL,NULL,NULL,NULL,0,0,1,GETDATE(),0,0,NULL,NULL,NULL
           ,@CompanyCode,@LanguageCode,1,@CompanyCode,NULL,0,NULL,NULL,0,NULL,NULL,1,NULL,1)           
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductID" dbType="String" />
      <param name="@ProductName" dbType="String" />
      <param name="@BriefName" dbType="String" />
      <param name="@ProductTitle" dbType="String" />
      <param name="@Keywords" dbType="String" />
      <param name="@C3SysNo" dbType="Int32" />
      <param name="@BrandSysNo" dbType="Int32" />
      <param name="@MerchantSysNo" dbType="Int32" />
      <param name="@ProductType" dbType="String" />
      <param name="@UPCCode" dbType="String" />
      <param name="@BMCode" dbType="String" />
      <param name="@ProductDesc" dbType="String" />
      <param name="@ProductDescLong" dbType="String" />
      <param name="@Performance" dbType="String" />
      <param name="@PackageList" dbType="String" />
      <param name="@ProductPhotoDesc" dbType="String" />
      <param name="@Warranty" dbType="String" />
      <param name="@Attention" dbType="String" />
      <param name="@Note" dbType="String" />
      <param name="@ManufacturerSysNo" dbType="Int32" />
      <param name="@ProductLink" dbType="String" />
      <param name="@IsLarge" dbType="String" />
      <param name="@CurrencySysNo" dbType="Int32" />
      <param name="@IsTakePictures" dbType="Int32" />
      <param name="@IsGroupProduct" dbType="Int32" />
      <param name="@Weight" dbType="Int32" />
      <param name="@PMUserSysNo" dbType="Int32" />
      <param name="@PPMUserSysNo" dbType="Int32" />
      <param name="@InUserSysNo" dbType="Int32" />
      <param name="@InUserName" dbType="String" />
      <param name="@CompanyCode" dbType="String" />
      <param name="@LanguageCode" dbType="String" />
      <param name="@OriginCode" dbType="String" />
      <param name="@FrontCategorySysNo" dbType="Int32" />
      <param name="@ProductTradeType" dbType="Int32" />
      <param name="@ProductGroupSysNo" dbType="Int32" direction="Output" />
      <param name="@ProductSysNo" dbType="Int32" direction="Output" />
    </parameters>
  </dataCommand>
  <!--获取指定C3的分组属性，2个-->
  <dataCommand name="GetSplitPropertyByCategorySysNo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
SELECT TOP 2 K.SysNo AS PropertySysNo, K.PropertyDescription AS PropertyName,
		G.SysNo AS PropertyGroupSysNo, G.GroupDescription AS PropertyGroupName,
		1 AS IsSplitGroupProperty
      FROM [PMDB].[dbo].[PIM_CategoryTemplateProperty] P WITH(NOLOCK) 
      INNER JOIN [PMDB].[dbo].[PIM_CategoryTemplate] M WITH(NOLOCK) 
          ON M.SysNo=P.CategoryTemplateSysNo 
      INNER JOIN [PMDB].[dbo].[PIM_PropertyGroup] G WITH(NOLOCK)  
          ON P.GroupSysNo=G.SysNo 
      INNER JOIN [PMDB].[dbo].[PIM_Property] K WITH(NOLOCK) 
          ON K.SysNo=P.PropertySysNo
      WHERE K.IsActive = 1 AND [Type] = 'G' AND M.CategorySysNo = @CategorySysNo
      ORDER BY [Priority] ASC 
      ]]>
    </commandText>
    <parameters>
      <param name="@CategorySysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--创建商品组分组属性-->
  <dataCommand name="CreateProductGroupInfoPropertySetting" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
INSERT INTO [OverseaContentManagement].[dbo].[ProductGroupInfo_PropertySetting]
           ([ProductGroupSysno]
           ,[PropertySysno]
           ,[IsPolymeric]
           ,[InDate]
           ,[InUser]
           ,[EditDate]
           ,[EditUser]
           ,[CompanyCode]
           ,[StoreCompanyCode]
           ,[LanguageCode]
           ,[IsDisplayPic]
           ,[ShowName])
     VALUES
           (@ProductGroupSysNo
           ,@PropertySysNo
           ,'Y'
           ,GETDATE()
           ,@InUserName 
           ,NULL
           ,NULL
           ,@CompanyCode
           ,@CompanyCode
           ,@LanguageCode
           ,'N'
           ,@PropertyName)
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductGroupSysNo" dbType="Int32" />
      <param name="@PropertySysNo" dbType="Int32" />
      <param name="@InUserName" dbType="String" />
      <param name="@CompanyCode" dbType="String" />
      <param name="@LanguageCode" dbType="String" />
      <param name="@PropertyName" dbType="String" />
    </parameters>
  </dataCommand>
  <!--获取指定C3的一般属性-->
  <dataCommand name="GetNormalPropertyByCategorySysNo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT P.[SysNo] AS [SysNo] 
             ,[PropertySysNo]
             ,K.PropertyDescription AS [PropertyName]
             ,[GroupSysNo] AS [PropertyGroupSysNo]
             ,G.GroupDescription AS [PropertyGroupName] 
             ,[Priority] 
             ,[IsMustInput] 
             ,[Type]  AS [PropertyType] 
             ,M.CategorySysNo
             ,K.IsActive AS [PropertyStatus]
             ,P.[CompanyCode] 
             ,P.[LanguageCode] 
             ,P.[StoreCompanyCode] 
      FROM [PMDB].[dbo].[PIM_CategoryTemplateProperty] P WITH(NOLOCK) 
      INNER JOIN [PMDB].[dbo].[PIM_CategoryTemplate] M WITH(NOLOCK) 
          ON M.SysNo=P.CategoryTemplateSysNo 
      INNER JOIN [PMDB].[dbo].[PIM_PropertyGroup] G WITH(NOLOCK)  
          ON P.GroupSysNo=G.SysNo 
      INNER JOIN [PMDB].[dbo].[PIM_Property] K WITH(NOLOCK) 
          ON K.SysNo=P.PropertySysNo
      WHERE K.IsActive = 1 AND [Type] = 'A' AND M.CategorySysNo = @CategorySysNo
      ORDER BY [Priority] ASC
      ]]>
    </commandText>
    <parameters>
      <param name="@CategorySysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--获取指定C3的一般属性的值-->
  <dataCommand name="GetNormalPropertyValueByCategorySysNo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT [SysNo] AS PropertyValueSysNo
            ,[PropertySysNo]
            ,[ValueDescription]
            ,[Priority]
            ,[IsActive]
        FROM [PMDB].[dbo].[PIM_PropertyValue](NOLOCK)
        WHERE IsActive = 1  
        AND PropertySysNo IN
        (SELECT [PropertySysNo]
      FROM [PMDB].[dbo].[PIM_CategoryTemplateProperty] P WITH(NOLOCK) 
      INNER JOIN [PMDB].[dbo].[PIM_CategoryTemplate] M WITH(NOLOCK) 
          ON M.SysNo=P.CategoryTemplateSysNo 
      INNER JOIN [PMDB].[dbo].[PIM_Property] K WITH(NOLOCK) 
          ON K.SysNo=P.PropertySysNo
      WHERE K.IsActive = 1 AND M.CategorySysNo = @CategorySysNo)
      ORDER BY PropertySysNo, [Priority]
      ]]>
    </commandText>
    <parameters>
      <param name="@CategorySysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--获取商品组的分组属性-->
  <dataCommand name="GetSplitGroupPropertyByProductGroupSysNo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
      DECLARE @CategorySysNo INT;
      SELECT @CategorySysNo = C3SysNo FROM OverseaContentManagement.dbo.ProductGroupInfo(NOLOCK)
      WHERE SysNo = @ProductGroupSysNo
      SELECT [PropertySysNo]
             ,K.PropertyDescription AS [PropertyName]
             ,[GroupSysNo] AS [PropertyGroupSysNo]
             ,G.GroupDescription AS [PropertyGroupName] 
             ,[Priority] 
             ,[IsMustInput] 
             ,[Type]  AS [PropertyType] 
             ,M.CategorySysNo
             ,K.IsActive AS [PropertyStatus]
             ,P.[CompanyCode] 
             ,P.[LanguageCode] 
             ,P.[StoreCompanyCode] 
      FROM [PMDB].[dbo].[PIM_CategoryTemplateProperty] P WITH(NOLOCK) 
      INNER JOIN [PMDB].[dbo].[PIM_CategoryTemplate] M WITH(NOLOCK) 
          ON M.SysNo=P.CategoryTemplateSysNo 
      INNER JOIN [PMDB].[dbo].[PIM_PropertyGroup] G WITH(NOLOCK)  
          ON P.GroupSysNo=G.SysNo 
      INNER JOIN [PMDB].[dbo].[PIM_Property] K WITH(NOLOCK) 
          ON K.SysNo=P.PropertySysNo
      WHERE K.IsActive = 1 AND [Type] = 'G'
      AND M.CategorySysNo = @CategorySysNo
      AND P.PropertySysNo IN (
      SELECT PropertySysno FROM [OverseaContentManagement].[dbo].[ProductGroupInfo_PropertySetting](NOLOCK)
      WHERE ProductGroupSysno = @ProductGroupSysNo)
      ORDER BY [Priority] ASC
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductGroupSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--获取商品组的分组属性的值-->
  <dataCommand name="GetSplitGroupPropertyValueByProductGroupSysNo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT [SysNo] AS PropertyValueSysNo
            ,[PropertySysNo]
            ,[ValueDescription]
            ,[Priority]
            ,[IsActive]
        FROM [PMDB].[dbo].[PIM_PropertyValue](NOLOCK)
        WHERE IsActive = 1  
        AND PropertySysNo IN
        (SELECT PropertySysno FROM [OverseaContentManagement].[dbo].[ProductGroupInfo_PropertySetting](NOLOCK)
      WHERE ProductGroupSysno = @ProductGroupSysNo)
      ORDER BY PropertySysNo, [Priority]
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductGroupSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--获取商品基础信息-->
  <dataCommand name="GetProductBasicInfoByProductGroupSysNo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT TOP 1 CommonInfo.ProductGroupSysno AS ProductGroupSysNo,
	        CommonInfo.ProductName,
	        CommonInfo.BriefName,
	        CommonInfo.PromotionTitle,
	        CommonInfo.[Keywords],
	        ProductGroupInfo.C3SysNo,
	        ProductGroupInfo.BrandSysno AS BrandSysNo,
	        CommonInfo.ProductType,
	        CommonInfo.UPCCode,
	        CommonInfo.BMCode,
	        CommonInfo.ProductDesc,
	        CommonInfoEx.ProductDescLong,
	        CommonInfoEx.Performance,
	        CommonInfo.PackageList,
	        CommonInfoEx.ProductPhotoDesc,
	        CommonInfo.Warranty,
	        CommonInfo.Attention,
	        CommonInfo.Note,
	        CommonInfo.ProductLink,
	        CommonInfo.IsLarge,
	        CASE WHEN CommonInfo.IsTakePictures = 'Y' THEN 1 ELSE 0 END AS IsTakePictures,
	        CommonInfoEx.IsGroupProduct,
	        CommonInfo.[Weight],
	        CommonInfo.PMUserSysNo,
	        CommonInfoEx.Origin AS OriginCode,
	        GroupInfo.BrandSysno AS BrandSysNo,
          CommonInfoEx.FrontCategorySysNo,
          CommonInfoEx.ProductTradeType
        FROM OverseaContentManagement.dbo.ProductCommonInfo(NOLOCK) CommonInfo
        INNER JOIN OverseaContentManagement.dbo.ProductCommonInfo_Ex(NOLOCK) CommonInfoEx
	        ON CommonInfo.SysNo = CommonInfoEx.SysNo
        INNER JOIN OverseaContentManagement.dbo.ProductGroupInfo(NOLOCK) ProductGroupInfo
	        ON CommonInfo.ProductGroupSysno = ProductGroupInfo.SysNo
	      INNER JOIN OverseaContentManagement.dbo.ProductGroupInfo(NOLOCK) GroupInfo
			    ON CommonInfo.ProductGroupSysno = GroupInfo.SysNo
        WHERE CommonInfo.ProductGroupSysno = @ProductGroupSysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductGroupSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--获取商家前台根级类别-->
  <dataCommand name="GetParentFrontProductCategory" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT [SysNo]
            ,[CategoryCode]
            ,[CategoryName]
            ,[ParentCategoryCode]
            ,[IsLeaf]
            ,[Priority]
            ,[Status]
            ,[FPCLinkUrlMode]
            ,[FPCLinkUrl]
            -- C3SysNo 在表里不存在
            --,[C3SysNo]
            ,[SellerSysNo]
            ,[InUserSysNo]
            ,[InUserName]
            ,[InDate]
            ,[EditUserSysNo]
            ,[EditUserName]
            ,[EditDate]
        FROM [ECStore].[dbo].[FrontProductCategory](NOLOCK)
        WHERE SellerSysNo = @SellerSysNo AND ParentCategoryCode IS NULL
      ]]>
    </commandText>
    <parameters>
      <param name="@SellerSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--获取类别文本-->
  <dataCommand name="GetCategoryTextByCategorySysNo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
      DECLARE @CategoryName NVARCHAR(100), @C2SysNo INT, @C1SysNo INT;  
      SELECT @CategoryName = C3Name, @C2SysNo = C2SysNo
      FROM [IPP3].[dbo].[Category3](NOLOCK)
      WHERE SysNo = @C3SysNo
      SELECT @CategoryName = C2Name + ' > ' + @CategoryName, @C1SysNo = C1SysNo
      FROM [IPP3].[dbo].[Category2](NOLOCK)
      WHERE SysNo = @C2SysNo
      SELECT @CategoryName = C1Name + ' > ' + @CategoryName
      FROM [IPP3].[dbo].[Category1](NOLOCK)
      WHERE SysNo = @C1SysNo
      select @CategoryName
      ]]>
    </commandText>
    <parameters>
      <param name="@C3SysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--获取指定父级类别编码的商家前台类别-->
  <dataCommand name="GetFrontProductCategoryByParentCode" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT [SysNo]
            ,[CategoryCode]
            ,[CategoryName]
            ,[ParentCategoryCode]
            ,[IsLeaf]
            ,[Priority]
            ,[Status]
            ,[FPCLinkUrlMode]
            ,[FPCLinkUrl]
            -- C3SysNo 在表里不存在
            --,[C3SysNo]
            ,[SellerSysNo]
            ,[InUserSysNo]
            ,[InUserName]
            ,[InDate]
            ,[EditUserSysNo]
            ,[EditUserName]
            ,[EditDate]
        FROM [ECStore].[dbo].[FrontProductCategory](NOLOCK)
        WHERE ParentCategoryCode = @ParentCategoryCode
      ]]>
    </commandText>
    <parameters>
      <param name="@ParentCategoryCode" dbType="String" />
    </parameters>
  </dataCommand>
  <!--获取指定商家编号和指定商家前台类别编号的类别-->
  <dataCommand name="GetFrontProductCategoryBySysNo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT [SysNo]
            ,[CategoryCode]
            ,[CategoryName]
            ,[ParentCategoryCode]
            ,[IsLeaf]
            ,[Priority]
            ,[Status]
            ,[FPCLinkUrlMode]
            ,[FPCLinkUrl]
            ,[UIModeType]
            ,[SellerSysNo]
            ,[InUserSysNo]
            ,[InUserName]
            ,[InDate]
            ,[EditUserSysNo]
            ,[EditUserName]
            ,[EditDate]
        FROM [ECStore].[dbo].[FrontProductCategory](NOLOCK)
        WHERE SellerSysNo = @SellerSysNo AND SysNo = @SysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@SellerSysNo" dbType="Int32" />
      <param name="@SysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--获取指定类别编码的商家前台类别-->
  <dataCommand name="GetFrontProductCategoryByCode" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT [SysNo]
            ,[CategoryCode]
            ,[CategoryName]
            ,[ParentCategoryCode]
            ,[IsLeaf]
            ,[Priority]
            ,[Status]
            ,[FPCLinkUrlMode]
            ,[FPCLinkUrl]
            ,[SellerSysNo]
            ,[InUserSysNo]
            ,[InUserName]
            ,[InDate]
            ,[EditUserSysNo]
            ,[EditUserName]
            ,[EditDate]
        FROM [ECStore].[dbo].[FrontProductCategory](NOLOCK)
        WHERE CategoryCode = @CategoryCode
      ]]>
    </commandText>
    <parameters>
      <param name="@CategoryCode" dbType="String" />
    </parameters>
  </dataCommand>
  <!--获取同系商品ID前缀最大的商品ID-->
  <dataCommand name="GetProductSameIDMaxProductID" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
  SELECT MAX([ProductID]) AS [ProductID]
  FROM [IPP3].[dbo].[Product](NOLOCK)
  WHERE [ProductID] LIKE (@Code + N'%')
        ]]>
    </commandText>
    <parameters>
      <param name="@Code" dbType="String"/>
    </parameters>
  </dataCommand>
  <!--获取商品产地列表-->
  <dataCommand name="GetProductCountryList" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
  SELECT [SysNo]
      ,[CountryName]
      ,[CountryCode]
  FROM [IPP3].[dbo].[Country](NOLOCK)
        ]]>
    </commandText>
    <parameters>
    </parameters>
  </dataCommand>
  <!--获取商品组是否设置同组商品-->
  <dataCommand name="GetIsGroupProduct" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
 SELECT B.IsGroupProduct FROM [OverseaContentManagement].[dbo].[ProductCommonInfo](NOLOCK) A
	INNER JOIN [OverseaContentManagement].[dbo].[ProductCommonInfo_Ex](NOLOCK) B
		ON A.SysNo = B.SysNo
	WHERE A.ProductGroupSysno = @ProductGroupSysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@ProductGroupSysNo" dbType="Int32"/>
    </parameters>
  </dataCommand>
  <!--编辑商品基础信息-->
  <dataCommand name="UpdateProductBasicInfoByProductGroupSysNo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
DECLARE @OldProductName NVARCHAR(200);
SELECT TOP 1 @OldProductName = ProductName
FROM [OverseaContentManagement].[dbo].[ProductCommonInfo](NOLOCK)
WHERE ProductGroupSysno = @ProductGroupSysNo

DECLARE @TblProductIDList TABLE(ProductID NVARCHAR(100));
INSERT INTO @TblProductIDList  
SELECT CommonSKUNumber FROM [OverseaContentManagement].[dbo].[ProductCommonInfo](NOLOCK)
WHERE ProductGroupSysno = @ProductGroupSysNo AND CommonSKUNumber IS NOT NULL

DECLARE @StrIsTakePictures CHAR(1);
SET @StrIsTakePictures = 'N';
IF(@IsTakePictures = 1)
BEGIN
SET @StrIsTakePictures = 'Y';
END
UPDATE [OverseaContentManagement].[dbo].[ProductCommonInfo]
  SET ProductName = @ProductName,
  UPCCode = @UPCCode,
  BriefName = @BriefName,
  Keywords = @Keywords,
  IsTakePictures = @StrIsTakePictures,
  PackageList = @PackageList,
  Attention = @Attention,
  Note = @Note,
  ProductDesc = @ProductDesc,
  BMCode = @BMCode,
  EditDate = GETDATE(),
  EditUser = @EditUserName
WHERE ProductGroupSysno = @ProductGroupSysNo

UPDATE [OverseaContentManagement].[dbo].[ProductCommonInfo_Ex]
  SET Performance = @Performance,
	  ProductDescLong = @ProductDescLong,
	  ProductPhotoDesc = @ProductPhotoDesc,
	  ProductTradeType = @ProductTradeType,
	  IsGroupProduct = @IsGroupProduct,
    FrontCategorySysNo = @FrontCategorySysNo
WHERE SysNo IN 
(SELECT SysNo FROM [OverseaContentManagement].[dbo].[ProductCommonInfo]
(NOLOCK) WHERE ProductGroupSysno = @ProductGroupSysNo)

UPDATE [IPP3].[dbo].[Product]
  SET ProductName = @ProductName,
  ProductDesc = @ProductDesc,
  ProductDescLong = @ProductDescLong,
  Performance = @Performance,
  PackageList = @PackageList,
  Attention = @Attention,
  Note = @Note,
  BarCode = @BMCode,
  BriefName = @BriefName,
  ProductLine = @BriefName,
  ProductPhotoDesc = @ProductPhotoDesc,
  ProductTitle = REPLACE(ProductTitle, @OldProductName, @ProductName)
WHERE ProductID IN
(SELECT ProductID FROM @TblProductIDList) 

UPDATE [IPP3].[dbo].[Product_Ex]
SET ProductTradeType = @ProductTradeType,
    FrontCategorySysNo = @FrontCategorySysNo
WHERE SysNo IN
(SELECT SysNo FROM IPP3.dbo.Product(NOLOCK)
WHERE ProductID IN
(SELECT ProductID FROM @TblProductIDList))
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductID" dbType="String" />
      <param name="@ProductName" dbType="String" />
      <param name="@BriefName" dbType="String" />
      <param name="@ProductTitle" dbType="String" />
      <param name="@Keywords" dbType="String" />
      <param name="@C3SysNo" dbType="Int32" />
      <param name="@BrandSysNo" dbType="Int32" />
      <param name="@MerchantSysNo" dbType="Int32" />
      <param name="@ProductType" dbType="String" />
      <param name="@UPCCode" dbType="String" />
      <param name="@BMCode" dbType="String" />
      <param name="@ProductDesc" dbType="String" />
      <param name="@ProductDescLong" dbType="String" />
      <param name="@Performance" dbType="String" />
      <param name="@PackageList" dbType="String" />
      <param name="@ProductPhotoDesc" dbType="String" />
      <param name="@Warranty" dbType="String" />
      <param name="@Attention" dbType="String" />
      <param name="@Note" dbType="String" />
      <param name="@ManufacturerSysNo" dbType="Int32" />
      <param name="@ProductLink" dbType="String" />
      <param name="@IsLarge" dbType="String" />
      <param name="@CurrencySysNo" dbType="Int32" />
      <param name="@IsTakePictures" dbType="Int32" />
      <param name="@IsGroupProduct" dbType="Int32" />
      <param name="@Weight" dbType="Int32" />
      <param name="@PMUserSysNo" dbType="Int32" />
      <param name="@PPMUserSysNo" dbType="Int32" />
      <param name="@InUserSysNo" dbType="Int32" />
      <param name="@InUserName" dbType="String" />
      <param name="@CompanyCode" dbType="String" />
      <param name="@LanguageCode" dbType="String" />
      <param name="@OriginCode" dbType="String" />
      <param name="@FrontCategorySysNo" dbType="Int32" />
      <param name="@ProductGroupSysNo" dbType="Int32" />
      <param name="@ProductTradeType" dbType="Int32" />
      <param name="@EditUserName" dbType="String" />
    </parameters>
  </dataCommand>
  <!--新建商品属性-->
  <dataCommand name="CreateProductProperties" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT @PropertyGroupSysNo = SysNo FROM [PMDB].[dbo].[PIM_PropertyGroup](NOLOCK)
	      WHERE [GroupDescription] = @PropertyGroupName
      SELECT @PropertySysNo = SysNo FROM [PMDB].[dbo].[PIM_Property](NOLOCK)
	      WHERE [PropertyDescription] = @PropertyName
      SELECT @PropertyValueSysNo = SysNo FROM [PMDB].[dbo].[PIM_PropertyValue](NOLOCK)
	      WHERE [ValueDescription] = @ValueDescription

      INSERT INTO [OverseaContentManagement].[dbo].[ProductCommonInfo_Property]
                ([CommonSKUNumber]
                ,[GroupSysno]
                ,[PropertySysno]
                ,[ValueSysno]
                ,[ManualInput]
                ,[EditDate]
                ,[EditUser]
                ,[CompanyCode]
                ,[StoreCompanyCode]
                ,[LanguageCode])
          VALUES
                (@CommonSKUNumber
                ,@PropertyGroupSysNo
                ,@PropertySysNo
                ,@PropertyValueSysNo
                ,NULL
                ,GETDATE()
                ,@InUserName
                ,@CompanyCode
                ,@CompanyCode
                ,@LanguageCode)

      INSERT INTO [PMDB].[dbo].[PIM_ProductProperty] 
	      ([ProductSysNo] 
	      ,[GroupSysNo] 
	      ,[PropertySysNo] 
	      ,[ValueSysNo] 
	      ,[ManualInput] 
	      ,[IsActive] 
	      ,[LastEditUserSysNo] 
	      ,[LastEditTime] 
	      ,[CompanyCode] 
	      ,[LanguageCode] 
	      ,[StoreCompanyCode]) 
      VALUES      
		      (@ProductSysNo
	      ,@PropertyGroupSysNo 
	      ,@PropertySysNo 
	      ,@PropertyValueSysNo 
	      ,NULL 
	      ,1 
	      ,@InUserSysNo 
	      ,GETDATE() 
	      ,@CompanyCode 
	      ,@LanguageCode 
	      ,@CompanyCode)  
      ]]>
    </commandText>
    <parameters>
      <param name="@CommonSKUNumber" dbType="String" />
      <param name="@ProductSysNo" dbType="Int32" />      
      <param name="@PropertyGroupSysNo" dbType="Int32" />
      <param name="@PropertySysNo" dbType="Int32" />
      <param name="@PropertyValueSysNo" dbType="Int32" />
      <param name="@PropertyName" dbType="String" />
      <param name="@PropertyGroupName" dbType="String" />
      <param name="@ValueDescription" dbType="String" />
      <param name="@InUserSysNo" dbType="Int32" />
      <param name="@InUserName" dbType="String" />
      <param name="@CompanyCode" dbType="String" />
      <param name="@LanguageCode" dbType="String" />
    </parameters>
  </dataCommand>
  <!--更新产品一般属性-->
  <dataCommand name="UpdateProductPerformanceByProductID" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
  UPDATE [OverseaContentManagement].[dbo].[ProductCommonInfo_Ex]
	  SET [Performance] = @Performance
  WHERE SysNo IN
  (SELECT SysNo FROM [OverseaContentManagement].[dbo].[ProductCommonInfo](NOLOCK)
  WHERE CommonSKUNumber = @ProductID)

  UPDATE [IPP3].[dbo].[Product]
	  SET [Performance] = @Performance
  WHERE ProductID = @ProductID
        ]]>
    </commandText>
    <parameters>
      <param name="@ProductID" dbType="String" />
      <param name="@Performance" dbType="String" />
    </parameters>
  </dataCommand>
  <!--根据商品组编号删除商品一般属性-->
  <dataCommand name="DeleteProductNormalPropertyByProductGroupSysNo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
      DELETE FROM OverseaContentManagement.dbo.ProductCommonInfo_Property 
      WHERE CommonSKUNumber IN
      (SELECT CommonSKUNumber FROM OverseaContentManagement.dbo.ProductCommonInfo WITH(NOLOCK)
      WHERE ProductGroupSysno = @ProductGroupSysNo AND CommonSKUNumber IS NOT NULL)
      AND PropertySysNo NOT IN
      (SELECT [PropertySysno]
        FROM [OverseaContentManagement].[dbo].[ProductGroupInfo_PropertySetting](NOLOCK)
        WHERE ProductGroupSysno = @ProductGroupSysNo)
    
      DELETE PMDB.dbo.PIM_ProductProperty 
      WHERE ProductSysNo IN 
      (SELECT P.SysNo FROM OverseaContentManagement.dbo.ProductCommonInfo(NOLOCK) C
	      INNER JOIN IPP3.dbo.Product(NOLOCK) P
	      ON C.CommonSKUNumber = P.ProductID
      WHERE C.ProductGroupSysno = @ProductGroupSysNo AND C.CommonSKUNumber IS NOT NULL)
      AND PropertySysNo NOT IN
      (SELECT [PropertySysno]
        FROM [OverseaContentManagement].[dbo].[ProductGroupInfo_PropertySetting](NOLOCK)
        WHERE ProductGroupSysno = @ProductGroupSysNo)
        ]]>
    </commandText>
    <parameters>
      <param name="@ProductGroupSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--根据商品组编号获取商品列表-->
  <dataCommand name="GetProductListByProductGroupSysNo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
SELECT P.[SysNo] AS ProductSysNo
      ,[ProductID]
      ,[ProductMode]
      ,P.[ProductType]
      ,P.[ProductName]
      ,P.[ProductDesc]
      ,[ProductDescLong]
      ,[Performance]
      ,P.[Warranty]
      ,P.[PackageList]
      ,P.[Weight]
      ,[C3SysNo]
      ,[ManufacturerSysNo]
      ,P.[ProductLink]
      ,[MultiPicNum]
      ,P.[PMUserSysNo]
      ,[PPMUserSysNo]
      ,[CreateUserSysNo]
      ,P.[CreateTime]
      ,P.[Attention]
      ,P.[Note]
      ,[BarCode]
      ,[Status]
      ,P.[IsLarge]
      ,[OrderByDateTime]
      ,P.[BriefName]
      ,[RemarkCount]
      ,[RemarkScore]
      ,[IsConsign]
      ,[OwnerList]
      ,P.[PromotionTitle]
      ,[ProductTitle]
      ,[ProductLine]
      ,[BriefNameAddition]
      ,[IsHaveValidGift]
      ,Price.[CurrencySysNo] 
      ,[ProductPhotoDesc]
      ,[VFItem]
      ,[BrandSysNo]
      ,[ProductCommonInfoSysno]
      ,[MerchantSysNo]
      ,[DefaultImage]
      ,[SourceProductID]
      ,P.[MaterialNumber]
      ,[InventoryType]
      ,[ERPProductID]
      ,[MerchantProductID]
      ,[TaxNo]
      ,[EntryRecord]
      ,[TariffPrice]
      ,[ShipType]
      ,ISNULL((SELECT 1 FROM OverseaContentManagement.dbo.Product_PromotionTitle(NOLOCK)      
WHERE ProductSysNo = P.SysNo AND [Type] = 'CountDown'), 0) AS HaveTimePromotionTitle
      ,PEI.EntryStatus
      ,price.CurrentPrice
      FROM OverseaContentManagement.dbo.ProductCommonInfo(NOLOCK) C
	      INNER JOIN IPP3.dbo.Product(NOLOCK) P
	      ON C.CommonSKUNumber = P.ProductID
        LEFT JOIN IPP3.dbo.Product_EntryInfo(NOLOCK) PEI
        ON P.SysNo = PEI.ProductSysNo
        LEFT JOIN ipp3.dbo.Product_Price   price with(nolock)
        ON p.sysno=price.ProductSysNo
      WHERE P.[Status] <> -1 AND C.ProductGroupSysno = @ProductGroupSysNo AND C.CommonSKUNumber IS NOT NULL
        ]]>
    </commandText>
    <parameters>
      <param name="@ProductGroupSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--根据商品编号获取商品-->
  <dataCommand name="GetProductByProductSysNo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT [SysNo] AS ProductSysNo
      ,[ProductID]
      ,[ProductMode]
      ,[ProductType]
      ,[ProductName]
      ,[ProductDesc]
      ,[ProductDescLong]
      ,[Performance]
      ,[Warranty]
      ,[PackageList]
      ,[Weight]
      ,[C3SysNo]
      ,[ManufacturerSysNo]
      ,[ProductLink]
      ,[MultiPicNum]
      ,[PMUserSysNo]
      ,[PPMUserSysNo]
      ,[CreateUserSysNo]
      ,[CreateTime]
      ,[Attention]
      ,[Note]
      ,[BarCode]
      ,[Status]
      ,[IsLarge]
      ,[OrderByDateTime]
      ,[BriefName]
      ,[RemarkCount]
      ,[RemarkScore]
      ,[IsConsign]
      ,[OwnerList]
      ,[PromotionTitle]
      ,[ProductTitle]
      ,[ProductLine]
      ,[BriefNameAddition]
      ,[IsHaveValidGift]
      ,[CurrencySysNo]
      ,[ProductPhotoDesc]
      ,[VFItem]
      ,[BrandSysNo]
      ,[ProductCommonInfoSysno]
      ,[MerchantSysNo]
      ,[DefaultImage]
      ,[SourceProductID]
      ,[MaterialNumber]
      ,[InventoryType]
      ,[ERPProductID]
      ,[MerchantProductID]
      ,[TaxNo]
      ,[EntryRecord]
      ,[TariffPrice]
      ,[ShipType]
      FROM IPP3.dbo.Product(NOLOCK)
      WHERE Sysno = @ProductSysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--获取单个商品维护信息-->
  <dataCommand name="GetSingleProductMaintainInfo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[

SELECT P.SysNo AS ProductSysNo,
	   P.ProductTitle,
	   P.ProductMode,
	   P.PromotionTitle,
	   PT.PromotionTitle AS TimePromotionTitle,
	   PT.BeginDate AS PromotionTitleBeginDate,
	   PT.Enddate AS PromotionTitleEndDate,
     P.Weight,
     PCI.Length,
     PCI.Width,
     PCI.Height,
     PEX.ProductOutUrl,
     V.InvoiceType AS MerchantInvoiceType
FROM IPP3.dbo.Product(NOLOCK) P
	LEFT JOIN [OverseaContentManagement].[dbo].[Product_PromotionTitle](NOLOCK) PT
	ON P.SysNo = PT.ProductSysNo AND [Type] = 'CountDown'
  LEFT JOIN OverseaContentManagement.dbo.ProductCommonInfo(NOLOCK) PCI
  ON P.ProductID = PCI.CommonSKUNumber
	LEFT JOIN IPP3.dbo.Product_Ex(NOLOCK) PEX
	ON P.SysNo = PEX.SysNo
	LEFT JOIN IPP3.dbo.Vendor_Ex(NOLOCK) V
	ON P.MerchantSysNo = V.VendorSysNo
WHERE P.SysNo = @ProductSysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--更新单个商品信息-->
  <dataCommand name="UpdateSingleProductMaintainInfo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
--常规促销语
DECLARE @OldPromotionTitle NVARCHAR(100);
SELECT @OldPromotionTitle = ISNULL(PromotionTitle, N'')
FROM IPP3.dbo.Product(NOLOCK)
WHERE SysNo = @ProductSysNo
IF(@PromotionTitle IS NULL OR @PromotionTitle = N'')
BEGIN
	DELETE FROM [OverseaContentManagement].[dbo].[Product_PromotionTitle]
	WHERE ProductSysNo = @ProductSysNo AND [Type] = 'Normal'
	UPDATE IPP3.dbo.Product
		SET ProductName = REPLACE(ProductName, @OldPromotionTitle, N''),
    PromotionTitle = @PromotionTitle
	WHERE SysNo = @ProductSysNo	
END
ELSE
BEGIN
	IF(EXISTS(SELECT 1 FROM [OverseaContentManagement].[dbo].[Product_PromotionTitle](NOLOCK)
	WHERE ProductSysNo = @ProductSysNo AND [Type] = 'Normal'))
	BEGIN
		UPDATE [OverseaContentManagement].[dbo].[Product_PromotionTitle]
			SET PromotionTitle = @PromotionTitle,
				EditDate = GETDATE(),
				EditUser = @InUserName
		WHERE ProductSysNo = @ProductSysNo AND [Type] = 'Normal'
	END
	ELSE
	BEGIN
		INSERT INTO [OverseaContentManagement].[dbo].[Product_PromotionTitle]
			   ([ProductSysNo]
			   ,[PromotionTitle]
			   ,[Type]
			   ,[BeginDate]
			   ,[Enddate]
			   ,[Status]
			   ,[InDate]
			   ,[InUser]
			   ,[EditDate]
			   ,[EditUser]
			   ,[CompanyCode]
			   ,[LanguageCode]
			   ,[StoreCompanyCode])
		 VALUES
			   (@ProductSysNo
			   ,@PromotionTitle
			   ,'Normal'
			   ,NULL
			   ,NULL
			   ,'A'
			   ,GETDATE()
			   ,@InUserName
			   ,NULL
			   ,NULL
			   ,@CompanyCode
			   ,@LanguageCode
			   ,@CompanyCode)
	END
	UPDATE IPP3.dbo.Product
		SET PromotionTitle = @PromotionTitle
	WHERE SysNo = @ProductSysNo
	IF(LEN(@OldPromotionTitle) > 0)
	BEGIN
		UPDATE IPP3.dbo.Product
			SET ProductName = REPLACE(ProductName, @OldPromotionTitle, @PromotionTitle)
		WHERE SysNo = @ProductSysNo	
	END
	ELSE
	BEGIN
		UPDATE IPP3.dbo.Product
			SET ProductName = ProductName + @PromotionTitle
		WHERE SysNo = @ProductSysNo	
	END
END

--时效促销语
IF(@TimePromotionTitle IS NULL OR @TimePromotionTitle = N'')
BEGIN
	SELECT @OldPromotionTitle = ISNULL(PromotionTitle, N'')
	FROM [OverseaContentManagement].[dbo].[Product_PromotionTitle](NOLOCK)
	WHERE ProductSysNo = @ProductSysNo AND [Type] = 'CountDown'

	DELETE FROM [OverseaContentManagement].[dbo].[Product_PromotionTitle]
	WHERE ProductSysNo = @ProductSysNo AND [Type] = 'CountDown'
	UPDATE IPP3.dbo.Product
		SET ProductName = REPLACE(ProductName, '<font color=''red''>' + @OldPromotionTitle + '</font>', N'')
	WHERE SysNo = @ProductSysNo
END
ELSE
BEGIN
	IF(EXISTS(SELECT 1 FROM [OverseaContentManagement].[dbo].[Product_PromotionTitle](NOLOCK)
	WHERE ProductSysNo = @ProductSysNo AND [Type] = 'CountDown'))
	BEGIN
		UPDATE [OverseaContentManagement].[dbo].[Product_PromotionTitle]
			SET PromotionTitle = @TimePromotionTitle,
				BeginDate = @PromotionTitleBeginDate,
				Enddate = @PromotionTitleEndDate,
				[Status] = 'A',
				EditDate = GETDATE(),
				EditUser = @InUserName
		WHERE ProductSysNo = @ProductSysNo AND [Type] = 'CountDown'
	END
	ELSE
	BEGIN
		INSERT INTO [OverseaContentManagement].[dbo].[Product_PromotionTitle]
			   ([ProductSysNo]
			   ,[PromotionTitle]
			   ,[Type]
			   ,[BeginDate]
			   ,[Enddate]
			   ,[Status]
			   ,[InDate]
			   ,[InUser]
			   ,[EditDate]
			   ,[EditUser]
			   ,[CompanyCode]
			   ,[LanguageCode]
			   ,[StoreCompanyCode])
		 VALUES
			   (@ProductSysNo
			   ,@TimePromotionTitle
			   ,'CountDown'
			   ,@PromotionTitleBeginDate
			   ,@PromotionTitleEndDate
			   ,'A'
			   ,GETDATE()
			   ,@InUserName
			   ,NULL
			   ,NULL
			   ,@CompanyCode
			   ,@LanguageCode
			   ,@CompanyCode)
	END
END

--更新型号
UPDATE IPP3.dbo.Product
	SET ProductMode = @ProductMode,
      Weight = @Weight
WHERE SysNo = @ProductSysNo
--更新商品外部导购链接
UPDATE IPP3.dbo.Product_Ex
	SET ProductOutUrl = @ProductOutUrl
WHERE SysNo = @ProductSysNo

DECLARE @ProductID NVARCHAR(100);
SELECT @ProductID = [ProductID] FROM IPP3.dbo.Product(NOLOCK) WHERE SysNo = @ProductSysNo
UPDATE OverseaContentManagement.dbo.ProductCommonInfo
  SET ProductModel = @ProductMode,
      Weight = @Weight,
      Length = @Length,
      Width = @Width,
      Height = @Height,
      EditDate = GETDATE(),
      EditUser = @InUserName
WHERE CommonSKUNumber = @ProductID
        ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@PromotionTitle" dbType="String" />
      <param name="@TimePromotionTitle" dbType="String" />
      <param name="@PromotionTitleBeginDate" dbType="String" />
      <param name="@PromotionTitleEndDate" dbType="String" />
      <param name="@ProductMode" dbType="String" />
      <param name="@Weight" dbType="Decimal" />
      <param name="@Length" dbType="Decimal" />
      <param name="@Width" dbType="Decimal" />
      <param name="@Height" dbType="Decimal" />
      <param name="@InUserName" dbType="String" />
      <param name="@CompanyCode" dbType="String" />
      <param name="@LanguageCode" dbType="String" />
      <param name="@ProductOutUrl" dbType="String" />
    </parameters>
  </dataCommand>
  <!--获取商家财务类型-->
  <dataCommand name="GetVendorInvoiceType" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
SELECT InvoiceType FROM IPP3.dbo.Vendor_Ex(NOLOCK)
WHERE VendorSysNo = @VendorSysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@VendorSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--获取商品组分组属性商品列表-->
  <dataCommand name="GetProductGroupSplitPropertyProductList" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT ProductSysNo FROM PMDB.dbo.PIM_ProductProperty(NOLOCK)
WHERE ProductSysNo IN (
SELECT P.SysNo FROM OverseaContentManagement.dbo.ProductCommonInfo(NOLOCK) C
  INNER JOIN IPP3.dbo.Product(NOLOCK) P
  ON [Status] <> -1 AND C.CommonSKUNumber = P.ProductID
WHERE C.ProductGroupSysno = @ProductGroupSysNo AND C.CommonSKUNumber IS NOT NULL)
AND PropertySysNo = @PropertySysNo
AND ValueSysNo = @ValueSysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@ProductGroupSysNo" dbType="Int32" />
      <param name="@PropertySysNo" dbType="Int32" />
      <param name="@ValueSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--创建同组商品-->
  <dataCommand name="CreateGroupProduct" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
DECLARE @ProductCommonInfoSysno INT;

--创建CommonInfo
INSERT INTO OverseaContentManagement.dbo.ProductCommonInfo
SELECT TOP 1 @ProductID
      ,[ProductGroupSysno]
      ,[UPCCode]
      ,[ProductName]
      ,[PromotionTitle]
      ,[BriefName]
      ,[Keywords]
      ,[PMUserSysNo]
      ,[ProductModel]
      ,[ProductType]
      ,[IsTakePictures]
      ,[PackageList]
      ,[ProductLink]
      ,[Attention]
      ,[Note]
      ,[CompanyBelongs]
      ,[OnlyForRank]
      ,[PicNumber]
      ,[HostWarrantyDay]
      ,[PartWarrantyDay]
      ,[Warranty]
      ,[ServicePhone]
      ,[ServiceInfo]
      ,[IsOfferInvoice]
      ,[Weight]
      ,[IsLarge]
      ,[Length]
      ,[Width]
      ,[Height]
      ,[MinPackNumber]
      ,[InDate]
      ,[InUser]
      ,[EditDate]
      ,[EditUser]
      ,[CompanyCode]
      ,[StoreCompanyCode]
      ,[LanguageCode]
      ,[Is360Show]
      ,[IsVideo]
      ,[ProductDesc]
      ,[MaterialNumber]
      ,[BMCode]
    FROM OverseaContentManagement.dbo.ProductCommonInfo(NOLOCK)
    WHERE ProductGroupSysno = @ProductGroupSysNo
SELECT @ProductCommonInfoSysno = SCOPE_IDENTITY();

INSERT INTO [OverseaContentManagement].[dbo].[ProductCommonInfo_Ex]    
SELECT TOP 1 @ProductCommonInfoSysno,[Performance],[ProductDescLong],
[ProductPhotoDesc],[IsGroupProduct],[Origin],ProductTradeType,FrontCategorySysNo
FROM OverseaContentManagement.dbo.ProductCommonInfo(NOLOCK) CommonInfo
	INNER JOIN OverseaContentManagement.dbo.ProductCommonInfo_Ex(NOLOCK) CommonInfoEx
	ON CommonInfo.SysNo = CommonInfoEx.SysNo
WHERE ProductGroupSysno = @ProductGroupSysNo    

--创建Product	
INSERT INTO [IPP3].[dbo].[Product_Sequence]
         ([CreateTime])
   VALUES
         (GETDATE())
 SELECT @ProductSysNo = SCOPE_IDENTITY();
INSERT INTO [IPP3].[dbo].[Product]
         ([SysNo]
         ,[ProductID]
         ,[ProductMode]
         ,[ProductType]
         ,[ProductName]
         ,[ProductDesc]
         ,[ProductDescLong]
         ,[Performance]
         ,[Warranty]
         ,[PackageList]
         ,[Weight]
         ,[C3SysNo]
         ,[ManufacturerSysNo]
         ,[ProductLink]
         ,[MultiPicNum]
         ,[PMUserSysNo]
         ,[PPMUserSysNo]
         ,[CreateUserSysNo]
         ,[CreateTime]
         ,[Attention]
         ,[Note]
         ,[BarCode]
         ,[Status]
         ,[IsLarge]
         ,[OrderByDateTime]
         ,[BriefName]
         ,[RemarkCount]
         ,[RemarkScore]
         ,[IsConsign]
         ,[OwnerList]
         ,[PromotionTitle]
         ,[ProductTitle]
         ,[ProductLine]
         ,[BriefNameAddition]
         ,[IsHaveValidGift]
         ,[CompanyCode]
         ,[LanguageCode]
         ,[CurrencySysNo]
         ,[StoreCompanyCode]
         ,[ProductPhotoDesc]
         ,[VFItem]
         ,[BrandSysNo]
         ,[ProductCommonInfoSysno]
         ,[MerchantSysNo]
         ,[DefaultImage]
         ,[SourceProductID]
         ,[MaterialNumber]
         ,[InventoryType]
         ,[ERPProductID]
         ,[MerchantProductID]
         ,[TaxNo]
         ,[EntryRecord]
         ,[TariffPrice]
         ,[ShipType])
SELECT TOP 1 @ProductSysNo,@ProductID,NULL,
CASE WHEN CommonInfo.ProductType = 'V' THEN 3
ELSE 0 END AS ProductType,CommonInfo.ProductName,
CommonInfo.ProductDesc,CommonInfoEx.ProductDescLong,
CommonInfoEx.Performance,ISNULL(CommonInfo.Warranty, N''),
CommonInfo.PackageList,CommonInfo.[Weight],
GroupInfo.C3SysNo,Brand.ManufacturerSysNo,CommonInfo.ProductLink,0,
CommonInfo.PMUserSysNo,CommonInfo.PMUserSysNo,@InUserSysNo,
GETDATE(),CommonInfo.Attention,CommonInfo.Note,
CommonInfo.BMCode,3,CASE WHEN CommonInfo.IsLarge = 'Y' THEN 1
ELSE 0 END AS IsLarge,NULL,CommonInfo.BriefName,NULL,NULL,
1,NULL,N'',CommonInfo.ProductName + '(' + @SplitName + ')',CommonInfo.BriefName,NULL,0,
CommonInfo.CompanyCode,CommonInfo.LanguageCode,1,
CommonInfo.CompanyCode,CommonInfoEx.ProductPhotoDesc,NULL,
GroupInfo.BrandSysno,@ProductCommonInfoSysno,@SellerSysNo,
NULL,NULL,NULL,0,NULL,@ProductID,NULL,NULL,NULL,NULL
FROM OverseaContentManagement.dbo.ProductCommonInfo(NOLOCK) CommonInfo
	INNER JOIN OverseaContentManagement.dbo.ProductCommonInfo_Ex(NOLOCK) CommonInfoEx
	ON CommonInfo.SysNo = CommonInfoEx.SysNo
	INNER JOIN OverseaContentManagement.dbo.ProductGroupInfo(NOLOCK) GroupInfo
	ON CommonInfo.ProductGroupSysno = GroupInfo.SysNo
  INNER JOIN OverseaContentManagement.dbo.Brand(NOLOCK) Brand
  ON GroupInfo.BrandSysno = Brand.SysNo
WHERE ProductGroupSysno = @ProductGroupSysNo   
      
INSERT INTO [IPP3].[dbo].[Product_Ex]
         ([SysNo]
         ,[IsPermitRefund]
         ,[IsOfferValueAddedInvoice]
         ,[DMSValue]
         ,[SaleDays]
         ,[InventoryDays]
         ,[CompanyProduct]
         ,[PreviousProductSysNo]
         ,[BuyOnlyForRank]
         ,[IsInstalmentProduct]
         ,[InstalmentPhase]
         ,[HoldMark]
         ,[HoldDate]
         ,[HoldUser]
         ,[HoldReason]
         ,[NoInventoryDays]
         ,[AccessoriesIsShow]
         ,[AccessoriesMemo]
         ,[Keywords]
         ,[IsTakePictures]
         ,[ProductNotifyTimes]
         ,[ProductColor]
         ,[HostWarrantyDay]
         ,[PartWarrantyDay]
         ,[ServicePhone]
         ,[ServiceInfo]
         ,[WeighupByWMS]
         ,[IsChangeStylewithTemplate]
         ,[VirtualType]
         ,[CompanyCode]
         ,[LanguageCode]
         ,[StoreCompanyCode]
         ,[PromotionType]
         ,[AutoAdjustPrice]
         ,[UnshownAllowSearch]
         ,[AutoPricingStartDate]
         ,[AutoPricingEndDate]
         ,[ImageVersion]
         ,[EditDate]
         ,[EditUser]
         ,[Is360Show]
         ,[IsVideo]
         ,[MinPackNumber]
         ,[IsAutoShowSecHand]
         ,[PO_Memo]
         ,[Keywords0]
         ,[IsBatch]
         ,[ProductInfoFinishStatus]
         ,[GiftVoucherType]
         ,[IsSyncShopPrice]
         ,[ContractCode]
         ,[ProductTradeType]
         ,[FrontCategorySysNo])
   SELECT TOP 1 @ProductSysNo,1,0,0,0,0,0,NULL,0,0,0,NULL,NULL,NULL,NULL,0,0,NULL
         ,CommonInfo.Keywords
         ,CASE WHEN CommonInfo.IsTakePictures = 'Y' THEN 1
         ELSE 0 END
         ,0,NULL,0,0,N'',N'',NULL,1
         ,NULL,CommonInfo.CompanyCode,CommonInfo.LanguageCode,CommonInfo.CompanyCode
         ,NULL,0,NULL,NULL,NULL,NULL,NULL,NULL,'D','D',1,'D',NULL,NULL,'N','Y',0,1,NULL
         ,ProductTradeType,FrontCategorySysNo
         FROM OverseaContentManagement.dbo.ProductCommonInfo(NOLOCK) CommonInfo
			INNER JOIN OverseaContentManagement.dbo.ProductCommonInfo_Ex(NOLOCK) CommonInfoEx
			ON CommonInfo.SysNo = CommonInfoEx.SysNo
			INNER JOIN OverseaContentManagement.dbo.ProductGroupInfo(NOLOCK) GroupInfo
			ON CommonInfo.ProductGroupSysno = GroupInfo.SysNo
		WHERE ProductGroupSysno = @ProductGroupSysNo 
    
INSERT INTO [IPP3].[dbo].[Product_Status]
           ([ProductSysNo]
           ,[InfoStatus]
           ,[InfoUserSysNo]
           ,[InfoTime]
           ,[PicStatus]
           ,[PicUserSysNo]
           ,[PicTime]
           ,[WarrantyStatus]
           ,[WarrantyUserSysNo]
           ,[WarrantyTime]
           ,[PriceStatus]
           ,[PriceUserSysNo]
           ,[PriceTime]
           ,[WeightStatus]
           ,[WeightUserSysNo]
           ,[WeightTime]
           ,[AllowStatus]
           ,[AllowUserSysNo]
           ,[AllowTime]
           ,[FirstOnlineTime]
           ,[LastOnlineTime]
           ,[virtualPicStatus]
           ,[AccessoryStatus]
           ,[CompanyCode]
           ,[LanguageCode]
           ,[StoreCompanyCode])
     SELECT TOP 1 @ProductSysNo
           ,1
           ,NULL
           ,NULL
           ,1
           ,NULL
           ,NULL
           ,1
           ,NULL
           ,NULL
           ,1
           ,NULL
           ,NULL
           ,1
           ,NULL
           ,NULL
           ,1
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,1
           ,1
           ,CommonInfo.CompanyCode,CommonInfo.LanguageCode,CommonInfo.CompanyCode
FROM OverseaContentManagement.dbo.ProductCommonInfo(NOLOCK) CommonInfo
			INNER JOIN OverseaContentManagement.dbo.ProductCommonInfo_Ex(NOLOCK) CommonInfoEx
			ON CommonInfo.SysNo = CommonInfoEx.SysNo
			INNER JOIN OverseaContentManagement.dbo.ProductGroupInfo(NOLOCK) GroupInfo
			ON CommonInfo.ProductGroupSysno = GroupInfo.SysNo
		WHERE ProductGroupSysno = @ProductGroupSysNo  

DECLARE @CompanyCode VARCHAR(50), @LanguageCode VARCHAR(50);
SELECT @CompanyCode = CompanyCode,@LanguageCode = LanguageCode
FROM OverseaContentManagement.dbo.ProductCommonInfo(NOLOCK)
WHERE ProductGroupSysno = @ProductGroupSysNo

INSERT INTO [IPP3].[dbo].[Inventory]
           ([ProductSysNo],[AccountQty],[AvailableQty],[AllocatedQty],[OrderQty],[PurchaseQty],
           [VirtualQty],[ConsignQty],[ShiftQty],[CompanyCode],[LanguageCode],[StoreCompanyCode],
           [ReservedQty],[InvalidQty],[ChannelQty])
     VALUES(@ProductSysNo,0,0,0,0,0,0,0,0,@CompanyCode,@LanguageCode,@CompanyCode,0,0,0)
     
     
INSERT INTO [IPP3].[dbo].[Product_Price]
           ([ProductSysNo],[BasicPrice],[CurrentPrice],[UnitCost],[Discount]
           ,[PointType],[MaxPerOrder],[IsWholeSale],[Q1],[P1],[Q2],[P2],[Q3]
           ,[P3],[CashRebate],[Point],[ClearanceSale],[CreateTime]
           ,[UnitCostWithoutTax],[IsExistRankPrice],[PMMemo],[TLMemo],[LastOnSaleTime]
           ,[CompanyCode],[LanguageCode],[CurrencySysNo],[StoreCompanyCode],[ReservedMaxPerOrder]
           ,[VirtualPrice],[SupplyMemo],[SupplyPrice],[MinCommission],[IsUseAlipayVipPrice]
           ,[AlipayVipPrice],[MinCountPerOrder],[ERPZKDSysNo],[UnitCostCurrencySysNo])
     VALUES(@ProductSysNo
           ,0,0,0,0,1,1,0,NULL,NULL,NULL,NULL,NULL,NULL,0,0,1,GETDATE(),0,0,NULL,NULL,NULL
           ,@CompanyCode,@LanguageCode,1,@CompanyCode,NULL,0,NULL,NULL,0,NULL,NULL,1,NULL,1)    
        ]]>
    </commandText>
    <parameters>
      <param name="@ProductGroupSysNo" dbType="Int32" />
      <param name="@ProductID" dbType="String" />
      <param name="@SellerSysNo" dbType="Int32" />
      <param name="@InUserSysNo" dbType="Int32" />
      <param name="@SplitName" dbType="String" />
      <param name="@ManufacturerSysNo" dbType="Int32" />
      <param name="@ProductSysNo" dbType="Int32" direction="Output" />
    </parameters>
  </dataCommand>
  <!--根据商品组编号获取构建商品ID值-->
  <dataCommand name="GetBuildProductIDDataByProductGroupSysNo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT PG.BrandSysno,CX.Origin, PG.C3SysNo FROM OverseaContentManagement.dbo.ProductGroupInfo(NOLOCK) PG
	INNER JOIN OverseaContentManagement.dbo.ProductCommonInfo(NOLOCK) C
	ON PG.SysNo = C.ProductGroupSysno
	INNER JOIN OverseaContentManagement.dbo.ProductCommonInfo_Ex(NOLOCK) CX
	ON C.SysNo = CX.SysNo
WHERE PG.SysNo = @ProductGroupSysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@ProductGroupSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--获取C1列表-->
  <dataCommand name="GetCategory1List" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
DECLARE @TblList1 TABLE (SysNo INT);
INSERT INTO @TblList1
SELECT MAX(SysNo) FROM IPP3.dbo.Vendor_ModifyRequest(NOLOCK)
WHERE VendorSysNo = @SellerSysNo
GROUP BY VendorSysNo, C3SysNo
SELECT [SysNo]
      ,[C1Name] AS CategoryName
  FROM [IPP3].[dbo].[Category1](NOLOCK)
  WHERE [Status] = 0 AND SysNo IN(  
SELECT C1.SysNo FROM [IPP3].[dbo].[Vendor_Manufacturer](NOLOCK) VM
  INNER JOIN [IPP3].[dbo].[Category3](NOLOCK) C3
  ON VM.C3SysNo = C3.SysNo
  LEFT JOIN IPP3.dbo.Vendor_ModifyRequest(NOLOCK) VMR
  ON VM.VendorSysNo = VMR.VendorSysNo AND VM.C3SysNo = VMR.C3SysNo
  INNER JOIN @TblList1 T
  ON VMR.SysNo = T.SysNo AND VMR.Status <> 0
  INNER JOIN [IPP3].[dbo].[Category2](NOLOCK) C2
  ON C3.C2SysNo = C2.SysNo
  INNER JOIN [IPP3].[dbo].[Category1](NOLOCK) C1
  ON C2.C1SysNo = C1.SysNo
WHERE VM.VendorSysNo = @SellerSysNo AND VM.[Status] <> 2)
        ]]>
    </commandText>
    <parameters>
      <param name="@SellerSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--获取C2列表-->
  <dataCommand name="GetCategory2List" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
DECLARE @TblList2 TABLE (SysNo INT);
INSERT INTO @TblList2
SELECT MAX(SysNo) FROM IPP3.dbo.Vendor_ModifyRequest(NOLOCK)
WHERE VendorSysNo = @SellerSysNo
GROUP BY VendorSysNo, C3SysNo
SELECT [SysNo]
      ,[C2Name] AS CategoryName
  FROM [IPP3].[dbo].[Category2](NOLOCK)
  WHERE [Status] = 0 AND C1SysNo = @C1SysNo AND SysNo IN(  
SELECT C2.SysNo FROM [IPP3].[dbo].[Vendor_Manufacturer](NOLOCK) VM
  INNER JOIN [IPP3].[dbo].[Category3](NOLOCK) C3
  ON VM.C3SysNo = C3.SysNo
  LEFT JOIN IPP3.dbo.Vendor_ModifyRequest(NOLOCK) VMR
  ON VM.VendorSysNo = VMR.VendorSysNo AND VM.C3SysNo = VMR.C3SysNo
  INNER JOIN @TblList2 T
  ON VMR.SysNo = T.SysNo AND VMR.Status <> 0
  INNER JOIN [IPP3].[dbo].[Category2](NOLOCK) C2
  ON C3.C2SysNo = C2.SysNo
WHERE VM.VendorSysNo = @SellerSysNo AND VM.[Status] <> 2)
        ]]>
    </commandText>
    <parameters>
      <param name="@SellerSysNo" dbType="Int32" />
      <param name="@C1SysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--获取C3列表-->
  <dataCommand name="GetCategory3List" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
DECLARE @TblList3 TABLE (SysNo INT);
INSERT INTO @TblList3
SELECT MAX(SysNo) FROM IPP3.dbo.Vendor_ModifyRequest(NOLOCK)
WHERE VendorSysNo = @SellerSysNo
GROUP BY VendorSysNo, C3SysNo
SELECT [SysNo]
      ,[C3Name] AS CategoryName
  FROM [IPP3].[dbo].[Category3](NOLOCK)
  WHERE [Status] = 0 AND C2SysNo = @C2SysNo AND SysNo IN(  
SELECT C3.SysNo FROM [IPP3].[dbo].[Vendor_Manufacturer](NOLOCK) VM
  INNER JOIN [IPP3].[dbo].[Category3](NOLOCK) C3
  ON VM.C3SysNo = C3.SysNo
  LEFT JOIN IPP3.dbo.Vendor_ModifyRequest(NOLOCK) VMR
  ON VM.VendorSysNo = VMR.VendorSysNo AND VM.C3SysNo = VMR.C3SysNo
  INNER JOIN @TblList3 T
  ON VMR.SysNo = T.SysNo AND VMR.Status <> 0
WHERE VM.VendorSysNo = @SellerSysNo AND VM.[Status] <> 2)
        ]]>
    </commandText>
    <parameters>
      <param name="@SellerSysNo" dbType="Int32" />
      <param name="@C2SysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <!--获取所有的C1列表-->
  <dataCommand name="GetAllCategory1List" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
SELECT [SysNo]
      ,[C1Name] AS CategoryName
  FROM [IPP3].[dbo].[Category1](NOLOCK)
  WHERE [Status] = 0
        ]]>
    </commandText>
    <parameters>
    </parameters>
  </dataCommand>
  <!--获取所有的C2列表-->
  <dataCommand name="GetAllCategory2List" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
SELECT [SysNo]
      ,[C2Name] AS CategoryName
  FROM [IPP3].[dbo].[Category2](NOLOCK)
  WHERE [Status] = 0 AND C1SysNo = @C1SysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@C1SysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--获取所有的C3列表-->
  <dataCommand name="GetAllCategory3List" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
SELECT [SysNo]
      ,[C3Name] AS CategoryName
  FROM [IPP3].[dbo].[Category3](NOLOCK)
  WHERE [Status] = 0 AND C2SysNo = @C2SysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@C2SysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  
  <!--保存商品价格信息-->
  <dataCommand name="SaveProductPriceInfo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
IF(EXISTS(SELECT 1 FROM [IPP3].[dbo].[Product_Price](NOLOCK)
WHERE ProductSysNo = @ProductSysNo))
BEGIN
	UPDATE [IPP3].[dbo].[Product_Price]
		SET BasicPrice = @BasicPrice,
			CurrentPrice = @CurrentPrice,
			PointType = @PointType,
			Discount = @Discount,
			MinCountPerOrder = @MinCountPerOrder,
			MaxPerOrder = @MaxPerOrder,
			VirtualPrice = @VirtualPrice,
			CashRebate = @CashRebate,
			Point = @Point,
			UnitCost = @UnitCost,
			UnitCostWithoutTax = @UnitCostWithoutTax
		WHERE ProductSysNo = @ProductSysNo
    
  DECLARE @ProductID NVARCHAR(100);
  SELECT @ProductID = [ProductID] FROM IPP3.dbo.Product(NOLOCK) WHERE SysNo = @ProductSysNo
  UPDATE OverseaContentManagement.dbo.ProductCommonInfo
    SET EditDate = GETDATE(),
        EditUser = @InUserName
    WHERE CommonSKUNumber = @ProductID
  
END
ELSE
BEGIN
	INSERT INTO [IPP3].[dbo].[Product_Price]
           ([ProductSysNo]
           ,[BasicPrice]
           ,[CurrentPrice]
           ,[UnitCost]
           ,[Discount]
           ,[PointType]
           ,[MaxPerOrder]
           ,[IsWholeSale]
           ,[Q1]
           ,[P1]
           ,[Q2]
           ,[P2]
           ,[Q3]
           ,[P3]
           ,[CashRebate]
           ,[Point]
           ,[ClearanceSale]
           ,[CreateTime]
           ,[UnitCostWithoutTax]
           ,[IsExistRankPrice]
           ,[PMMemo]
           ,[TLMemo]
           ,[LastOnSaleTime]
           ,[CompanyCode]
           ,[LanguageCode]
           ,[CurrencySysNo]
           ,[StoreCompanyCode]
           ,[ReservedMaxPerOrder]
           ,[VirtualPrice]
           ,[SupplyMemo]
           ,[SupplyPrice]
           ,[MinCommission]
           ,[IsUseAlipayVipPrice]
           ,[AlipayVipPrice]
           ,[MinCountPerOrder]
           ,[ERPZKDSysNo]
           ,[UnitCostCurrencySysNo])
     VALUES
           (@ProductSysNo
           ,@BasicPrice
           ,@CurrentPrice
           ,@UnitCost
           ,@Discount
           ,@PointType
           ,@MaxPerOrder
           ,0
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,NULL
           ,@CashRebate
           ,@Point
           ,1
           ,GETDATE()
           ,@UnitCostWithoutTax
           ,0
           ,NULL
           ,NULL
           ,NULL
           ,@CompanyCode
           ,@LanguageCode
           ,1
           ,@CompanyCode
           ,NULL
           ,@VirtualPrice
           ,NULL
           ,NULL
           ,0
           ,NULL
           ,NULL
           ,@MinCountPerOrder
           ,NULL
           ,1)
END
        ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@BasicPrice" dbType="Decimal" />
      <param name="@CurrentPrice" dbType="Decimal" />
      <param name="@PointType" dbType="Int32" />
      <param name="@Discount" dbType="Decimal" />
      <param name="@MaxPerOrder" dbType="Int32" />
      <param name="@MinCountPerOrder" dbType="Int32" />
      <param name="@VirtualPrice" dbType="Decimal" />
      <param name="@CashRebate" dbType="Int32" />
      <param name="@Point" dbType="Int32" />
      <param name="@UnitCost" dbType="Decimal" />
      <param name="@UnitCostWithoutTax" dbType="Decimal" />
      <param name="@CompanyCode" dbType="String" />
      <param name="@LanguageCode" dbType="String" />
      <param name="@InUserName" dbType="String" />
    </parameters>
  </dataCommand>
  <!--根据商品编号获取商品价格信息-->
  <dataCommand name="GetProductPriceInfoByProductSysNo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
SELECT [SysNo]
      ,[ProductSysNo]
      ,[BasicPrice]
      ,[CurrentPrice]
      ,[UnitCost]
      ,[Discount]
      ,[PointType]
      ,[MaxPerOrder]
      ,[IsWholeSale]
      ,[Q1]
      ,[P1]
      ,[Q2]
      ,[P2]
      ,[Q3]
      ,[P3]
      ,[CashRebate]
      ,[Point]
      ,[ClearanceSale]
      ,[CreateTime]
      ,[UnitCostWithoutTax]
      ,[IsExistRankPrice]
      ,[PMMemo]
      ,[TLMemo]
      ,[LastOnSaleTime]
      ,[CompanyCode]
      ,[LanguageCode]
      ,[CurrencySysNo]
      ,[StoreCompanyCode]
      ,[ReservedMaxPerOrder]
      ,[VirtualPrice]
      ,[SupplyMemo]
      ,[SupplyPrice]
      ,[MinCommission]
      ,[IsUseAlipayVipPrice]
      ,[AlipayVipPrice]
      ,[MinCountPerOrder]
      ,[ERPZKDSysNo]
      ,[UnitCostCurrencySysNo]
  FROM [IPP3].[dbo].[Product_Price](NOLOCK)
  WHERE [ProductSysNo] = @ProductSysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--根据商品编号获取商品备案信息-->
  <dataCommand name="GetProductEntryInfoByProductSysNo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
SELECT PEI.[SysNo]
      ,[ProductSysNo]
      ,[ProductName_EN] AS ProductNameEN
      ,[Specifications]
      ,[Functions]
      ,[Component]
      ,[Origin]
      ,[Purpose]
      ,[TaxQty]
      ,[TaxUnit]
      ,[ApplyUnit]
      ,[GrossWeight]
      ,[BizType]
      ,[ApplyDistrict]
      ,[Product_SKUNO] AS ProductSKUNO
      ,[Supplies_Serial_No] AS SuppliesSerialNo
      ,[ApplyQty]
      ,[SuttleWeight]
      ,PEI.[Note]
      ,[Supplies_Serial_No_1] AS SuppliesSerialNo1
      ,[TariffRate]
      ,[TariffCode]
      ,[StoreType]
      ,[EntryCode]
      ,[Remark1]
      ,[Remark2]
      ,[Remark3]
      ,[Remark4]
      ,[ProductOthterName]
      ,[ManufactureDate]
      ,[SourceCompany]
      ,[BMCode]
      ,[UPCCode]
      ,[DefaultLeadTimeDays]
      ,[RealLeadTimeDays]
      ,[EntryStatus]
      ,P.ProductID
      ,P.BrandSysNo
      ,ISNULL(Brand.BrandName_Ch, Brand.BrandName_En) AS BrandName
      ,P.ProductName
      ,P.ProductTitle
      ,Country.CountryName
      ,AuditNote
  FROM [IPP3].[dbo].[Product_EntryInfo](NOLOCK) PEI
  INNER JOIN [IPP3].[dbo].[Product](NOLOCK) P
  ON PEI.ProductSysNo = P.SysNo
  INNER JOIN [IPP3].[dbo].[Product_Ex](NOLOCK) PEX
  ON PEI.ProductSysNo = PEX.SysNo
  LEFT JOIN OverseaContentManagement.dbo.Brand(NOLOCK) Brand
  ON P.BrandSysNo = Brand.SysNo
  LEFT JOIN [IPP3].[dbo].[Country](NOLOCK) Country
  ON PEI.Origin = Country.CountryCode
  WHERE ProductSysNo = @ProductSysNo
        ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--保存商品备案信息-->
  <dataCommand name="SaveProductEntryInfo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
IF(EXISTS(SELECT 1 FROM [IPP3].[dbo].[Product_EntryInfo](NOLOCK)
WHERE [ProductSysNo] = @ProductSysNo))
BEGIN
UPDATE [IPP3].[dbo].[Product_EntryInfo]
           SET [ProductName_EN] = @ProductNameEN
              ,[Specifications] =@Specifications
              ,[Functions] = @Functions
              ,[Component] = @Component
              ,[Purpose] =@Purpose
              ,[TaxQty] = @TaxQty
              ,[TaxUnit]=@TaxUnit
              ,[ApplyUnit] = @ApplyUnit
              ,[BizType] = @BizType
              ,[ApplyDistrict] = @ApplyDistrict
              ,[Product_SKUNO] = @ProductSKUNO
              ,[Supplies_Serial_No] =@SuppliesSerialNo
              ,[ApplyQty] =@ApplyQty
              ,[SuttleWeight] =@SuttleWeight
              ,[GrossWeight]=@GrossWeight
              ,[Note] =@Note
              ,[Supplies_Serial_No_1] =@SuppliesSerialNo1
              ,[StoreType] = @StoreType
              ,[Remark1] = @Remark1
              ,[Remark2] = @Remark2
              ,[Remark3] =@Remark3
              ,[Remark4] =@Remark4
              ,[ProductOthterName]=@ProductOthterName
              ,[ManufactureDate]=@ManufactureDate
         WHERE ProductSysNo=@ProductSysNo
END
ELSE
BEGIN
SELECT @Origin = PCIEX.Origin FROM IPP3.dbo.Product(NOLOCK) P
INNER JOIN OverseaContentManagement.dbo.ProductCommonInfo(NOLOCK) PCI
ON P.ProductID = PCI.CommonSKUNumber
INNER JOIN OverseaContentManagement.dbo.ProductCommonInfo_Ex(NOLOCK) PCIEX
ON PCI.SysNo = PCIEX.SysNo
WHERE P.SysNo = @ProductSysNo
INSERT INTO [IPP3].[dbo].[Product_EntryInfo]
           ([ProductSysNo]
           ,[ProductName_EN]
           ,[Specifications]
           ,[Functions]
           ,[Component]
           ,[Origin]
           ,[Purpose]
           ,[TaxQty]
           ,[TaxUnit]
           ,[ApplyUnit]
           ,[GrossWeight]
           ,[BizType]
           ,[ApplyDistrict]
           ,[Product_SKUNO]
           ,[Supplies_Serial_No]
           ,[ApplyQty]
           ,[SuttleWeight]
           ,[Note]
           ,[Supplies_Serial_No_1]
           ,[TariffRate]
           ,[TariffCode]
           ,[StoreType]
           ,[EntryCode]
           ,[Remark1]
           ,[Remark2]
           ,[Remark3]
           ,[Remark4]
           ,[ProductOthterName]
           ,[ManufactureDate]
           ,[SourceCompany]
           ,[BMCode]
           ,[UPCCode]
           ,[DefaultLeadTimeDays]
           ,[RealLeadTimeDays]
           ,[EntryStatus])
     VALUES
           (@ProductSysNo
           ,@ProductNameEN
           ,@Specifications
           ,@Functions
           ,@Component
           ,@Origin
           ,@Purpose
           ,@TaxQty
           ,@TaxUnit
           ,@ApplyUnit
           ,@GrossWeight
           ,@BizType
           ,@ApplyDistrict
           ,@ProductSKUNO
           ,@SuppliesSerialNo
           ,@ApplyQty
           ,@SuttleWeight
           ,@Note
           ,@SuppliesSerialNo1           
           ,NULL
           ,NULL
           ,@StoreType
           ,NULL           
           ,@Remark1
           ,@Remark2
           ,@Remark3
           ,@Remark4
           ,@ProductOthterName
           ,@ManufactureDate
           ,0
           ,NULL
           ,NULL
           ,0
           ,NULL
           ,0)
END
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32"/>
      <param name="@ProductNameEN" dbType="String" />
      <param name="@Specifications" dbType="String" />
      <param name="@Functions" dbType="String" />
      <param name="@Component" dbType="String" />
      <param name="@Origin" dbType="String" />
      <param name="@Purpose" dbType="String" />
      <param name="@TaxQty" dbType="Decimal" />
      <param name="@TaxUnit" dbType="String" />
      <param name="@ApplyUnit" dbType="String" />
      <param name="@GrossWeight" dbType="Decimal" />
      <param name="@BizType" dbType="Int32" />
      <param name="@ApplyDistrict" dbType="Int32" />
      <param name="@ProductSKUNO" dbType="String" />
      <param name="@SuppliesSerialNo" dbType="String" />
      <param name="@ApplyQty" dbType="Int32" />
      <param name="@SuttleWeight" dbType="Decimal" />
      <param name="@Note" dbType="String" />
      <param name="@SuppliesSerialNo1" dbType="String" />
      <param name="@StoreType" dbType="Int32"/>
      <param name="@Remark1" dbType="String" />
      <param name="@Remark2" dbType="String" />
      <param name="@Remark3" dbType="String" />
      <param name="@Remark4" dbType="String" />
      <param name="@ProductOthterName" dbType="String" />
      <param name="@ManufactureDate" dbType="String" />
    </parameters>
  </dataCommand>
  <!--保存商品图片信息-->
  <dataCommand name="SaveProductImageInfo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
DECLARE @ProductGroupImageSysNo INT, @Priority INT = 0;
DECLARE @ProductGroupSysNo INT = 0, @ProductCommonInfoSysNo INT;

SELECT @ProductGroupSysNo = ProductGroupSysno, @ProductCommonInfoSysNo = PC.SysNo
FROM [OverseaContentManagement].[dbo].[ProductCommonInfo](NOLOCK) PC
INNER JOIN IPP3.dbo.Product(NOLOCK) P 
ON PC.CommonSKUNumber = P.ProductID
WHERE P.SysNo = @ProductSysNo          
            
SELECT @Priority = ISNULL(MAX([Priority]), 0) + 10 
FROM [OverseaContentManagement].[dbo].[ProductGroupInfo_Image](NOLOCK) 
Where ProductGroupSysNo = @ProductGroupSysNo AND [Type]= 'I'
        
INSERT INTO [OverseaContentManagement].[dbo].[ProductGroupInfo_Image]
         ([ResourceUrl]
         ,[Type]
	     ,[ProductGroupSysNo]
	     ,[Priority]
	     ,[InUser]
	     ,[InDate]
		 ,[LanguageCode]
		 ,[CompanyCode])
   VALUES
         (@ResourceUrl
         ,N'I'
	     ,@ProductGroupSysNo
	     ,@Priority
	     ,@InUserName
	     ,GETDATE()
	     ,@LanguageCode
	     ,@CompanyCode)
SELECT @ProductGroupImageSysNo = SCOPE_IDENTITY();
           
INSERT INTO [OverseaContentManagement].[dbo].[ProductCommonInfo_Image]
         ([ProductGroupImageSysNo]
         ,[ProductCommonInfoSysNo]
         ,[InUser]
	     ,[InDate]
	     ,[LanguageCode]
	     ,[CompanyCode])
   VALUES
         (@ProductGroupImageSysNo
         ,@ProductCommonInfoSysNo
	     ,@InUserName
	     ,GETDATE()
	     ,@LanguageCode
	     ,@CompanyCode)
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32"/>
      <param name="@ResourceUrl" dbType="String" />
      <param name="@InUserName" dbType="String" />
      <param name="@CompanyCode" dbType="String" />
      <param name="@LanguageCode" dbType="String" />
    </parameters>
  </dataCommand>
  <!--根据商品组编号查询商品图片列表-->
  <dataCommand name="GetProductImageListByProductGroupSysNo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
SELECT PGroupImg.SysNo, P.SysNo AS ProductSysNo, PGroupImg.[Priority], PGroupImg.ResourceUrl,
PCII.InDate, P.DefaultImage
FROM [OverseaContentManagement].[dbo].[ProductCommonInfo_Image](NOLOCK) PCII
	INNER JOIN OverseaContentManagement.dbo.ProductGroupInfo_Image(NOLOCK) PGroupImg
	ON PCII.ProductGroupImageSysNo = PGroupImg.SysNo
	INNER JOIN OverseaContentManagement.dbo.ProductCommonInfo(NOLOCK) PCI
	ON PCII.ProductCommonInfoSysNo = PCI.SysNo
	INNER JOIN IPP3.dbo.Product(NOLOCK) P
	ON PCI.CommonSKUNumber = P.ProductID
WHERE PCI.ProductGroupSysno = @ProductGroupSysNo
ORDER BY P.SysNo, PGroupImg.[Priority]
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductGroupSysNo" dbType="Int32"/>
    </parameters>
  </dataCommand>
  <!--更新商品图片优先级-->
  <dataCommand name="UpdateProductImagePriority" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE [OverseaContentManagement].[dbo].[ProductGroupInfo_Image]
	SET [Priority] = @Priority
WHERE SysNo = @SysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32"/>
      <param name="@Priority" dbType="Int32"/>
    </parameters>
  </dataCommand>
  <!--删除指定商品图片-->
  <dataCommand name="DeleteProductImageBySysNo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
DELETE FROM [OverseaContentManagement].[dbo].[ProductCommonInfo_Image]
	WHERE [ProductGroupImageSysNo] = @SysNo

DELETE FROM [OverseaContentManagement].[dbo].[ProductGroupInfo_Image]
	WHERE [SysNo] = @SysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32"/>
    </parameters>
  </dataCommand>
  <!--设置商品默认图片-->
  <dataCommand name="SetProductDefaultImage" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE IPP3.dbo.Product
	SET DefaultImage = 
	(SELECT TOP 1 ResourceUrl FROM [OverseaContentManagement].[dbo].[ProductGroupInfo_Image](NOLOCK)
	WHERE SysNo = @SysNo)
WHERE SysNo = @ProductSysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32"/>
      <param name="@ProductSysNo" dbType="Int32"/>
    </parameters>
  </dataCommand>
  <!--获取商家前台类别-->
  <dataCommand name="GetFrontProductCategory" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
      SELECT [SysNo]
      ,[CategoryCode]
      ,[CategoryName]
      ,[ParentCategoryCode]
      ,[IsLeaf]
      ,[Priority]
      ,[Status]
      ,[FPCLinkUrlMode]
      ,[FPCLinkUrl]
      ,[SellerSysNo]
  FROM [ECStore].[dbo].[FrontProductCategory] WITH(NOLOCK)
        WHERE SellerSysNo = @SellerSysNo
        ORDER BY [Priority] DESC
      ]]>
    </commandText>
    <parameters>
      <param name="@SellerSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>  
  <!--查询商品备案信息-->
  <dataCommand name="QueryProductEntryInfo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
SELECT @TotalCount = COUNT(1) 
  FROM [IPP3].[dbo].[Product](NOLOCK) P
  LEFT JOIN [OverseaContentManagement].[dbo].[ProductCommonInfo](NOLOCK) PCI
  ON P.ProductID = PCI.CommonSKUNumber
  LEFT JOIN [OverseaContentManagement].[dbo].[ProductCommonInfo_Ex](NOLOCK) PCIEx 
  ON PCI.SysNo = PCIEx.SysNo
  LEFT JOIN [IPP3].[dbo].[Product_EntryInfo](NOLOCK) PEI
  ON PEI.ProductSysNo = P.SysNo
  LEFT JOIN [IPP3].[dbo].[Product_Ex](NOLOCK) PEX
  ON PEI.ProductSysNo = PEX.SysNo
  LEFT JOIN OverseaContentManagement.dbo.Brand(NOLOCK) Brand
  ON P.BrandSysNo = Brand.SysNo
  LEFT JOIN [IPP3].[dbo].[Country](NOLOCK) Country
  ON PCIEx.Origin = Country.CountryCode
  LEFT JOIN [OverseaContentManagement].[dbo].[ProductGroupInfo](NOLOCK) GroupInfo
  ON PCI.ProductGroupSysno = GroupInfo.SysNo
	        #StrWhere# 

      SELECT *
      FROM(
	      SELECT TOP (@EndNumber)
		  ISNULL(PEI.[SysNo], 0) [SysNo]
      ,P.SysNo AS [ProductSysNo]
      ,[ProductName_EN] AS ProductNameEN
      ,[Specifications]
      ,[Functions]
      ,[Component]
      ,PCIEx.[Origin]
      ,[Purpose]
      ,[TaxQty]
      ,[TaxUnit]
      ,[ApplyUnit]
      ,[GrossWeight]
      ,[BizType]
      ,[ApplyDistrict]
      ,[Product_SKUNO] AS ProductSKUNO
      ,[Supplies_Serial_No] AS SuppliesSerialNo
      ,[ApplyQty]
      ,[SuttleWeight]
      ,PEI.[Note]
      ,[Supplies_Serial_No_1] AS SuppliesSerialNo1
      ,[TariffRate]
      ,[TariffCode]
      ,[StoreType]
      ,[EntryCode]
      ,[Remark1]
      ,[Remark2]
      ,[Remark3]
      ,[Remark4]
      ,[ProductOthterName]
      ,[ManufactureDate]
      ,[SourceCompany]
      ,PEI.[BMCode]
      ,PEI.[UPCCode]
      ,[DefaultLeadTimeDays]
      ,[RealLeadTimeDays]
      ,ISNULL([EntryStatus], 0) AS [EntryStatus]
      ,P.ProductID
      ,P.BrandSysNo
      ,ISNULL(Brand.BrandName_Ch, Brand.BrandName_En) AS BrandName
      ,P.ProductName
      ,P.ProductTitle
      ,Country.CountryName
      ,GroupInfo.SysNo AS ProductGroupSysNo
	  ,(ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
  FROM [IPP3].[dbo].[Product](NOLOCK) P
  LEFT JOIN [OverseaContentManagement].[dbo].[ProductCommonInfo](NOLOCK) PCI
  ON P.ProductID = PCI.CommonSKUNumber
  LEFT JOIN [OverseaContentManagement].[dbo].[ProductCommonInfo_Ex](NOLOCK) PCIEx 
  ON PCI.SysNo = PCIEx.SysNo
  LEFT JOIN [IPP3].[dbo].[Product_EntryInfo](NOLOCK) PEI
  ON PEI.ProductSysNo = P.SysNo
  LEFT JOIN [IPP3].[dbo].[Product_Ex](NOLOCK) PEX
  ON PEI.ProductSysNo = PEX.SysNo
  LEFT JOIN OverseaContentManagement.dbo.Brand(NOLOCK) Brand
  ON P.BrandSysNo = Brand.SysNo
  LEFT JOIN [IPP3].[dbo].[Country](NOLOCK) Country
  ON PCIEx.Origin = Country.CountryCode
  LEFT JOIN [OverseaContentManagement].[dbo].[ProductGroupInfo](NOLOCK) GroupInfo
  ON PCI.ProductGroupSysno = GroupInfo.SysNo
	        #StrWhere# 
      ) PagingTable
      WHERE RowNumber > @StartNumber
        ]]>
    </commandText>
    <parameters>
    </parameters>
  </dataCommand>
  <!--提交备案申请-->
  <dataCommand name="SubmitProductEntryAudit" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE IPP3.dbo.Product_EntryInfo
SET EntryStatus = 1
WHERE ProductSysNo = @ProductSysNo
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32"/>
    </parameters>
  </dataCommand>
  <!--修改前台类别-->
  <dataCommand name="UpdateFrontProductCategory" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
  DECLARE @ParentCategoryCode CHAR(20)
  DECLARE @ParentStatus INT
  SELECT @SysNo=[SysNo],@ParentCategoryCode=[ParentCategoryCode] FROM [ECStore].[dbo].[FrontProductCategory] WITH(NOLOCK)
  WHERE CategoryCode=@CategoryCode AND [SellerSysNo]=@SellerSysNo
  
  IF @ParentCategoryCode IS NOT NULL
  BEGIN
	SELECT @ParentStatus=[Status] FROM [ECStore].[dbo].[FrontProductCategory] WITH(NOLOCK)
	WHERE CategoryCode=@ParentCategoryCode AND [SellerSysNo]=@SellerSysNo
	IF @ParentStatus=0
	BEGIN
		SET @Status=0
	END
  END
  
  SET @StatusOutput=@Status
  
  IF @SysNo>0
  BEGIN
    UPDATE [ECStore].[dbo].[FrontProductCategory]
    SET 
    [CategoryName]=@CategoryName
    ,[UIModeType]=@UIModeType
    ,[FPCLinkUrlMode]=@FPCLinkUrlMode
    ,[FPCLinkUrl]=@FPCLinkUrl
    ,[Priority]=@Priority
    ,[Status]=@Status
    ,[EditUserSysNo]=@EditUserSysNo
    ,[EditUserName]=@EditUserName
    ,[EditDate]=GETDATE()
    WHERE SysNo=@SysNo AND [SellerSysNo]=@SellerSysNo
  END
  IF @Status=0
  BEGIN
	IF EXISTS(SELECT 1 FROM [ECStore].[dbo].[FrontProductCategory] WITH(NOLOCK) WHERE LEFT(ParentCategoryCode, LEN(RTRIM(@CategoryCode)))=@CategoryCode AND [SellerSysNo]=@SellerSysNo)
	BEGIN
		UPDATE [ECStore].[dbo].[FrontProductCategory] SET [Status]=@Status WHERE LEFT(ParentCategoryCode, LEN(RTRIM(@CategoryCode)))=@CategoryCode AND [SellerSysNo]=@SellerSysNo
	END
  END
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" direction="Output" />
      <param name="@CategoryCode" dbType="AnsiStringFixedLength" size="20" />
      <param name="@CategoryName" dbType="String" />
      <param name="@UIModeType" dbType="Int32" />
      <param name="@FPCLinkUrlMode" dbType="Int32" />
      <param name="@FPCLinkUrl" dbType="String" />
      <param name="@Priority" dbType="Int32" />
      <param name="@Status" dbType="Int32"/>
      <param name="@StatusOutput" dbType="Int32" direction="Output"/>
      <param name="@EditUserSysNo" dbType="Int32" />
      <param name="@EditUserName" dbType="AnsiStringFixedLength" />
      <param name="@SellerSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--新增前台类别-->
  <dataCommand name="InsertFrontProductCategory" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
 DECLARE @ParentStatus INT
 DECLARE @ParentSysNo INT
 SELECT @ParentSysNo=SysNo,@ParentStatus=[Status] FROM [ECStore].[dbo].[FrontProductCategory] WITH(NOLOCK)
 WHERE [CategoryCode]=@ParentCategoryCode
 IF @ParentSysNo>0 AND @ParentStatus=1
 BEGIN
  UPDATE [ECStore].[dbo].[FrontProductCategory] SET IsLeaf=0 WHERE SysNo=@ParentSysNo
	SELECT @CategoryCode=MAX(CONVERT(CHAR(20),RIGHT(RTRIM(CONVERT(VARCHAR(20),[CategoryCode])),4)))+1 FROM [ECStore].[dbo].[FrontProductCategory] WITH(NOLOCK)
  WHERE [ParentCategoryCode]=@ParentCategoryCode
  IF @CategoryCode IS NULL
  BEGIN
  SET @CategoryCode=CONVERT(CHAR(20),(RTRIM(CONVERT(VARCHAR(20),@ParentCategoryCode))+'0001'))
  END
  ELSE
  BEGIN
	  DECLARE @TEMPCHAR VARCHAR(3)
	  IF @CategoryCode<10
	  BEGIN
	  SET @TEMPCHAR='000'
	  END
	  IF  @CategoryCode>=10 AND @CategoryCode<100
	  BEGIN
	  SET @TEMPCHAR='00'
	  END
	  IF  @CategoryCode>=100 AND @CategoryCode<1000
	  BEGIN
	  SET @TEMPCHAR='0'
	  END
	  IF  @CategoryCode>=1000 AND @CategoryCode<10000
	  BEGIN
	  SET @TEMPCHAR=''
	  END
	  
	  SET @CategoryCode=CONVERT(CHAR(20),RTRIM(CONVERT(VARCHAR(20),@ParentCategoryCode))+CONVERT(VARCHAR(4),@TEMPCHAR+CONVERT(VARCHAR(4),@CategoryCode)))
  END
    
  INSERT INTO [ECStore].[dbo].[FrontProductCategory]
  (
  [CategoryCode],
  [CategoryName],
  [ParentCategoryCode],
  [IsLeaf],
  [Priority],
  [Status],
  [FPCLinkUrlMode],
  [FPCLinkUrl],
  [UIModeType],
  [SellerSysNo],
  [InUserSysNo],
  [InUserName],
  [InDate]
  )
  VALUES
  (
  @CategoryCode,
  @CategoryName,
  @ParentCategoryCode,
  @IsLeaf,
  @Priority,
  @Status,
  @FPCLinkUrlMode,
  @FPCLinkUrl,
  @UIModeType,
  @SellerSysNo,
  @InUserSysNo,
  @InUserName,
  GETDATE()
  )
  SELECT @SysNo = SCOPE_IDENTITY();
 END
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" direction="Output" />
      <param name="@CategoryCode" dbType="AnsiStringFixedLength" direction="Output" size="20" />
      <param name="@ParentCategoryCode" dbType="AnsiStringFixedLength" />
      <param name="@CategoryName" dbType="String" />
      <param name="@IsLeaf" dbType="Int32" />
      <param name="@Priority" dbType="Int32" />
      <param name="@Status" dbType="Int32" />
      <param name="@FPCLinkUrlMode" dbType="Int32" />
      <param name="@FPCLinkUrl" dbType="String" />
      <param name="@UIModeType" dbType="Int32" />
      <param name="@SellerSysNo" dbType="Int32" />
      <param name="@InUserSysNo" dbType="Int32" />
      <param name="@InUserName" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>
  <!--新增类别ROOT节点-->
  <dataCommand name="InsertFrontProductCategoryRoot" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
  SELECT @CategoryCode=(MAX([CategoryCode])+1) FROM [ECStore].[dbo].[FrontProductCategory] WITH(NOLOCK)
  WHERE [ParentCategoryCode] IS NULL OR [ParentCategoryCode]=''
  IF (@CategoryCode IS NULL) OR (@CategoryCode='')
  BEGIN
  SET @CategoryCode='1001'
  END
  
  INSERT INTO [ECStore].[dbo].[FrontProductCategory]
  (
  [CategoryCode],
  [CategoryName],
  [IsLeaf],
  [Priority],
  [Status],
  [FPCLinkUrlMode],
  [FPCLinkUrl],
  [UIModeType],
  [SellerSysNo],
  [InUserSysNo],
  [InUserName],
  [InDate]
  )
  VALUES
  (
  @CategoryCode,
  @CategoryName,
  @IsLeaf,
  @Priority,
  @Status,
  @FPCLinkUrlMode,
  @FPCLinkUrl,
  @UIModeType,
  @SellerSysNo,
  @InUserSysNo,
  @InUserName,
  GETDATE()
  )
  SELECT @SysNo = SCOPE_IDENTITY();
      ]]>
    </commandText>
    <parameters>
      <param name="@SysNo" dbType="Int32" direction="Output" />
      <param name="@CategoryCode" dbType="AnsiStringFixedLength" direction="Output" size="20" />
      <param name="@CategoryName" dbType="String" />
      <param name="@IsLeaf" dbType="Int32" />
      <param name="@Priority" dbType="Int32" />
      <param name="@Status" dbType="Int32" />
      <param name="@FPCLinkUrlMode" dbType="Int32" />
      <param name="@FPCLinkUrl" dbType="String" />
      <param name="@UIModeType" dbType="Int32" />
      <param name="@SellerSysNo" dbType="Int32" />
      <param name="@InUserSysNo" dbType="Int32" />
      <param name="@InUserName" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>
  <!--根据商品编号获取商品上下架信息-->
  <dataCommand name="GetProductOnSaleInfoByProductSysNo" database="Write"  commandType="Text">
    <commandText>
      <![CDATA[
SELECT P.SysNo AS ProductSysNo,
	P.DefaultImage,
	P.BrandSysNo,
	B.[Status] AS BrandStatus,
	P.C3SysNo,
	C.[Status] AS CategoryStatus,
	P.ProductTitle,
	P.ProductDesc,
	P.ProductDescLong,
	PP.BasicPrice,
	PP.CurrentPrice,
	P.[Weight],
	P.Performance,
	PEI.EntryStatus,
	PEI.TariffCode,
	PEI.TariffRate,
	PEI.EntryCode,
	PEI.BizType,
	PEI.Product_SKUNO AS ProductSKUNO,
	PEI.Supplies_Serial_No AS SuppliesSerialNo,
	PEI.ApplyUnit,
	PEI.ApplyQty,
	PEI.GrossWeight,
	PEI.SuttleWeight,
	PEX.ProductTradeType,
	P.MerchantSysNo,
  P.[Status]
FROM IPP3.dbo.Product(NOLOCK) P
LEFT JOIN OverseaContentManagement.dbo.Brand(NOLOCK) B
	ON P.BrandSysNo = B.SysNo
LEFT JOIN IPP3.dbo.Category3(NOLOCK) C
	ON P.C3SysNo = C.SysNo
LEFT JOIN IPP3.dbo.Product_Price(NOLOCK) PP
	ON P.SysNo = PP.ProductSysNo	
LEFT JOIN IPP3.dbo.Product_EntryInfo(NOLOCK) PEI
	ON P.SysNo = PEI.ProductSysNo
LEFT JOIN IPP3.dbo.Product_Ex(NOLOCK) PEX
	ON P.SysNo = PEX.SysNo
WHERE P.SysNo = @ProductSysNo
         ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--判断商品在赠品活动中是否作为赠品存在，但是要排除已“作废”和“完成”两种状态的记录的赠品活动-->
  <dataCommand name="SaleGiftProductIsGift" database="Write"  commandType="Text">
    <commandText>
      <![CDATA[
        SELECT 
            COUNT(1) 
        FROM [OverseaEcommerceManagement].[dbo].[Gift_GiftRules] A WITH(NOLOCK) 
        INNER JOIN [OverseaEcommerceManagement].[dbo].[Gift] B WITH(NOLOCK) 
            ON A.PromotionSysNo=B.SysNo 
        WHERE 
            A.ProductSysNo=@ProductSysNo 
            AND B.Status NOT IN('F','D','S')  
         ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--更新商品状态-->
  <dataCommand name="UpdateProductStatus" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
      UPDATE IPP3.dbo.Product 
        SET Status = @ProductStatus
      WHERE SysNo = @ProductSysNo
      
      IF(@ProductStatus = 1)
      BEGIN
        DECLARE @FirstOnlineTime datetime
        SELECT @FirstOnlineTime = ISNULL(FirstOnlineTime, GETDATE()) 
        FROM IPP3.dbo.Product_Status WITH(NOLOCK) 
        WHERE ProductSysNo = @ProductSysNo

        UPDATE IPP3.dbo.Product_Status 
        SET FirstOnlineTime = @FirstOnlineTime
           ,LastOnlineTime=GETDATE() 
        WHERE ProductSysNo = @ProductSysNo
      END
      ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@ProductStatus" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--获取商品ID前缀-->
  <dataCommand name="GetProductIDPreCode" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
DECLARE @C3Code NVARCHAR(10), @BrandCode NVARCHAR(10), @SelerCode NVARCHAR(10);
SELECT @C3Code = ISNULL(C3Code, '') FROM IPP3.dbo.Category3(NOLOCK)
	WHERE SysNo = @C3SysNo
SELECT @BrandCode = ISNULL(BrandCode, '') FROM OverseaContentManagement.dbo.Brand(NOLOCK)
	WHERE SysNo = @BrandSysNo
SELECT @SelerCode = ISNULL(SellerID, '') FROM IPP3.dbo.Vendor(NOLOCK)
	WHERE SysNo = @SellerSysNo
	
SELECT (RTRIM(@SelerCode) + RTRIM(@CountryCode) + RTRIM(@C3Code) + RTRIM(@BrandCode)) AS PreCode
      ]]>
    </commandText>
    <parameters>
      <param name="@C3SysNo" dbType="Int32" />
      <param name="@BrandSysNo" dbType="Int32" />
      <param name="@SellerSysNo" dbType="Int32" />
      <param name="@CountryCode" dbType="String" />
    </parameters>
  </dataCommand>

  <!--获取商品销售区域-->
  <dataCommand name="GetProductSalesAreaInfoBySysNo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
  SELECT @TotalCount = COUNT(1) 
  FROM OverseaContentManagement.dbo.ProductRestrictedArea AS pra  WITH(NOLOCK) 
  #StrWhere# AND Status='A'
  
  SELECT * FROM (
                SELECT TOP (@EndNumber) (ROW_NUMBER() OVER(ORDER BY #SortColumnName#)) AS RowNumber
                 ,pra.SysNo 
                 ,pra.StockSysNo AS [Stock.SysNo]
                 ,pra.StockName AS [Stock.StockName]
                 ,pra.ProvinceSysNo AS [Province.ProvinceSysNo]
                 ,pra.ProvinceName AS [Province.ProvinceName]
                 ,pra.CitySysNo AS [Province.CitySysNo]
                 ,pra.CityName AS [Province.CityName]
              FROM OverseaContentManagement.dbo.ProductRestrictedArea AS pra WITH(NOLOCK) 
             #StrWhere# AND Status='A'
             ) T WHERE RowNumber > @StartNumber
	  ]]>
    </commandText>
    <parameters>
    </parameters>
  </dataCommand>
  <!--更新商品销售区域-->
  <dataCommand name="InsertProductSalesArea" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
    INSERT INTO [OverseaContentManagement].[dbo].[ProductRestrictedArea] 
( 
     [ProductSysNo] 
    ,[ProductID] 
    ,[ProductName] 
    ,[StockSysNo] 
    ,[StockName] 
    ,[ProvinceSysNo] 
    ,[ProvinceName] 
    ,[CitySysNo]
    ,[CityName]
    ,[InDate] 
    ,[InUser] 
    ,[EditDate] 
    ,[EditUser] 
    ,[CompanyCode] 
    ,[CountryCode] 
    ,[LanguageCode] 
    ,[Status] 
    ,[StoreCompanyCode] 
) 
VALUES
( 
     @ProductSysNo 
    ,@ProductID 
    ,@ProductName 
    ,@StockSysNo 
    ,@StockName 
    ,@ProvinceSysNo 
    ,@ProvinceName 
    ,@CitySysNo 
    ,@CityName 
    ,GETDATE()
    ,@InUser
    ,GETDATE()
    ,@InUser
    ,@CompanyCode 
    ,NULL 
    ,@LanguageCode
    ,'A'
    ,@CompanyCode)
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@ProductID" dbType="String" />
      <param name="@ProductName" dbType="String" />
      <param name="@StockSysNo" dbType="Int32" />
      <param name="@StockName" dbType="String" />
      <param name="@CitySysNo" dbType="Int32" />
      <param name="@CityName" dbType="String" />
      <param name="@ProvinceSysNo" dbType="Int32" />
      <param name="@ProvinceName" dbType="String" />
      <param name="@InUser" dbType="String" />
      <param name="@CompanyCode" dbType="AnsiStringFixedLength" />
      <param name="@LanguageCode" dbType="AnsiStringFixedLength" />
    </parameters>
  </dataCommand>
  <!--根据SysNo获取商品[ProductID]和[ProductTitle]-->
  <dataCommand name="GetProductTitleInfo" database="Write"  commandType="Text">
    <commandText>
      <![CDATA[
        SELECT TOP(1)
	     P.[SysNo]
      ,P.[ProductID]
      ,P.[ProductTitle]
  FROM [IPP3].[dbo].[Product] AS P WITH(NOLOCK)
WHERE P.SysNo = @ProductSysNo
         ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--根据SysNo删除商品销售区域-->
  <dataCommand name="DeleteProductSalesArea" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
    DELETE 
FROM [OverseaContentManagement].[dbo].[ProductRestrictedArea] 
WHERE 
    ProductSysNo=@ProductSysNo
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>

  <!--根据商品SysNo获取商品批号-->
  <dataCommand name="GetProductBatchManagementInfo" database="Write" commandType="Text">
    <!--定义SQL语句-->
    <commandText>
      <![CDATA[
SELECT
  batch.SysNo,
	case ex.IsBatch when 'Y' then 1
	else 0 end as IsBatch,
	batch.ProductSysNo,
	case batch.CollectType when 'E' then 0
	else 1 end as CollectType,
  case batch.IsCollectBatchNo when 'Y' then 1
	else 0 end as IsCollectBatchNo,
	batch.MinReceiptDays,
	batch.MaxDeliveryDays,
	batch.GuaranteePeriodYear,
	batch.GuaranteePeriodMonth,
	batch.GuaranteePeriodDay,
	batch.InDate,
	batch.InUser as EidtUser,
	batch.CompanyCode,
	batch.LanguageCode,
	batch.StoreCompanyCode
FROM IPP3.dbo.Product_Ex ex WITH(NOLOCK)
INNER JOIN OverseaContentManagement.dbo.Product_BatchManagementInfo batch WITH(NOLOCK)
ON ex.SysNo = batch.ProductSysNo
WHERE batch.ProductSysNo=@ProductSysNo
	  ]]>
    </commandText>
    <parameters>
      <param name="@ProductSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
  <!--更新商品批号-->
  <dataCommand name="UpdateProductBatchManagementInfo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
BEGIN TRY
	BEGIN TRAN
	UPDATE IPP3.dbo.Product_Ex SET 
		IsBatch=@IsBatch
	WHERE SysNo = @ProductSysNo
  
  IF @IsBatch='Y'
  BEGIN
	  IF EXISTS(
		  SELECT TOP 1 SysNo 
		  FROM OverseaContentManagement.dbo.Product_BatchManagementInfo
		  WHERE ProductSysNo = @ProductSysNo)
	  BEGIN
		  UPDATE OverseaContentManagement.dbo.Product_BatchManagementInfo SET
			  CollectType=@CollectType,
			  IsCollectBatchNo=@IsCollectBatchNo,
			  MinReceiptDays=@MinReceiptDays,
			  MaxDeliveryDays=@MaxDeliveryDays,
			  GuaranteePeriodYear=@GuaranteePeriodYear,
			  GuaranteePeriodMonth=@GuaranteePeriodMonth,
			  GuaranteePeriodDay=@GuaranteePeriodDay,
			  EditDate=GETDATE(),
			  EditUser=@EidtUser
		  WHERE ProductSysNo=@ProductSysNo
	  END
	  ELSE BEGIN
		  INSERT INTO OverseaContentManagement.dbo.Product_BatchManagementInfo
		  (
			  ProductSysNo,
			  CollectType,
			  IsCollectBatchNo,
			  MinReceiptDays,
			  MaxDeliveryDays,
			  GuaranteePeriodYear,
			  GuaranteePeriodMonth,
			  GuaranteePeriodDay,     
			  InDate,
			  InUser,      
			  CompanyCode,
			  LanguageCode,
			  StoreCompanyCode
			  )
		  VALUES(
			  @ProductSysNo,
			  @CollectType,
			  @IsCollectBatchNo,
			  @MinReceiptDays,
			  @MaxDeliveryDays,
			  @GuaranteePeriodYear,
			  @GuaranteePeriodMonth,
			  @GuaranteePeriodDay,      
			  GETDATE(),
			  @EidtUser,
			  '8601',
			  'zh-CN',
			  '8601'
		  )
	  END		
  END
	COMMIT TRAN
END TRY
BEGIN CATCH
    ROLLBACK TRAN
    DECLARE @ErrorMessage NVARCHAR(MAX)
    DECLARE @ErrorSeverity INT
    DECLARE @ErrorState INT
    SELECT
	     @ErrorMessage = ERROR_MESSAGE()
	    ,@ErrorSeverity = ERROR_SEVERITY()
	    ,@ErrorState = ERROR_STATE()
    RAISERROR (@ErrorMessage, @ErrorSeverity, @ErrorState)
END CATCH
	  ]]>
    </commandText>
    <parameters>
      <param name="@IsBatch" dbType="AnsiStringFixedLength" size="1" />
      <param name="@ProductSysNo" dbType="Int32" />
      <param name="@CollectType" dbType="AnsiStringFixedLength" size="1" />
      <param name="@IsCollectBatchNo" dbType="AnsiStringFixedLength" size="1" />
      <param name="@MinReceiptDays" dbType="Int32" />
      <param name="@MaxDeliveryDays" dbType="Int32" />
      <param name="@GuaranteePeriodYear" dbType="Int32" />
      <param name="@GuaranteePeriodMonth" dbType="Int32" />
      <param name="@GuaranteePeriodDay" dbType="Int32" />
      <param name="@EidtUser" dbType="String" />
    </parameters>
  </dataCommand>
  <!--新增历史备注-->
  <dataCommand name="InsertProductBatchManagementLog" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
INSERT INTO [OverseaContentManagement].[dbo].[Product_BatchManagementInfo_log]
           (
           [BatchManagementSysNo]
           ,[Note]
           ,[InDate]
           ,[InUser]
           )
     VALUES
           (
           @BatchManagementSysNo
           ,@Note
           ,GETDATE()
           ,@InUser
           )
      	]]>
    </commandText>
    <parameters>
      <param name="@BatchManagementSysNo" dbType="Int32" />
      <param name="@Note" dbType="String" size="10000" />
      <param name="@InUser" dbType="String" />
    </parameters>
  </dataCommand>
  <!--根据商品批号编号获得历史备注-->
  <dataCommand name="GetProductBatchManagementLogByBatchManagementSysNo" database="Write" commandType="Text">
    <commandText>
      <![CDATA[
SELECT 
       [SysNo]
      ,[BatchManagementSysNo]
      ,[Note]
      ,[InDate]
      ,[InUser]
  FROM [OverseaContentManagement].[dbo].[Product_BatchManagementInfo_log]
  WHERE [BatchManagementSysNo]=@BatchManagementSysNo 
  ORDER BY InDate DESC
      	]]>
    </commandText>
    <parameters>
      <param name="@BatchManagementSysNo" dbType="Int32" />
    </parameters>
  </dataCommand>
</dataOperations>


